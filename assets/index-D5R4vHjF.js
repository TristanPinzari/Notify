var FA=i=>{throw TypeError(i)};var yy=(i,t,e)=>t.has(i)||FA("Cannot "+e);var Ce=(i,t,e)=>(yy(i,t,"read from private field"),e?e.call(i):t.get(i)),Ts=(i,t,e)=>t.has(i)?FA("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),ei=(i,t,e,n)=>(yy(i,t,"write to private field"),n?n.call(i,e):t.set(i,e),e),As=(i,t,e)=>(yy(i,t,"access private method"),e);var HA=(i,t,e,n)=>({set _(s){ei(i,t,s,e)},get _(){return Ce(i,t,n)}});(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();function Wx(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var _y={exports:{}},Vu={};var GA;function Kx(){if(GA)return Vu;GA=1;var i=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function e(n,s,r){var a=null;if(r!==void 0&&(a=""+r),s.key!==void 0&&(a=""+s.key),"key"in s){r={};for(var c in s)c!=="key"&&(r[c]=s[c])}else r=s;return s=r.ref,{$$typeof:i,type:n,key:a,ref:s!==void 0?s:null,props:r}}return Vu.Fragment=t,Vu.jsx=e,Vu.jsxs=e,Vu}var qA;function Xx(){return qA||(qA=1,_y.exports=Kx()),_y.exports}var st=Xx(),vy={exports:{}},zt={};var zA;function Jx(){if(zA)return zt;zA=1;var i=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),r=Symbol.for("react.consumer"),a=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),m=Symbol.iterator;function y(z){return z===null||typeof z!="object"?null:(z=m&&z[m]||z["@@iterator"],typeof z=="function"?z:null)}var T={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,b={};function C(z,ot,dt){this.props=z,this.context=ot,this.refs=b,this.updater=dt||T}C.prototype.isReactComponent={},C.prototype.setState=function(z,ot){if(typeof z!="object"&&typeof z!="function"&&z!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,z,ot,"setState")},C.prototype.forceUpdate=function(z){this.updater.enqueueForceUpdate(this,z,"forceUpdate")};function I(){}I.prototype=C.prototype;function D(z,ot,dt){this.props=z,this.context=ot,this.refs=b,this.updater=dt||T}var P=D.prototype=new I;P.constructor=D,S(P,C.prototype),P.isPureReactComponent=!0;var H=Array.isArray,F={H:null,A:null,T:null,S:null,V:null},G=Object.prototype.hasOwnProperty;function N(z,ot,dt,ht,_t,Ot){return dt=Ot.ref,{$$typeof:i,type:z,key:ot,ref:dt!==void 0?dt:null,props:Ot}}function x(z,ot){return N(z.type,ot,void 0,void 0,void 0,z.props)}function k(z){return typeof z=="object"&&z!==null&&z.$$typeof===i}function V(z){var ot={"=":"=0",":":"=2"};return"$"+z.replace(/[=:]/g,function(dt){return ot[dt]})}var U=/\/+/g;function $(z,ot){return typeof z=="object"&&z!==null&&z.key!=null?V(""+z.key):ot.toString(36)}function B(){}function vt(z){switch(z.status){case"fulfilled":return z.value;case"rejected":throw z.reason;default:switch(typeof z.status=="string"?z.then(B,B):(z.status="pending",z.then(function(ot){z.status==="pending"&&(z.status="fulfilled",z.value=ot)},function(ot){z.status==="pending"&&(z.status="rejected",z.reason=ot)})),z.status){case"fulfilled":return z.value;case"rejected":throw z.reason}}throw z}function It(z,ot,dt,ht,_t){var Ot=typeof z;(Ot==="undefined"||Ot==="boolean")&&(z=null);var St=!1;if(z===null)St=!0;else switch(Ot){case"bigint":case"string":case"number":St=!0;break;case"object":switch(z.$$typeof){case i:case t:St=!0;break;case f:return St=z._init,It(St(z._payload),ot,dt,ht,_t)}}if(St)return _t=_t(z),St=ht===""?"."+$(z,0):ht,H(_t)?(dt="",St!=null&&(dt=St.replace(U,"$&/")+"/"),It(_t,ot,dt,"",function(Xe){return Xe})):_t!=null&&(k(_t)&&(_t=x(_t,dt+(_t.key==null||z&&z.key===_t.key?"":(""+_t.key).replace(U,"$&/")+"/")+St)),ot.push(_t)),1;St=0;var $t=ht===""?".":ht+":";if(H(z))for(var Wt=0;Wt<z.length;Wt++)ht=z[Wt],Ot=$t+$(ht,Wt),St+=It(ht,ot,dt,Ot,_t);else if(Wt=y(z),typeof Wt=="function")for(z=Wt.call(z),Wt=0;!(ht=z.next()).done;)ht=ht.value,Ot=$t+$(ht,Wt++),St+=It(ht,ot,dt,Ot,_t);else if(Ot==="object"){if(typeof z.then=="function")return It(vt(z),ot,dt,ht,_t);throw ot=String(z),Error("Objects are not valid as a React child (found: "+(ot==="[object Object]"?"object with keys {"+Object.keys(z).join(", ")+"}":ot)+"). If you meant to render a collection of children, use an array instead.")}return St}function W(z,ot,dt){if(z==null)return z;var ht=[],_t=0;return It(z,ht,"","",function(Ot){return ot.call(dt,Ot,_t++)}),ht}function nt(z){if(z._status===-1){var ot=z._result;ot=ot(),ot.then(function(dt){(z._status===0||z._status===-1)&&(z._status=1,z._result=dt)},function(dt){(z._status===0||z._status===-1)&&(z._status=2,z._result=dt)}),z._status===-1&&(z._status=0,z._result=ot)}if(z._status===1)return z._result.default;throw z._result}var ft=typeof reportError=="function"?reportError:function(z){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ot=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof z=="object"&&z!==null&&typeof z.message=="string"?String(z.message):String(z),error:z});if(!window.dispatchEvent(ot))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",z);return}console.error(z)};function xt(){}return zt.Children={map:W,forEach:function(z,ot,dt){W(z,function(){ot.apply(this,arguments)},dt)},count:function(z){var ot=0;return W(z,function(){ot++}),ot},toArray:function(z){return W(z,function(ot){return ot})||[]},only:function(z){if(!k(z))throw Error("React.Children.only expected to receive a single React element child.");return z}},zt.Component=C,zt.Fragment=e,zt.Profiler=s,zt.PureComponent=D,zt.StrictMode=n,zt.Suspense=u,zt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=F,zt.__COMPILER_RUNTIME={__proto__:null,c:function(z){return F.H.useMemoCache(z)}},zt.cache=function(z){return function(){return z.apply(null,arguments)}},zt.cloneElement=function(z,ot,dt){if(z==null)throw Error("The argument must be a React element, but you passed "+z+".");var ht=S({},z.props),_t=z.key,Ot=void 0;if(ot!=null)for(St in ot.ref!==void 0&&(Ot=void 0),ot.key!==void 0&&(_t=""+ot.key),ot)!G.call(ot,St)||St==="key"||St==="__self"||St==="__source"||St==="ref"&&ot.ref===void 0||(ht[St]=ot[St]);var St=arguments.length-2;if(St===1)ht.children=dt;else if(1<St){for(var $t=Array(St),Wt=0;Wt<St;Wt++)$t[Wt]=arguments[Wt+2];ht.children=$t}return N(z.type,_t,void 0,void 0,Ot,ht)},zt.createContext=function(z){return z={$$typeof:a,_currentValue:z,_currentValue2:z,_threadCount:0,Provider:null,Consumer:null},z.Provider=z,z.Consumer={$$typeof:r,_context:z},z},zt.createElement=function(z,ot,dt){var ht,_t={},Ot=null;if(ot!=null)for(ht in ot.key!==void 0&&(Ot=""+ot.key),ot)G.call(ot,ht)&&ht!=="key"&&ht!=="__self"&&ht!=="__source"&&(_t[ht]=ot[ht]);var St=arguments.length-2;if(St===1)_t.children=dt;else if(1<St){for(var $t=Array(St),Wt=0;Wt<St;Wt++)$t[Wt]=arguments[Wt+2];_t.children=$t}if(z&&z.defaultProps)for(ht in St=z.defaultProps,St)_t[ht]===void 0&&(_t[ht]=St[ht]);return N(z,Ot,void 0,void 0,null,_t)},zt.createRef=function(){return{current:null}},zt.forwardRef=function(z){return{$$typeof:c,render:z}},zt.isValidElement=k,zt.lazy=function(z){return{$$typeof:f,_payload:{_status:-1,_result:z},_init:nt}},zt.memo=function(z,ot){return{$$typeof:h,type:z,compare:ot===void 0?null:ot}},zt.startTransition=function(z){var ot=F.T,dt={};F.T=dt;try{var ht=z(),_t=F.S;_t!==null&&_t(dt,ht),typeof ht=="object"&&ht!==null&&typeof ht.then=="function"&&ht.then(xt,ft)}catch(Ot){ft(Ot)}finally{F.T=ot}},zt.unstable_useCacheRefresh=function(){return F.H.useCacheRefresh()},zt.use=function(z){return F.H.use(z)},zt.useActionState=function(z,ot,dt){return F.H.useActionState(z,ot,dt)},zt.useCallback=function(z,ot){return F.H.useCallback(z,ot)},zt.useContext=function(z){return F.H.useContext(z)},zt.useDebugValue=function(){},zt.useDeferredValue=function(z,ot){return F.H.useDeferredValue(z,ot)},zt.useEffect=function(z,ot,dt){var ht=F.H;if(typeof dt=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ht.useEffect(z,ot)},zt.useId=function(){return F.H.useId()},zt.useImperativeHandle=function(z,ot,dt){return F.H.useImperativeHandle(z,ot,dt)},zt.useInsertionEffect=function(z,ot){return F.H.useInsertionEffect(z,ot)},zt.useLayoutEffect=function(z,ot){return F.H.useLayoutEffect(z,ot)},zt.useMemo=function(z,ot){return F.H.useMemo(z,ot)},zt.useOptimistic=function(z,ot){return F.H.useOptimistic(z,ot)},zt.useReducer=function(z,ot,dt){return F.H.useReducer(z,ot,dt)},zt.useRef=function(z){return F.H.useRef(z)},zt.useState=function(z){return F.H.useState(z)},zt.useSyncExternalStore=function(z,ot,dt){return F.H.useSyncExternalStore(z,ot,dt)},zt.useTransition=function(){return F.H.useTransition()},zt.version="19.1.1",zt}var $A;function nv(){return $A||($A=1,vy.exports=Jx()),vy.exports}var et=nv();const Ma=Wx(et);var Ey={exports:{}},Bu={},Ty={exports:{}},Ay={};var YA;function Qx(){return YA||(YA=1,(function(i){function t(W,nt){var ft=W.length;W.push(nt);t:for(;0<ft;){var xt=ft-1>>>1,z=W[xt];if(0<s(z,nt))W[xt]=nt,W[ft]=z,ft=xt;else break t}}function e(W){return W.length===0?null:W[0]}function n(W){if(W.length===0)return null;var nt=W[0],ft=W.pop();if(ft!==nt){W[0]=ft;t:for(var xt=0,z=W.length,ot=z>>>1;xt<ot;){var dt=2*(xt+1)-1,ht=W[dt],_t=dt+1,Ot=W[_t];if(0>s(ht,ft))_t<z&&0>s(Ot,ht)?(W[xt]=Ot,W[_t]=ft,xt=_t):(W[xt]=ht,W[dt]=ft,xt=dt);else if(_t<z&&0>s(Ot,ft))W[xt]=Ot,W[_t]=ft,xt=_t;else break t}}return nt}function s(W,nt){var ft=W.sortIndex-nt.sortIndex;return ft!==0?ft:W.id-nt.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;i.unstable_now=function(){return r.now()}}else{var a=Date,c=a.now();i.unstable_now=function(){return a.now()-c}}var u=[],h=[],f=1,m=null,y=3,T=!1,S=!1,b=!1,C=!1,I=typeof setTimeout=="function"?setTimeout:null,D=typeof clearTimeout=="function"?clearTimeout:null,P=typeof setImmediate<"u"?setImmediate:null;function H(W){for(var nt=e(h);nt!==null;){if(nt.callback===null)n(h);else if(nt.startTime<=W)n(h),nt.sortIndex=nt.expirationTime,t(u,nt);else break;nt=e(h)}}function F(W){if(b=!1,H(W),!S)if(e(u)!==null)S=!0,G||(G=!0,$());else{var nt=e(h);nt!==null&&It(F,nt.startTime-W)}}var G=!1,N=-1,x=5,k=-1;function V(){return C?!0:!(i.unstable_now()-k<x)}function U(){if(C=!1,G){var W=i.unstable_now();k=W;var nt=!0;try{t:{S=!1,b&&(b=!1,D(N),N=-1),T=!0;var ft=y;try{e:{for(H(W),m=e(u);m!==null&&!(m.expirationTime>W&&V());){var xt=m.callback;if(typeof xt=="function"){m.callback=null,y=m.priorityLevel;var z=xt(m.expirationTime<=W);if(W=i.unstable_now(),typeof z=="function"){m.callback=z,H(W),nt=!0;break e}m===e(u)&&n(u),H(W)}else n(u);m=e(u)}if(m!==null)nt=!0;else{var ot=e(h);ot!==null&&It(F,ot.startTime-W),nt=!1}}break t}finally{m=null,y=ft,T=!1}nt=void 0}}finally{nt?$():G=!1}}}var $;if(typeof P=="function")$=function(){P(U)};else if(typeof MessageChannel<"u"){var B=new MessageChannel,vt=B.port2;B.port1.onmessage=U,$=function(){vt.postMessage(null)}}else $=function(){I(U,0)};function It(W,nt){N=I(function(){W(i.unstable_now())},nt)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(W){W.callback=null},i.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):x=0<W?Math.floor(1e3/W):5},i.unstable_getCurrentPriorityLevel=function(){return y},i.unstable_next=function(W){switch(y){case 1:case 2:case 3:var nt=3;break;default:nt=y}var ft=y;y=nt;try{return W()}finally{y=ft}},i.unstable_requestPaint=function(){C=!0},i.unstable_runWithPriority=function(W,nt){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var ft=y;y=W;try{return nt()}finally{y=ft}},i.unstable_scheduleCallback=function(W,nt,ft){var xt=i.unstable_now();switch(typeof ft=="object"&&ft!==null?(ft=ft.delay,ft=typeof ft=="number"&&0<ft?xt+ft:xt):ft=xt,W){case 1:var z=-1;break;case 2:z=250;break;case 5:z=1073741823;break;case 4:z=1e4;break;default:z=5e3}return z=ft+z,W={id:f++,callback:nt,priorityLevel:W,startTime:ft,expirationTime:z,sortIndex:-1},ft>xt?(W.sortIndex=ft,t(h,W),e(u)===null&&W===e(h)&&(b?(D(N),N=-1):b=!0,It(F,ft-xt))):(W.sortIndex=z,t(u,W),S||T||(S=!0,G||(G=!0,$()))),W},i.unstable_shouldYield=V,i.unstable_wrapCallback=function(W){var nt=y;return function(){var ft=y;y=nt;try{return W.apply(this,arguments)}finally{y=ft}}}})(Ay)),Ay}var WA;function jx(){return WA||(WA=1,Ty.exports=Qx()),Ty.exports}var Sy={exports:{}},Ln={};var KA;function Zx(){if(KA)return Ln;KA=1;var i=nv();function t(u){var h="https://react.dev/errors/"+u;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)h+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+u+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function e(){}var n={d:{f:e,r:function(){throw Error(t(522))},D:e,C:e,L:e,m:e,X:e,S:e,M:e},p:0,findDOMNode:null},s=Symbol.for("react.portal");function r(u,h,f){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:m==null?null:""+m,children:u,containerInfo:h,implementation:f}}var a=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(u,h){if(u==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return Ln.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Ln.createPortal=function(u,h){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(t(299));return r(u,h,null,f)},Ln.flushSync=function(u){var h=a.T,f=n.p;try{if(a.T=null,n.p=2,u)return u()}finally{a.T=h,n.p=f,n.d.f()}},Ln.preconnect=function(u,h){typeof u=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,n.d.C(u,h))},Ln.prefetchDNS=function(u){typeof u=="string"&&n.d.D(u)},Ln.preinit=function(u,h){if(typeof u=="string"&&h&&typeof h.as=="string"){var f=h.as,m=c(f,h.crossOrigin),y=typeof h.integrity=="string"?h.integrity:void 0,T=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;f==="style"?n.d.S(u,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:m,integrity:y,fetchPriority:T}):f==="script"&&n.d.X(u,{crossOrigin:m,integrity:y,fetchPriority:T,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},Ln.preinitModule=function(u,h){if(typeof u=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var f=c(h.as,h.crossOrigin);n.d.M(u,{crossOrigin:f,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&n.d.M(u)},Ln.preload=function(u,h){if(typeof u=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var f=h.as,m=c(f,h.crossOrigin);n.d.L(u,f,{crossOrigin:m,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},Ln.preloadModule=function(u,h){if(typeof u=="string")if(h){var f=c(h.as,h.crossOrigin);n.d.m(u,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:f,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else n.d.m(u)},Ln.requestFormReset=function(u){n.d.r(u)},Ln.unstable_batchedUpdates=function(u,h){return u(h)},Ln.useFormState=function(u,h,f){return a.H.useFormState(u,h,f)},Ln.useFormStatus=function(){return a.H.useHostTransitionStatus()},Ln.version="19.1.1",Ln}var XA;function tD(){if(XA)return Sy.exports;XA=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(t){console.error(t)}}return i(),Sy.exports=Zx(),Sy.exports}var JA;function eD(){if(JA)return Bu;JA=1;var i=jx(),t=nv(),e=tD();function n(o){var l="https://react.dev/errors/"+o;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)l+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+o+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function r(o){var l=o,d=o;if(o.alternate)for(;l.return;)l=l.return;else{o=l;do l=o,(l.flags&4098)!==0&&(d=l.return),o=l.return;while(o)}return l.tag===3?d:null}function a(o){if(o.tag===13){var l=o.memoizedState;if(l===null&&(o=o.alternate,o!==null&&(l=o.memoizedState)),l!==null)return l.dehydrated}return null}function c(o){if(r(o)!==o)throw Error(n(188))}function u(o){var l=o.alternate;if(!l){if(l=r(o),l===null)throw Error(n(188));return l!==o?null:o}for(var d=o,p=l;;){var E=d.return;if(E===null)break;var A=E.alternate;if(A===null){if(p=E.return,p!==null){d=p;continue}break}if(E.child===A.child){for(A=E.child;A;){if(A===d)return c(E),o;if(A===p)return c(E),l;A=A.sibling}throw Error(n(188))}if(d.return!==p.return)d=E,p=A;else{for(var M=!1,L=E.child;L;){if(L===d){M=!0,d=E,p=A;break}if(L===p){M=!0,p=E,d=A;break}L=L.sibling}if(!M){for(L=A.child;L;){if(L===d){M=!0,d=A,p=E;break}if(L===p){M=!0,p=A,d=E;break}L=L.sibling}if(!M)throw Error(n(189))}}if(d.alternate!==p)throw Error(n(190))}if(d.tag!==3)throw Error(n(188));return d.stateNode.current===d?o:l}function h(o){var l=o.tag;if(l===5||l===26||l===27||l===6)return o;for(o=o.child;o!==null;){if(l=h(o),l!==null)return l;o=o.sibling}return null}var f=Object.assign,m=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),T=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),b=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),I=Symbol.for("react.provider"),D=Symbol.for("react.consumer"),P=Symbol.for("react.context"),H=Symbol.for("react.forward_ref"),F=Symbol.for("react.suspense"),G=Symbol.for("react.suspense_list"),N=Symbol.for("react.memo"),x=Symbol.for("react.lazy"),k=Symbol.for("react.activity"),V=Symbol.for("react.memo_cache_sentinel"),U=Symbol.iterator;function $(o){return o===null||typeof o!="object"?null:(o=U&&o[U]||o["@@iterator"],typeof o=="function"?o:null)}var B=Symbol.for("react.client.reference");function vt(o){if(o==null)return null;if(typeof o=="function")return o.$$typeof===B?null:o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case S:return"Fragment";case C:return"Profiler";case b:return"StrictMode";case F:return"Suspense";case G:return"SuspenseList";case k:return"Activity"}if(typeof o=="object")switch(o.$$typeof){case T:return"Portal";case P:return(o.displayName||"Context")+".Provider";case D:return(o._context.displayName||"Context")+".Consumer";case H:var l=o.render;return o=o.displayName,o||(o=l.displayName||l.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case N:return l=o.displayName||null,l!==null?l:vt(o.type)||"Memo";case x:l=o._payload,o=o._init;try{return vt(o(l))}catch{}}return null}var It=Array.isArray,W=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,nt=e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ft={pending:!1,data:null,method:null,action:null},xt=[],z=-1;function ot(o){return{current:o}}function dt(o){0>z||(o.current=xt[z],xt[z]=null,z--)}function ht(o,l){z++,xt[z]=o.current,o.current=l}var _t=ot(null),Ot=ot(null),St=ot(null),$t=ot(null);function Wt(o,l){switch(ht(St,l),ht(Ot,o),ht(_t,null),l.nodeType){case 9:case 11:o=(o=l.documentElement)&&(o=o.namespaceURI)?pA(o):0;break;default:if(o=l.tagName,l=l.namespaceURI)l=pA(l),o=mA(l,o);else switch(o){case"svg":o=1;break;case"math":o=2;break;default:o=0}}dt(_t),ht(_t,o)}function Xe(){dt(_t),dt(Ot),dt(St)}function qs(o){o.memoizedState!==null&&ht($t,o);var l=_t.current,d=mA(l,o.type);l!==d&&(ht(Ot,o),ht(_t,d))}function vi(o){Ot.current===o&&(dt(_t),dt(Ot)),$t.current===o&&(dt($t),Nu._currentValue=ft)}var Ei=Object.prototype.hasOwnProperty,ct=i.unstable_scheduleCallback,mt=i.unstable_cancelCallback,wt=i.unstable_shouldYield,se=i.unstable_requestPaint,Ve=i.unstable_now,Ka=i.unstable_getCurrentPriorityLevel,rn=i.unstable_ImmediatePriority,hn=i.unstable_UserBlockingPriority,zs=i.unstable_NormalPriority,vm=i.unstable_LowPriority,kc=i.unstable_IdlePriority,Em=i.log,Fo=i.unstable_setDisableYieldValue,Rr=null,Dn=null;function Ti(o){if(typeof Em=="function"&&Fo(o),Dn&&typeof Dn.setStrictMode=="function")try{Dn.setStrictMode(Rr,o)}catch{}}var Hn=Math.clz32?Math.clz32:Jh,Tm=Math.log,Xh=Math.LN2;function Jh(o){return o>>>=0,o===0?32:31-(Tm(o)/Xh|0)|0}var as=256,Mr=4194304;function Hi(o){var l=o&42;if(l!==0)return l;switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return o&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return o}}function Ai(o,l,d){var p=o.pendingLanes;if(p===0)return 0;var E=0,A=o.suspendedLanes,M=o.pingedLanes;o=o.warmLanes;var L=p&134217727;return L!==0?(p=L&~A,p!==0?E=Hi(p):(M&=L,M!==0?E=Hi(M):d||(d=L&~o,d!==0&&(E=Hi(d))))):(L=p&~A,L!==0?E=Hi(L):M!==0?E=Hi(M):d||(d=p&~o,d!==0&&(E=Hi(d)))),E===0?0:l!==0&&l!==E&&(l&A)===0&&(A=E&-E,d=l&-l,A>=d||A===32&&(d&4194048)!==0)?l:E}function Pr(o,l){return(o.pendingLanes&~(o.suspendedLanes&~o.pingedLanes)&l)===0}function Xa(o,l){switch(o){case 1:case 2:case 4:case 8:case 64:return l+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Lc(){var o=as;return as<<=1,(as&4194048)===0&&(as=256),o}function xr(){var o=Mr;return Mr<<=1,(Mr&62914560)===0&&(Mr=4194304),o}function Ja(o){for(var l=[],d=0;31>d;d++)l.push(o);return l}function Be(o,l){o.pendingLanes|=l,l!==268435456&&(o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0)}function Qh(o,l,d,p,E,A){var M=o.pendingLanes;o.pendingLanes=d,o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0,o.expiredLanes&=d,o.entangledLanes&=d,o.errorRecoveryDisabledLanes&=d,o.shellSuspendCounter=0;var L=o.entanglements,q=o.expirationTimes,Q=o.hiddenUpdates;for(d=M&~d;0<d;){var it=31-Hn(d),at=1<<it;L[it]=0,q[it]=-1;var j=Q[it];if(j!==null)for(Q[it]=null,it=0;it<j.length;it++){var Z=j[it];Z!==null&&(Z.lane&=-536870913)}d&=~at}p!==0&&Dr(o,p,0),A!==0&&E===0&&o.tag!==0&&(o.suspendedLanes|=A&~(M&~l))}function Dr(o,l,d){o.pendingLanes|=l,o.suspendedLanes&=~l;var p=31-Hn(l);o.entangledLanes|=l,o.entanglements[p]=o.entanglements[p]|1073741824|d&4194090}function Nr(o,l){var d=o.entangledLanes|=l;for(o=o.entanglements;d;){var p=31-Hn(d),E=1<<p;E&l|o[p]&l&&(o[p]|=l),d&=~E}}function Oc(o){switch(o){case 2:o=1;break;case 8:o=4;break;case 32:o=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:o=128;break;case 268435456:o=134217728;break;default:o=0}return o}function Uc(o){return o&=-o,2<o?8<o?(o&134217727)!==0?32:268435456:8:2}function $s(){var o=nt.p;return o!==0?o:(o=window.event,o===void 0?32:kA(o.type))}function Am(o,l){var d=nt.p;try{return nt.p=o,l()}finally{nt.p=d}}var ls=Math.random().toString(36).slice(2),Fe="__reactFiber$"+ls,Tn="__reactProps$"+ls,Ys="__reactContainer$"+ls,Ho="__reactEvents$"+ls,Go="__reactListeners$"+ls,Sm="__reactHandles$"+ls,Gi="__reactResources$"+ls,kr="__reactMarker$"+ls;function Qa(o){delete o[Fe],delete o[Tn],delete o[Ho],delete o[Go],delete o[Sm]}function cs(o){var l=o[Fe];if(l)return l;for(var d=o.parentNode;d;){if(l=d[Ys]||d[Fe]){if(d=l.alternate,l.child!==null||d!==null&&d.child!==null)for(o=vA(o);o!==null;){if(d=o[Fe])return d;o=vA(o)}return l}o=d,d=o.parentNode}return null}function us(o){if(o=o[Fe]||o[Ys]){var l=o.tag;if(l===5||l===6||l===13||l===26||l===27||l===3)return o}return null}function Lr(o){var l=o.tag;if(l===5||l===26||l===27||l===6)return o.stateNode;throw Error(n(33))}function Or(o){var l=o[Gi];return l||(l=o[Gi]={hoistableStyles:new Map,hoistableScripts:new Map}),l}function He(o){o[kr]=!0}var jh=new Set,qo={};function hs(o,l){ds(o,l),ds(o+"Capture",l)}function ds(o,l){for(qo[o]=l,o=0;o<l.length;o++)jh.add(l[o])}var zo=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),fs={},ja={};function wm(o){return Ei.call(ja,o)?!0:Ei.call(fs,o)?!1:zo.test(o)?ja[o]=!0:(fs[o]=!0,!1)}function $o(o,l,d){if(wm(l))if(d===null)o.removeAttribute(l);else{switch(typeof d){case"undefined":case"function":case"symbol":o.removeAttribute(l);return;case"boolean":var p=l.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){o.removeAttribute(l);return}}o.setAttribute(l,""+d)}}function Yo(o,l,d){if(d===null)o.removeAttribute(l);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(l);return}o.setAttribute(l,""+d)}}function Si(o,l,d,p){if(p===null)o.removeAttribute(d);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(d);return}o.setAttributeNS(l,d,""+p)}}var Wo,Za;function Ws(o){if(Wo===void 0)try{throw Error()}catch(d){var l=d.stack.trim().match(/\n( *(at )?)/);Wo=l&&l[1]||"",Za=-1<d.stack.indexOf(`
    at`)?" (<anonymous>)":-1<d.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Wo+o+Za}var tl=!1;function el(o,l){if(!o||tl)return"";tl=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(l){var at=function(){throw Error()};if(Object.defineProperty(at.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(at,[])}catch(Z){var j=Z}Reflect.construct(o,[],at)}else{try{at.call()}catch(Z){j=Z}o.call(at.prototype)}}else{try{throw Error()}catch(Z){j=Z}(at=o())&&typeof at.catch=="function"&&at.catch(function(){})}}catch(Z){if(Z&&j&&typeof Z.stack=="string")return[Z.stack,j.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var E=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");E&&E.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var A=p.DetermineComponentFrameRoot(),M=A[0],L=A[1];if(M&&L){var q=M.split(`
`),Q=L.split(`
`);for(E=p=0;p<q.length&&!q[p].includes("DetermineComponentFrameRoot");)p++;for(;E<Q.length&&!Q[E].includes("DetermineComponentFrameRoot");)E++;if(p===q.length||E===Q.length)for(p=q.length-1,E=Q.length-1;1<=p&&0<=E&&q[p]!==Q[E];)E--;for(;1<=p&&0<=E;p--,E--)if(q[p]!==Q[E]){if(p!==1||E!==1)do if(p--,E--,0>E||q[p]!==Q[E]){var it=`
`+q[p].replace(" at new "," at ");return o.displayName&&it.includes("<anonymous>")&&(it=it.replace("<anonymous>",o.displayName)),it}while(1<=p&&0<=E);break}}}finally{tl=!1,Error.prepareStackTrace=d}return(d=o?o.displayName||o.name:"")?Ws(d):""}function bm(o){switch(o.tag){case 26:case 27:case 5:return Ws(o.type);case 16:return Ws("Lazy");case 13:return Ws("Suspense");case 19:return Ws("SuspenseList");case 0:case 15:return el(o.type,!1);case 11:return el(o.type.render,!1);case 1:return el(o.type,!0);case 31:return Ws("Activity");default:return""}}function qi(o){try{var l="";do l+=bm(o),o=o.return;while(o);return l}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}function Me(o){switch(typeof o){case"bigint":case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function Ur(o){var l=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function Ko(o){var l=Ur(o)?"checked":"value",d=Object.getOwnPropertyDescriptor(o.constructor.prototype,l),p=""+o[l];if(!o.hasOwnProperty(l)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var E=d.get,A=d.set;return Object.defineProperty(o,l,{configurable:!0,get:function(){return E.call(this)},set:function(M){p=""+M,A.call(this,M)}}),Object.defineProperty(o,l,{enumerable:d.enumerable}),{getValue:function(){return p},setValue:function(M){p=""+M},stopTracking:function(){o._valueTracker=null,delete o[l]}}}}function Vr(o){o._valueTracker||(o._valueTracker=Ko(o))}function pe(o){if(!o)return!1;var l=o._valueTracker;if(!l)return!0;var d=l.getValue(),p="";return o&&(p=Ur(o)?o.checked?"true":"false":o.value),o=p,o!==d?(l.setValue(o),!0):!1}function Ks(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}var Xo=/[\n"\\]/g;function dn(o){return o.replace(Xo,function(l){return"\\"+l.charCodeAt(0).toString(16)+" "})}function Vc(o,l,d,p,E,A,M,L){o.name="",M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"?o.type=M:o.removeAttribute("type"),l!=null?M==="number"?(l===0&&o.value===""||o.value!=l)&&(o.value=""+Me(l)):o.value!==""+Me(l)&&(o.value=""+Me(l)):M!=="submit"&&M!=="reset"||o.removeAttribute("value"),l!=null?Fc(o,M,Me(l)):d!=null?Fc(o,M,Me(d)):p!=null&&o.removeAttribute("value"),E==null&&A!=null&&(o.defaultChecked=!!A),E!=null&&(o.checked=E&&typeof E!="function"&&typeof E!="symbol"),L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"?o.name=""+Me(L):o.removeAttribute("name")}function Bc(o,l,d,p,E,A,M,L){if(A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"&&(o.type=A),l!=null||d!=null){if(!(A!=="submit"&&A!=="reset"||l!=null))return;d=d!=null?""+Me(d):"",l=l!=null?""+Me(l):d,L||l===o.value||(o.value=l),o.defaultValue=l}p=p??E,p=typeof p!="function"&&typeof p!="symbol"&&!!p,o.checked=L?o.checked:!!p,o.defaultChecked=!!p,M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"&&(o.name=M)}function Fc(o,l,d){l==="number"&&Ks(o.ownerDocument)===o||o.defaultValue===""+d||(o.defaultValue=""+d)}function Br(o,l,d,p){if(o=o.options,l){l={};for(var E=0;E<d.length;E++)l["$"+d[E]]=!0;for(d=0;d<o.length;d++)E=l.hasOwnProperty("$"+o[d].value),o[d].selected!==E&&(o[d].selected=E),E&&p&&(o[d].defaultSelected=!0)}else{for(d=""+Me(d),l=null,E=0;E<o.length;E++){if(o[E].value===d){o[E].selected=!0,p&&(o[E].defaultSelected=!0);return}l!==null||o[E].disabled||(l=o[E])}l!==null&&(l.selected=!0)}}function Zh(o,l,d){if(l!=null&&(l=""+Me(l),l!==o.value&&(o.value=l),d==null)){o.defaultValue!==l&&(o.defaultValue=l);return}o.defaultValue=d!=null?""+Me(d):""}function td(o,l,d,p){if(l==null){if(p!=null){if(d!=null)throw Error(n(92));if(It(p)){if(1<p.length)throw Error(n(93));p=p[0]}d=p}d==null&&(d=""),l=d}d=Me(l),o.defaultValue=d,p=o.textContent,p===d&&p!==""&&p!==null&&(o.value=p)}function wi(o,l){if(l){var d=o.firstChild;if(d&&d===o.lastChild&&d.nodeType===3){d.nodeValue=l;return}}o.textContent=l}var Xs=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Hc(o,l,d){var p=l.indexOf("--")===0;d==null||typeof d=="boolean"||d===""?p?o.setProperty(l,""):l==="float"?o.cssFloat="":o[l]="":p?o.setProperty(l,d):typeof d!="number"||d===0||Xs.has(l)?l==="float"?o.cssFloat=d:o[l]=(""+d).trim():o[l]=d+"px"}function Gc(o,l,d){if(l!=null&&typeof l!="object")throw Error(n(62));if(o=o.style,d!=null){for(var p in d)!d.hasOwnProperty(p)||l!=null&&l.hasOwnProperty(p)||(p.indexOf("--")===0?o.setProperty(p,""):p==="float"?o.cssFloat="":o[p]="");for(var E in l)p=l[E],l.hasOwnProperty(E)&&d[E]!==p&&Hc(o,E,p)}else for(var A in l)l.hasOwnProperty(A)&&Hc(o,A,l[A])}function nl(o){if(o.indexOf("-")===-1)return!1;switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ed=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),nd=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function zi(o){return nd.test(""+o)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":o}var qc=null;function zc(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var Fr=null,Gn=null;function id(o){var l=us(o);if(l&&(o=l.stateNode)){var d=o[Tn]||null;t:switch(o=l.stateNode,l.type){case"input":if(Vc(o,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name),l=d.name,d.type==="radio"&&l!=null){for(d=o;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll('input[name="'+dn(""+l)+'"][type="radio"]'),l=0;l<d.length;l++){var p=d[l];if(p!==o&&p.form===o.form){var E=p[Tn]||null;if(!E)throw Error(n(90));Vc(p,E.value,E.defaultValue,E.defaultValue,E.checked,E.defaultChecked,E.type,E.name)}}for(l=0;l<d.length;l++)p=d[l],p.form===o.form&&pe(p)}break t;case"textarea":Zh(o,d.value,d.defaultValue);break t;case"select":l=d.value,l!=null&&Br(o,!!d.multiple,l,!1)}}}var Jo=!1;function Qo(o,l,d){if(Jo)return o(l,d);Jo=!0;try{var p=o(l);return p}finally{if(Jo=!1,(Fr!==null||Gn!==null)&&(Yd(),Fr&&(l=Fr,o=Gn,Gn=Fr=null,id(l),o)))for(l=0;l<o.length;l++)id(o[l])}}function Hr(o,l){var d=o.stateNode;if(d===null)return null;var p=d[Tn]||null;if(p===null)return null;d=p[l];t:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(o=o.type,p=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!p;break t;default:o=!1}if(o)return null;if(d&&typeof d!="function")throw Error(n(231,l,typeof d));return d}var qn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Js=!1;if(qn)try{var Gr={};Object.defineProperty(Gr,"passive",{get:function(){Js=!0}}),window.addEventListener("test",Gr,Gr),window.removeEventListener("test",Gr,Gr)}catch{Js=!1}var bi=null,Te=null,il=null;function sd(){if(il)return il;var o,l=Te,d=l.length,p,E="value"in bi?bi.value:bi.textContent,A=E.length;for(o=0;o<d&&l[o]===E[o];o++);var M=d-o;for(p=1;p<=M&&l[d-p]===E[A-p];p++);return il=E.slice(o,1<p?1-p:void 0)}function jo(o){var l=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&l===13&&(o=13)):o=l,o===10&&(o=13),32<=o||o===13?o:0}function Zo(){return!0}function $c(){return!1}function on(o){function l(d,p,E,A,M){this._reactName=d,this._targetInst=E,this.type=p,this.nativeEvent=A,this.target=M,this.currentTarget=null;for(var L in o)o.hasOwnProperty(L)&&(d=o[L],this[L]=d?d(A):A[L]);return this.isDefaultPrevented=(A.defaultPrevented!=null?A.defaultPrevented:A.returnValue===!1)?Zo:$c,this.isPropagationStopped=$c,this}return f(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=Zo)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=Zo)},persist:function(){},isPersistent:Zo}),l}var Nn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ta=on(Nn),ea=f({},Nn,{view:0,detail:0}),na=on(ea),sl,ia,ps,sa=f({},ea,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:al,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==ps&&(ps&&o.type==="mousemove"?(sl=o.screenX-ps.screenX,ia=o.screenY-ps.screenY):ia=sl=0,ps=o),sl)},movementY:function(o){return"movementY"in o?o.movementY:ia}}),ra=on(sa),Cm=f({},sa,{dataTransfer:0}),rd=on(Cm),oa=f({},ea,{relatedTarget:0}),rl=on(oa),od=f({},Nn,{animationName:0,elapsedTime:0,pseudoElement:0}),Yc=on(od),Wc=f({},Nn,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),ad=on(Wc),ol=f({},Nn,{data:0}),Kc=on(ol),ld={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Qs={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},cd={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ud(o){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(o):(o=cd[o])?!!l[o]:!1}function al(){return ud}var hd=f({},ea,{key:function(o){if(o.key){var l=ld[o.key]||o.key;if(l!=="Unidentified")return l}return o.type==="keypress"?(o=jo(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?Qs[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:al,charCode:function(o){return o.type==="keypress"?jo(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?jo(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),ll=on(hd),zn=f({},sa,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Xc=on(zn),dd=f({},ea,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:al}),qr=on(dd),v=f({},Nn,{propertyName:0,elapsedTime:0,pseudoElement:0}),w=on(v),R=f({},sa,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),O=on(R),J=f({},Nn,{newState:0,oldState:0}),tt=on(J),pt=[9,13,27,32],Bt=qn&&"CompositionEvent"in window,Se=null;qn&&"documentMode"in document&&(Se=document.documentMode);var he=qn&&"TextEvent"in window&&!Se,Ge=qn&&(!Bt||Se&&8<Se&&11>=Se),oi=" ",ms=!1;function $i(o,l){switch(o){case"keyup":return pt.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Yi(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var Wi=!1;function Jc(o,l){switch(o){case"compositionend":return Yi(l);case"keypress":return l.which!==32?null:(ms=!0,oi);case"textInput":return o=l.data,o===oi&&ms?null:o;default:return null}}function EP(o,l){if(Wi)return o==="compositionend"||!Bt&&$i(o,l)?(o=sd(),il=Te=bi=null,Wi=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return Ge&&l.locale!=="ko"?null:l.data;default:return null}}var TP={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function RE(o){var l=o&&o.nodeName&&o.nodeName.toLowerCase();return l==="input"?!!TP[o.type]:l==="textarea"}function ME(o,l,d,p){Fr?Gn?Gn.push(p):Gn=[p]:Fr=p,l=jd(l,"onChange"),0<l.length&&(d=new ta("onChange","change",null,d,p),o.push({event:d,listeners:l}))}var Qc=null,jc=null;function AP(o){cA(o,0)}function fd(o){var l=Lr(o);if(pe(l))return o}function PE(o,l){if(o==="change")return l}var xE=!1;if(qn){var Im;if(qn){var Rm="oninput"in document;if(!Rm){var DE=document.createElement("div");DE.setAttribute("oninput","return;"),Rm=typeof DE.oninput=="function"}Im=Rm}else Im=!1;xE=Im&&(!document.documentMode||9<document.documentMode)}function NE(){Qc&&(Qc.detachEvent("onpropertychange",kE),jc=Qc=null)}function kE(o){if(o.propertyName==="value"&&fd(jc)){var l=[];ME(l,jc,o,zc(o)),Qo(AP,l)}}function SP(o,l,d){o==="focusin"?(NE(),Qc=l,jc=d,Qc.attachEvent("onpropertychange",kE)):o==="focusout"&&NE()}function wP(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return fd(jc)}function bP(o,l){if(o==="click")return fd(l)}function CP(o,l){if(o==="input"||o==="change")return fd(l)}function IP(o,l){return o===l&&(o!==0||1/o===1/l)||o!==o&&l!==l}var ai=typeof Object.is=="function"?Object.is:IP;function Zc(o,l){if(ai(o,l))return!0;if(typeof o!="object"||o===null||typeof l!="object"||l===null)return!1;var d=Object.keys(o),p=Object.keys(l);if(d.length!==p.length)return!1;for(p=0;p<d.length;p++){var E=d[p];if(!Ei.call(l,E)||!ai(o[E],l[E]))return!1}return!0}function LE(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function OE(o,l){var d=LE(o);o=0;for(var p;d;){if(d.nodeType===3){if(p=o+d.textContent.length,o<=l&&p>=l)return{node:d,offset:l-o};o=p}t:{for(;d;){if(d.nextSibling){d=d.nextSibling;break t}d=d.parentNode}d=void 0}d=LE(d)}}function UE(o,l){return o&&l?o===l?!0:o&&o.nodeType===3?!1:l&&l.nodeType===3?UE(o,l.parentNode):"contains"in o?o.contains(l):o.compareDocumentPosition?!!(o.compareDocumentPosition(l)&16):!1:!1}function VE(o){o=o!=null&&o.ownerDocument!=null&&o.ownerDocument.defaultView!=null?o.ownerDocument.defaultView:window;for(var l=Ks(o.document);l instanceof o.HTMLIFrameElement;){try{var d=typeof l.contentWindow.location.href=="string"}catch{d=!1}if(d)o=l.contentWindow;else break;l=Ks(o.document)}return l}function Mm(o){var l=o&&o.nodeName&&o.nodeName.toLowerCase();return l&&(l==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||l==="textarea"||o.contentEditable==="true")}var RP=qn&&"documentMode"in document&&11>=document.documentMode,cl=null,Pm=null,tu=null,xm=!1;function BE(o,l,d){var p=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;xm||cl==null||cl!==Ks(p)||(p=cl,"selectionStart"in p&&Mm(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),tu&&Zc(tu,p)||(tu=p,p=jd(Pm,"onSelect"),0<p.length&&(l=new ta("onSelect","select",null,l,d),o.push({event:l,listeners:p}),l.target=cl)))}function aa(o,l){var d={};return d[o.toLowerCase()]=l.toLowerCase(),d["Webkit"+o]="webkit"+l,d["Moz"+o]="moz"+l,d}var ul={animationend:aa("Animation","AnimationEnd"),animationiteration:aa("Animation","AnimationIteration"),animationstart:aa("Animation","AnimationStart"),transitionrun:aa("Transition","TransitionRun"),transitionstart:aa("Transition","TransitionStart"),transitioncancel:aa("Transition","TransitionCancel"),transitionend:aa("Transition","TransitionEnd")},Dm={},FE={};qn&&(FE=document.createElement("div").style,"AnimationEvent"in window||(delete ul.animationend.animation,delete ul.animationiteration.animation,delete ul.animationstart.animation),"TransitionEvent"in window||delete ul.transitionend.transition);function la(o){if(Dm[o])return Dm[o];if(!ul[o])return o;var l=ul[o],d;for(d in l)if(l.hasOwnProperty(d)&&d in FE)return Dm[o]=l[d];return o}var HE=la("animationend"),GE=la("animationiteration"),qE=la("animationstart"),MP=la("transitionrun"),PP=la("transitionstart"),xP=la("transitioncancel"),zE=la("transitionend"),$E=new Map,Nm="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Nm.push("scrollEnd");function Ki(o,l){$E.set(o,l),hs(l,[o])}var YE=new WeakMap;function Ci(o,l){if(typeof o=="object"&&o!==null){var d=YE.get(o);return d!==void 0?d:(l={value:o,source:l,stack:qi(l)},YE.set(o,l),l)}return{value:o,source:l,stack:qi(l)}}var Ii=[],hl=0,km=0;function pd(){for(var o=hl,l=km=hl=0;l<o;){var d=Ii[l];Ii[l++]=null;var p=Ii[l];Ii[l++]=null;var E=Ii[l];Ii[l++]=null;var A=Ii[l];if(Ii[l++]=null,p!==null&&E!==null){var M=p.pending;M===null?E.next=E:(E.next=M.next,M.next=E),p.pending=E}A!==0&&WE(d,E,A)}}function md(o,l,d,p){Ii[hl++]=o,Ii[hl++]=l,Ii[hl++]=d,Ii[hl++]=p,km|=p,o.lanes|=p,o=o.alternate,o!==null&&(o.lanes|=p)}function Lm(o,l,d,p){return md(o,l,d,p),gd(o)}function dl(o,l){return md(o,null,null,l),gd(o)}function WE(o,l,d){o.lanes|=d;var p=o.alternate;p!==null&&(p.lanes|=d);for(var E=!1,A=o.return;A!==null;)A.childLanes|=d,p=A.alternate,p!==null&&(p.childLanes|=d),A.tag===22&&(o=A.stateNode,o===null||o._visibility&1||(E=!0)),o=A,A=A.return;return o.tag===3?(A=o.stateNode,E&&l!==null&&(E=31-Hn(d),o=A.hiddenUpdates,p=o[E],p===null?o[E]=[l]:p.push(l),l.lane=d|536870912),A):null}function gd(o){if(50<bu)throw bu=0,Hg=null,Error(n(185));for(var l=o.return;l!==null;)o=l,l=o.return;return o.tag===3?o.stateNode:null}var fl={};function DP(o,l,d,p){this.tag=o,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function li(o,l,d,p){return new DP(o,l,d,p)}function Om(o){return o=o.prototype,!(!o||!o.isReactComponent)}function js(o,l){var d=o.alternate;return d===null?(d=li(o.tag,l,o.key,o.mode),d.elementType=o.elementType,d.type=o.type,d.stateNode=o.stateNode,d.alternate=o,o.alternate=d):(d.pendingProps=l,d.type=o.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=o.flags&65011712,d.childLanes=o.childLanes,d.lanes=o.lanes,d.child=o.child,d.memoizedProps=o.memoizedProps,d.memoizedState=o.memoizedState,d.updateQueue=o.updateQueue,l=o.dependencies,d.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},d.sibling=o.sibling,d.index=o.index,d.ref=o.ref,d.refCleanup=o.refCleanup,d}function KE(o,l){o.flags&=65011714;var d=o.alternate;return d===null?(o.childLanes=0,o.lanes=l,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=d.childLanes,o.lanes=d.lanes,o.child=d.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=d.memoizedProps,o.memoizedState=d.memoizedState,o.updateQueue=d.updateQueue,o.type=d.type,l=d.dependencies,o.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext}),o}function yd(o,l,d,p,E,A){var M=0;if(p=o,typeof o=="function")Om(o)&&(M=1);else if(typeof o=="string")M=kx(o,d,_t.current)?26:o==="html"||o==="head"||o==="body"?27:5;else t:switch(o){case k:return o=li(31,d,l,E),o.elementType=k,o.lanes=A,o;case S:return ca(d.children,E,A,l);case b:M=8,E|=24;break;case C:return o=li(12,d,l,E|2),o.elementType=C,o.lanes=A,o;case F:return o=li(13,d,l,E),o.elementType=F,o.lanes=A,o;case G:return o=li(19,d,l,E),o.elementType=G,o.lanes=A,o;default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case I:case P:M=10;break t;case D:M=9;break t;case H:M=11;break t;case N:M=14;break t;case x:M=16,p=null;break t}M=29,d=Error(n(130,o===null?"null":typeof o,"")),p=null}return l=li(M,d,l,E),l.elementType=o,l.type=p,l.lanes=A,l}function ca(o,l,d,p){return o=li(7,o,p,l),o.lanes=d,o}function Um(o,l,d){return o=li(6,o,null,l),o.lanes=d,o}function Vm(o,l,d){return l=li(4,o.children!==null?o.children:[],o.key,l),l.lanes=d,l.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},l}var pl=[],ml=0,_d=null,vd=0,Ri=[],Mi=0,ua=null,Zs=1,tr="";function ha(o,l){pl[ml++]=vd,pl[ml++]=_d,_d=o,vd=l}function XE(o,l,d){Ri[Mi++]=Zs,Ri[Mi++]=tr,Ri[Mi++]=ua,ua=o;var p=Zs;o=tr;var E=32-Hn(p)-1;p&=~(1<<E),d+=1;var A=32-Hn(l)+E;if(30<A){var M=E-E%5;A=(p&(1<<M)-1).toString(32),p>>=M,E-=M,Zs=1<<32-Hn(l)+E|d<<E|p,tr=A+o}else Zs=1<<A|d<<E|p,tr=o}function Bm(o){o.return!==null&&(ha(o,1),XE(o,1,0))}function Fm(o){for(;o===_d;)_d=pl[--ml],pl[ml]=null,vd=pl[--ml],pl[ml]=null;for(;o===ua;)ua=Ri[--Mi],Ri[Mi]=null,tr=Ri[--Mi],Ri[Mi]=null,Zs=Ri[--Mi],Ri[Mi]=null}var $n=null,Le=null,ae=!1,da=null,gs=!1,Hm=Error(n(519));function fa(o){var l=Error(n(418,""));throw iu(Ci(l,o)),Hm}function JE(o){var l=o.stateNode,d=o.type,p=o.memoizedProps;switch(l[Fe]=o,l[Tn]=p,d){case"dialog":Jt("cancel",l),Jt("close",l);break;case"iframe":case"object":case"embed":Jt("load",l);break;case"video":case"audio":for(d=0;d<Iu.length;d++)Jt(Iu[d],l);break;case"source":Jt("error",l);break;case"img":case"image":case"link":Jt("error",l),Jt("load",l);break;case"details":Jt("toggle",l);break;case"input":Jt("invalid",l),Bc(l,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0),Vr(l);break;case"select":Jt("invalid",l);break;case"textarea":Jt("invalid",l),td(l,p.value,p.defaultValue,p.children),Vr(l)}d=p.children,typeof d!="string"&&typeof d!="number"&&typeof d!="bigint"||l.textContent===""+d||p.suppressHydrationWarning===!0||fA(l.textContent,d)?(p.popover!=null&&(Jt("beforetoggle",l),Jt("toggle",l)),p.onScroll!=null&&Jt("scroll",l),p.onScrollEnd!=null&&Jt("scrollend",l),p.onClick!=null&&(l.onclick=Zd),l=!0):l=!1,l||fa(o)}function QE(o){for($n=o.return;$n;)switch($n.tag){case 5:case 13:gs=!1;return;case 27:case 3:gs=!0;return;default:$n=$n.return}}function eu(o){if(o!==$n)return!1;if(!ae)return QE(o),ae=!0,!1;var l=o.tag,d;if((d=l!==3&&l!==27)&&((d=l===5)&&(d=o.type,d=!(d!=="form"&&d!=="button")||iy(o.type,o.memoizedProps)),d=!d),d&&Le&&fa(o),QE(o),l===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(317));t:{for(o=o.nextSibling,l=0;o;){if(o.nodeType===8)if(d=o.data,d==="/$"){if(l===0){Le=Ji(o.nextSibling);break t}l--}else d!=="$"&&d!=="$!"&&d!=="$?"||l++;o=o.nextSibling}Le=null}}else l===27?(l=Le,ro(o.type)?(o=ay,ay=null,Le=o):Le=l):Le=$n?Ji(o.stateNode.nextSibling):null;return!0}function nu(){Le=$n=null,ae=!1}function jE(){var o=da;return o!==null&&(ti===null?ti=o:ti.push.apply(ti,o),da=null),o}function iu(o){da===null?da=[o]:da.push(o)}var Gm=ot(null),pa=null,er=null;function zr(o,l,d){ht(Gm,l._currentValue),l._currentValue=d}function nr(o){o._currentValue=Gm.current,dt(Gm)}function qm(o,l,d){for(;o!==null;){var p=o.alternate;if((o.childLanes&l)!==l?(o.childLanes|=l,p!==null&&(p.childLanes|=l)):p!==null&&(p.childLanes&l)!==l&&(p.childLanes|=l),o===d)break;o=o.return}}function zm(o,l,d,p){var E=o.child;for(E!==null&&(E.return=o);E!==null;){var A=E.dependencies;if(A!==null){var M=E.child;A=A.firstContext;t:for(;A!==null;){var L=A;A=E;for(var q=0;q<l.length;q++)if(L.context===l[q]){A.lanes|=d,L=A.alternate,L!==null&&(L.lanes|=d),qm(A.return,d,o),p||(M=null);break t}A=L.next}}else if(E.tag===18){if(M=E.return,M===null)throw Error(n(341));M.lanes|=d,A=M.alternate,A!==null&&(A.lanes|=d),qm(M,d,o),M=null}else M=E.child;if(M!==null)M.return=E;else for(M=E;M!==null;){if(M===o){M=null;break}if(E=M.sibling,E!==null){E.return=M.return,M=E;break}M=M.return}E=M}}function su(o,l,d,p){o=null;for(var E=l,A=!1;E!==null;){if(!A){if((E.flags&524288)!==0)A=!0;else if((E.flags&262144)!==0)break}if(E.tag===10){var M=E.alternate;if(M===null)throw Error(n(387));if(M=M.memoizedProps,M!==null){var L=E.type;ai(E.pendingProps.value,M.value)||(o!==null?o.push(L):o=[L])}}else if(E===$t.current){if(M=E.alternate,M===null)throw Error(n(387));M.memoizedState.memoizedState!==E.memoizedState.memoizedState&&(o!==null?o.push(Nu):o=[Nu])}E=E.return}o!==null&&zm(l,o,d,p),l.flags|=262144}function Ed(o){for(o=o.firstContext;o!==null;){if(!ai(o.context._currentValue,o.memoizedValue))return!0;o=o.next}return!1}function ma(o){pa=o,er=null,o=o.dependencies,o!==null&&(o.firstContext=null)}function kn(o){return ZE(pa,o)}function Td(o,l){return pa===null&&ma(o),ZE(o,l)}function ZE(o,l){var d=l._currentValue;if(l={context:l,memoizedValue:d,next:null},er===null){if(o===null)throw Error(n(308));er=l,o.dependencies={lanes:0,firstContext:l},o.flags|=524288}else er=er.next=l;return d}var NP=typeof AbortController<"u"?AbortController:function(){var o=[],l=this.signal={aborted:!1,addEventListener:function(d,p){o.push(p)}};this.abort=function(){l.aborted=!0,o.forEach(function(d){return d()})}},kP=i.unstable_scheduleCallback,LP=i.unstable_NormalPriority,an={$$typeof:P,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function $m(){return{controller:new NP,data:new Map,refCount:0}}function ru(o){o.refCount--,o.refCount===0&&kP(LP,function(){o.controller.abort()})}var ou=null,Ym=0,gl=0,yl=null;function OP(o,l){if(ou===null){var d=ou=[];Ym=0,gl=Kg(),yl={status:"pending",value:void 0,then:function(p){d.push(p)}}}return Ym++,l.then(t0,t0),l}function t0(){if(--Ym===0&&ou!==null){yl!==null&&(yl.status="fulfilled");var o=ou;ou=null,gl=0,yl=null;for(var l=0;l<o.length;l++)(0,o[l])()}}function UP(o,l){var d=[],p={status:"pending",value:null,reason:null,then:function(E){d.push(E)}};return o.then(function(){p.status="fulfilled",p.value=l;for(var E=0;E<d.length;E++)(0,d[E])(l)},function(E){for(p.status="rejected",p.reason=E,E=0;E<d.length;E++)(0,d[E])(void 0)}),p}var e0=W.S;W.S=function(o,l){typeof l=="object"&&l!==null&&typeof l.then=="function"&&OP(o,l),e0!==null&&e0(o,l)};var ga=ot(null);function Wm(){var o=ga.current;return o!==null?o:Ae.pooledCache}function Ad(o,l){l===null?ht(ga,ga.current):ht(ga,l.pool)}function n0(){var o=Wm();return o===null?null:{parent:an._currentValue,pool:o}}var au=Error(n(460)),i0=Error(n(474)),Sd=Error(n(542)),Km={then:function(){}};function s0(o){return o=o.status,o==="fulfilled"||o==="rejected"}function wd(){}function r0(o,l,d){switch(d=o[d],d===void 0?o.push(l):d!==l&&(l.then(wd,wd),l=d),l.status){case"fulfilled":return l.value;case"rejected":throw o=l.reason,a0(o),o;default:if(typeof l.status=="string")l.then(wd,wd);else{if(o=Ae,o!==null&&100<o.shellSuspendCounter)throw Error(n(482));o=l,o.status="pending",o.then(function(p){if(l.status==="pending"){var E=l;E.status="fulfilled",E.value=p}},function(p){if(l.status==="pending"){var E=l;E.status="rejected",E.reason=p}})}switch(l.status){case"fulfilled":return l.value;case"rejected":throw o=l.reason,a0(o),o}throw lu=l,au}}var lu=null;function o0(){if(lu===null)throw Error(n(459));var o=lu;return lu=null,o}function a0(o){if(o===au||o===Sd)throw Error(n(483))}var $r=!1;function Xm(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Jm(o,l){o=o.updateQueue,l.updateQueue===o&&(l.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,callbacks:null})}function Yr(o){return{lane:o,tag:0,payload:null,callback:null,next:null}}function Wr(o,l,d){var p=o.updateQueue;if(p===null)return null;if(p=p.shared,(de&2)!==0){var E=p.pending;return E===null?l.next=l:(l.next=E.next,E.next=l),p.pending=l,l=gd(o),WE(o,null,d),l}return md(o,p,l,d),gd(o)}function cu(o,l,d){if(l=l.updateQueue,l!==null&&(l=l.shared,(d&4194048)!==0)){var p=l.lanes;p&=o.pendingLanes,d|=p,l.lanes=d,Nr(o,d)}}function Qm(o,l){var d=o.updateQueue,p=o.alternate;if(p!==null&&(p=p.updateQueue,d===p)){var E=null,A=null;if(d=d.firstBaseUpdate,d!==null){do{var M={lane:d.lane,tag:d.tag,payload:d.payload,callback:null,next:null};A===null?E=A=M:A=A.next=M,d=d.next}while(d!==null);A===null?E=A=l:A=A.next=l}else E=A=l;d={baseState:p.baseState,firstBaseUpdate:E,lastBaseUpdate:A,shared:p.shared,callbacks:p.callbacks},o.updateQueue=d;return}o=d.lastBaseUpdate,o===null?d.firstBaseUpdate=l:o.next=l,d.lastBaseUpdate=l}var jm=!1;function uu(){if(jm){var o=yl;if(o!==null)throw o}}function hu(o,l,d,p){jm=!1;var E=o.updateQueue;$r=!1;var A=E.firstBaseUpdate,M=E.lastBaseUpdate,L=E.shared.pending;if(L!==null){E.shared.pending=null;var q=L,Q=q.next;q.next=null,M===null?A=Q:M.next=Q,M=q;var it=o.alternate;it!==null&&(it=it.updateQueue,L=it.lastBaseUpdate,L!==M&&(L===null?it.firstBaseUpdate=Q:L.next=Q,it.lastBaseUpdate=q))}if(A!==null){var at=E.baseState;M=0,it=Q=q=null,L=A;do{var j=L.lane&-536870913,Z=j!==L.lane;if(Z?(ne&j)===j:(p&j)===j){j!==0&&j===gl&&(jm=!0),it!==null&&(it=it.next={lane:0,tag:L.tag,payload:L.payload,callback:null,next:null});t:{var Lt=o,Pt=L;j=l;var ye=d;switch(Pt.tag){case 1:if(Lt=Pt.payload,typeof Lt=="function"){at=Lt.call(ye,at,j);break t}at=Lt;break t;case 3:Lt.flags=Lt.flags&-65537|128;case 0:if(Lt=Pt.payload,j=typeof Lt=="function"?Lt.call(ye,at,j):Lt,j==null)break t;at=f({},at,j);break t;case 2:$r=!0}}j=L.callback,j!==null&&(o.flags|=64,Z&&(o.flags|=8192),Z=E.callbacks,Z===null?E.callbacks=[j]:Z.push(j))}else Z={lane:j,tag:L.tag,payload:L.payload,callback:L.callback,next:null},it===null?(Q=it=Z,q=at):it=it.next=Z,M|=j;if(L=L.next,L===null){if(L=E.shared.pending,L===null)break;Z=L,L=Z.next,Z.next=null,E.lastBaseUpdate=Z,E.shared.pending=null}}while(!0);it===null&&(q=at),E.baseState=q,E.firstBaseUpdate=Q,E.lastBaseUpdate=it,A===null&&(E.shared.lanes=0),eo|=M,o.lanes=M,o.memoizedState=at}}function l0(o,l){if(typeof o!="function")throw Error(n(191,o));o.call(l)}function c0(o,l){var d=o.callbacks;if(d!==null)for(o.callbacks=null,o=0;o<d.length;o++)l0(d[o],l)}var _l=ot(null),bd=ot(0);function u0(o,l){o=cr,ht(bd,o),ht(_l,l),cr=o|l.baseLanes}function Zm(){ht(bd,cr),ht(_l,_l.current)}function tg(){cr=bd.current,dt(_l),dt(bd)}var Kr=0,Yt=null,me=null,Je=null,Cd=!1,vl=!1,ya=!1,Id=0,du=0,El=null,VP=0;function qe(){throw Error(n(321))}function eg(o,l){if(l===null)return!1;for(var d=0;d<l.length&&d<o.length;d++)if(!ai(o[d],l[d]))return!1;return!0}function ng(o,l,d,p,E,A){return Kr=A,Yt=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,W.H=o===null||o.memoizedState===null?W0:K0,ya=!1,A=d(p,E),ya=!1,vl&&(A=d0(l,d,p,E)),h0(o),A}function h0(o){W.H=Nd;var l=me!==null&&me.next!==null;if(Kr=0,Je=me=Yt=null,Cd=!1,du=0,El=null,l)throw Error(n(300));o===null||fn||(o=o.dependencies,o!==null&&Ed(o)&&(fn=!0))}function d0(o,l,d,p){Yt=o;var E=0;do{if(vl&&(El=null),du=0,vl=!1,25<=E)throw Error(n(301));if(E+=1,Je=me=null,o.updateQueue!=null){var A=o.updateQueue;A.lastEffect=null,A.events=null,A.stores=null,A.memoCache!=null&&(A.memoCache.index=0)}W.H=$P,A=l(d,p)}while(vl);return A}function BP(){var o=W.H,l=o.useState()[0];return l=typeof l.then=="function"?fu(l):l,o=o.useState()[0],(me!==null?me.memoizedState:null)!==o&&(Yt.flags|=1024),l}function ig(){var o=Id!==0;return Id=0,o}function sg(o,l,d){l.updateQueue=o.updateQueue,l.flags&=-2053,o.lanes&=~d}function rg(o){if(Cd){for(o=o.memoizedState;o!==null;){var l=o.queue;l!==null&&(l.pending=null),o=o.next}Cd=!1}Kr=0,Je=me=Yt=null,vl=!1,du=Id=0,El=null}function jn(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Je===null?Yt.memoizedState=Je=o:Je=Je.next=o,Je}function Qe(){if(me===null){var o=Yt.alternate;o=o!==null?o.memoizedState:null}else o=me.next;var l=Je===null?Yt.memoizedState:Je.next;if(l!==null)Je=l,me=o;else{if(o===null)throw Yt.alternate===null?Error(n(467)):Error(n(310));me=o,o={memoizedState:me.memoizedState,baseState:me.baseState,baseQueue:me.baseQueue,queue:me.queue,next:null},Je===null?Yt.memoizedState=Je=o:Je=Je.next=o}return Je}function og(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function fu(o){var l=du;return du+=1,El===null&&(El=[]),o=r0(El,o,l),l=Yt,(Je===null?l.memoizedState:Je.next)===null&&(l=l.alternate,W.H=l===null||l.memoizedState===null?W0:K0),o}function Rd(o){if(o!==null&&typeof o=="object"){if(typeof o.then=="function")return fu(o);if(o.$$typeof===P)return kn(o)}throw Error(n(438,String(o)))}function ag(o){var l=null,d=Yt.updateQueue;if(d!==null&&(l=d.memoCache),l==null){var p=Yt.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(l={data:p.data.map(function(E){return E.slice()}),index:0})))}if(l==null&&(l={data:[],index:0}),d===null&&(d=og(),Yt.updateQueue=d),d.memoCache=l,d=l.data[l.index],d===void 0)for(d=l.data[l.index]=Array(o),p=0;p<o;p++)d[p]=V;return l.index++,d}function ir(o,l){return typeof l=="function"?l(o):l}function Md(o){var l=Qe();return lg(l,me,o)}function lg(o,l,d){var p=o.queue;if(p===null)throw Error(n(311));p.lastRenderedReducer=d;var E=o.baseQueue,A=p.pending;if(A!==null){if(E!==null){var M=E.next;E.next=A.next,A.next=M}l.baseQueue=E=A,p.pending=null}if(A=o.baseState,E===null)o.memoizedState=A;else{l=E.next;var L=M=null,q=null,Q=l,it=!1;do{var at=Q.lane&-536870913;if(at!==Q.lane?(ne&at)===at:(Kr&at)===at){var j=Q.revertLane;if(j===0)q!==null&&(q=q.next={lane:0,revertLane:0,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null}),at===gl&&(it=!0);else if((Kr&j)===j){Q=Q.next,j===gl&&(it=!0);continue}else at={lane:0,revertLane:Q.revertLane,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null},q===null?(L=q=at,M=A):q=q.next=at,Yt.lanes|=j,eo|=j;at=Q.action,ya&&d(A,at),A=Q.hasEagerState?Q.eagerState:d(A,at)}else j={lane:at,revertLane:Q.revertLane,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null},q===null?(L=q=j,M=A):q=q.next=j,Yt.lanes|=at,eo|=at;Q=Q.next}while(Q!==null&&Q!==l);if(q===null?M=A:q.next=L,!ai(A,o.memoizedState)&&(fn=!0,it&&(d=yl,d!==null)))throw d;o.memoizedState=A,o.baseState=M,o.baseQueue=q,p.lastRenderedState=A}return E===null&&(p.lanes=0),[o.memoizedState,p.dispatch]}function cg(o){var l=Qe(),d=l.queue;if(d===null)throw Error(n(311));d.lastRenderedReducer=o;var p=d.dispatch,E=d.pending,A=l.memoizedState;if(E!==null){d.pending=null;var M=E=E.next;do A=o(A,M.action),M=M.next;while(M!==E);ai(A,l.memoizedState)||(fn=!0),l.memoizedState=A,l.baseQueue===null&&(l.baseState=A),d.lastRenderedState=A}return[A,p]}function f0(o,l,d){var p=Yt,E=Qe(),A=ae;if(A){if(d===void 0)throw Error(n(407));d=d()}else d=l();var M=!ai((me||E).memoizedState,d);M&&(E.memoizedState=d,fn=!0),E=E.queue;var L=g0.bind(null,p,E,o);if(pu(2048,8,L,[o]),E.getSnapshot!==l||M||Je!==null&&Je.memoizedState.tag&1){if(p.flags|=2048,Tl(9,Pd(),m0.bind(null,p,E,d,l),null),Ae===null)throw Error(n(349));A||(Kr&124)!==0||p0(p,l,d)}return d}function p0(o,l,d){o.flags|=16384,o={getSnapshot:l,value:d},l=Yt.updateQueue,l===null?(l=og(),Yt.updateQueue=l,l.stores=[o]):(d=l.stores,d===null?l.stores=[o]:d.push(o))}function m0(o,l,d,p){l.value=d,l.getSnapshot=p,y0(l)&&_0(o)}function g0(o,l,d){return d(function(){y0(l)&&_0(o)})}function y0(o){var l=o.getSnapshot;o=o.value;try{var d=l();return!ai(o,d)}catch{return!0}}function _0(o){var l=dl(o,2);l!==null&&fi(l,o,2)}function ug(o){var l=jn();if(typeof o=="function"){var d=o;if(o=d(),ya){Ti(!0);try{d()}finally{Ti(!1)}}}return l.memoizedState=l.baseState=o,l.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ir,lastRenderedState:o},l}function v0(o,l,d,p){return o.baseState=d,lg(o,me,typeof p=="function"?p:ir)}function FP(o,l,d,p,E){if(Dd(o))throw Error(n(485));if(o=l.action,o!==null){var A={payload:E,action:o,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(M){A.listeners.push(M)}};W.T!==null?d(!0):A.isTransition=!1,p(A),d=l.pending,d===null?(A.next=l.pending=A,E0(l,A)):(A.next=d.next,l.pending=d.next=A)}}function E0(o,l){var d=l.action,p=l.payload,E=o.state;if(l.isTransition){var A=W.T,M={};W.T=M;try{var L=d(E,p),q=W.S;q!==null&&q(M,L),T0(o,l,L)}catch(Q){hg(o,l,Q)}finally{W.T=A}}else try{A=d(E,p),T0(o,l,A)}catch(Q){hg(o,l,Q)}}function T0(o,l,d){d!==null&&typeof d=="object"&&typeof d.then=="function"?d.then(function(p){A0(o,l,p)},function(p){return hg(o,l,p)}):A0(o,l,d)}function A0(o,l,d){l.status="fulfilled",l.value=d,S0(l),o.state=d,l=o.pending,l!==null&&(d=l.next,d===l?o.pending=null:(d=d.next,l.next=d,E0(o,d)))}function hg(o,l,d){var p=o.pending;if(o.pending=null,p!==null){p=p.next;do l.status="rejected",l.reason=d,S0(l),l=l.next;while(l!==p)}o.action=null}function S0(o){o=o.listeners;for(var l=0;l<o.length;l++)(0,o[l])()}function w0(o,l){return l}function b0(o,l){if(ae){var d=Ae.formState;if(d!==null){t:{var p=Yt;if(ae){if(Le){e:{for(var E=Le,A=gs;E.nodeType!==8;){if(!A){E=null;break e}if(E=Ji(E.nextSibling),E===null){E=null;break e}}A=E.data,E=A==="F!"||A==="F"?E:null}if(E){Le=Ji(E.nextSibling),p=E.data==="F!";break t}}fa(p)}p=!1}p&&(l=d[0])}}return d=jn(),d.memoizedState=d.baseState=l,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:w0,lastRenderedState:l},d.queue=p,d=z0.bind(null,Yt,p),p.dispatch=d,p=ug(!1),A=gg.bind(null,Yt,!1,p.queue),p=jn(),E={state:l,dispatch:null,action:o,pending:null},p.queue=E,d=FP.bind(null,Yt,E,A,d),E.dispatch=d,p.memoizedState=o,[l,d,!1]}function C0(o){var l=Qe();return I0(l,me,o)}function I0(o,l,d){if(l=lg(o,l,w0)[0],o=Md(ir)[0],typeof l=="object"&&l!==null&&typeof l.then=="function")try{var p=fu(l)}catch(M){throw M===au?Sd:M}else p=l;l=Qe();var E=l.queue,A=E.dispatch;return d!==l.memoizedState&&(Yt.flags|=2048,Tl(9,Pd(),HP.bind(null,E,d),null)),[p,A,o]}function HP(o,l){o.action=l}function R0(o){var l=Qe(),d=me;if(d!==null)return I0(l,d,o);Qe(),l=l.memoizedState,d=Qe();var p=d.queue.dispatch;return d.memoizedState=o,[l,p,!1]}function Tl(o,l,d,p){return o={tag:o,create:d,deps:p,inst:l,next:null},l=Yt.updateQueue,l===null&&(l=og(),Yt.updateQueue=l),d=l.lastEffect,d===null?l.lastEffect=o.next=o:(p=d.next,d.next=o,o.next=p,l.lastEffect=o),o}function Pd(){return{destroy:void 0,resource:void 0}}function M0(){return Qe().memoizedState}function xd(o,l,d,p){var E=jn();p=p===void 0?null:p,Yt.flags|=o,E.memoizedState=Tl(1|l,Pd(),d,p)}function pu(o,l,d,p){var E=Qe();p=p===void 0?null:p;var A=E.memoizedState.inst;me!==null&&p!==null&&eg(p,me.memoizedState.deps)?E.memoizedState=Tl(l,A,d,p):(Yt.flags|=o,E.memoizedState=Tl(1|l,A,d,p))}function P0(o,l){xd(8390656,8,o,l)}function x0(o,l){pu(2048,8,o,l)}function D0(o,l){return pu(4,2,o,l)}function N0(o,l){return pu(4,4,o,l)}function k0(o,l){if(typeof l=="function"){o=o();var d=l(o);return function(){typeof d=="function"?d():l(null)}}if(l!=null)return o=o(),l.current=o,function(){l.current=null}}function L0(o,l,d){d=d!=null?d.concat([o]):null,pu(4,4,k0.bind(null,l,o),d)}function dg(){}function O0(o,l){var d=Qe();l=l===void 0?null:l;var p=d.memoizedState;return l!==null&&eg(l,p[1])?p[0]:(d.memoizedState=[o,l],o)}function U0(o,l){var d=Qe();l=l===void 0?null:l;var p=d.memoizedState;if(l!==null&&eg(l,p[1]))return p[0];if(p=o(),ya){Ti(!0);try{o()}finally{Ti(!1)}}return d.memoizedState=[p,l],p}function fg(o,l,d){return d===void 0||(Kr&1073741824)!==0?o.memoizedState=l:(o.memoizedState=d,o=FT(),Yt.lanes|=o,eo|=o,d)}function V0(o,l,d,p){return ai(d,l)?d:_l.current!==null?(o=fg(o,d,p),ai(o,l)||(fn=!0),o):(Kr&42)===0?(fn=!0,o.memoizedState=d):(o=FT(),Yt.lanes|=o,eo|=o,l)}function B0(o,l,d,p,E){var A=nt.p;nt.p=A!==0&&8>A?A:8;var M=W.T,L={};W.T=L,gg(o,!1,l,d);try{var q=E(),Q=W.S;if(Q!==null&&Q(L,q),q!==null&&typeof q=="object"&&typeof q.then=="function"){var it=UP(q,p);mu(o,l,it,di(o))}else mu(o,l,p,di(o))}catch(at){mu(o,l,{then:function(){},status:"rejected",reason:at},di())}finally{nt.p=A,W.T=M}}function GP(){}function pg(o,l,d,p){if(o.tag!==5)throw Error(n(476));var E=F0(o).queue;B0(o,E,l,ft,d===null?GP:function(){return H0(o),d(p)})}function F0(o){var l=o.memoizedState;if(l!==null)return l;l={memoizedState:ft,baseState:ft,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ir,lastRenderedState:ft},next:null};var d={};return l.next={memoizedState:d,baseState:d,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ir,lastRenderedState:d},next:null},o.memoizedState=l,o=o.alternate,o!==null&&(o.memoizedState=l),l}function H0(o){var l=F0(o).next.queue;mu(o,l,{},di())}function mg(){return kn(Nu)}function G0(){return Qe().memoizedState}function q0(){return Qe().memoizedState}function qP(o){for(var l=o.return;l!==null;){switch(l.tag){case 24:case 3:var d=di();o=Yr(d);var p=Wr(l,o,d);p!==null&&(fi(p,l,d),cu(p,l,d)),l={cache:$m()},o.payload=l;return}l=l.return}}function zP(o,l,d){var p=di();d={lane:p,revertLane:0,action:d,hasEagerState:!1,eagerState:null,next:null},Dd(o)?$0(l,d):(d=Lm(o,l,d,p),d!==null&&(fi(d,o,p),Y0(d,l,p)))}function z0(o,l,d){var p=di();mu(o,l,d,p)}function mu(o,l,d,p){var E={lane:p,revertLane:0,action:d,hasEagerState:!1,eagerState:null,next:null};if(Dd(o))$0(l,E);else{var A=o.alternate;if(o.lanes===0&&(A===null||A.lanes===0)&&(A=l.lastRenderedReducer,A!==null))try{var M=l.lastRenderedState,L=A(M,d);if(E.hasEagerState=!0,E.eagerState=L,ai(L,M))return md(o,l,E,0),Ae===null&&pd(),!1}catch{}finally{}if(d=Lm(o,l,E,p),d!==null)return fi(d,o,p),Y0(d,l,p),!0}return!1}function gg(o,l,d,p){if(p={lane:2,revertLane:Kg(),action:p,hasEagerState:!1,eagerState:null,next:null},Dd(o)){if(l)throw Error(n(479))}else l=Lm(o,d,p,2),l!==null&&fi(l,o,2)}function Dd(o){var l=o.alternate;return o===Yt||l!==null&&l===Yt}function $0(o,l){vl=Cd=!0;var d=o.pending;d===null?l.next=l:(l.next=d.next,d.next=l),o.pending=l}function Y0(o,l,d){if((d&4194048)!==0){var p=l.lanes;p&=o.pendingLanes,d|=p,l.lanes=d,Nr(o,d)}}var Nd={readContext:kn,use:Rd,useCallback:qe,useContext:qe,useEffect:qe,useImperativeHandle:qe,useLayoutEffect:qe,useInsertionEffect:qe,useMemo:qe,useReducer:qe,useRef:qe,useState:qe,useDebugValue:qe,useDeferredValue:qe,useTransition:qe,useSyncExternalStore:qe,useId:qe,useHostTransitionStatus:qe,useFormState:qe,useActionState:qe,useOptimistic:qe,useMemoCache:qe,useCacheRefresh:qe},W0={readContext:kn,use:Rd,useCallback:function(o,l){return jn().memoizedState=[o,l===void 0?null:l],o},useContext:kn,useEffect:P0,useImperativeHandle:function(o,l,d){d=d!=null?d.concat([o]):null,xd(4194308,4,k0.bind(null,l,o),d)},useLayoutEffect:function(o,l){return xd(4194308,4,o,l)},useInsertionEffect:function(o,l){xd(4,2,o,l)},useMemo:function(o,l){var d=jn();l=l===void 0?null:l;var p=o();if(ya){Ti(!0);try{o()}finally{Ti(!1)}}return d.memoizedState=[p,l],p},useReducer:function(o,l,d){var p=jn();if(d!==void 0){var E=d(l);if(ya){Ti(!0);try{d(l)}finally{Ti(!1)}}}else E=l;return p.memoizedState=p.baseState=E,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:E},p.queue=o,o=o.dispatch=zP.bind(null,Yt,o),[p.memoizedState,o]},useRef:function(o){var l=jn();return o={current:o},l.memoizedState=o},useState:function(o){o=ug(o);var l=o.queue,d=z0.bind(null,Yt,l);return l.dispatch=d,[o.memoizedState,d]},useDebugValue:dg,useDeferredValue:function(o,l){var d=jn();return fg(d,o,l)},useTransition:function(){var o=ug(!1);return o=B0.bind(null,Yt,o.queue,!0,!1),jn().memoizedState=o,[!1,o]},useSyncExternalStore:function(o,l,d){var p=Yt,E=jn();if(ae){if(d===void 0)throw Error(n(407));d=d()}else{if(d=l(),Ae===null)throw Error(n(349));(ne&124)!==0||p0(p,l,d)}E.memoizedState=d;var A={value:d,getSnapshot:l};return E.queue=A,P0(g0.bind(null,p,A,o),[o]),p.flags|=2048,Tl(9,Pd(),m0.bind(null,p,A,d,l),null),d},useId:function(){var o=jn(),l=Ae.identifierPrefix;if(ae){var d=tr,p=Zs;d=(p&~(1<<32-Hn(p)-1)).toString(32)+d,l=""+l+"R"+d,d=Id++,0<d&&(l+="H"+d.toString(32)),l+=""}else d=VP++,l=""+l+"r"+d.toString(32)+"";return o.memoizedState=l},useHostTransitionStatus:mg,useFormState:b0,useActionState:b0,useOptimistic:function(o){var l=jn();l.memoizedState=l.baseState=o;var d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return l.queue=d,l=gg.bind(null,Yt,!0,d),d.dispatch=l,[o,l]},useMemoCache:ag,useCacheRefresh:function(){return jn().memoizedState=qP.bind(null,Yt)}},K0={readContext:kn,use:Rd,useCallback:O0,useContext:kn,useEffect:x0,useImperativeHandle:L0,useInsertionEffect:D0,useLayoutEffect:N0,useMemo:U0,useReducer:Md,useRef:M0,useState:function(){return Md(ir)},useDebugValue:dg,useDeferredValue:function(o,l){var d=Qe();return V0(d,me.memoizedState,o,l)},useTransition:function(){var o=Md(ir)[0],l=Qe().memoizedState;return[typeof o=="boolean"?o:fu(o),l]},useSyncExternalStore:f0,useId:G0,useHostTransitionStatus:mg,useFormState:C0,useActionState:C0,useOptimistic:function(o,l){var d=Qe();return v0(d,me,o,l)},useMemoCache:ag,useCacheRefresh:q0},$P={readContext:kn,use:Rd,useCallback:O0,useContext:kn,useEffect:x0,useImperativeHandle:L0,useInsertionEffect:D0,useLayoutEffect:N0,useMemo:U0,useReducer:cg,useRef:M0,useState:function(){return cg(ir)},useDebugValue:dg,useDeferredValue:function(o,l){var d=Qe();return me===null?fg(d,o,l):V0(d,me.memoizedState,o,l)},useTransition:function(){var o=cg(ir)[0],l=Qe().memoizedState;return[typeof o=="boolean"?o:fu(o),l]},useSyncExternalStore:f0,useId:G0,useHostTransitionStatus:mg,useFormState:R0,useActionState:R0,useOptimistic:function(o,l){var d=Qe();return me!==null?v0(d,me,o,l):(d.baseState=o,[o,d.queue.dispatch])},useMemoCache:ag,useCacheRefresh:q0},Al=null,gu=0;function kd(o){var l=gu;return gu+=1,Al===null&&(Al=[]),r0(Al,o,l)}function yu(o,l){l=l.props.ref,o.ref=l!==void 0?l:null}function Ld(o,l){throw l.$$typeof===m?Error(n(525)):(o=Object.prototype.toString.call(l),Error(n(31,o==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":o)))}function X0(o){var l=o._init;return l(o._payload)}function J0(o){function l(K,Y){if(o){var X=K.deletions;X===null?(K.deletions=[Y],K.flags|=16):X.push(Y)}}function d(K,Y){if(!o)return null;for(;Y!==null;)l(K,Y),Y=Y.sibling;return null}function p(K){for(var Y=new Map;K!==null;)K.key!==null?Y.set(K.key,K):Y.set(K.index,K),K=K.sibling;return Y}function E(K,Y){return K=js(K,Y),K.index=0,K.sibling=null,K}function A(K,Y,X){return K.index=X,o?(X=K.alternate,X!==null?(X=X.index,X<Y?(K.flags|=67108866,Y):X):(K.flags|=67108866,Y)):(K.flags|=1048576,Y)}function M(K){return o&&K.alternate===null&&(K.flags|=67108866),K}function L(K,Y,X,rt){return Y===null||Y.tag!==6?(Y=Um(X,K.mode,rt),Y.return=K,Y):(Y=E(Y,X),Y.return=K,Y)}function q(K,Y,X,rt){var At=X.type;return At===S?it(K,Y,X.props.children,rt,X.key):Y!==null&&(Y.elementType===At||typeof At=="object"&&At!==null&&At.$$typeof===x&&X0(At)===Y.type)?(Y=E(Y,X.props),yu(Y,X),Y.return=K,Y):(Y=yd(X.type,X.key,X.props,null,K.mode,rt),yu(Y,X),Y.return=K,Y)}function Q(K,Y,X,rt){return Y===null||Y.tag!==4||Y.stateNode.containerInfo!==X.containerInfo||Y.stateNode.implementation!==X.implementation?(Y=Vm(X,K.mode,rt),Y.return=K,Y):(Y=E(Y,X.children||[]),Y.return=K,Y)}function it(K,Y,X,rt,At){return Y===null||Y.tag!==7?(Y=ca(X,K.mode,rt,At),Y.return=K,Y):(Y=E(Y,X),Y.return=K,Y)}function at(K,Y,X){if(typeof Y=="string"&&Y!==""||typeof Y=="number"||typeof Y=="bigint")return Y=Um(""+Y,K.mode,X),Y.return=K,Y;if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case y:return X=yd(Y.type,Y.key,Y.props,null,K.mode,X),yu(X,Y),X.return=K,X;case T:return Y=Vm(Y,K.mode,X),Y.return=K,Y;case x:var rt=Y._init;return Y=rt(Y._payload),at(K,Y,X)}if(It(Y)||$(Y))return Y=ca(Y,K.mode,X,null),Y.return=K,Y;if(typeof Y.then=="function")return at(K,kd(Y),X);if(Y.$$typeof===P)return at(K,Td(K,Y),X);Ld(K,Y)}return null}function j(K,Y,X,rt){var At=Y!==null?Y.key:null;if(typeof X=="string"&&X!==""||typeof X=="number"||typeof X=="bigint")return At!==null?null:L(K,Y,""+X,rt);if(typeof X=="object"&&X!==null){switch(X.$$typeof){case y:return X.key===At?q(K,Y,X,rt):null;case T:return X.key===At?Q(K,Y,X,rt):null;case x:return At=X._init,X=At(X._payload),j(K,Y,X,rt)}if(It(X)||$(X))return At!==null?null:it(K,Y,X,rt,null);if(typeof X.then=="function")return j(K,Y,kd(X),rt);if(X.$$typeof===P)return j(K,Y,Td(K,X),rt);Ld(K,X)}return null}function Z(K,Y,X,rt,At){if(typeof rt=="string"&&rt!==""||typeof rt=="number"||typeof rt=="bigint")return K=K.get(X)||null,L(Y,K,""+rt,At);if(typeof rt=="object"&&rt!==null){switch(rt.$$typeof){case y:return K=K.get(rt.key===null?X:rt.key)||null,q(Y,K,rt,At);case T:return K=K.get(rt.key===null?X:rt.key)||null,Q(Y,K,rt,At);case x:var Kt=rt._init;return rt=Kt(rt._payload),Z(K,Y,X,rt,At)}if(It(rt)||$(rt))return K=K.get(X)||null,it(Y,K,rt,At,null);if(typeof rt.then=="function")return Z(K,Y,X,kd(rt),At);if(rt.$$typeof===P)return Z(K,Y,X,Td(Y,rt),At);Ld(Y,rt)}return null}function Lt(K,Y,X,rt){for(var At=null,Kt=null,Ct=Y,Dt=Y=0,mn=null;Ct!==null&&Dt<X.length;Dt++){Ct.index>Dt?(mn=Ct,Ct=null):mn=Ct.sibling;var re=j(K,Ct,X[Dt],rt);if(re===null){Ct===null&&(Ct=mn);break}o&&Ct&&re.alternate===null&&l(K,Ct),Y=A(re,Y,Dt),Kt===null?At=re:Kt.sibling=re,Kt=re,Ct=mn}if(Dt===X.length)return d(K,Ct),ae&&ha(K,Dt),At;if(Ct===null){for(;Dt<X.length;Dt++)Ct=at(K,X[Dt],rt),Ct!==null&&(Y=A(Ct,Y,Dt),Kt===null?At=Ct:Kt.sibling=Ct,Kt=Ct);return ae&&ha(K,Dt),At}for(Ct=p(Ct);Dt<X.length;Dt++)mn=Z(Ct,K,Dt,X[Dt],rt),mn!==null&&(o&&mn.alternate!==null&&Ct.delete(mn.key===null?Dt:mn.key),Y=A(mn,Y,Dt),Kt===null?At=mn:Kt.sibling=mn,Kt=mn);return o&&Ct.forEach(function(uo){return l(K,uo)}),ae&&ha(K,Dt),At}function Pt(K,Y,X,rt){if(X==null)throw Error(n(151));for(var At=null,Kt=null,Ct=Y,Dt=Y=0,mn=null,re=X.next();Ct!==null&&!re.done;Dt++,re=X.next()){Ct.index>Dt?(mn=Ct,Ct=null):mn=Ct.sibling;var uo=j(K,Ct,re.value,rt);if(uo===null){Ct===null&&(Ct=mn);break}o&&Ct&&uo.alternate===null&&l(K,Ct),Y=A(uo,Y,Dt),Kt===null?At=uo:Kt.sibling=uo,Kt=uo,Ct=mn}if(re.done)return d(K,Ct),ae&&ha(K,Dt),At;if(Ct===null){for(;!re.done;Dt++,re=X.next())re=at(K,re.value,rt),re!==null&&(Y=A(re,Y,Dt),Kt===null?At=re:Kt.sibling=re,Kt=re);return ae&&ha(K,Dt),At}for(Ct=p(Ct);!re.done;Dt++,re=X.next())re=Z(Ct,K,Dt,re.value,rt),re!==null&&(o&&re.alternate!==null&&Ct.delete(re.key===null?Dt:re.key),Y=A(re,Y,Dt),Kt===null?At=re:Kt.sibling=re,Kt=re);return o&&Ct.forEach(function(Yx){return l(K,Yx)}),ae&&ha(K,Dt),At}function ye(K,Y,X,rt){if(typeof X=="object"&&X!==null&&X.type===S&&X.key===null&&(X=X.props.children),typeof X=="object"&&X!==null){switch(X.$$typeof){case y:t:{for(var At=X.key;Y!==null;){if(Y.key===At){if(At=X.type,At===S){if(Y.tag===7){d(K,Y.sibling),rt=E(Y,X.props.children),rt.return=K,K=rt;break t}}else if(Y.elementType===At||typeof At=="object"&&At!==null&&At.$$typeof===x&&X0(At)===Y.type){d(K,Y.sibling),rt=E(Y,X.props),yu(rt,X),rt.return=K,K=rt;break t}d(K,Y);break}else l(K,Y);Y=Y.sibling}X.type===S?(rt=ca(X.props.children,K.mode,rt,X.key),rt.return=K,K=rt):(rt=yd(X.type,X.key,X.props,null,K.mode,rt),yu(rt,X),rt.return=K,K=rt)}return M(K);case T:t:{for(At=X.key;Y!==null;){if(Y.key===At)if(Y.tag===4&&Y.stateNode.containerInfo===X.containerInfo&&Y.stateNode.implementation===X.implementation){d(K,Y.sibling),rt=E(Y,X.children||[]),rt.return=K,K=rt;break t}else{d(K,Y);break}else l(K,Y);Y=Y.sibling}rt=Vm(X,K.mode,rt),rt.return=K,K=rt}return M(K);case x:return At=X._init,X=At(X._payload),ye(K,Y,X,rt)}if(It(X))return Lt(K,Y,X,rt);if($(X)){if(At=$(X),typeof At!="function")throw Error(n(150));return X=At.call(X),Pt(K,Y,X,rt)}if(typeof X.then=="function")return ye(K,Y,kd(X),rt);if(X.$$typeof===P)return ye(K,Y,Td(K,X),rt);Ld(K,X)}return typeof X=="string"&&X!==""||typeof X=="number"||typeof X=="bigint"?(X=""+X,Y!==null&&Y.tag===6?(d(K,Y.sibling),rt=E(Y,X),rt.return=K,K=rt):(d(K,Y),rt=Um(X,K.mode,rt),rt.return=K,K=rt),M(K)):d(K,Y)}return function(K,Y,X,rt){try{gu=0;var At=ye(K,Y,X,rt);return Al=null,At}catch(Ct){if(Ct===au||Ct===Sd)throw Ct;var Kt=li(29,Ct,null,K.mode);return Kt.lanes=rt,Kt.return=K,Kt}finally{}}}var Sl=J0(!0),Q0=J0(!1),Pi=ot(null),ys=null;function Xr(o){var l=o.alternate;ht(ln,ln.current&1),ht(Pi,o),ys===null&&(l===null||_l.current!==null||l.memoizedState!==null)&&(ys=o)}function j0(o){if(o.tag===22){if(ht(ln,ln.current),ht(Pi,o),ys===null){var l=o.alternate;l!==null&&l.memoizedState!==null&&(ys=o)}}else Jr()}function Jr(){ht(ln,ln.current),ht(Pi,Pi.current)}function sr(o){dt(Pi),ys===o&&(ys=null),dt(ln)}var ln=ot(0);function Od(o){for(var l=o;l!==null;){if(l.tag===13){var d=l.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||oy(d)))return l}else if(l.tag===19&&l.memoizedProps.revealOrder!==void 0){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===o)break;for(;l.sibling===null;){if(l.return===null||l.return===o)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}function yg(o,l,d,p){l=o.memoizedState,d=d(p,l),d=d==null?l:f({},l,d),o.memoizedState=d,o.lanes===0&&(o.updateQueue.baseState=d)}var _g={enqueueSetState:function(o,l,d){o=o._reactInternals;var p=di(),E=Yr(p);E.payload=l,d!=null&&(E.callback=d),l=Wr(o,E,p),l!==null&&(fi(l,o,p),cu(l,o,p))},enqueueReplaceState:function(o,l,d){o=o._reactInternals;var p=di(),E=Yr(p);E.tag=1,E.payload=l,d!=null&&(E.callback=d),l=Wr(o,E,p),l!==null&&(fi(l,o,p),cu(l,o,p))},enqueueForceUpdate:function(o,l){o=o._reactInternals;var d=di(),p=Yr(d);p.tag=2,l!=null&&(p.callback=l),l=Wr(o,p,d),l!==null&&(fi(l,o,d),cu(l,o,d))}};function Z0(o,l,d,p,E,A,M){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(p,A,M):l.prototype&&l.prototype.isPureReactComponent?!Zc(d,p)||!Zc(E,A):!0}function tT(o,l,d,p){o=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(d,p),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(d,p),l.state!==o&&_g.enqueueReplaceState(l,l.state,null)}function _a(o,l){var d=l;if("ref"in l){d={};for(var p in l)p!=="ref"&&(d[p]=l[p])}if(o=o.defaultProps){d===l&&(d=f({},d));for(var E in o)d[E]===void 0&&(d[E]=o[E])}return d}var Ud=typeof reportError=="function"?reportError:function(o){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var l=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof o=="object"&&o!==null&&typeof o.message=="string"?String(o.message):String(o),error:o});if(!window.dispatchEvent(l))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",o);return}console.error(o)};function eT(o){Ud(o)}function nT(o){console.error(o)}function iT(o){Ud(o)}function Vd(o,l){try{var d=o.onUncaughtError;d(l.value,{componentStack:l.stack})}catch(p){setTimeout(function(){throw p})}}function sT(o,l,d){try{var p=o.onCaughtError;p(d.value,{componentStack:d.stack,errorBoundary:l.tag===1?l.stateNode:null})}catch(E){setTimeout(function(){throw E})}}function vg(o,l,d){return d=Yr(d),d.tag=3,d.payload={element:null},d.callback=function(){Vd(o,l)},d}function rT(o){return o=Yr(o),o.tag=3,o}function oT(o,l,d,p){var E=d.type.getDerivedStateFromError;if(typeof E=="function"){var A=p.value;o.payload=function(){return E(A)},o.callback=function(){sT(l,d,p)}}var M=d.stateNode;M!==null&&typeof M.componentDidCatch=="function"&&(o.callback=function(){sT(l,d,p),typeof E!="function"&&(no===null?no=new Set([this]):no.add(this));var L=p.stack;this.componentDidCatch(p.value,{componentStack:L!==null?L:""})})}function YP(o,l,d,p,E){if(d.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(l=d.alternate,l!==null&&su(l,d,E,!0),d=Pi.current,d!==null){switch(d.tag){case 13:return ys===null?qg():d.alternate===null&&Oe===0&&(Oe=3),d.flags&=-257,d.flags|=65536,d.lanes=E,p===Km?d.flags|=16384:(l=d.updateQueue,l===null?d.updateQueue=new Set([p]):l.add(p),$g(o,p,E)),!1;case 22:return d.flags|=65536,p===Km?d.flags|=16384:(l=d.updateQueue,l===null?(l={transitions:null,markerInstances:null,retryQueue:new Set([p])},d.updateQueue=l):(d=l.retryQueue,d===null?l.retryQueue=new Set([p]):d.add(p)),$g(o,p,E)),!1}throw Error(n(435,d.tag))}return $g(o,p,E),qg(),!1}if(ae)return l=Pi.current,l!==null?((l.flags&65536)===0&&(l.flags|=256),l.flags|=65536,l.lanes=E,p!==Hm&&(o=Error(n(422),{cause:p}),iu(Ci(o,d)))):(p!==Hm&&(l=Error(n(423),{cause:p}),iu(Ci(l,d))),o=o.current.alternate,o.flags|=65536,E&=-E,o.lanes|=E,p=Ci(p,d),E=vg(o.stateNode,p,E),Qm(o,E),Oe!==4&&(Oe=2)),!1;var A=Error(n(520),{cause:p});if(A=Ci(A,d),wu===null?wu=[A]:wu.push(A),Oe!==4&&(Oe=2),l===null)return!0;p=Ci(p,d),d=l;do{switch(d.tag){case 3:return d.flags|=65536,o=E&-E,d.lanes|=o,o=vg(d.stateNode,p,o),Qm(d,o),!1;case 1:if(l=d.type,A=d.stateNode,(d.flags&128)===0&&(typeof l.getDerivedStateFromError=="function"||A!==null&&typeof A.componentDidCatch=="function"&&(no===null||!no.has(A))))return d.flags|=65536,E&=-E,d.lanes|=E,E=rT(E),oT(E,o,d,p),Qm(d,E),!1}d=d.return}while(d!==null);return!1}var aT=Error(n(461)),fn=!1;function An(o,l,d,p){l.child=o===null?Q0(l,null,d,p):Sl(l,o.child,d,p)}function lT(o,l,d,p,E){d=d.render;var A=l.ref;if("ref"in p){var M={};for(var L in p)L!=="ref"&&(M[L]=p[L])}else M=p;return ma(l),p=ng(o,l,d,M,A,E),L=ig(),o!==null&&!fn?(sg(o,l,E),rr(o,l,E)):(ae&&L&&Bm(l),l.flags|=1,An(o,l,p,E),l.child)}function cT(o,l,d,p,E){if(o===null){var A=d.type;return typeof A=="function"&&!Om(A)&&A.defaultProps===void 0&&d.compare===null?(l.tag=15,l.type=A,uT(o,l,A,p,E)):(o=yd(d.type,null,p,l,l.mode,E),o.ref=l.ref,o.return=l,l.child=o)}if(A=o.child,!Ig(o,E)){var M=A.memoizedProps;if(d=d.compare,d=d!==null?d:Zc,d(M,p)&&o.ref===l.ref)return rr(o,l,E)}return l.flags|=1,o=js(A,p),o.ref=l.ref,o.return=l,l.child=o}function uT(o,l,d,p,E){if(o!==null){var A=o.memoizedProps;if(Zc(A,p)&&o.ref===l.ref)if(fn=!1,l.pendingProps=p=A,Ig(o,E))(o.flags&131072)!==0&&(fn=!0);else return l.lanes=o.lanes,rr(o,l,E)}return Eg(o,l,d,p,E)}function hT(o,l,d){var p=l.pendingProps,E=p.children,A=o!==null?o.memoizedState:null;if(p.mode==="hidden"){if((l.flags&128)!==0){if(p=A!==null?A.baseLanes|d:d,o!==null){for(E=l.child=o.child,A=0;E!==null;)A=A|E.lanes|E.childLanes,E=E.sibling;l.childLanes=A&~p}else l.childLanes=0,l.child=null;return dT(o,l,p,d)}if((d&536870912)!==0)l.memoizedState={baseLanes:0,cachePool:null},o!==null&&Ad(l,A!==null?A.cachePool:null),A!==null?u0(l,A):Zm(),j0(l);else return l.lanes=l.childLanes=536870912,dT(o,l,A!==null?A.baseLanes|d:d,d)}else A!==null?(Ad(l,A.cachePool),u0(l,A),Jr(),l.memoizedState=null):(o!==null&&Ad(l,null),Zm(),Jr());return An(o,l,E,d),l.child}function dT(o,l,d,p){var E=Wm();return E=E===null?null:{parent:an._currentValue,pool:E},l.memoizedState={baseLanes:d,cachePool:E},o!==null&&Ad(l,null),Zm(),j0(l),o!==null&&su(o,l,p,!0),null}function Bd(o,l){var d=l.ref;if(d===null)o!==null&&o.ref!==null&&(l.flags|=4194816);else{if(typeof d!="function"&&typeof d!="object")throw Error(n(284));(o===null||o.ref!==d)&&(l.flags|=4194816)}}function Eg(o,l,d,p,E){return ma(l),d=ng(o,l,d,p,void 0,E),p=ig(),o!==null&&!fn?(sg(o,l,E),rr(o,l,E)):(ae&&p&&Bm(l),l.flags|=1,An(o,l,d,E),l.child)}function fT(o,l,d,p,E,A){return ma(l),l.updateQueue=null,d=d0(l,p,d,E),h0(o),p=ig(),o!==null&&!fn?(sg(o,l,A),rr(o,l,A)):(ae&&p&&Bm(l),l.flags|=1,An(o,l,d,A),l.child)}function pT(o,l,d,p,E){if(ma(l),l.stateNode===null){var A=fl,M=d.contextType;typeof M=="object"&&M!==null&&(A=kn(M)),A=new d(p,A),l.memoizedState=A.state!==null&&A.state!==void 0?A.state:null,A.updater=_g,l.stateNode=A,A._reactInternals=l,A=l.stateNode,A.props=p,A.state=l.memoizedState,A.refs={},Xm(l),M=d.contextType,A.context=typeof M=="object"&&M!==null?kn(M):fl,A.state=l.memoizedState,M=d.getDerivedStateFromProps,typeof M=="function"&&(yg(l,d,M,p),A.state=l.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof A.getSnapshotBeforeUpdate=="function"||typeof A.UNSAFE_componentWillMount!="function"&&typeof A.componentWillMount!="function"||(M=A.state,typeof A.componentWillMount=="function"&&A.componentWillMount(),typeof A.UNSAFE_componentWillMount=="function"&&A.UNSAFE_componentWillMount(),M!==A.state&&_g.enqueueReplaceState(A,A.state,null),hu(l,p,A,E),uu(),A.state=l.memoizedState),typeof A.componentDidMount=="function"&&(l.flags|=4194308),p=!0}else if(o===null){A=l.stateNode;var L=l.memoizedProps,q=_a(d,L);A.props=q;var Q=A.context,it=d.contextType;M=fl,typeof it=="object"&&it!==null&&(M=kn(it));var at=d.getDerivedStateFromProps;it=typeof at=="function"||typeof A.getSnapshotBeforeUpdate=="function",L=l.pendingProps!==L,it||typeof A.UNSAFE_componentWillReceiveProps!="function"&&typeof A.componentWillReceiveProps!="function"||(L||Q!==M)&&tT(l,A,p,M),$r=!1;var j=l.memoizedState;A.state=j,hu(l,p,A,E),uu(),Q=l.memoizedState,L||j!==Q||$r?(typeof at=="function"&&(yg(l,d,at,p),Q=l.memoizedState),(q=$r||Z0(l,d,q,p,j,Q,M))?(it||typeof A.UNSAFE_componentWillMount!="function"&&typeof A.componentWillMount!="function"||(typeof A.componentWillMount=="function"&&A.componentWillMount(),typeof A.UNSAFE_componentWillMount=="function"&&A.UNSAFE_componentWillMount()),typeof A.componentDidMount=="function"&&(l.flags|=4194308)):(typeof A.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=p,l.memoizedState=Q),A.props=p,A.state=Q,A.context=M,p=q):(typeof A.componentDidMount=="function"&&(l.flags|=4194308),p=!1)}else{A=l.stateNode,Jm(o,l),M=l.memoizedProps,it=_a(d,M),A.props=it,at=l.pendingProps,j=A.context,Q=d.contextType,q=fl,typeof Q=="object"&&Q!==null&&(q=kn(Q)),L=d.getDerivedStateFromProps,(Q=typeof L=="function"||typeof A.getSnapshotBeforeUpdate=="function")||typeof A.UNSAFE_componentWillReceiveProps!="function"&&typeof A.componentWillReceiveProps!="function"||(M!==at||j!==q)&&tT(l,A,p,q),$r=!1,j=l.memoizedState,A.state=j,hu(l,p,A,E),uu();var Z=l.memoizedState;M!==at||j!==Z||$r||o!==null&&o.dependencies!==null&&Ed(o.dependencies)?(typeof L=="function"&&(yg(l,d,L,p),Z=l.memoizedState),(it=$r||Z0(l,d,it,p,j,Z,q)||o!==null&&o.dependencies!==null&&Ed(o.dependencies))?(Q||typeof A.UNSAFE_componentWillUpdate!="function"&&typeof A.componentWillUpdate!="function"||(typeof A.componentWillUpdate=="function"&&A.componentWillUpdate(p,Z,q),typeof A.UNSAFE_componentWillUpdate=="function"&&A.UNSAFE_componentWillUpdate(p,Z,q)),typeof A.componentDidUpdate=="function"&&(l.flags|=4),typeof A.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof A.componentDidUpdate!="function"||M===o.memoizedProps&&j===o.memoizedState||(l.flags|=4),typeof A.getSnapshotBeforeUpdate!="function"||M===o.memoizedProps&&j===o.memoizedState||(l.flags|=1024),l.memoizedProps=p,l.memoizedState=Z),A.props=p,A.state=Z,A.context=q,p=it):(typeof A.componentDidUpdate!="function"||M===o.memoizedProps&&j===o.memoizedState||(l.flags|=4),typeof A.getSnapshotBeforeUpdate!="function"||M===o.memoizedProps&&j===o.memoizedState||(l.flags|=1024),p=!1)}return A=p,Bd(o,l),p=(l.flags&128)!==0,A||p?(A=l.stateNode,d=p&&typeof d.getDerivedStateFromError!="function"?null:A.render(),l.flags|=1,o!==null&&p?(l.child=Sl(l,o.child,null,E),l.child=Sl(l,null,d,E)):An(o,l,d,E),l.memoizedState=A.state,o=l.child):o=rr(o,l,E),o}function mT(o,l,d,p){return nu(),l.flags|=256,An(o,l,d,p),l.child}var Tg={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ag(o){return{baseLanes:o,cachePool:n0()}}function Sg(o,l,d){return o=o!==null?o.childLanes&~d:0,l&&(o|=xi),o}function gT(o,l,d){var p=l.pendingProps,E=!1,A=(l.flags&128)!==0,M;if((M=A)||(M=o!==null&&o.memoizedState===null?!1:(ln.current&2)!==0),M&&(E=!0,l.flags&=-129),M=(l.flags&32)!==0,l.flags&=-33,o===null){if(ae){if(E?Xr(l):Jr(),ae){var L=Le,q;if(q=L){t:{for(q=L,L=gs;q.nodeType!==8;){if(!L){L=null;break t}if(q=Ji(q.nextSibling),q===null){L=null;break t}}L=q}L!==null?(l.memoizedState={dehydrated:L,treeContext:ua!==null?{id:Zs,overflow:tr}:null,retryLane:536870912,hydrationErrors:null},q=li(18,null,null,0),q.stateNode=L,q.return=l,l.child=q,$n=l,Le=null,q=!0):q=!1}q||fa(l)}if(L=l.memoizedState,L!==null&&(L=L.dehydrated,L!==null))return oy(L)?l.lanes=32:l.lanes=536870912,null;sr(l)}return L=p.children,p=p.fallback,E?(Jr(),E=l.mode,L=Fd({mode:"hidden",children:L},E),p=ca(p,E,d,null),L.return=l,p.return=l,L.sibling=p,l.child=L,E=l.child,E.memoizedState=Ag(d),E.childLanes=Sg(o,M,d),l.memoizedState=Tg,p):(Xr(l),wg(l,L))}if(q=o.memoizedState,q!==null&&(L=q.dehydrated,L!==null)){if(A)l.flags&256?(Xr(l),l.flags&=-257,l=bg(o,l,d)):l.memoizedState!==null?(Jr(),l.child=o.child,l.flags|=128,l=null):(Jr(),E=p.fallback,L=l.mode,p=Fd({mode:"visible",children:p.children},L),E=ca(E,L,d,null),E.flags|=2,p.return=l,E.return=l,p.sibling=E,l.child=p,Sl(l,o.child,null,d),p=l.child,p.memoizedState=Ag(d),p.childLanes=Sg(o,M,d),l.memoizedState=Tg,l=E);else if(Xr(l),oy(L)){if(M=L.nextSibling&&L.nextSibling.dataset,M)var Q=M.dgst;M=Q,p=Error(n(419)),p.stack="",p.digest=M,iu({value:p,source:null,stack:null}),l=bg(o,l,d)}else if(fn||su(o,l,d,!1),M=(d&o.childLanes)!==0,fn||M){if(M=Ae,M!==null&&(p=d&-d,p=(p&42)!==0?1:Oc(p),p=(p&(M.suspendedLanes|d))!==0?0:p,p!==0&&p!==q.retryLane))throw q.retryLane=p,dl(o,p),fi(M,o,p),aT;L.data==="$?"||qg(),l=bg(o,l,d)}else L.data==="$?"?(l.flags|=192,l.child=o.child,l=null):(o=q.treeContext,Le=Ji(L.nextSibling),$n=l,ae=!0,da=null,gs=!1,o!==null&&(Ri[Mi++]=Zs,Ri[Mi++]=tr,Ri[Mi++]=ua,Zs=o.id,tr=o.overflow,ua=l),l=wg(l,p.children),l.flags|=4096);return l}return E?(Jr(),E=p.fallback,L=l.mode,q=o.child,Q=q.sibling,p=js(q,{mode:"hidden",children:p.children}),p.subtreeFlags=q.subtreeFlags&65011712,Q!==null?E=js(Q,E):(E=ca(E,L,d,null),E.flags|=2),E.return=l,p.return=l,p.sibling=E,l.child=p,p=E,E=l.child,L=o.child.memoizedState,L===null?L=Ag(d):(q=L.cachePool,q!==null?(Q=an._currentValue,q=q.parent!==Q?{parent:Q,pool:Q}:q):q=n0(),L={baseLanes:L.baseLanes|d,cachePool:q}),E.memoizedState=L,E.childLanes=Sg(o,M,d),l.memoizedState=Tg,p):(Xr(l),d=o.child,o=d.sibling,d=js(d,{mode:"visible",children:p.children}),d.return=l,d.sibling=null,o!==null&&(M=l.deletions,M===null?(l.deletions=[o],l.flags|=16):M.push(o)),l.child=d,l.memoizedState=null,d)}function wg(o,l){return l=Fd({mode:"visible",children:l},o.mode),l.return=o,o.child=l}function Fd(o,l){return o=li(22,o,null,l),o.lanes=0,o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},o}function bg(o,l,d){return Sl(l,o.child,null,d),o=wg(l,l.pendingProps.children),o.flags|=2,l.memoizedState=null,o}function yT(o,l,d){o.lanes|=l;var p=o.alternate;p!==null&&(p.lanes|=l),qm(o.return,l,d)}function Cg(o,l,d,p,E){var A=o.memoizedState;A===null?o.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:p,tail:d,tailMode:E}:(A.isBackwards=l,A.rendering=null,A.renderingStartTime=0,A.last=p,A.tail=d,A.tailMode=E)}function _T(o,l,d){var p=l.pendingProps,E=p.revealOrder,A=p.tail;if(An(o,l,p.children,d),p=ln.current,(p&2)!==0)p=p&1|2,l.flags|=128;else{if(o!==null&&(o.flags&128)!==0)t:for(o=l.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&yT(o,d,l);else if(o.tag===19)yT(o,d,l);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===l)break t;for(;o.sibling===null;){if(o.return===null||o.return===l)break t;o=o.return}o.sibling.return=o.return,o=o.sibling}p&=1}switch(ht(ln,p),E){case"forwards":for(d=l.child,E=null;d!==null;)o=d.alternate,o!==null&&Od(o)===null&&(E=d),d=d.sibling;d=E,d===null?(E=l.child,l.child=null):(E=d.sibling,d.sibling=null),Cg(l,!1,E,d,A);break;case"backwards":for(d=null,E=l.child,l.child=null;E!==null;){if(o=E.alternate,o!==null&&Od(o)===null){l.child=E;break}o=E.sibling,E.sibling=d,d=E,E=o}Cg(l,!0,d,null,A);break;case"together":Cg(l,!1,null,null,void 0);break;default:l.memoizedState=null}return l.child}function rr(o,l,d){if(o!==null&&(l.dependencies=o.dependencies),eo|=l.lanes,(d&l.childLanes)===0)if(o!==null){if(su(o,l,d,!1),(d&l.childLanes)===0)return null}else return null;if(o!==null&&l.child!==o.child)throw Error(n(153));if(l.child!==null){for(o=l.child,d=js(o,o.pendingProps),l.child=d,d.return=l;o.sibling!==null;)o=o.sibling,d=d.sibling=js(o,o.pendingProps),d.return=l;d.sibling=null}return l.child}function Ig(o,l){return(o.lanes&l)!==0?!0:(o=o.dependencies,!!(o!==null&&Ed(o)))}function WP(o,l,d){switch(l.tag){case 3:Wt(l,l.stateNode.containerInfo),zr(l,an,o.memoizedState.cache),nu();break;case 27:case 5:qs(l);break;case 4:Wt(l,l.stateNode.containerInfo);break;case 10:zr(l,l.type,l.memoizedProps.value);break;case 13:var p=l.memoizedState;if(p!==null)return p.dehydrated!==null?(Xr(l),l.flags|=128,null):(d&l.child.childLanes)!==0?gT(o,l,d):(Xr(l),o=rr(o,l,d),o!==null?o.sibling:null);Xr(l);break;case 19:var E=(o.flags&128)!==0;if(p=(d&l.childLanes)!==0,p||(su(o,l,d,!1),p=(d&l.childLanes)!==0),E){if(p)return _T(o,l,d);l.flags|=128}if(E=l.memoizedState,E!==null&&(E.rendering=null,E.tail=null,E.lastEffect=null),ht(ln,ln.current),p)break;return null;case 22:case 23:return l.lanes=0,hT(o,l,d);case 24:zr(l,an,o.memoizedState.cache)}return rr(o,l,d)}function vT(o,l,d){if(o!==null)if(o.memoizedProps!==l.pendingProps)fn=!0;else{if(!Ig(o,d)&&(l.flags&128)===0)return fn=!1,WP(o,l,d);fn=(o.flags&131072)!==0}else fn=!1,ae&&(l.flags&1048576)!==0&&XE(l,vd,l.index);switch(l.lanes=0,l.tag){case 16:t:{o=l.pendingProps;var p=l.elementType,E=p._init;if(p=E(p._payload),l.type=p,typeof p=="function")Om(p)?(o=_a(p,o),l.tag=1,l=pT(null,l,p,o,d)):(l.tag=0,l=Eg(null,l,p,o,d));else{if(p!=null){if(E=p.$$typeof,E===H){l.tag=11,l=lT(null,l,p,o,d);break t}else if(E===N){l.tag=14,l=cT(null,l,p,o,d);break t}}throw l=vt(p)||p,Error(n(306,l,""))}}return l;case 0:return Eg(o,l,l.type,l.pendingProps,d);case 1:return p=l.type,E=_a(p,l.pendingProps),pT(o,l,p,E,d);case 3:t:{if(Wt(l,l.stateNode.containerInfo),o===null)throw Error(n(387));p=l.pendingProps;var A=l.memoizedState;E=A.element,Jm(o,l),hu(l,p,null,d);var M=l.memoizedState;if(p=M.cache,zr(l,an,p),p!==A.cache&&zm(l,[an],d,!0),uu(),p=M.element,A.isDehydrated)if(A={element:p,isDehydrated:!1,cache:M.cache},l.updateQueue.baseState=A,l.memoizedState=A,l.flags&256){l=mT(o,l,p,d);break t}else if(p!==E){E=Ci(Error(n(424)),l),iu(E),l=mT(o,l,p,d);break t}else{switch(o=l.stateNode.containerInfo,o.nodeType){case 9:o=o.body;break;default:o=o.nodeName==="HTML"?o.ownerDocument.body:o}for(Le=Ji(o.firstChild),$n=l,ae=!0,da=null,gs=!0,d=Q0(l,null,p,d),l.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling}else{if(nu(),p===E){l=rr(o,l,d);break t}An(o,l,p,d)}l=l.child}return l;case 26:return Bd(o,l),o===null?(d=SA(l.type,null,l.pendingProps,null))?l.memoizedState=d:ae||(d=l.type,o=l.pendingProps,p=tf(St.current).createElement(d),p[Fe]=l,p[Tn]=o,wn(p,d,o),He(p),l.stateNode=p):l.memoizedState=SA(l.type,o.memoizedProps,l.pendingProps,o.memoizedState),null;case 27:return qs(l),o===null&&ae&&(p=l.stateNode=EA(l.type,l.pendingProps,St.current),$n=l,gs=!0,E=Le,ro(l.type)?(ay=E,Le=Ji(p.firstChild)):Le=E),An(o,l,l.pendingProps.children,d),Bd(o,l),o===null&&(l.flags|=4194304),l.child;case 5:return o===null&&ae&&((E=p=Le)&&(p=Tx(p,l.type,l.pendingProps,gs),p!==null?(l.stateNode=p,$n=l,Le=Ji(p.firstChild),gs=!1,E=!0):E=!1),E||fa(l)),qs(l),E=l.type,A=l.pendingProps,M=o!==null?o.memoizedProps:null,p=A.children,iy(E,A)?p=null:M!==null&&iy(E,M)&&(l.flags|=32),l.memoizedState!==null&&(E=ng(o,l,BP,null,null,d),Nu._currentValue=E),Bd(o,l),An(o,l,p,d),l.child;case 6:return o===null&&ae&&((o=d=Le)&&(d=Ax(d,l.pendingProps,gs),d!==null?(l.stateNode=d,$n=l,Le=null,o=!0):o=!1),o||fa(l)),null;case 13:return gT(o,l,d);case 4:return Wt(l,l.stateNode.containerInfo),p=l.pendingProps,o===null?l.child=Sl(l,null,p,d):An(o,l,p,d),l.child;case 11:return lT(o,l,l.type,l.pendingProps,d);case 7:return An(o,l,l.pendingProps,d),l.child;case 8:return An(o,l,l.pendingProps.children,d),l.child;case 12:return An(o,l,l.pendingProps.children,d),l.child;case 10:return p=l.pendingProps,zr(l,l.type,p.value),An(o,l,p.children,d),l.child;case 9:return E=l.type._context,p=l.pendingProps.children,ma(l),E=kn(E),p=p(E),l.flags|=1,An(o,l,p,d),l.child;case 14:return cT(o,l,l.type,l.pendingProps,d);case 15:return uT(o,l,l.type,l.pendingProps,d);case 19:return _T(o,l,d);case 31:return p=l.pendingProps,d=l.mode,p={mode:p.mode,children:p.children},o===null?(d=Fd(p,d),d.ref=l.ref,l.child=d,d.return=l,l=d):(d=js(o.child,p),d.ref=l.ref,l.child=d,d.return=l,l=d),l;case 22:return hT(o,l,d);case 24:return ma(l),p=kn(an),o===null?(E=Wm(),E===null&&(E=Ae,A=$m(),E.pooledCache=A,A.refCount++,A!==null&&(E.pooledCacheLanes|=d),E=A),l.memoizedState={parent:p,cache:E},Xm(l),zr(l,an,E)):((o.lanes&d)!==0&&(Jm(o,l),hu(l,null,null,d),uu()),E=o.memoizedState,A=l.memoizedState,E.parent!==p?(E={parent:p,cache:p},l.memoizedState=E,l.lanes===0&&(l.memoizedState=l.updateQueue.baseState=E),zr(l,an,p)):(p=A.cache,zr(l,an,p),p!==E.cache&&zm(l,[an],d,!0))),An(o,l,l.pendingProps.children,d),l.child;case 29:throw l.pendingProps}throw Error(n(156,l.tag))}function or(o){o.flags|=4}function ET(o,l){if(l.type!=="stylesheet"||(l.state.loading&4)!==0)o.flags&=-16777217;else if(o.flags|=16777216,!RA(l)){if(l=Pi.current,l!==null&&((ne&4194048)===ne?ys!==null:(ne&62914560)!==ne&&(ne&536870912)===0||l!==ys))throw lu=Km,i0;o.flags|=8192}}function Hd(o,l){l!==null&&(o.flags|=4),o.flags&16384&&(l=o.tag!==22?xr():536870912,o.lanes|=l,Il|=l)}function _u(o,l){if(!ae)switch(o.tailMode){case"hidden":l=o.tail;for(var d=null;l!==null;)l.alternate!==null&&(d=l),l=l.sibling;d===null?o.tail=null:d.sibling=null;break;case"collapsed":d=o.tail;for(var p=null;d!==null;)d.alternate!==null&&(p=d),d=d.sibling;p===null?l||o.tail===null?o.tail=null:o.tail.sibling=null:p.sibling=null}}function Pe(o){var l=o.alternate!==null&&o.alternate.child===o.child,d=0,p=0;if(l)for(var E=o.child;E!==null;)d|=E.lanes|E.childLanes,p|=E.subtreeFlags&65011712,p|=E.flags&65011712,E.return=o,E=E.sibling;else for(E=o.child;E!==null;)d|=E.lanes|E.childLanes,p|=E.subtreeFlags,p|=E.flags,E.return=o,E=E.sibling;return o.subtreeFlags|=p,o.childLanes=d,l}function KP(o,l,d){var p=l.pendingProps;switch(Fm(l),l.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Pe(l),null;case 1:return Pe(l),null;case 3:return d=l.stateNode,p=null,o!==null&&(p=o.memoizedState.cache),l.memoizedState.cache!==p&&(l.flags|=2048),nr(an),Xe(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(o===null||o.child===null)&&(eu(l)?or(l):o===null||o.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,jE())),Pe(l),null;case 26:return d=l.memoizedState,o===null?(or(l),d!==null?(Pe(l),ET(l,d)):(Pe(l),l.flags&=-16777217)):d?d!==o.memoizedState?(or(l),Pe(l),ET(l,d)):(Pe(l),l.flags&=-16777217):(o.memoizedProps!==p&&or(l),Pe(l),l.flags&=-16777217),null;case 27:vi(l),d=St.current;var E=l.type;if(o!==null&&l.stateNode!=null)o.memoizedProps!==p&&or(l);else{if(!p){if(l.stateNode===null)throw Error(n(166));return Pe(l),null}o=_t.current,eu(l)?JE(l):(o=EA(E,p,d),l.stateNode=o,or(l))}return Pe(l),null;case 5:if(vi(l),d=l.type,o!==null&&l.stateNode!=null)o.memoizedProps!==p&&or(l);else{if(!p){if(l.stateNode===null)throw Error(n(166));return Pe(l),null}if(o=_t.current,eu(l))JE(l);else{switch(E=tf(St.current),o){case 1:o=E.createElementNS("http://www.w3.org/2000/svg",d);break;case 2:o=E.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;default:switch(d){case"svg":o=E.createElementNS("http://www.w3.org/2000/svg",d);break;case"math":o=E.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;case"script":o=E.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild);break;case"select":o=typeof p.is=="string"?E.createElement("select",{is:p.is}):E.createElement("select"),p.multiple?o.multiple=!0:p.size&&(o.size=p.size);break;default:o=typeof p.is=="string"?E.createElement(d,{is:p.is}):E.createElement(d)}}o[Fe]=l,o[Tn]=p;t:for(E=l.child;E!==null;){if(E.tag===5||E.tag===6)o.appendChild(E.stateNode);else if(E.tag!==4&&E.tag!==27&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===l)break t;for(;E.sibling===null;){if(E.return===null||E.return===l)break t;E=E.return}E.sibling.return=E.return,E=E.sibling}l.stateNode=o;t:switch(wn(o,d,p),d){case"button":case"input":case"select":case"textarea":o=!!p.autoFocus;break t;case"img":o=!0;break t;default:o=!1}o&&or(l)}}return Pe(l),l.flags&=-16777217,null;case 6:if(o&&l.stateNode!=null)o.memoizedProps!==p&&or(l);else{if(typeof p!="string"&&l.stateNode===null)throw Error(n(166));if(o=St.current,eu(l)){if(o=l.stateNode,d=l.memoizedProps,p=null,E=$n,E!==null)switch(E.tag){case 27:case 5:p=E.memoizedProps}o[Fe]=l,o=!!(o.nodeValue===d||p!==null&&p.suppressHydrationWarning===!0||fA(o.nodeValue,d)),o||fa(l)}else o=tf(o).createTextNode(p),o[Fe]=l,l.stateNode=o}return Pe(l),null;case 13:if(p=l.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(E=eu(l),p!==null&&p.dehydrated!==null){if(o===null){if(!E)throw Error(n(318));if(E=l.memoizedState,E=E!==null?E.dehydrated:null,!E)throw Error(n(317));E[Fe]=l}else nu(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;Pe(l),E=!1}else E=jE(),o!==null&&o.memoizedState!==null&&(o.memoizedState.hydrationErrors=E),E=!0;if(!E)return l.flags&256?(sr(l),l):(sr(l),null)}if(sr(l),(l.flags&128)!==0)return l.lanes=d,l;if(d=p!==null,o=o!==null&&o.memoizedState!==null,d){p=l.child,E=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(E=p.alternate.memoizedState.cachePool.pool);var A=null;p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(A=p.memoizedState.cachePool.pool),A!==E&&(p.flags|=2048)}return d!==o&&d&&(l.child.flags|=8192),Hd(l,l.updateQueue),Pe(l),null;case 4:return Xe(),o===null&&jg(l.stateNode.containerInfo),Pe(l),null;case 10:return nr(l.type),Pe(l),null;case 19:if(dt(ln),E=l.memoizedState,E===null)return Pe(l),null;if(p=(l.flags&128)!==0,A=E.rendering,A===null)if(p)_u(E,!1);else{if(Oe!==0||o!==null&&(o.flags&128)!==0)for(o=l.child;o!==null;){if(A=Od(o),A!==null){for(l.flags|=128,_u(E,!1),o=A.updateQueue,l.updateQueue=o,Hd(l,o),l.subtreeFlags=0,o=d,d=l.child;d!==null;)KE(d,o),d=d.sibling;return ht(ln,ln.current&1|2),l.child}o=o.sibling}E.tail!==null&&Ve()>zd&&(l.flags|=128,p=!0,_u(E,!1),l.lanes=4194304)}else{if(!p)if(o=Od(A),o!==null){if(l.flags|=128,p=!0,o=o.updateQueue,l.updateQueue=o,Hd(l,o),_u(E,!0),E.tail===null&&E.tailMode==="hidden"&&!A.alternate&&!ae)return Pe(l),null}else 2*Ve()-E.renderingStartTime>zd&&d!==536870912&&(l.flags|=128,p=!0,_u(E,!1),l.lanes=4194304);E.isBackwards?(A.sibling=l.child,l.child=A):(o=E.last,o!==null?o.sibling=A:l.child=A,E.last=A)}return E.tail!==null?(l=E.tail,E.rendering=l,E.tail=l.sibling,E.renderingStartTime=Ve(),l.sibling=null,o=ln.current,ht(ln,p?o&1|2:o&1),l):(Pe(l),null);case 22:case 23:return sr(l),tg(),p=l.memoizedState!==null,o!==null?o.memoizedState!==null!==p&&(l.flags|=8192):p&&(l.flags|=8192),p?(d&536870912)!==0&&(l.flags&128)===0&&(Pe(l),l.subtreeFlags&6&&(l.flags|=8192)):Pe(l),d=l.updateQueue,d!==null&&Hd(l,d.retryQueue),d=null,o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(d=o.memoizedState.cachePool.pool),p=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(p=l.memoizedState.cachePool.pool),p!==d&&(l.flags|=2048),o!==null&&dt(ga),null;case 24:return d=null,o!==null&&(d=o.memoizedState.cache),l.memoizedState.cache!==d&&(l.flags|=2048),nr(an),Pe(l),null;case 25:return null;case 30:return null}throw Error(n(156,l.tag))}function XP(o,l){switch(Fm(l),l.tag){case 1:return o=l.flags,o&65536?(l.flags=o&-65537|128,l):null;case 3:return nr(an),Xe(),o=l.flags,(o&65536)!==0&&(o&128)===0?(l.flags=o&-65537|128,l):null;case 26:case 27:case 5:return vi(l),null;case 13:if(sr(l),o=l.memoizedState,o!==null&&o.dehydrated!==null){if(l.alternate===null)throw Error(n(340));nu()}return o=l.flags,o&65536?(l.flags=o&-65537|128,l):null;case 19:return dt(ln),null;case 4:return Xe(),null;case 10:return nr(l.type),null;case 22:case 23:return sr(l),tg(),o!==null&&dt(ga),o=l.flags,o&65536?(l.flags=o&-65537|128,l):null;case 24:return nr(an),null;case 25:return null;default:return null}}function TT(o,l){switch(Fm(l),l.tag){case 3:nr(an),Xe();break;case 26:case 27:case 5:vi(l);break;case 4:Xe();break;case 13:sr(l);break;case 19:dt(ln);break;case 10:nr(l.type);break;case 22:case 23:sr(l),tg(),o!==null&&dt(ga);break;case 24:nr(an)}}function vu(o,l){try{var d=l.updateQueue,p=d!==null?d.lastEffect:null;if(p!==null){var E=p.next;d=E;do{if((d.tag&o)===o){p=void 0;var A=d.create,M=d.inst;p=A(),M.destroy=p}d=d.next}while(d!==E)}}catch(L){ve(l,l.return,L)}}function Qr(o,l,d){try{var p=l.updateQueue,E=p!==null?p.lastEffect:null;if(E!==null){var A=E.next;p=A;do{if((p.tag&o)===o){var M=p.inst,L=M.destroy;if(L!==void 0){M.destroy=void 0,E=l;var q=d,Q=L;try{Q()}catch(it){ve(E,q,it)}}}p=p.next}while(p!==A)}}catch(it){ve(l,l.return,it)}}function AT(o){var l=o.updateQueue;if(l!==null){var d=o.stateNode;try{c0(l,d)}catch(p){ve(o,o.return,p)}}}function ST(o,l,d){d.props=_a(o.type,o.memoizedProps),d.state=o.memoizedState;try{d.componentWillUnmount()}catch(p){ve(o,l,p)}}function Eu(o,l){try{var d=o.ref;if(d!==null){switch(o.tag){case 26:case 27:case 5:var p=o.stateNode;break;case 30:p=o.stateNode;break;default:p=o.stateNode}typeof d=="function"?o.refCleanup=d(p):d.current=p}}catch(E){ve(o,l,E)}}function _s(o,l){var d=o.ref,p=o.refCleanup;if(d!==null)if(typeof p=="function")try{p()}catch(E){ve(o,l,E)}finally{o.refCleanup=null,o=o.alternate,o!=null&&(o.refCleanup=null)}else if(typeof d=="function")try{d(null)}catch(E){ve(o,l,E)}else d.current=null}function wT(o){var l=o.type,d=o.memoizedProps,p=o.stateNode;try{t:switch(l){case"button":case"input":case"select":case"textarea":d.autoFocus&&p.focus();break t;case"img":d.src?p.src=d.src:d.srcSet&&(p.srcset=d.srcSet)}}catch(E){ve(o,o.return,E)}}function Rg(o,l,d){try{var p=o.stateNode;gx(p,o.type,d,l),p[Tn]=l}catch(E){ve(o,o.return,E)}}function bT(o){return o.tag===5||o.tag===3||o.tag===26||o.tag===27&&ro(o.type)||o.tag===4}function Mg(o){t:for(;;){for(;o.sibling===null;){if(o.return===null||bT(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.tag===27&&ro(o.type)||o.flags&2||o.child===null||o.tag===4)continue t;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function Pg(o,l,d){var p=o.tag;if(p===5||p===6)o=o.stateNode,l?(d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d).insertBefore(o,l):(l=d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d,l.appendChild(o),d=d._reactRootContainer,d!=null||l.onclick!==null||(l.onclick=Zd));else if(p!==4&&(p===27&&ro(o.type)&&(d=o.stateNode,l=null),o=o.child,o!==null))for(Pg(o,l,d),o=o.sibling;o!==null;)Pg(o,l,d),o=o.sibling}function Gd(o,l,d){var p=o.tag;if(p===5||p===6)o=o.stateNode,l?d.insertBefore(o,l):d.appendChild(o);else if(p!==4&&(p===27&&ro(o.type)&&(d=o.stateNode),o=o.child,o!==null))for(Gd(o,l,d),o=o.sibling;o!==null;)Gd(o,l,d),o=o.sibling}function CT(o){var l=o.stateNode,d=o.memoizedProps;try{for(var p=o.type,E=l.attributes;E.length;)l.removeAttributeNode(E[0]);wn(l,p,d),l[Fe]=o,l[Tn]=d}catch(A){ve(o,o.return,A)}}var ar=!1,ze=!1,xg=!1,IT=typeof WeakSet=="function"?WeakSet:Set,pn=null;function JP(o,l){if(o=o.containerInfo,ey=af,o=VE(o),Mm(o)){if("selectionStart"in o)var d={start:o.selectionStart,end:o.selectionEnd};else t:{d=(d=o.ownerDocument)&&d.defaultView||window;var p=d.getSelection&&d.getSelection();if(p&&p.rangeCount!==0){d=p.anchorNode;var E=p.anchorOffset,A=p.focusNode;p=p.focusOffset;try{d.nodeType,A.nodeType}catch{d=null;break t}var M=0,L=-1,q=-1,Q=0,it=0,at=o,j=null;e:for(;;){for(var Z;at!==d||E!==0&&at.nodeType!==3||(L=M+E),at!==A||p!==0&&at.nodeType!==3||(q=M+p),at.nodeType===3&&(M+=at.nodeValue.length),(Z=at.firstChild)!==null;)j=at,at=Z;for(;;){if(at===o)break e;if(j===d&&++Q===E&&(L=M),j===A&&++it===p&&(q=M),(Z=at.nextSibling)!==null)break;at=j,j=at.parentNode}at=Z}d=L===-1||q===-1?null:{start:L,end:q}}else d=null}d=d||{start:0,end:0}}else d=null;for(ny={focusedElem:o,selectionRange:d},af=!1,pn=l;pn!==null;)if(l=pn,o=l.child,(l.subtreeFlags&1024)!==0&&o!==null)o.return=l,pn=o;else for(;pn!==null;){switch(l=pn,A=l.alternate,o=l.flags,l.tag){case 0:break;case 11:case 15:break;case 1:if((o&1024)!==0&&A!==null){o=void 0,d=l,E=A.memoizedProps,A=A.memoizedState,p=d.stateNode;try{var Lt=_a(d.type,E,d.elementType===d.type);o=p.getSnapshotBeforeUpdate(Lt,A),p.__reactInternalSnapshotBeforeUpdate=o}catch(Pt){ve(d,d.return,Pt)}}break;case 3:if((o&1024)!==0){if(o=l.stateNode.containerInfo,d=o.nodeType,d===9)ry(o);else if(d===1)switch(o.nodeName){case"HEAD":case"HTML":case"BODY":ry(o);break;default:o.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((o&1024)!==0)throw Error(n(163))}if(o=l.sibling,o!==null){o.return=l.return,pn=o;break}pn=l.return}}function RT(o,l,d){var p=d.flags;switch(d.tag){case 0:case 11:case 15:jr(o,d),p&4&&vu(5,d);break;case 1:if(jr(o,d),p&4)if(o=d.stateNode,l===null)try{o.componentDidMount()}catch(M){ve(d,d.return,M)}else{var E=_a(d.type,l.memoizedProps);l=l.memoizedState;try{o.componentDidUpdate(E,l,o.__reactInternalSnapshotBeforeUpdate)}catch(M){ve(d,d.return,M)}}p&64&&AT(d),p&512&&Eu(d,d.return);break;case 3:if(jr(o,d),p&64&&(o=d.updateQueue,o!==null)){if(l=null,d.child!==null)switch(d.child.tag){case 27:case 5:l=d.child.stateNode;break;case 1:l=d.child.stateNode}try{c0(o,l)}catch(M){ve(d,d.return,M)}}break;case 27:l===null&&p&4&&CT(d);case 26:case 5:jr(o,d),l===null&&p&4&&wT(d),p&512&&Eu(d,d.return);break;case 12:jr(o,d);break;case 13:jr(o,d),p&4&&xT(o,d),p&64&&(o=d.memoizedState,o!==null&&(o=o.dehydrated,o!==null&&(d=rx.bind(null,d),Sx(o,d))));break;case 22:if(p=d.memoizedState!==null||ar,!p){l=l!==null&&l.memoizedState!==null||ze,E=ar;var A=ze;ar=p,(ze=l)&&!A?Zr(o,d,(d.subtreeFlags&8772)!==0):jr(o,d),ar=E,ze=A}break;case 30:break;default:jr(o,d)}}function MT(o){var l=o.alternate;l!==null&&(o.alternate=null,MT(l)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(l=o.stateNode,l!==null&&Qa(l)),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}var be=null,Zn=!1;function lr(o,l,d){for(d=d.child;d!==null;)PT(o,l,d),d=d.sibling}function PT(o,l,d){if(Dn&&typeof Dn.onCommitFiberUnmount=="function")try{Dn.onCommitFiberUnmount(Rr,d)}catch{}switch(d.tag){case 26:ze||_s(d,l),lr(o,l,d),d.memoizedState?d.memoizedState.count--:d.stateNode&&(d=d.stateNode,d.parentNode.removeChild(d));break;case 27:ze||_s(d,l);var p=be,E=Zn;ro(d.type)&&(be=d.stateNode,Zn=!1),lr(o,l,d),Mu(d.stateNode),be=p,Zn=E;break;case 5:ze||_s(d,l);case 6:if(p=be,E=Zn,be=null,lr(o,l,d),be=p,Zn=E,be!==null)if(Zn)try{(be.nodeType===9?be.body:be.nodeName==="HTML"?be.ownerDocument.body:be).removeChild(d.stateNode)}catch(A){ve(d,l,A)}else try{be.removeChild(d.stateNode)}catch(A){ve(d,l,A)}break;case 18:be!==null&&(Zn?(o=be,_A(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,d.stateNode),Uu(o)):_A(be,d.stateNode));break;case 4:p=be,E=Zn,be=d.stateNode.containerInfo,Zn=!0,lr(o,l,d),be=p,Zn=E;break;case 0:case 11:case 14:case 15:ze||Qr(2,d,l),ze||Qr(4,d,l),lr(o,l,d);break;case 1:ze||(_s(d,l),p=d.stateNode,typeof p.componentWillUnmount=="function"&&ST(d,l,p)),lr(o,l,d);break;case 21:lr(o,l,d);break;case 22:ze=(p=ze)||d.memoizedState!==null,lr(o,l,d),ze=p;break;default:lr(o,l,d)}}function xT(o,l){if(l.memoizedState===null&&(o=l.alternate,o!==null&&(o=o.memoizedState,o!==null&&(o=o.dehydrated,o!==null))))try{Uu(o)}catch(d){ve(l,l.return,d)}}function QP(o){switch(o.tag){case 13:case 19:var l=o.stateNode;return l===null&&(l=o.stateNode=new IT),l;case 22:return o=o.stateNode,l=o._retryCache,l===null&&(l=o._retryCache=new IT),l;default:throw Error(n(435,o.tag))}}function Dg(o,l){var d=QP(o);l.forEach(function(p){var E=ox.bind(null,o,p);d.has(p)||(d.add(p),p.then(E,E))})}function ci(o,l){var d=l.deletions;if(d!==null)for(var p=0;p<d.length;p++){var E=d[p],A=o,M=l,L=M;t:for(;L!==null;){switch(L.tag){case 27:if(ro(L.type)){be=L.stateNode,Zn=!1;break t}break;case 5:be=L.stateNode,Zn=!1;break t;case 3:case 4:be=L.stateNode.containerInfo,Zn=!0;break t}L=L.return}if(be===null)throw Error(n(160));PT(A,M,E),be=null,Zn=!1,A=E.alternate,A!==null&&(A.return=null),E.return=null}if(l.subtreeFlags&13878)for(l=l.child;l!==null;)DT(l,o),l=l.sibling}var Xi=null;function DT(o,l){var d=o.alternate,p=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:ci(l,o),ui(o),p&4&&(Qr(3,o,o.return),vu(3,o),Qr(5,o,o.return));break;case 1:ci(l,o),ui(o),p&512&&(ze||d===null||_s(d,d.return)),p&64&&ar&&(o=o.updateQueue,o!==null&&(p=o.callbacks,p!==null&&(d=o.shared.hiddenCallbacks,o.shared.hiddenCallbacks=d===null?p:d.concat(p))));break;case 26:var E=Xi;if(ci(l,o),ui(o),p&512&&(ze||d===null||_s(d,d.return)),p&4){var A=d!==null?d.memoizedState:null;if(p=o.memoizedState,d===null)if(p===null)if(o.stateNode===null){t:{p=o.type,d=o.memoizedProps,E=E.ownerDocument||E;e:switch(p){case"title":A=E.getElementsByTagName("title")[0],(!A||A[kr]||A[Fe]||A.namespaceURI==="http://www.w3.org/2000/svg"||A.hasAttribute("itemprop"))&&(A=E.createElement(p),E.head.insertBefore(A,E.querySelector("head > title"))),wn(A,p,d),A[Fe]=o,He(A),p=A;break t;case"link":var M=CA("link","href",E).get(p+(d.href||""));if(M){for(var L=0;L<M.length;L++)if(A=M[L],A.getAttribute("href")===(d.href==null||d.href===""?null:d.href)&&A.getAttribute("rel")===(d.rel==null?null:d.rel)&&A.getAttribute("title")===(d.title==null?null:d.title)&&A.getAttribute("crossorigin")===(d.crossOrigin==null?null:d.crossOrigin)){M.splice(L,1);break e}}A=E.createElement(p),wn(A,p,d),E.head.appendChild(A);break;case"meta":if(M=CA("meta","content",E).get(p+(d.content||""))){for(L=0;L<M.length;L++)if(A=M[L],A.getAttribute("content")===(d.content==null?null:""+d.content)&&A.getAttribute("name")===(d.name==null?null:d.name)&&A.getAttribute("property")===(d.property==null?null:d.property)&&A.getAttribute("http-equiv")===(d.httpEquiv==null?null:d.httpEquiv)&&A.getAttribute("charset")===(d.charSet==null?null:d.charSet)){M.splice(L,1);break e}}A=E.createElement(p),wn(A,p,d),E.head.appendChild(A);break;default:throw Error(n(468,p))}A[Fe]=o,He(A),p=A}o.stateNode=p}else IA(E,o.type,o.stateNode);else o.stateNode=bA(E,p,o.memoizedProps);else A!==p?(A===null?d.stateNode!==null&&(d=d.stateNode,d.parentNode.removeChild(d)):A.count--,p===null?IA(E,o.type,o.stateNode):bA(E,p,o.memoizedProps)):p===null&&o.stateNode!==null&&Rg(o,o.memoizedProps,d.memoizedProps)}break;case 27:ci(l,o),ui(o),p&512&&(ze||d===null||_s(d,d.return)),d!==null&&p&4&&Rg(o,o.memoizedProps,d.memoizedProps);break;case 5:if(ci(l,o),ui(o),p&512&&(ze||d===null||_s(d,d.return)),o.flags&32){E=o.stateNode;try{wi(E,"")}catch(Z){ve(o,o.return,Z)}}p&4&&o.stateNode!=null&&(E=o.memoizedProps,Rg(o,E,d!==null?d.memoizedProps:E)),p&1024&&(xg=!0);break;case 6:if(ci(l,o),ui(o),p&4){if(o.stateNode===null)throw Error(n(162));p=o.memoizedProps,d=o.stateNode;try{d.nodeValue=p}catch(Z){ve(o,o.return,Z)}}break;case 3:if(sf=null,E=Xi,Xi=ef(l.containerInfo),ci(l,o),Xi=E,ui(o),p&4&&d!==null&&d.memoizedState.isDehydrated)try{Uu(l.containerInfo)}catch(Z){ve(o,o.return,Z)}xg&&(xg=!1,NT(o));break;case 4:p=Xi,Xi=ef(o.stateNode.containerInfo),ci(l,o),ui(o),Xi=p;break;case 12:ci(l,o),ui(o);break;case 13:ci(l,o),ui(o),o.child.flags&8192&&o.memoizedState!==null!=(d!==null&&d.memoizedState!==null)&&(Vg=Ve()),p&4&&(p=o.updateQueue,p!==null&&(o.updateQueue=null,Dg(o,p)));break;case 22:E=o.memoizedState!==null;var q=d!==null&&d.memoizedState!==null,Q=ar,it=ze;if(ar=Q||E,ze=it||q,ci(l,o),ze=it,ar=Q,ui(o),p&8192)t:for(l=o.stateNode,l._visibility=E?l._visibility&-2:l._visibility|1,E&&(d===null||q||ar||ze||va(o)),d=null,l=o;;){if(l.tag===5||l.tag===26){if(d===null){q=d=l;try{if(A=q.stateNode,E)M=A.style,typeof M.setProperty=="function"?M.setProperty("display","none","important"):M.display="none";else{L=q.stateNode;var at=q.memoizedProps.style,j=at!=null&&at.hasOwnProperty("display")?at.display:null;L.style.display=j==null||typeof j=="boolean"?"":(""+j).trim()}}catch(Z){ve(q,q.return,Z)}}}else if(l.tag===6){if(d===null){q=l;try{q.stateNode.nodeValue=E?"":q.memoizedProps}catch(Z){ve(q,q.return,Z)}}}else if((l.tag!==22&&l.tag!==23||l.memoizedState===null||l===o)&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===o)break t;for(;l.sibling===null;){if(l.return===null||l.return===o)break t;d===l&&(d=null),l=l.return}d===l&&(d=null),l.sibling.return=l.return,l=l.sibling}p&4&&(p=o.updateQueue,p!==null&&(d=p.retryQueue,d!==null&&(p.retryQueue=null,Dg(o,d))));break;case 19:ci(l,o),ui(o),p&4&&(p=o.updateQueue,p!==null&&(o.updateQueue=null,Dg(o,p)));break;case 30:break;case 21:break;default:ci(l,o),ui(o)}}function ui(o){var l=o.flags;if(l&2){try{for(var d,p=o.return;p!==null;){if(bT(p)){d=p;break}p=p.return}if(d==null)throw Error(n(160));switch(d.tag){case 27:var E=d.stateNode,A=Mg(o);Gd(o,A,E);break;case 5:var M=d.stateNode;d.flags&32&&(wi(M,""),d.flags&=-33);var L=Mg(o);Gd(o,L,M);break;case 3:case 4:var q=d.stateNode.containerInfo,Q=Mg(o);Pg(o,Q,q);break;default:throw Error(n(161))}}catch(it){ve(o,o.return,it)}o.flags&=-3}l&4096&&(o.flags&=-4097)}function NT(o){if(o.subtreeFlags&1024)for(o=o.child;o!==null;){var l=o;NT(l),l.tag===5&&l.flags&1024&&l.stateNode.reset(),o=o.sibling}}function jr(o,l){if(l.subtreeFlags&8772)for(l=l.child;l!==null;)RT(o,l.alternate,l),l=l.sibling}function va(o){for(o=o.child;o!==null;){var l=o;switch(l.tag){case 0:case 11:case 14:case 15:Qr(4,l,l.return),va(l);break;case 1:_s(l,l.return);var d=l.stateNode;typeof d.componentWillUnmount=="function"&&ST(l,l.return,d),va(l);break;case 27:Mu(l.stateNode);case 26:case 5:_s(l,l.return),va(l);break;case 22:l.memoizedState===null&&va(l);break;case 30:va(l);break;default:va(l)}o=o.sibling}}function Zr(o,l,d){for(d=d&&(l.subtreeFlags&8772)!==0,l=l.child;l!==null;){var p=l.alternate,E=o,A=l,M=A.flags;switch(A.tag){case 0:case 11:case 15:Zr(E,A,d),vu(4,A);break;case 1:if(Zr(E,A,d),p=A,E=p.stateNode,typeof E.componentDidMount=="function")try{E.componentDidMount()}catch(Q){ve(p,p.return,Q)}if(p=A,E=p.updateQueue,E!==null){var L=p.stateNode;try{var q=E.shared.hiddenCallbacks;if(q!==null)for(E.shared.hiddenCallbacks=null,E=0;E<q.length;E++)l0(q[E],L)}catch(Q){ve(p,p.return,Q)}}d&&M&64&&AT(A),Eu(A,A.return);break;case 27:CT(A);case 26:case 5:Zr(E,A,d),d&&p===null&&M&4&&wT(A),Eu(A,A.return);break;case 12:Zr(E,A,d);break;case 13:Zr(E,A,d),d&&M&4&&xT(E,A);break;case 22:A.memoizedState===null&&Zr(E,A,d),Eu(A,A.return);break;case 30:break;default:Zr(E,A,d)}l=l.sibling}}function Ng(o,l){var d=null;o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(d=o.memoizedState.cachePool.pool),o=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(o=l.memoizedState.cachePool.pool),o!==d&&(o!=null&&o.refCount++,d!=null&&ru(d))}function kg(o,l){o=null,l.alternate!==null&&(o=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==o&&(l.refCount++,o!=null&&ru(o))}function vs(o,l,d,p){if(l.subtreeFlags&10256)for(l=l.child;l!==null;)kT(o,l,d,p),l=l.sibling}function kT(o,l,d,p){var E=l.flags;switch(l.tag){case 0:case 11:case 15:vs(o,l,d,p),E&2048&&vu(9,l);break;case 1:vs(o,l,d,p);break;case 3:vs(o,l,d,p),E&2048&&(o=null,l.alternate!==null&&(o=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==o&&(l.refCount++,o!=null&&ru(o)));break;case 12:if(E&2048){vs(o,l,d,p),o=l.stateNode;try{var A=l.memoizedProps,M=A.id,L=A.onPostCommit;typeof L=="function"&&L(M,l.alternate===null?"mount":"update",o.passiveEffectDuration,-0)}catch(q){ve(l,l.return,q)}}else vs(o,l,d,p);break;case 13:vs(o,l,d,p);break;case 23:break;case 22:A=l.stateNode,M=l.alternate,l.memoizedState!==null?A._visibility&2?vs(o,l,d,p):Tu(o,l):A._visibility&2?vs(o,l,d,p):(A._visibility|=2,wl(o,l,d,p,(l.subtreeFlags&10256)!==0)),E&2048&&Ng(M,l);break;case 24:vs(o,l,d,p),E&2048&&kg(l.alternate,l);break;default:vs(o,l,d,p)}}function wl(o,l,d,p,E){for(E=E&&(l.subtreeFlags&10256)!==0,l=l.child;l!==null;){var A=o,M=l,L=d,q=p,Q=M.flags;switch(M.tag){case 0:case 11:case 15:wl(A,M,L,q,E),vu(8,M);break;case 23:break;case 22:var it=M.stateNode;M.memoizedState!==null?it._visibility&2?wl(A,M,L,q,E):Tu(A,M):(it._visibility|=2,wl(A,M,L,q,E)),E&&Q&2048&&Ng(M.alternate,M);break;case 24:wl(A,M,L,q,E),E&&Q&2048&&kg(M.alternate,M);break;default:wl(A,M,L,q,E)}l=l.sibling}}function Tu(o,l){if(l.subtreeFlags&10256)for(l=l.child;l!==null;){var d=o,p=l,E=p.flags;switch(p.tag){case 22:Tu(d,p),E&2048&&Ng(p.alternate,p);break;case 24:Tu(d,p),E&2048&&kg(p.alternate,p);break;default:Tu(d,p)}l=l.sibling}}var Au=8192;function bl(o){if(o.subtreeFlags&Au)for(o=o.child;o!==null;)LT(o),o=o.sibling}function LT(o){switch(o.tag){case 26:bl(o),o.flags&Au&&o.memoizedState!==null&&Ox(Xi,o.memoizedState,o.memoizedProps);break;case 5:bl(o);break;case 3:case 4:var l=Xi;Xi=ef(o.stateNode.containerInfo),bl(o),Xi=l;break;case 22:o.memoizedState===null&&(l=o.alternate,l!==null&&l.memoizedState!==null?(l=Au,Au=16777216,bl(o),Au=l):bl(o));break;default:bl(o)}}function OT(o){var l=o.alternate;if(l!==null&&(o=l.child,o!==null)){l.child=null;do l=o.sibling,o.sibling=null,o=l;while(o!==null)}}function Su(o){var l=o.deletions;if((o.flags&16)!==0){if(l!==null)for(var d=0;d<l.length;d++){var p=l[d];pn=p,VT(p,o)}OT(o)}if(o.subtreeFlags&10256)for(o=o.child;o!==null;)UT(o),o=o.sibling}function UT(o){switch(o.tag){case 0:case 11:case 15:Su(o),o.flags&2048&&Qr(9,o,o.return);break;case 3:Su(o);break;case 12:Su(o);break;case 22:var l=o.stateNode;o.memoizedState!==null&&l._visibility&2&&(o.return===null||o.return.tag!==13)?(l._visibility&=-3,qd(o)):Su(o);break;default:Su(o)}}function qd(o){var l=o.deletions;if((o.flags&16)!==0){if(l!==null)for(var d=0;d<l.length;d++){var p=l[d];pn=p,VT(p,o)}OT(o)}for(o=o.child;o!==null;){switch(l=o,l.tag){case 0:case 11:case 15:Qr(8,l,l.return),qd(l);break;case 22:d=l.stateNode,d._visibility&2&&(d._visibility&=-3,qd(l));break;default:qd(l)}o=o.sibling}}function VT(o,l){for(;pn!==null;){var d=pn;switch(d.tag){case 0:case 11:case 15:Qr(8,d,l);break;case 23:case 22:if(d.memoizedState!==null&&d.memoizedState.cachePool!==null){var p=d.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:ru(d.memoizedState.cache)}if(p=d.child,p!==null)p.return=d,pn=p;else t:for(d=o;pn!==null;){p=pn;var E=p.sibling,A=p.return;if(MT(p),p===d){pn=null;break t}if(E!==null){E.return=A,pn=E;break t}pn=A}}}var jP={getCacheForType:function(o){var l=kn(an),d=l.data.get(o);return d===void 0&&(d=o(),l.data.set(o,d)),d}},ZP=typeof WeakMap=="function"?WeakMap:Map,de=0,Ae=null,Xt=null,ne=0,fe=0,hi=null,to=!1,Cl=!1,Lg=!1,cr=0,Oe=0,eo=0,Ea=0,Og=0,xi=0,Il=0,wu=null,ti=null,Ug=!1,Vg=0,zd=1/0,$d=null,no=null,Sn=0,io=null,Rl=null,Ml=0,Bg=0,Fg=null,BT=null,bu=0,Hg=null;function di(){if((de&2)!==0&&ne!==0)return ne&-ne;if(W.T!==null){var o=gl;return o!==0?o:Kg()}return $s()}function FT(){xi===0&&(xi=(ne&536870912)===0||ae?Lc():536870912);var o=Pi.current;return o!==null&&(o.flags|=32),xi}function fi(o,l,d){(o===Ae&&(fe===2||fe===9)||o.cancelPendingCommit!==null)&&(Pl(o,0),so(o,ne,xi,!1)),Be(o,d),((de&2)===0||o!==Ae)&&(o===Ae&&((de&2)===0&&(Ea|=d),Oe===4&&so(o,ne,xi,!1)),Es(o))}function HT(o,l,d){if((de&6)!==0)throw Error(n(327));var p=!d&&(l&124)===0&&(l&o.expiredLanes)===0||Pr(o,l),E=p?nx(o,l):zg(o,l,!0),A=p;do{if(E===0){Cl&&!p&&so(o,l,0,!1);break}else{if(d=o.current.alternate,A&&!tx(d)){E=zg(o,l,!1),A=!1;continue}if(E===2){if(A=l,o.errorRecoveryDisabledLanes&A)var M=0;else M=o.pendingLanes&-536870913,M=M!==0?M:M&536870912?536870912:0;if(M!==0){l=M;t:{var L=o;E=wu;var q=L.current.memoizedState.isDehydrated;if(q&&(Pl(L,M).flags|=256),M=zg(L,M,!1),M!==2){if(Lg&&!q){L.errorRecoveryDisabledLanes|=A,Ea|=A,E=4;break t}A=ti,ti=E,A!==null&&(ti===null?ti=A:ti.push.apply(ti,A))}E=M}if(A=!1,E!==2)continue}}if(E===1){Pl(o,0),so(o,l,0,!0);break}t:{switch(p=o,A=E,A){case 0:case 1:throw Error(n(345));case 4:if((l&4194048)!==l)break;case 6:so(p,l,xi,!to);break t;case 2:ti=null;break;case 3:case 5:break;default:throw Error(n(329))}if((l&62914560)===l&&(E=Vg+300-Ve(),10<E)){if(so(p,l,xi,!to),Ai(p,0,!0)!==0)break t;p.timeoutHandle=gA(GT.bind(null,p,d,ti,$d,Ug,l,xi,Ea,Il,to,A,2,-0,0),E);break t}GT(p,d,ti,$d,Ug,l,xi,Ea,Il,to,A,0,-0,0)}}break}while(!0);Es(o)}function GT(o,l,d,p,E,A,M,L,q,Q,it,at,j,Z){if(o.timeoutHandle=-1,at=l.subtreeFlags,(at&8192||(at&16785408)===16785408)&&(Du={stylesheets:null,count:0,unsuspend:Lx},LT(l),at=Ux(),at!==null)){o.cancelPendingCommit=at(XT.bind(null,o,l,A,d,p,E,M,L,q,it,1,j,Z)),so(o,A,M,!Q);return}XT(o,l,A,d,p,E,M,L,q)}function tx(o){for(var l=o;;){var d=l.tag;if((d===0||d===11||d===15)&&l.flags&16384&&(d=l.updateQueue,d!==null&&(d=d.stores,d!==null)))for(var p=0;p<d.length;p++){var E=d[p],A=E.getSnapshot;E=E.value;try{if(!ai(A(),E))return!1}catch{return!1}}if(d=l.child,l.subtreeFlags&16384&&d!==null)d.return=l,l=d;else{if(l===o)break;for(;l.sibling===null;){if(l.return===null||l.return===o)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function so(o,l,d,p){l&=~Og,l&=~Ea,o.suspendedLanes|=l,o.pingedLanes&=~l,p&&(o.warmLanes|=l),p=o.expirationTimes;for(var E=l;0<E;){var A=31-Hn(E),M=1<<A;p[A]=-1,E&=~M}d!==0&&Dr(o,d,l)}function Yd(){return(de&6)===0?(Cu(0),!1):!0}function Gg(){if(Xt!==null){if(fe===0)var o=Xt.return;else o=Xt,er=pa=null,rg(o),Al=null,gu=0,o=Xt;for(;o!==null;)TT(o.alternate,o),o=o.return;Xt=null}}function Pl(o,l){var d=o.timeoutHandle;d!==-1&&(o.timeoutHandle=-1,_x(d)),d=o.cancelPendingCommit,d!==null&&(o.cancelPendingCommit=null,d()),Gg(),Ae=o,Xt=d=js(o.current,null),ne=l,fe=0,hi=null,to=!1,Cl=Pr(o,l),Lg=!1,Il=xi=Og=Ea=eo=Oe=0,ti=wu=null,Ug=!1,(l&8)!==0&&(l|=l&32);var p=o.entangledLanes;if(p!==0)for(o=o.entanglements,p&=l;0<p;){var E=31-Hn(p),A=1<<E;l|=o[E],p&=~A}return cr=l,pd(),d}function qT(o,l){Yt=null,W.H=Nd,l===au||l===Sd?(l=o0(),fe=3):l===i0?(l=o0(),fe=4):fe=l===aT?8:l!==null&&typeof l=="object"&&typeof l.then=="function"?6:1,hi=l,Xt===null&&(Oe=1,Vd(o,Ci(l,o.current)))}function zT(){var o=W.H;return W.H=Nd,o===null?Nd:o}function $T(){var o=W.A;return W.A=jP,o}function qg(){Oe=4,to||(ne&4194048)!==ne&&Pi.current!==null||(Cl=!0),(eo&134217727)===0&&(Ea&134217727)===0||Ae===null||so(Ae,ne,xi,!1)}function zg(o,l,d){var p=de;de|=2;var E=zT(),A=$T();(Ae!==o||ne!==l)&&($d=null,Pl(o,l)),l=!1;var M=Oe;t:do try{if(fe!==0&&Xt!==null){var L=Xt,q=hi;switch(fe){case 8:Gg(),M=6;break t;case 3:case 2:case 9:case 6:Pi.current===null&&(l=!0);var Q=fe;if(fe=0,hi=null,xl(o,L,q,Q),d&&Cl){M=0;break t}break;default:Q=fe,fe=0,hi=null,xl(o,L,q,Q)}}ex(),M=Oe;break}catch(it){qT(o,it)}while(!0);return l&&o.shellSuspendCounter++,er=pa=null,de=p,W.H=E,W.A=A,Xt===null&&(Ae=null,ne=0,pd()),M}function ex(){for(;Xt!==null;)YT(Xt)}function nx(o,l){var d=de;de|=2;var p=zT(),E=$T();Ae!==o||ne!==l?($d=null,zd=Ve()+500,Pl(o,l)):Cl=Pr(o,l);t:do try{if(fe!==0&&Xt!==null){l=Xt;var A=hi;e:switch(fe){case 1:fe=0,hi=null,xl(o,l,A,1);break;case 2:case 9:if(s0(A)){fe=0,hi=null,WT(l);break}l=function(){fe!==2&&fe!==9||Ae!==o||(fe=7),Es(o)},A.then(l,l);break t;case 3:fe=7;break t;case 4:fe=5;break t;case 7:s0(A)?(fe=0,hi=null,WT(l)):(fe=0,hi=null,xl(o,l,A,7));break;case 5:var M=null;switch(Xt.tag){case 26:M=Xt.memoizedState;case 5:case 27:var L=Xt;if(!M||RA(M)){fe=0,hi=null;var q=L.sibling;if(q!==null)Xt=q;else{var Q=L.return;Q!==null?(Xt=Q,Wd(Q)):Xt=null}break e}}fe=0,hi=null,xl(o,l,A,5);break;case 6:fe=0,hi=null,xl(o,l,A,6);break;case 8:Gg(),Oe=6;break t;default:throw Error(n(462))}}ix();break}catch(it){qT(o,it)}while(!0);return er=pa=null,W.H=p,W.A=E,de=d,Xt!==null?0:(Ae=null,ne=0,pd(),Oe)}function ix(){for(;Xt!==null&&!wt();)YT(Xt)}function YT(o){var l=vT(o.alternate,o,cr);o.memoizedProps=o.pendingProps,l===null?Wd(o):Xt=l}function WT(o){var l=o,d=l.alternate;switch(l.tag){case 15:case 0:l=fT(d,l,l.pendingProps,l.type,void 0,ne);break;case 11:l=fT(d,l,l.pendingProps,l.type.render,l.ref,ne);break;case 5:rg(l);default:TT(d,l),l=Xt=KE(l,cr),l=vT(d,l,cr)}o.memoizedProps=o.pendingProps,l===null?Wd(o):Xt=l}function xl(o,l,d,p){er=pa=null,rg(l),Al=null,gu=0;var E=l.return;try{if(YP(o,E,l,d,ne)){Oe=1,Vd(o,Ci(d,o.current)),Xt=null;return}}catch(A){if(E!==null)throw Xt=E,A;Oe=1,Vd(o,Ci(d,o.current)),Xt=null;return}l.flags&32768?(ae||p===1?o=!0:Cl||(ne&536870912)!==0?o=!1:(to=o=!0,(p===2||p===9||p===3||p===6)&&(p=Pi.current,p!==null&&p.tag===13&&(p.flags|=16384))),KT(l,o)):Wd(l)}function Wd(o){var l=o;do{if((l.flags&32768)!==0){KT(l,to);return}o=l.return;var d=KP(l.alternate,l,cr);if(d!==null){Xt=d;return}if(l=l.sibling,l!==null){Xt=l;return}Xt=l=o}while(l!==null);Oe===0&&(Oe=5)}function KT(o,l){do{var d=XP(o.alternate,o);if(d!==null){d.flags&=32767,Xt=d;return}if(d=o.return,d!==null&&(d.flags|=32768,d.subtreeFlags=0,d.deletions=null),!l&&(o=o.sibling,o!==null)){Xt=o;return}Xt=o=d}while(o!==null);Oe=6,Xt=null}function XT(o,l,d,p,E,A,M,L,q){o.cancelPendingCommit=null;do Kd();while(Sn!==0);if((de&6)!==0)throw Error(n(327));if(l!==null){if(l===o.current)throw Error(n(177));if(A=l.lanes|l.childLanes,A|=km,Qh(o,d,A,M,L,q),o===Ae&&(Xt=Ae=null,ne=0),Rl=l,io=o,Ml=d,Bg=A,Fg=E,BT=p,(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?(o.callbackNode=null,o.callbackPriority=0,ax(zs,function(){return tA(),null})):(o.callbackNode=null,o.callbackPriority=0),p=(l.flags&13878)!==0,(l.subtreeFlags&13878)!==0||p){p=W.T,W.T=null,E=nt.p,nt.p=2,M=de,de|=4;try{JP(o,l,d)}finally{de=M,nt.p=E,W.T=p}}Sn=1,JT(),QT(),jT()}}function JT(){if(Sn===1){Sn=0;var o=io,l=Rl,d=(l.flags&13878)!==0;if((l.subtreeFlags&13878)!==0||d){d=W.T,W.T=null;var p=nt.p;nt.p=2;var E=de;de|=4;try{DT(l,o);var A=ny,M=VE(o.containerInfo),L=A.focusedElem,q=A.selectionRange;if(M!==L&&L&&L.ownerDocument&&UE(L.ownerDocument.documentElement,L)){if(q!==null&&Mm(L)){var Q=q.start,it=q.end;if(it===void 0&&(it=Q),"selectionStart"in L)L.selectionStart=Q,L.selectionEnd=Math.min(it,L.value.length);else{var at=L.ownerDocument||document,j=at&&at.defaultView||window;if(j.getSelection){var Z=j.getSelection(),Lt=L.textContent.length,Pt=Math.min(q.start,Lt),ye=q.end===void 0?Pt:Math.min(q.end,Lt);!Z.extend&&Pt>ye&&(M=ye,ye=Pt,Pt=M);var K=OE(L,Pt),Y=OE(L,ye);if(K&&Y&&(Z.rangeCount!==1||Z.anchorNode!==K.node||Z.anchorOffset!==K.offset||Z.focusNode!==Y.node||Z.focusOffset!==Y.offset)){var X=at.createRange();X.setStart(K.node,K.offset),Z.removeAllRanges(),Pt>ye?(Z.addRange(X),Z.extend(Y.node,Y.offset)):(X.setEnd(Y.node,Y.offset),Z.addRange(X))}}}}for(at=[],Z=L;Z=Z.parentNode;)Z.nodeType===1&&at.push({element:Z,left:Z.scrollLeft,top:Z.scrollTop});for(typeof L.focus=="function"&&L.focus(),L=0;L<at.length;L++){var rt=at[L];rt.element.scrollLeft=rt.left,rt.element.scrollTop=rt.top}}af=!!ey,ny=ey=null}finally{de=E,nt.p=p,W.T=d}}o.current=l,Sn=2}}function QT(){if(Sn===2){Sn=0;var o=io,l=Rl,d=(l.flags&8772)!==0;if((l.subtreeFlags&8772)!==0||d){d=W.T,W.T=null;var p=nt.p;nt.p=2;var E=de;de|=4;try{RT(o,l.alternate,l)}finally{de=E,nt.p=p,W.T=d}}Sn=3}}function jT(){if(Sn===4||Sn===3){Sn=0,se();var o=io,l=Rl,d=Ml,p=BT;(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?Sn=5:(Sn=0,Rl=io=null,ZT(o,o.pendingLanes));var E=o.pendingLanes;if(E===0&&(no=null),Uc(d),l=l.stateNode,Dn&&typeof Dn.onCommitFiberRoot=="function")try{Dn.onCommitFiberRoot(Rr,l,void 0,(l.current.flags&128)===128)}catch{}if(p!==null){l=W.T,E=nt.p,nt.p=2,W.T=null;try{for(var A=o.onRecoverableError,M=0;M<p.length;M++){var L=p[M];A(L.value,{componentStack:L.stack})}}finally{W.T=l,nt.p=E}}(Ml&3)!==0&&Kd(),Es(o),E=o.pendingLanes,(d&4194090)!==0&&(E&42)!==0?o===Hg?bu++:(bu=0,Hg=o):bu=0,Cu(0)}}function ZT(o,l){(o.pooledCacheLanes&=l)===0&&(l=o.pooledCache,l!=null&&(o.pooledCache=null,ru(l)))}function Kd(o){return JT(),QT(),jT(),tA()}function tA(){if(Sn!==5)return!1;var o=io,l=Bg;Bg=0;var d=Uc(Ml),p=W.T,E=nt.p;try{nt.p=32>d?32:d,W.T=null,d=Fg,Fg=null;var A=io,M=Ml;if(Sn=0,Rl=io=null,Ml=0,(de&6)!==0)throw Error(n(331));var L=de;if(de|=4,UT(A.current),kT(A,A.current,M,d),de=L,Cu(0,!1),Dn&&typeof Dn.onPostCommitFiberRoot=="function")try{Dn.onPostCommitFiberRoot(Rr,A)}catch{}return!0}finally{nt.p=E,W.T=p,ZT(o,l)}}function eA(o,l,d){l=Ci(d,l),l=vg(o.stateNode,l,2),o=Wr(o,l,2),o!==null&&(Be(o,2),Es(o))}function ve(o,l,d){if(o.tag===3)eA(o,o,d);else for(;l!==null;){if(l.tag===3){eA(l,o,d);break}else if(l.tag===1){var p=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(no===null||!no.has(p))){o=Ci(d,o),d=rT(2),p=Wr(l,d,2),p!==null&&(oT(d,p,l,o),Be(p,2),Es(p));break}}l=l.return}}function $g(o,l,d){var p=o.pingCache;if(p===null){p=o.pingCache=new ZP;var E=new Set;p.set(l,E)}else E=p.get(l),E===void 0&&(E=new Set,p.set(l,E));E.has(d)||(Lg=!0,E.add(d),o=sx.bind(null,o,l,d),l.then(o,o))}function sx(o,l,d){var p=o.pingCache;p!==null&&p.delete(l),o.pingedLanes|=o.suspendedLanes&d,o.warmLanes&=~d,Ae===o&&(ne&d)===d&&(Oe===4||Oe===3&&(ne&62914560)===ne&&300>Ve()-Vg?(de&2)===0&&Pl(o,0):Og|=d,Il===ne&&(Il=0)),Es(o)}function nA(o,l){l===0&&(l=xr()),o=dl(o,l),o!==null&&(Be(o,l),Es(o))}function rx(o){var l=o.memoizedState,d=0;l!==null&&(d=l.retryLane),nA(o,d)}function ox(o,l){var d=0;switch(o.tag){case 13:var p=o.stateNode,E=o.memoizedState;E!==null&&(d=E.retryLane);break;case 19:p=o.stateNode;break;case 22:p=o.stateNode._retryCache;break;default:throw Error(n(314))}p!==null&&p.delete(l),nA(o,d)}function ax(o,l){return ct(o,l)}var Xd=null,Dl=null,Yg=!1,Jd=!1,Wg=!1,Ta=0;function Es(o){o!==Dl&&o.next===null&&(Dl===null?Xd=Dl=o:Dl=Dl.next=o),Jd=!0,Yg||(Yg=!0,cx())}function Cu(o,l){if(!Wg&&Jd){Wg=!0;do for(var d=!1,p=Xd;p!==null;){if(o!==0){var E=p.pendingLanes;if(E===0)var A=0;else{var M=p.suspendedLanes,L=p.pingedLanes;A=(1<<31-Hn(42|o)+1)-1,A&=E&~(M&~L),A=A&201326741?A&201326741|1:A?A|2:0}A!==0&&(d=!0,oA(p,A))}else A=ne,A=Ai(p,p===Ae?A:0,p.cancelPendingCommit!==null||p.timeoutHandle!==-1),(A&3)===0||Pr(p,A)||(d=!0,oA(p,A));p=p.next}while(d);Wg=!1}}function lx(){iA()}function iA(){Jd=Yg=!1;var o=0;Ta!==0&&(yx()&&(o=Ta),Ta=0);for(var l=Ve(),d=null,p=Xd;p!==null;){var E=p.next,A=sA(p,l);A===0?(p.next=null,d===null?Xd=E:d.next=E,E===null&&(Dl=d)):(d=p,(o!==0||(A&3)!==0)&&(Jd=!0)),p=E}Cu(o)}function sA(o,l){for(var d=o.suspendedLanes,p=o.pingedLanes,E=o.expirationTimes,A=o.pendingLanes&-62914561;0<A;){var M=31-Hn(A),L=1<<M,q=E[M];q===-1?((L&d)===0||(L&p)!==0)&&(E[M]=Xa(L,l)):q<=l&&(o.expiredLanes|=L),A&=~L}if(l=Ae,d=ne,d=Ai(o,o===l?d:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),p=o.callbackNode,d===0||o===l&&(fe===2||fe===9)||o.cancelPendingCommit!==null)return p!==null&&p!==null&&mt(p),o.callbackNode=null,o.callbackPriority=0;if((d&3)===0||Pr(o,d)){if(l=d&-d,l===o.callbackPriority)return l;switch(p!==null&&mt(p),Uc(d)){case 2:case 8:d=hn;break;case 32:d=zs;break;case 268435456:d=kc;break;default:d=zs}return p=rA.bind(null,o),d=ct(d,p),o.callbackPriority=l,o.callbackNode=d,l}return p!==null&&p!==null&&mt(p),o.callbackPriority=2,o.callbackNode=null,2}function rA(o,l){if(Sn!==0&&Sn!==5)return o.callbackNode=null,o.callbackPriority=0,null;var d=o.callbackNode;if(Kd()&&o.callbackNode!==d)return null;var p=ne;return p=Ai(o,o===Ae?p:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),p===0?null:(HT(o,p,l),sA(o,Ve()),o.callbackNode!=null&&o.callbackNode===d?rA.bind(null,o):null)}function oA(o,l){if(Kd())return null;HT(o,l,!0)}function cx(){vx(function(){(de&6)!==0?ct(rn,lx):iA()})}function Kg(){return Ta===0&&(Ta=Lc()),Ta}function aA(o){return o==null||typeof o=="symbol"||typeof o=="boolean"?null:typeof o=="function"?o:zi(""+o)}function lA(o,l){var d=l.ownerDocument.createElement("input");return d.name=l.name,d.value=l.value,o.id&&d.setAttribute("form",o.id),l.parentNode.insertBefore(d,l),o=new FormData(o),d.parentNode.removeChild(d),o}function ux(o,l,d,p,E){if(l==="submit"&&d&&d.stateNode===E){var A=aA((E[Tn]||null).action),M=p.submitter;M&&(l=(l=M[Tn]||null)?aA(l.formAction):M.getAttribute("formAction"),l!==null&&(A=l,M=null));var L=new ta("action","action",null,p,E);o.push({event:L,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if(Ta!==0){var q=M?lA(E,M):new FormData(E);pg(d,{pending:!0,data:q,method:E.method,action:A},null,q)}}else typeof A=="function"&&(L.preventDefault(),q=M?lA(E,M):new FormData(E),pg(d,{pending:!0,data:q,method:E.method,action:A},A,q))},currentTarget:E}]})}}for(var Xg=0;Xg<Nm.length;Xg++){var Jg=Nm[Xg],hx=Jg.toLowerCase(),dx=Jg[0].toUpperCase()+Jg.slice(1);Ki(hx,"on"+dx)}Ki(HE,"onAnimationEnd"),Ki(GE,"onAnimationIteration"),Ki(qE,"onAnimationStart"),Ki("dblclick","onDoubleClick"),Ki("focusin","onFocus"),Ki("focusout","onBlur"),Ki(MP,"onTransitionRun"),Ki(PP,"onTransitionStart"),Ki(xP,"onTransitionCancel"),Ki(zE,"onTransitionEnd"),ds("onMouseEnter",["mouseout","mouseover"]),ds("onMouseLeave",["mouseout","mouseover"]),ds("onPointerEnter",["pointerout","pointerover"]),ds("onPointerLeave",["pointerout","pointerover"]),hs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),hs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),hs("onBeforeInput",["compositionend","keypress","textInput","paste"]),hs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),hs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),hs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Iu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),fx=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Iu));function cA(o,l){l=(l&4)!==0;for(var d=0;d<o.length;d++){var p=o[d],E=p.event;p=p.listeners;t:{var A=void 0;if(l)for(var M=p.length-1;0<=M;M--){var L=p[M],q=L.instance,Q=L.currentTarget;if(L=L.listener,q!==A&&E.isPropagationStopped())break t;A=L,E.currentTarget=Q;try{A(E)}catch(it){Ud(it)}E.currentTarget=null,A=q}else for(M=0;M<p.length;M++){if(L=p[M],q=L.instance,Q=L.currentTarget,L=L.listener,q!==A&&E.isPropagationStopped())break t;A=L,E.currentTarget=Q;try{A(E)}catch(it){Ud(it)}E.currentTarget=null,A=q}}}}function Jt(o,l){var d=l[Ho];d===void 0&&(d=l[Ho]=new Set);var p=o+"__bubble";d.has(p)||(uA(l,o,2,!1),d.add(p))}function Qg(o,l,d){var p=0;l&&(p|=4),uA(d,o,p,l)}var Qd="_reactListening"+Math.random().toString(36).slice(2);function jg(o){if(!o[Qd]){o[Qd]=!0,jh.forEach(function(d){d!=="selectionchange"&&(fx.has(d)||Qg(d,!1,o),Qg(d,!0,o))});var l=o.nodeType===9?o:o.ownerDocument;l===null||l[Qd]||(l[Qd]=!0,Qg("selectionchange",!1,l))}}function uA(o,l,d,p){switch(kA(l)){case 2:var E=Fx;break;case 8:E=Hx;break;default:E=dy}d=E.bind(null,l,d,o),E=void 0,!Js||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(E=!0),p?E!==void 0?o.addEventListener(l,d,{capture:!0,passive:E}):o.addEventListener(l,d,!0):E!==void 0?o.addEventListener(l,d,{passive:E}):o.addEventListener(l,d,!1)}function Zg(o,l,d,p,E){var A=p;if((l&1)===0&&(l&2)===0&&p!==null)t:for(;;){if(p===null)return;var M=p.tag;if(M===3||M===4){var L=p.stateNode.containerInfo;if(L===E)break;if(M===4)for(M=p.return;M!==null;){var q=M.tag;if((q===3||q===4)&&M.stateNode.containerInfo===E)return;M=M.return}for(;L!==null;){if(M=cs(L),M===null)return;if(q=M.tag,q===5||q===6||q===26||q===27){p=A=M;continue t}L=L.parentNode}}p=p.return}Qo(function(){var Q=A,it=zc(d),at=[];t:{var j=$E.get(o);if(j!==void 0){var Z=ta,Lt=o;switch(o){case"keypress":if(jo(d)===0)break t;case"keydown":case"keyup":Z=ll;break;case"focusin":Lt="focus",Z=rl;break;case"focusout":Lt="blur",Z=rl;break;case"beforeblur":case"afterblur":Z=rl;break;case"click":if(d.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Z=ra;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Z=rd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Z=qr;break;case HE:case GE:case qE:Z=Yc;break;case zE:Z=w;break;case"scroll":case"scrollend":Z=na;break;case"wheel":Z=O;break;case"copy":case"cut":case"paste":Z=ad;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Z=Xc;break;case"toggle":case"beforetoggle":Z=tt}var Pt=(l&4)!==0,ye=!Pt&&(o==="scroll"||o==="scrollend"),K=Pt?j!==null?j+"Capture":null:j;Pt=[];for(var Y=Q,X;Y!==null;){var rt=Y;if(X=rt.stateNode,rt=rt.tag,rt!==5&&rt!==26&&rt!==27||X===null||K===null||(rt=Hr(Y,K),rt!=null&&Pt.push(Ru(Y,rt,X))),ye)break;Y=Y.return}0<Pt.length&&(j=new Z(j,Lt,null,d,it),at.push({event:j,listeners:Pt}))}}if((l&7)===0){t:{if(j=o==="mouseover"||o==="pointerover",Z=o==="mouseout"||o==="pointerout",j&&d!==qc&&(Lt=d.relatedTarget||d.fromElement)&&(cs(Lt)||Lt[Ys]))break t;if((Z||j)&&(j=it.window===it?it:(j=it.ownerDocument)?j.defaultView||j.parentWindow:window,Z?(Lt=d.relatedTarget||d.toElement,Z=Q,Lt=Lt?cs(Lt):null,Lt!==null&&(ye=r(Lt),Pt=Lt.tag,Lt!==ye||Pt!==5&&Pt!==27&&Pt!==6)&&(Lt=null)):(Z=null,Lt=Q),Z!==Lt)){if(Pt=ra,rt="onMouseLeave",K="onMouseEnter",Y="mouse",(o==="pointerout"||o==="pointerover")&&(Pt=Xc,rt="onPointerLeave",K="onPointerEnter",Y="pointer"),ye=Z==null?j:Lr(Z),X=Lt==null?j:Lr(Lt),j=new Pt(rt,Y+"leave",Z,d,it),j.target=ye,j.relatedTarget=X,rt=null,cs(it)===Q&&(Pt=new Pt(K,Y+"enter",Lt,d,it),Pt.target=X,Pt.relatedTarget=ye,rt=Pt),ye=rt,Z&&Lt)e:{for(Pt=Z,K=Lt,Y=0,X=Pt;X;X=Nl(X))Y++;for(X=0,rt=K;rt;rt=Nl(rt))X++;for(;0<Y-X;)Pt=Nl(Pt),Y--;for(;0<X-Y;)K=Nl(K),X--;for(;Y--;){if(Pt===K||K!==null&&Pt===K.alternate)break e;Pt=Nl(Pt),K=Nl(K)}Pt=null}else Pt=null;Z!==null&&hA(at,j,Z,Pt,!1),Lt!==null&&ye!==null&&hA(at,ye,Lt,Pt,!0)}}t:{if(j=Q?Lr(Q):window,Z=j.nodeName&&j.nodeName.toLowerCase(),Z==="select"||Z==="input"&&j.type==="file")var At=PE;else if(RE(j))if(xE)At=CP;else{At=wP;var Kt=SP}else Z=j.nodeName,!Z||Z.toLowerCase()!=="input"||j.type!=="checkbox"&&j.type!=="radio"?Q&&nl(Q.elementType)&&(At=PE):At=bP;if(At&&(At=At(o,Q))){ME(at,At,d,it);break t}Kt&&Kt(o,j,Q),o==="focusout"&&Q&&j.type==="number"&&Q.memoizedProps.value!=null&&Fc(j,"number",j.value)}switch(Kt=Q?Lr(Q):window,o){case"focusin":(RE(Kt)||Kt.contentEditable==="true")&&(cl=Kt,Pm=Q,tu=null);break;case"focusout":tu=Pm=cl=null;break;case"mousedown":xm=!0;break;case"contextmenu":case"mouseup":case"dragend":xm=!1,BE(at,d,it);break;case"selectionchange":if(RP)break;case"keydown":case"keyup":BE(at,d,it)}var Ct;if(Bt)t:{switch(o){case"compositionstart":var Dt="onCompositionStart";break t;case"compositionend":Dt="onCompositionEnd";break t;case"compositionupdate":Dt="onCompositionUpdate";break t}Dt=void 0}else Wi?$i(o,d)&&(Dt="onCompositionEnd"):o==="keydown"&&d.keyCode===229&&(Dt="onCompositionStart");Dt&&(Ge&&d.locale!=="ko"&&(Wi||Dt!=="onCompositionStart"?Dt==="onCompositionEnd"&&Wi&&(Ct=sd()):(bi=it,Te="value"in bi?bi.value:bi.textContent,Wi=!0)),Kt=jd(Q,Dt),0<Kt.length&&(Dt=new Kc(Dt,o,null,d,it),at.push({event:Dt,listeners:Kt}),Ct?Dt.data=Ct:(Ct=Yi(d),Ct!==null&&(Dt.data=Ct)))),(Ct=he?Jc(o,d):EP(o,d))&&(Dt=jd(Q,"onBeforeInput"),0<Dt.length&&(Kt=new Kc("onBeforeInput","beforeinput",null,d,it),at.push({event:Kt,listeners:Dt}),Kt.data=Ct)),ux(at,o,Q,d,it)}cA(at,l)})}function Ru(o,l,d){return{instance:o,listener:l,currentTarget:d}}function jd(o,l){for(var d=l+"Capture",p=[];o!==null;){var E=o,A=E.stateNode;if(E=E.tag,E!==5&&E!==26&&E!==27||A===null||(E=Hr(o,d),E!=null&&p.unshift(Ru(o,E,A)),E=Hr(o,l),E!=null&&p.push(Ru(o,E,A))),o.tag===3)return p;o=o.return}return[]}function Nl(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5&&o.tag!==27);return o||null}function hA(o,l,d,p,E){for(var A=l._reactName,M=[];d!==null&&d!==p;){var L=d,q=L.alternate,Q=L.stateNode;if(L=L.tag,q!==null&&q===p)break;L!==5&&L!==26&&L!==27||Q===null||(q=Q,E?(Q=Hr(d,A),Q!=null&&M.unshift(Ru(d,Q,q))):E||(Q=Hr(d,A),Q!=null&&M.push(Ru(d,Q,q)))),d=d.return}M.length!==0&&o.push({event:l,listeners:M})}var px=/\r\n?/g,mx=/\u0000|\uFFFD/g;function dA(o){return(typeof o=="string"?o:""+o).replace(px,`
`).replace(mx,"")}function fA(o,l){return l=dA(l),dA(o)===l}function Zd(){}function ge(o,l,d,p,E,A){switch(d){case"children":typeof p=="string"?l==="body"||l==="textarea"&&p===""||wi(o,p):(typeof p=="number"||typeof p=="bigint")&&l!=="body"&&wi(o,""+p);break;case"className":Yo(o,"class",p);break;case"tabIndex":Yo(o,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":Yo(o,d,p);break;case"style":Gc(o,p,A);break;case"data":if(l!=="object"){Yo(o,"data",p);break}case"src":case"href":if(p===""&&(l!=="a"||d!=="href")){o.removeAttribute(d);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){o.removeAttribute(d);break}p=zi(""+p),o.setAttribute(d,p);break;case"action":case"formAction":if(typeof p=="function"){o.setAttribute(d,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof A=="function"&&(d==="formAction"?(l!=="input"&&ge(o,l,"name",E.name,E,null),ge(o,l,"formEncType",E.formEncType,E,null),ge(o,l,"formMethod",E.formMethod,E,null),ge(o,l,"formTarget",E.formTarget,E,null)):(ge(o,l,"encType",E.encType,E,null),ge(o,l,"method",E.method,E,null),ge(o,l,"target",E.target,E,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){o.removeAttribute(d);break}p=zi(""+p),o.setAttribute(d,p);break;case"onClick":p!=null&&(o.onclick=Zd);break;case"onScroll":p!=null&&Jt("scroll",o);break;case"onScrollEnd":p!=null&&Jt("scrollend",o);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(n(61));if(d=p.__html,d!=null){if(E.children!=null)throw Error(n(60));o.innerHTML=d}}break;case"multiple":o.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":o.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){o.removeAttribute("xlink:href");break}d=zi(""+p),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",d);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?o.setAttribute(d,""+p):o.removeAttribute(d);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?o.setAttribute(d,""):o.removeAttribute(d);break;case"capture":case"download":p===!0?o.setAttribute(d,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?o.setAttribute(d,p):o.removeAttribute(d);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?o.setAttribute(d,p):o.removeAttribute(d);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?o.removeAttribute(d):o.setAttribute(d,p);break;case"popover":Jt("beforetoggle",o),Jt("toggle",o),$o(o,"popover",p);break;case"xlinkActuate":Si(o,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":Si(o,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":Si(o,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":Si(o,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":Si(o,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":Si(o,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":Si(o,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":Si(o,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":Si(o,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":$o(o,"is",p);break;case"innerText":case"textContent":break;default:(!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(d=ed.get(d)||d,$o(o,d,p))}}function ty(o,l,d,p,E,A){switch(d){case"style":Gc(o,p,A);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(n(61));if(d=p.__html,d!=null){if(E.children!=null)throw Error(n(60));o.innerHTML=d}}break;case"children":typeof p=="string"?wi(o,p):(typeof p=="number"||typeof p=="bigint")&&wi(o,""+p);break;case"onScroll":p!=null&&Jt("scroll",o);break;case"onScrollEnd":p!=null&&Jt("scrollend",o);break;case"onClick":p!=null&&(o.onclick=Zd);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!qo.hasOwnProperty(d))t:{if(d[0]==="o"&&d[1]==="n"&&(E=d.endsWith("Capture"),l=d.slice(2,E?d.length-7:void 0),A=o[Tn]||null,A=A!=null?A[d]:null,typeof A=="function"&&o.removeEventListener(l,A,E),typeof p=="function")){typeof A!="function"&&A!==null&&(d in o?o[d]=null:o.hasAttribute(d)&&o.removeAttribute(d)),o.addEventListener(l,p,E);break t}d in o?o[d]=p:p===!0?o.setAttribute(d,""):$o(o,d,p)}}}function wn(o,l,d){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Jt("error",o),Jt("load",o);var p=!1,E=!1,A;for(A in d)if(d.hasOwnProperty(A)){var M=d[A];if(M!=null)switch(A){case"src":p=!0;break;case"srcSet":E=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,l));default:ge(o,l,A,M,d,null)}}E&&ge(o,l,"srcSet",d.srcSet,d,null),p&&ge(o,l,"src",d.src,d,null);return;case"input":Jt("invalid",o);var L=A=M=E=null,q=null,Q=null;for(p in d)if(d.hasOwnProperty(p)){var it=d[p];if(it!=null)switch(p){case"name":E=it;break;case"type":M=it;break;case"checked":q=it;break;case"defaultChecked":Q=it;break;case"value":A=it;break;case"defaultValue":L=it;break;case"children":case"dangerouslySetInnerHTML":if(it!=null)throw Error(n(137,l));break;default:ge(o,l,p,it,d,null)}}Bc(o,A,L,q,Q,M,E,!1),Vr(o);return;case"select":Jt("invalid",o),p=M=A=null;for(E in d)if(d.hasOwnProperty(E)&&(L=d[E],L!=null))switch(E){case"value":A=L;break;case"defaultValue":M=L;break;case"multiple":p=L;default:ge(o,l,E,L,d,null)}l=A,d=M,o.multiple=!!p,l!=null?Br(o,!!p,l,!1):d!=null&&Br(o,!!p,d,!0);return;case"textarea":Jt("invalid",o),A=E=p=null;for(M in d)if(d.hasOwnProperty(M)&&(L=d[M],L!=null))switch(M){case"value":p=L;break;case"defaultValue":E=L;break;case"children":A=L;break;case"dangerouslySetInnerHTML":if(L!=null)throw Error(n(91));break;default:ge(o,l,M,L,d,null)}td(o,p,E,A),Vr(o);return;case"option":for(q in d)if(d.hasOwnProperty(q)&&(p=d[q],p!=null))switch(q){case"selected":o.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:ge(o,l,q,p,d,null)}return;case"dialog":Jt("beforetoggle",o),Jt("toggle",o),Jt("cancel",o),Jt("close",o);break;case"iframe":case"object":Jt("load",o);break;case"video":case"audio":for(p=0;p<Iu.length;p++)Jt(Iu[p],o);break;case"image":Jt("error",o),Jt("load",o);break;case"details":Jt("toggle",o);break;case"embed":case"source":case"link":Jt("error",o),Jt("load",o);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Q in d)if(d.hasOwnProperty(Q)&&(p=d[Q],p!=null))switch(Q){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,l));default:ge(o,l,Q,p,d,null)}return;default:if(nl(l)){for(it in d)d.hasOwnProperty(it)&&(p=d[it],p!==void 0&&ty(o,l,it,p,d,void 0));return}}for(L in d)d.hasOwnProperty(L)&&(p=d[L],p!=null&&ge(o,l,L,p,d,null))}function gx(o,l,d,p){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var E=null,A=null,M=null,L=null,q=null,Q=null,it=null;for(Z in d){var at=d[Z];if(d.hasOwnProperty(Z)&&at!=null)switch(Z){case"checked":break;case"value":break;case"defaultValue":q=at;default:p.hasOwnProperty(Z)||ge(o,l,Z,null,p,at)}}for(var j in p){var Z=p[j];if(at=d[j],p.hasOwnProperty(j)&&(Z!=null||at!=null))switch(j){case"type":A=Z;break;case"name":E=Z;break;case"checked":Q=Z;break;case"defaultChecked":it=Z;break;case"value":M=Z;break;case"defaultValue":L=Z;break;case"children":case"dangerouslySetInnerHTML":if(Z!=null)throw Error(n(137,l));break;default:Z!==at&&ge(o,l,j,Z,p,at)}}Vc(o,M,L,q,Q,it,A,E);return;case"select":Z=M=L=j=null;for(A in d)if(q=d[A],d.hasOwnProperty(A)&&q!=null)switch(A){case"value":break;case"multiple":Z=q;default:p.hasOwnProperty(A)||ge(o,l,A,null,p,q)}for(E in p)if(A=p[E],q=d[E],p.hasOwnProperty(E)&&(A!=null||q!=null))switch(E){case"value":j=A;break;case"defaultValue":L=A;break;case"multiple":M=A;default:A!==q&&ge(o,l,E,A,p,q)}l=L,d=M,p=Z,j!=null?Br(o,!!d,j,!1):!!p!=!!d&&(l!=null?Br(o,!!d,l,!0):Br(o,!!d,d?[]:"",!1));return;case"textarea":Z=j=null;for(L in d)if(E=d[L],d.hasOwnProperty(L)&&E!=null&&!p.hasOwnProperty(L))switch(L){case"value":break;case"children":break;default:ge(o,l,L,null,p,E)}for(M in p)if(E=p[M],A=d[M],p.hasOwnProperty(M)&&(E!=null||A!=null))switch(M){case"value":j=E;break;case"defaultValue":Z=E;break;case"children":break;case"dangerouslySetInnerHTML":if(E!=null)throw Error(n(91));break;default:E!==A&&ge(o,l,M,E,p,A)}Zh(o,j,Z);return;case"option":for(var Lt in d)if(j=d[Lt],d.hasOwnProperty(Lt)&&j!=null&&!p.hasOwnProperty(Lt))switch(Lt){case"selected":o.selected=!1;break;default:ge(o,l,Lt,null,p,j)}for(q in p)if(j=p[q],Z=d[q],p.hasOwnProperty(q)&&j!==Z&&(j!=null||Z!=null))switch(q){case"selected":o.selected=j&&typeof j!="function"&&typeof j!="symbol";break;default:ge(o,l,q,j,p,Z)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Pt in d)j=d[Pt],d.hasOwnProperty(Pt)&&j!=null&&!p.hasOwnProperty(Pt)&&ge(o,l,Pt,null,p,j);for(Q in p)if(j=p[Q],Z=d[Q],p.hasOwnProperty(Q)&&j!==Z&&(j!=null||Z!=null))switch(Q){case"children":case"dangerouslySetInnerHTML":if(j!=null)throw Error(n(137,l));break;default:ge(o,l,Q,j,p,Z)}return;default:if(nl(l)){for(var ye in d)j=d[ye],d.hasOwnProperty(ye)&&j!==void 0&&!p.hasOwnProperty(ye)&&ty(o,l,ye,void 0,p,j);for(it in p)j=p[it],Z=d[it],!p.hasOwnProperty(it)||j===Z||j===void 0&&Z===void 0||ty(o,l,it,j,p,Z);return}}for(var K in d)j=d[K],d.hasOwnProperty(K)&&j!=null&&!p.hasOwnProperty(K)&&ge(o,l,K,null,p,j);for(at in p)j=p[at],Z=d[at],!p.hasOwnProperty(at)||j===Z||j==null&&Z==null||ge(o,l,at,j,p,Z)}var ey=null,ny=null;function tf(o){return o.nodeType===9?o:o.ownerDocument}function pA(o){switch(o){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function mA(o,l){if(o===0)switch(l){case"svg":return 1;case"math":return 2;default:return 0}return o===1&&l==="foreignObject"?0:o}function iy(o,l){return o==="textarea"||o==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.children=="bigint"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var sy=null;function yx(){var o=window.event;return o&&o.type==="popstate"?o===sy?!1:(sy=o,!0):(sy=null,!1)}var gA=typeof setTimeout=="function"?setTimeout:void 0,_x=typeof clearTimeout=="function"?clearTimeout:void 0,yA=typeof Promise=="function"?Promise:void 0,vx=typeof queueMicrotask=="function"?queueMicrotask:typeof yA<"u"?function(o){return yA.resolve(null).then(o).catch(Ex)}:gA;function Ex(o){setTimeout(function(){throw o})}function ro(o){return o==="head"}function _A(o,l){var d=l,p=0,E=0;do{var A=d.nextSibling;if(o.removeChild(d),A&&A.nodeType===8)if(d=A.data,d==="/$"){if(0<p&&8>p){d=p;var M=o.ownerDocument;if(d&1&&Mu(M.documentElement),d&2&&Mu(M.body),d&4)for(d=M.head,Mu(d),M=d.firstChild;M;){var L=M.nextSibling,q=M.nodeName;M[kr]||q==="SCRIPT"||q==="STYLE"||q==="LINK"&&M.rel.toLowerCase()==="stylesheet"||d.removeChild(M),M=L}}if(E===0){o.removeChild(A),Uu(l);return}E--}else d==="$"||d==="$?"||d==="$!"?E++:p=d.charCodeAt(0)-48;else p=0;d=A}while(d);Uu(l)}function ry(o){var l=o.firstChild;for(l&&l.nodeType===10&&(l=l.nextSibling);l;){var d=l;switch(l=l.nextSibling,d.nodeName){case"HTML":case"HEAD":case"BODY":ry(d),Qa(d);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(d.rel.toLowerCase()==="stylesheet")continue}o.removeChild(d)}}function Tx(o,l,d,p){for(;o.nodeType===1;){var E=d;if(o.nodeName.toLowerCase()!==l.toLowerCase()){if(!p&&(o.nodeName!=="INPUT"||o.type!=="hidden"))break}else if(p){if(!o[kr])switch(l){case"meta":if(!o.hasAttribute("itemprop"))break;return o;case"link":if(A=o.getAttribute("rel"),A==="stylesheet"&&o.hasAttribute("data-precedence"))break;if(A!==E.rel||o.getAttribute("href")!==(E.href==null||E.href===""?null:E.href)||o.getAttribute("crossorigin")!==(E.crossOrigin==null?null:E.crossOrigin)||o.getAttribute("title")!==(E.title==null?null:E.title))break;return o;case"style":if(o.hasAttribute("data-precedence"))break;return o;case"script":if(A=o.getAttribute("src"),(A!==(E.src==null?null:E.src)||o.getAttribute("type")!==(E.type==null?null:E.type)||o.getAttribute("crossorigin")!==(E.crossOrigin==null?null:E.crossOrigin))&&A&&o.hasAttribute("async")&&!o.hasAttribute("itemprop"))break;return o;default:return o}}else if(l==="input"&&o.type==="hidden"){var A=E.name==null?null:""+E.name;if(E.type==="hidden"&&o.getAttribute("name")===A)return o}else return o;if(o=Ji(o.nextSibling),o===null)break}return null}function Ax(o,l,d){if(l==="")return null;for(;o.nodeType!==3;)if((o.nodeType!==1||o.nodeName!=="INPUT"||o.type!=="hidden")&&!d||(o=Ji(o.nextSibling),o===null))return null;return o}function oy(o){return o.data==="$!"||o.data==="$?"&&o.ownerDocument.readyState==="complete"}function Sx(o,l){var d=o.ownerDocument;if(o.data!=="$?"||d.readyState==="complete")l();else{var p=function(){l(),d.removeEventListener("DOMContentLoaded",p)};d.addEventListener("DOMContentLoaded",p),o._reactRetry=p}}function Ji(o){for(;o!=null;o=o.nextSibling){var l=o.nodeType;if(l===1||l===3)break;if(l===8){if(l=o.data,l==="$"||l==="$!"||l==="$?"||l==="F!"||l==="F")break;if(l==="/$")return null}}return o}var ay=null;function vA(o){o=o.previousSibling;for(var l=0;o;){if(o.nodeType===8){var d=o.data;if(d==="$"||d==="$!"||d==="$?"){if(l===0)return o;l--}else d==="/$"&&l++}o=o.previousSibling}return null}function EA(o,l,d){switch(l=tf(d),o){case"html":if(o=l.documentElement,!o)throw Error(n(452));return o;case"head":if(o=l.head,!o)throw Error(n(453));return o;case"body":if(o=l.body,!o)throw Error(n(454));return o;default:throw Error(n(451))}}function Mu(o){for(var l=o.attributes;l.length;)o.removeAttributeNode(l[0]);Qa(o)}var Di=new Map,TA=new Set;function ef(o){return typeof o.getRootNode=="function"?o.getRootNode():o.nodeType===9?o:o.ownerDocument}var ur=nt.d;nt.d={f:wx,r:bx,D:Cx,C:Ix,L:Rx,m:Mx,X:xx,S:Px,M:Dx};function wx(){var o=ur.f(),l=Yd();return o||l}function bx(o){var l=us(o);l!==null&&l.tag===5&&l.type==="form"?H0(l):ur.r(o)}var kl=typeof document>"u"?null:document;function AA(o,l,d){var p=kl;if(p&&typeof l=="string"&&l){var E=dn(l);E='link[rel="'+o+'"][href="'+E+'"]',typeof d=="string"&&(E+='[crossorigin="'+d+'"]'),TA.has(E)||(TA.add(E),o={rel:o,crossOrigin:d,href:l},p.querySelector(E)===null&&(l=p.createElement("link"),wn(l,"link",o),He(l),p.head.appendChild(l)))}}function Cx(o){ur.D(o),AA("dns-prefetch",o,null)}function Ix(o,l){ur.C(o,l),AA("preconnect",o,l)}function Rx(o,l,d){ur.L(o,l,d);var p=kl;if(p&&o&&l){var E='link[rel="preload"][as="'+dn(l)+'"]';l==="image"&&d&&d.imageSrcSet?(E+='[imagesrcset="'+dn(d.imageSrcSet)+'"]',typeof d.imageSizes=="string"&&(E+='[imagesizes="'+dn(d.imageSizes)+'"]')):E+='[href="'+dn(o)+'"]';var A=E;switch(l){case"style":A=Ll(o);break;case"script":A=Ol(o)}Di.has(A)||(o=f({rel:"preload",href:l==="image"&&d&&d.imageSrcSet?void 0:o,as:l},d),Di.set(A,o),p.querySelector(E)!==null||l==="style"&&p.querySelector(Pu(A))||l==="script"&&p.querySelector(xu(A))||(l=p.createElement("link"),wn(l,"link",o),He(l),p.head.appendChild(l)))}}function Mx(o,l){ur.m(o,l);var d=kl;if(d&&o){var p=l&&typeof l.as=="string"?l.as:"script",E='link[rel="modulepreload"][as="'+dn(p)+'"][href="'+dn(o)+'"]',A=E;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":A=Ol(o)}if(!Di.has(A)&&(o=f({rel:"modulepreload",href:o},l),Di.set(A,o),d.querySelector(E)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(d.querySelector(xu(A)))return}p=d.createElement("link"),wn(p,"link",o),He(p),d.head.appendChild(p)}}}function Px(o,l,d){ur.S(o,l,d);var p=kl;if(p&&o){var E=Or(p).hoistableStyles,A=Ll(o);l=l||"default";var M=E.get(A);if(!M){var L={loading:0,preload:null};if(M=p.querySelector(Pu(A)))L.loading=5;else{o=f({rel:"stylesheet",href:o,"data-precedence":l},d),(d=Di.get(A))&&ly(o,d);var q=M=p.createElement("link");He(q),wn(q,"link",o),q._p=new Promise(function(Q,it){q.onload=Q,q.onerror=it}),q.addEventListener("load",function(){L.loading|=1}),q.addEventListener("error",function(){L.loading|=2}),L.loading|=4,nf(M,l,p)}M={type:"stylesheet",instance:M,count:1,state:L},E.set(A,M)}}}function xx(o,l){ur.X(o,l);var d=kl;if(d&&o){var p=Or(d).hoistableScripts,E=Ol(o),A=p.get(E);A||(A=d.querySelector(xu(E)),A||(o=f({src:o,async:!0},l),(l=Di.get(E))&&cy(o,l),A=d.createElement("script"),He(A),wn(A,"link",o),d.head.appendChild(A)),A={type:"script",instance:A,count:1,state:null},p.set(E,A))}}function Dx(o,l){ur.M(o,l);var d=kl;if(d&&o){var p=Or(d).hoistableScripts,E=Ol(o),A=p.get(E);A||(A=d.querySelector(xu(E)),A||(o=f({src:o,async:!0,type:"module"},l),(l=Di.get(E))&&cy(o,l),A=d.createElement("script"),He(A),wn(A,"link",o),d.head.appendChild(A)),A={type:"script",instance:A,count:1,state:null},p.set(E,A))}}function SA(o,l,d,p){var E=(E=St.current)?ef(E):null;if(!E)throw Error(n(446));switch(o){case"meta":case"title":return null;case"style":return typeof d.precedence=="string"&&typeof d.href=="string"?(l=Ll(d.href),d=Or(E).hoistableStyles,p=d.get(l),p||(p={type:"style",instance:null,count:0,state:null},d.set(l,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(d.rel==="stylesheet"&&typeof d.href=="string"&&typeof d.precedence=="string"){o=Ll(d.href);var A=Or(E).hoistableStyles,M=A.get(o);if(M||(E=E.ownerDocument||E,M={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},A.set(o,M),(A=E.querySelector(Pu(o)))&&!A._p&&(M.instance=A,M.state.loading=5),Di.has(o)||(d={rel:"preload",as:"style",href:d.href,crossOrigin:d.crossOrigin,integrity:d.integrity,media:d.media,hrefLang:d.hrefLang,referrerPolicy:d.referrerPolicy},Di.set(o,d),A||Nx(E,o,d,M.state))),l&&p===null)throw Error(n(528,""));return M}if(l&&p!==null)throw Error(n(529,""));return null;case"script":return l=d.async,d=d.src,typeof d=="string"&&l&&typeof l!="function"&&typeof l!="symbol"?(l=Ol(d),d=Or(E).hoistableScripts,p=d.get(l),p||(p={type:"script",instance:null,count:0,state:null},d.set(l,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,o))}}function Ll(o){return'href="'+dn(o)+'"'}function Pu(o){return'link[rel="stylesheet"]['+o+"]"}function wA(o){return f({},o,{"data-precedence":o.precedence,precedence:null})}function Nx(o,l,d,p){o.querySelector('link[rel="preload"][as="style"]['+l+"]")?p.loading=1:(l=o.createElement("link"),p.preload=l,l.addEventListener("load",function(){return p.loading|=1}),l.addEventListener("error",function(){return p.loading|=2}),wn(l,"link",d),He(l),o.head.appendChild(l))}function Ol(o){return'[src="'+dn(o)+'"]'}function xu(o){return"script[async]"+o}function bA(o,l,d){if(l.count++,l.instance===null)switch(l.type){case"style":var p=o.querySelector('style[data-href~="'+dn(d.href)+'"]');if(p)return l.instance=p,He(p),p;var E=f({},d,{"data-href":d.href,"data-precedence":d.precedence,href:null,precedence:null});return p=(o.ownerDocument||o).createElement("style"),He(p),wn(p,"style",E),nf(p,d.precedence,o),l.instance=p;case"stylesheet":E=Ll(d.href);var A=o.querySelector(Pu(E));if(A)return l.state.loading|=4,l.instance=A,He(A),A;p=wA(d),(E=Di.get(E))&&ly(p,E),A=(o.ownerDocument||o).createElement("link"),He(A);var M=A;return M._p=new Promise(function(L,q){M.onload=L,M.onerror=q}),wn(A,"link",p),l.state.loading|=4,nf(A,d.precedence,o),l.instance=A;case"script":return A=Ol(d.src),(E=o.querySelector(xu(A)))?(l.instance=E,He(E),E):(p=d,(E=Di.get(A))&&(p=f({},d),cy(p,E)),o=o.ownerDocument||o,E=o.createElement("script"),He(E),wn(E,"link",p),o.head.appendChild(E),l.instance=E);case"void":return null;default:throw Error(n(443,l.type))}else l.type==="stylesheet"&&(l.state.loading&4)===0&&(p=l.instance,l.state.loading|=4,nf(p,d.precedence,o));return l.instance}function nf(o,l,d){for(var p=d.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),E=p.length?p[p.length-1]:null,A=E,M=0;M<p.length;M++){var L=p[M];if(L.dataset.precedence===l)A=L;else if(A!==E)break}A?A.parentNode.insertBefore(o,A.nextSibling):(l=d.nodeType===9?d.head:d,l.insertBefore(o,l.firstChild))}function ly(o,l){o.crossOrigin==null&&(o.crossOrigin=l.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=l.referrerPolicy),o.title==null&&(o.title=l.title)}function cy(o,l){o.crossOrigin==null&&(o.crossOrigin=l.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=l.referrerPolicy),o.integrity==null&&(o.integrity=l.integrity)}var sf=null;function CA(o,l,d){if(sf===null){var p=new Map,E=sf=new Map;E.set(d,p)}else E=sf,p=E.get(d),p||(p=new Map,E.set(d,p));if(p.has(o))return p;for(p.set(o,null),d=d.getElementsByTagName(o),E=0;E<d.length;E++){var A=d[E];if(!(A[kr]||A[Fe]||o==="link"&&A.getAttribute("rel")==="stylesheet")&&A.namespaceURI!=="http://www.w3.org/2000/svg"){var M=A.getAttribute(l)||"";M=o+M;var L=p.get(M);L?L.push(A):p.set(M,[A])}}return p}function IA(o,l,d){o=o.ownerDocument||o,o.head.insertBefore(d,l==="title"?o.querySelector("head > title"):null)}function kx(o,l,d){if(d===1||l.itemProp!=null)return!1;switch(o){case"meta":case"title":return!0;case"style":if(typeof l.precedence!="string"||typeof l.href!="string"||l.href==="")break;return!0;case"link":if(typeof l.rel!="string"||typeof l.href!="string"||l.href===""||l.onLoad||l.onError)break;switch(l.rel){case"stylesheet":return o=l.disabled,typeof l.precedence=="string"&&o==null;default:return!0}case"script":if(l.async&&typeof l.async!="function"&&typeof l.async!="symbol"&&!l.onLoad&&!l.onError&&l.src&&typeof l.src=="string")return!0}return!1}function RA(o){return!(o.type==="stylesheet"&&(o.state.loading&3)===0)}var Du=null;function Lx(){}function Ox(o,l,d){if(Du===null)throw Error(n(475));var p=Du;if(l.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var E=Ll(d.href),A=o.querySelector(Pu(E));if(A){o=A._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(p.count++,p=rf.bind(p),o.then(p,p)),l.state.loading|=4,l.instance=A,He(A);return}A=o.ownerDocument||o,d=wA(d),(E=Di.get(E))&&ly(d,E),A=A.createElement("link"),He(A);var M=A;M._p=new Promise(function(L,q){M.onload=L,M.onerror=q}),wn(A,"link",d),l.instance=A}p.stylesheets===null&&(p.stylesheets=new Map),p.stylesheets.set(l,o),(o=l.state.preload)&&(l.state.loading&3)===0&&(p.count++,l=rf.bind(p),o.addEventListener("load",l),o.addEventListener("error",l))}}function Ux(){if(Du===null)throw Error(n(475));var o=Du;return o.stylesheets&&o.count===0&&uy(o,o.stylesheets),0<o.count?function(l){var d=setTimeout(function(){if(o.stylesheets&&uy(o,o.stylesheets),o.unsuspend){var p=o.unsuspend;o.unsuspend=null,p()}},6e4);return o.unsuspend=l,function(){o.unsuspend=null,clearTimeout(d)}}:null}function rf(){if(this.count--,this.count===0){if(this.stylesheets)uy(this,this.stylesheets);else if(this.unsuspend){var o=this.unsuspend;this.unsuspend=null,o()}}}var of=null;function uy(o,l){o.stylesheets=null,o.unsuspend!==null&&(o.count++,of=new Map,l.forEach(Vx,o),of=null,rf.call(o))}function Vx(o,l){if(!(l.state.loading&4)){var d=of.get(o);if(d)var p=d.get(null);else{d=new Map,of.set(o,d);for(var E=o.querySelectorAll("link[data-precedence],style[data-precedence]"),A=0;A<E.length;A++){var M=E[A];(M.nodeName==="LINK"||M.getAttribute("media")!=="not all")&&(d.set(M.dataset.precedence,M),p=M)}p&&d.set(null,p)}E=l.instance,M=E.getAttribute("data-precedence"),A=d.get(M)||p,A===p&&d.set(null,E),d.set(M,E),this.count++,p=rf.bind(this),E.addEventListener("load",p),E.addEventListener("error",p),A?A.parentNode.insertBefore(E,A.nextSibling):(o=o.nodeType===9?o.head:o,o.insertBefore(E,o.firstChild)),l.state.loading|=4}}var Nu={$$typeof:P,Provider:null,Consumer:null,_currentValue:ft,_currentValue2:ft,_threadCount:0};function Bx(o,l,d,p,E,A,M,L){this.tag=1,this.containerInfo=o,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ja(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ja(0),this.hiddenUpdates=Ja(null),this.identifierPrefix=p,this.onUncaughtError=E,this.onCaughtError=A,this.onRecoverableError=M,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=L,this.incompleteTransitions=new Map}function MA(o,l,d,p,E,A,M,L,q,Q,it,at){return o=new Bx(o,l,d,M,L,q,Q,at),l=1,A===!0&&(l|=24),A=li(3,null,null,l),o.current=A,A.stateNode=o,l=$m(),l.refCount++,o.pooledCache=l,l.refCount++,A.memoizedState={element:p,isDehydrated:d,cache:l},Xm(A),o}function PA(o){return o?(o=fl,o):fl}function xA(o,l,d,p,E,A){E=PA(E),p.context===null?p.context=E:p.pendingContext=E,p=Yr(l),p.payload={element:d},A=A===void 0?null:A,A!==null&&(p.callback=A),d=Wr(o,p,l),d!==null&&(fi(d,o,l),cu(d,o,l))}function DA(o,l){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var d=o.retryLane;o.retryLane=d!==0&&d<l?d:l}}function hy(o,l){DA(o,l),(o=o.alternate)&&DA(o,l)}function NA(o){if(o.tag===13){var l=dl(o,67108864);l!==null&&fi(l,o,67108864),hy(o,67108864)}}var af=!0;function Fx(o,l,d,p){var E=W.T;W.T=null;var A=nt.p;try{nt.p=2,dy(o,l,d,p)}finally{nt.p=A,W.T=E}}function Hx(o,l,d,p){var E=W.T;W.T=null;var A=nt.p;try{nt.p=8,dy(o,l,d,p)}finally{nt.p=A,W.T=E}}function dy(o,l,d,p){if(af){var E=fy(p);if(E===null)Zg(o,l,p,lf,d),LA(o,p);else if(qx(E,o,l,d,p))p.stopPropagation();else if(LA(o,p),l&4&&-1<Gx.indexOf(o)){for(;E!==null;){var A=us(E);if(A!==null)switch(A.tag){case 3:if(A=A.stateNode,A.current.memoizedState.isDehydrated){var M=Hi(A.pendingLanes);if(M!==0){var L=A;for(L.pendingLanes|=2,L.entangledLanes|=2;M;){var q=1<<31-Hn(M);L.entanglements[1]|=q,M&=~q}Es(A),(de&6)===0&&(zd=Ve()+500,Cu(0))}}break;case 13:L=dl(A,2),L!==null&&fi(L,A,2),Yd(),hy(A,2)}if(A=fy(p),A===null&&Zg(o,l,p,lf,d),A===E)break;E=A}E!==null&&p.stopPropagation()}else Zg(o,l,p,null,d)}}function fy(o){return o=zc(o),py(o)}var lf=null;function py(o){if(lf=null,o=cs(o),o!==null){var l=r(o);if(l===null)o=null;else{var d=l.tag;if(d===13){if(o=a(l),o!==null)return o;o=null}else if(d===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;o=null}else l!==o&&(o=null)}}return lf=o,null}function kA(o){switch(o){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ka()){case rn:return 2;case hn:return 8;case zs:case vm:return 32;case kc:return 268435456;default:return 32}default:return 32}}var my=!1,oo=null,ao=null,lo=null,ku=new Map,Lu=new Map,co=[],Gx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function LA(o,l){switch(o){case"focusin":case"focusout":oo=null;break;case"dragenter":case"dragleave":ao=null;break;case"mouseover":case"mouseout":lo=null;break;case"pointerover":case"pointerout":ku.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":Lu.delete(l.pointerId)}}function Ou(o,l,d,p,E,A){return o===null||o.nativeEvent!==A?(o={blockedOn:l,domEventName:d,eventSystemFlags:p,nativeEvent:A,targetContainers:[E]},l!==null&&(l=us(l),l!==null&&NA(l)),o):(o.eventSystemFlags|=p,l=o.targetContainers,E!==null&&l.indexOf(E)===-1&&l.push(E),o)}function qx(o,l,d,p,E){switch(l){case"focusin":return oo=Ou(oo,o,l,d,p,E),!0;case"dragenter":return ao=Ou(ao,o,l,d,p,E),!0;case"mouseover":return lo=Ou(lo,o,l,d,p,E),!0;case"pointerover":var A=E.pointerId;return ku.set(A,Ou(ku.get(A)||null,o,l,d,p,E)),!0;case"gotpointercapture":return A=E.pointerId,Lu.set(A,Ou(Lu.get(A)||null,o,l,d,p,E)),!0}return!1}function OA(o){var l=cs(o.target);if(l!==null){var d=r(l);if(d!==null){if(l=d.tag,l===13){if(l=a(d),l!==null){o.blockedOn=l,Am(o.priority,function(){if(d.tag===13){var p=di();p=Oc(p);var E=dl(d,p);E!==null&&fi(E,d,p),hy(d,p)}});return}}else if(l===3&&d.stateNode.current.memoizedState.isDehydrated){o.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}o.blockedOn=null}function cf(o){if(o.blockedOn!==null)return!1;for(var l=o.targetContainers;0<l.length;){var d=fy(o.nativeEvent);if(d===null){d=o.nativeEvent;var p=new d.constructor(d.type,d);qc=p,d.target.dispatchEvent(p),qc=null}else return l=us(d),l!==null&&NA(l),o.blockedOn=d,!1;l.shift()}return!0}function UA(o,l,d){cf(o)&&d.delete(l)}function zx(){my=!1,oo!==null&&cf(oo)&&(oo=null),ao!==null&&cf(ao)&&(ao=null),lo!==null&&cf(lo)&&(lo=null),ku.forEach(UA),Lu.forEach(UA)}function uf(o,l){o.blockedOn===l&&(o.blockedOn=null,my||(my=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,zx)))}var hf=null;function VA(o){hf!==o&&(hf=o,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){hf===o&&(hf=null);for(var l=0;l<o.length;l+=3){var d=o[l],p=o[l+1],E=o[l+2];if(typeof p!="function"){if(py(p||d)===null)continue;break}var A=us(d);A!==null&&(o.splice(l,3),l-=3,pg(A,{pending:!0,data:E,method:d.method,action:p},p,E))}}))}function Uu(o){function l(q){return uf(q,o)}oo!==null&&uf(oo,o),ao!==null&&uf(ao,o),lo!==null&&uf(lo,o),ku.forEach(l),Lu.forEach(l);for(var d=0;d<co.length;d++){var p=co[d];p.blockedOn===o&&(p.blockedOn=null)}for(;0<co.length&&(d=co[0],d.blockedOn===null);)OA(d),d.blockedOn===null&&co.shift();if(d=(o.ownerDocument||o).$$reactFormReplay,d!=null)for(p=0;p<d.length;p+=3){var E=d[p],A=d[p+1],M=E[Tn]||null;if(typeof A=="function")M||VA(d);else if(M){var L=null;if(A&&A.hasAttribute("formAction")){if(E=A,M=A[Tn]||null)L=M.formAction;else if(py(E)!==null)continue}else L=M.action;typeof L=="function"?d[p+1]=L:(d.splice(p,3),p-=3),VA(d)}}}function gy(o){this._internalRoot=o}df.prototype.render=gy.prototype.render=function(o){var l=this._internalRoot;if(l===null)throw Error(n(409));var d=l.current,p=di();xA(d,p,o,l,null,null)},df.prototype.unmount=gy.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var l=o.containerInfo;xA(o.current,2,null,o,null,null),Yd(),l[Ys]=null}};function df(o){this._internalRoot=o}df.prototype.unstable_scheduleHydration=function(o){if(o){var l=$s();o={blockedOn:null,target:o,priority:l};for(var d=0;d<co.length&&l!==0&&l<co[d].priority;d++);co.splice(d,0,o),d===0&&OA(o)}};var BA=t.version;if(BA!=="19.1.1")throw Error(n(527,BA,"19.1.1"));nt.findDOMNode=function(o){var l=o._reactInternals;if(l===void 0)throw typeof o.render=="function"?Error(n(188)):(o=Object.keys(o).join(","),Error(n(268,o)));return o=u(l),o=o!==null?h(o):null,o=o===null?null:o.stateNode,o};var $x={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:W,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ff=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ff.isDisabled&&ff.supportsFiber)try{Rr=ff.inject($x),Dn=ff}catch{}}return Bu.createRoot=function(o,l){if(!s(o))throw Error(n(299));var d=!1,p="",E=eT,A=nT,M=iT,L=null;return l!=null&&(l.unstable_strictMode===!0&&(d=!0),l.identifierPrefix!==void 0&&(p=l.identifierPrefix),l.onUncaughtError!==void 0&&(E=l.onUncaughtError),l.onCaughtError!==void 0&&(A=l.onCaughtError),l.onRecoverableError!==void 0&&(M=l.onRecoverableError),l.unstable_transitionCallbacks!==void 0&&(L=l.unstable_transitionCallbacks)),l=MA(o,1,!1,null,null,d,p,E,A,M,L,null),o[Ys]=l.current,jg(o),new gy(l)},Bu.hydrateRoot=function(o,l,d){if(!s(o))throw Error(n(299));var p=!1,E="",A=eT,M=nT,L=iT,q=null,Q=null;return d!=null&&(d.unstable_strictMode===!0&&(p=!0),d.identifierPrefix!==void 0&&(E=d.identifierPrefix),d.onUncaughtError!==void 0&&(A=d.onUncaughtError),d.onCaughtError!==void 0&&(M=d.onCaughtError),d.onRecoverableError!==void 0&&(L=d.onRecoverableError),d.unstable_transitionCallbacks!==void 0&&(q=d.unstable_transitionCallbacks),d.formState!==void 0&&(Q=d.formState)),l=MA(o,1,!0,l,d??null,p,E,A,M,L,q,Q),l.context=PA(null),d=l.current,p=di(),p=Oc(p),E=Yr(p),E.callback=null,Wr(d,E,p),d=p,l.current.lanes=d,Be(l,d),Es(l),o[Ys]=l.current,jg(o),new df(l)},Bu.version="19.1.1",Bu}var QA;function nD(){if(QA)return Ey.exports;QA=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(t){console.error(t)}}return i(),Ey.exports=eD(),Ey.exports}var iD=nD();var jA="popstate";function sD(i={}){function t(s,r){let{pathname:a="/",search:c="",hash:u=""}=Ba(s.location.hash.substring(1));return!a.startsWith("/")&&!a.startsWith(".")&&(a="/"+a),Zy("",{pathname:a,search:c,hash:u},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function e(s,r){let a=s.document.querySelector("base"),c="";if(a&&a.getAttribute("href")){let u=s.location.href,h=u.indexOf("#");c=h===-1?u:u.slice(0,h)}return c+"#"+(typeof r=="string"?r:fh(r))}function n(s,r){Vi(s.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(r)})`)}return oD(t,e,n,i)}function Re(i,t){if(i===!1||i===null||typeof i>"u")throw new Error(t)}function Vi(i,t){if(!i){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function rD(){return Math.random().toString(36).substring(2,10)}function ZA(i,t){return{usr:i.state,key:i.key,idx:t}}function Zy(i,t,e=null,n){return{pathname:typeof i=="string"?i:i.pathname,search:"",hash:"",...typeof t=="string"?Ba(t):t,state:e,key:t&&t.key||n||rD()}}function fh({pathname:i="/",search:t="",hash:e=""}){return t&&t!=="?"&&(i+=t.charAt(0)==="?"?t:"?"+t),e&&e!=="#"&&(i+=e.charAt(0)==="#"?e:"#"+e),i}function Ba(i){let t={};if(i){let e=i.indexOf("#");e>=0&&(t.hash=i.substring(e),i=i.substring(0,e));let n=i.indexOf("?");n>=0&&(t.search=i.substring(n),i=i.substring(0,n)),i&&(t.pathname=i)}return t}function oD(i,t,e,n={}){let{window:s=document.defaultView,v5Compat:r=!1}=n,a=s.history,c="POP",u=null,h=f();h==null&&(h=0,a.replaceState({...a.state,idx:h},""));function f(){return(a.state||{idx:null}).idx}function m(){c="POP";let C=f(),I=C==null?null:C-h;h=C,u&&u({action:c,location:b.location,delta:I})}function y(C,I){c="PUSH";let D=Zy(b.location,C,I);e&&e(D,C),h=f()+1;let P=ZA(D,h),H=b.createHref(D);try{a.pushState(P,"",H)}catch(F){if(F instanceof DOMException&&F.name==="DataCloneError")throw F;s.location.assign(H)}r&&u&&u({action:c,location:b.location,delta:1})}function T(C,I){c="REPLACE";let D=Zy(b.location,C,I);e&&e(D,C),h=f();let P=ZA(D,h),H=b.createHref(D);a.replaceState(P,"",H),r&&u&&u({action:c,location:b.location,delta:0})}function S(C){return aD(C)}let b={get action(){return c},get location(){return i(s,a)},listen(C){if(u)throw new Error("A history only accepts one active listener");return s.addEventListener(jA,m),u=C,()=>{s.removeEventListener(jA,m),u=null}},createHref(C){return t(s,C)},createURL:S,encodeLocation(C){let I=S(C);return{pathname:I.pathname,search:I.search,hash:I.hash}},push:y,replace:T,go(C){return a.go(C)}};return b}function aD(i,t=!1){let e="http://localhost";typeof window<"u"&&(e=window.location.origin!=="null"?window.location.origin:window.location.href),Re(e,"No window.location.(origin|href) available to create URL");let n=typeof i=="string"?i:fh(i);return n=n.replace(/ $/,"%20"),!t&&n.startsWith("//")&&(n=e+n),new URL(n,e)}function ZC(i,t,e="/"){return lD(i,t,e,!1)}function lD(i,t,e,n){let s=typeof t=="string"?Ba(t):t,r=vr(s.pathname||"/",e);if(r==null)return null;let a=tI(i);cD(a);let c=null;for(let u=0;c==null&&u<a.length;++u){let h=ED(r);c=_D(a[u],h,n)}return c}function tI(i,t=[],e=[],n="",s=!1){let r=(a,c,u=s,h)=>{let f={relativePath:h===void 0?a.path||"":h,caseSensitive:a.caseSensitive===!0,childrenIndex:c,route:a};if(f.relativePath.startsWith("/")){if(!f.relativePath.startsWith(n)&&u)return;Re(f.relativePath.startsWith(n),`Absolute route path "${f.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),f.relativePath=f.relativePath.slice(n.length)}let m=yr([n,f.relativePath]),y=e.concat(f);a.children&&a.children.length>0&&(Re(a.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${m}".`),tI(a.children,t,y,m,u)),!(a.path==null&&!a.index)&&t.push({path:m,score:gD(m,a.index),routesMeta:y})};return i.forEach((a,c)=>{if(a.path===""||!a.path?.includes("?"))r(a,c);else for(let u of eI(a.path))r(a,c,!0,u)}),t}function eI(i){let t=i.split("/");if(t.length===0)return[];let[e,...n]=t,s=e.endsWith("?"),r=e.replace(/\?$/,"");if(n.length===0)return s?[r,""]:[r];let a=eI(n.join("/")),c=[];return c.push(...a.map(u=>u===""?r:[r,u].join("/"))),s&&c.push(...a),c.map(u=>i.startsWith("/")&&u===""?"/":u)}function cD(i){i.sort((t,e)=>t.score!==e.score?e.score-t.score:yD(t.routesMeta.map(n=>n.childrenIndex),e.routesMeta.map(n=>n.childrenIndex)))}var uD=/^:[\w-]+$/,hD=3,dD=2,fD=1,pD=10,mD=-2,tS=i=>i==="*";function gD(i,t){let e=i.split("/"),n=e.length;return e.some(tS)&&(n+=mD),t&&(n+=dD),e.filter(s=>!tS(s)).reduce((s,r)=>s+(uD.test(r)?hD:r===""?fD:pD),n)}function yD(i,t){return i.length===t.length&&i.slice(0,-1).every((n,s)=>n===t[s])?i[i.length-1]-t[t.length-1]:0}function _D(i,t,e=!1){let{routesMeta:n}=i,s={},r="/",a=[];for(let c=0;c<n.length;++c){let u=n[c],h=c===n.length-1,f=r==="/"?t:t.slice(r.length)||"/",m=tp({path:u.relativePath,caseSensitive:u.caseSensitive,end:h},f),y=u.route;if(!m&&h&&e&&!n[n.length-1].route.index&&(m=tp({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},f)),!m)return null;Object.assign(s,m.params),a.push({params:s,pathname:yr([r,m.pathname]),pathnameBase:wD(yr([r,m.pathnameBase])),route:y}),m.pathnameBase!=="/"&&(r=yr([r,m.pathnameBase]))}return a}function tp(i,t){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[e,n]=vD(i.path,i.caseSensitive,i.end),s=t.match(e);if(!s)return null;let r=s[0],a=r.replace(/(.)\/+$/,"$1"),c=s.slice(1);return{params:n.reduce((h,{paramName:f,isOptional:m},y)=>{if(f==="*"){let S=c[y]||"";a=r.slice(0,r.length-S.length).replace(/(.)\/+$/,"$1")}const T=c[y];return m&&!T?h[f]=void 0:h[f]=(T||"").replace(/%2F/g,"/"),h},{}),pathname:r,pathnameBase:a,pattern:i}}function vD(i,t=!1,e=!0){Vi(i==="*"||!i.endsWith("*")||i.endsWith("/*"),`Route path "${i}" will be treated as if it were "${i.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${i.replace(/\*$/,"/*")}".`);let n=[],s="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,c,u)=>(n.push({paramName:c,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return i.endsWith("*")?(n.push({paramName:"*"}),s+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):e?s+="\\/*$":i!==""&&i!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,t?void 0:"i"),n]}function ED(i){try{return i.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Vi(!1,`The URL path "${i}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),i}}function vr(i,t){if(t==="/")return i;if(!i.toLowerCase().startsWith(t.toLowerCase()))return null;let e=t.endsWith("/")?t.length-1:t.length,n=i.charAt(e);return n&&n!=="/"?null:i.slice(e)||"/"}function TD(i,t="/"){let{pathname:e,search:n="",hash:s=""}=typeof i=="string"?Ba(i):i;return{pathname:e?e.startsWith("/")?e:AD(e,t):t,search:bD(n),hash:CD(s)}}function AD(i,t){let e=t.replace(/\/+$/,"").split("/");return i.split("/").forEach(s=>{s===".."?e.length>1&&e.pop():s!=="."&&e.push(s)}),e.length>1?e.join("/"):"/"}function wy(i,t,e,n){return`Cannot include a '${i}' character in a manually specified \`to.${t}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${e}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function SD(i){return i.filter((t,e)=>e===0||t.route.path&&t.route.path.length>0)}function iv(i){let t=SD(i);return t.map((e,n)=>n===t.length-1?e.pathname:e.pathnameBase)}function sv(i,t,e,n=!1){let s;typeof i=="string"?s=Ba(i):(s={...i},Re(!s.pathname||!s.pathname.includes("?"),wy("?","pathname","search",s)),Re(!s.pathname||!s.pathname.includes("#"),wy("#","pathname","hash",s)),Re(!s.search||!s.search.includes("#"),wy("#","search","hash",s)));let r=i===""||s.pathname==="",a=r?"/":s.pathname,c;if(a==null)c=e;else{let m=t.length-1;if(!n&&a.startsWith("..")){let y=a.split("/");for(;y[0]==="..";)y.shift(),m-=1;s.pathname=y.join("/")}c=m>=0?t[m]:"/"}let u=TD(s,c),h=a&&a!=="/"&&a.endsWith("/"),f=(r||a===".")&&e.endsWith("/");return!u.pathname.endsWith("/")&&(h||f)&&(u.pathname+="/"),u}var yr=i=>i.join("/").replace(/\/\/+/g,"/"),wD=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),bD=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,CD=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i;function ID(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}var nI=["POST","PUT","PATCH","DELETE"];new Set(nI);var RD=["GET",...nI];new Set(RD);var Sc=et.createContext(null);Sc.displayName="DataRouter";var Lp=et.createContext(null);Lp.displayName="DataRouterState";et.createContext(!1);var iI=et.createContext({isTransitioning:!1});iI.displayName="ViewTransition";var MD=et.createContext(new Map);MD.displayName="Fetchers";var PD=et.createContext(null);PD.displayName="Await";var rs=et.createContext(null);rs.displayName="Navigation";var Ih=et.createContext(null);Ih.displayName="Location";var Bs=et.createContext({outlet:null,matches:[],isDataRoute:!1});Bs.displayName="Route";var rv=et.createContext(null);rv.displayName="RouteError";function xD(i,{relative:t}={}){Re(wc(),"useHref() may be used only in the context of a <Router> component.");let{basename:e,navigator:n}=et.useContext(rs),{hash:s,pathname:r,search:a}=Rh(i,{relative:t}),c=r;return e!=="/"&&(c=r==="/"?e:yr([e,r])),n.createHref({pathname:c,search:a,hash:s})}function wc(){return et.useContext(Ih)!=null}function ko(){return Re(wc(),"useLocation() may be used only in the context of a <Router> component."),et.useContext(Ih).location}var sI="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function rI(i){et.useContext(rs).static||et.useLayoutEffect(i)}function Op(){let{isDataRoute:i}=et.useContext(Bs);return i?zD():DD()}function DD(){Re(wc(),"useNavigate() may be used only in the context of a <Router> component.");let i=et.useContext(Sc),{basename:t,navigator:e}=et.useContext(rs),{matches:n}=et.useContext(Bs),{pathname:s}=ko(),r=JSON.stringify(iv(n)),a=et.useRef(!1);return rI(()=>{a.current=!0}),et.useCallback((u,h={})=>{if(Vi(a.current,sI),!a.current)return;if(typeof u=="number"){e.go(u);return}let f=sv(u,JSON.parse(r),s,h.relative==="path");i==null&&t!=="/"&&(f.pathname=f.pathname==="/"?t:yr([t,f.pathname])),(h.replace?e.replace:e.push)(f,h.state,h)},[t,e,r,s,i])}et.createContext(null);function Rh(i,{relative:t}={}){let{matches:e}=et.useContext(Bs),{pathname:n}=ko(),s=JSON.stringify(iv(e));return et.useMemo(()=>sv(i,JSON.parse(s),n,t==="path"),[i,s,n,t])}function ND(i,t){return oI(i,t)}function oI(i,t,e,n,s){Re(wc(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:r}=et.useContext(rs),{matches:a}=et.useContext(Bs),c=a[a.length-1],u=c?c.params:{},h=c?c.pathname:"/",f=c?c.pathnameBase:"/",m=c&&c.route;{let D=m&&m.path||"";aI(h,!m||D.endsWith("*")||D.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${h}" (under <Route path="${D}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${D}"> to <Route path="${D==="/"?"*":`${D}/*`}">.`)}let y=ko(),T;if(t){let D=typeof t=="string"?Ba(t):t;Re(f==="/"||D.pathname?.startsWith(f),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${f}" but pathname "${D.pathname}" was given in the \`location\` prop.`),T=D}else T=y;let S=T.pathname||"/",b=S;if(f!=="/"){let D=f.replace(/^\//,"").split("/");b="/"+S.replace(/^\//,"").split("/").slice(D.length).join("/")}let C=ZC(i,{pathname:b});Vi(m||C!=null,`No routes matched location "${T.pathname}${T.search}${T.hash}" `),Vi(C==null||C[C.length-1].route.element!==void 0||C[C.length-1].route.Component!==void 0||C[C.length-1].route.lazy!==void 0,`Matched leaf route at location "${T.pathname}${T.search}${T.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let I=VD(C&&C.map(D=>Object.assign({},D,{params:Object.assign({},u,D.params),pathname:yr([f,r.encodeLocation?r.encodeLocation(D.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:D.pathname]),pathnameBase:D.pathnameBase==="/"?f:yr([f,r.encodeLocation?r.encodeLocation(D.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:D.pathnameBase])})),a,e,n,s);return t&&I?et.createElement(Ih.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...T},navigationType:"POP"}},I):I}function kD(){let i=qD(),t=ID(i)?`${i.status} ${i.statusText}`:i instanceof Error?i.message:JSON.stringify(i),e=i instanceof Error?i.stack:null,n="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:n},r={padding:"2px 4px",backgroundColor:n},a=null;return console.error("Error handled by React Router default ErrorBoundary:",i),a=et.createElement(et.Fragment,null,et.createElement("p",null," Hey developer "),et.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",et.createElement("code",{style:r},"ErrorBoundary")," or"," ",et.createElement("code",{style:r},"errorElement")," prop on your route.")),et.createElement(et.Fragment,null,et.createElement("h2",null,"Unexpected Application Error!"),et.createElement("h3",{style:{fontStyle:"italic"}},t),e?et.createElement("pre",{style:s},e):null,a)}var LD=et.createElement(kD,null),OD=class extends et.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,t){return t.location!==i.location||t.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:t.error,location:t.location,revalidation:i.revalidation||t.revalidation}}componentDidCatch(i,t){this.props.unstable_onError?this.props.unstable_onError(i,t):console.error("React Router caught the following error during render",i)}render(){return this.state.error!==void 0?et.createElement(Bs.Provider,{value:this.props.routeContext},et.createElement(rv.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function UD({routeContext:i,match:t,children:e}){let n=et.useContext(Sc);return n&&n.static&&n.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=t.route.id),et.createElement(Bs.Provider,{value:i},e)}function VD(i,t=[],e=null,n=null,s=null){if(i==null){if(!e)return null;if(e.errors)i=e.matches;else if(t.length===0&&!e.initialized&&e.matches.length>0)i=e.matches;else return null}let r=i,a=e?.errors;if(a!=null){let h=r.findIndex(f=>f.route.id&&a?.[f.route.id]!==void 0);Re(h>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(a).join(",")}`),r=r.slice(0,Math.min(r.length,h+1))}let c=!1,u=-1;if(e)for(let h=0;h<r.length;h++){let f=r[h];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(u=h),f.route.id){let{loaderData:m,errors:y}=e,T=f.route.loader&&!m.hasOwnProperty(f.route.id)&&(!y||y[f.route.id]===void 0);if(f.route.lazy||T){c=!0,u>=0?r=r.slice(0,u+1):r=[r[0]];break}}}return r.reduceRight((h,f,m)=>{let y,T=!1,S=null,b=null;e&&(y=a&&f.route.id?a[f.route.id]:void 0,S=f.route.errorElement||LD,c&&(u<0&&m===0?(aI("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),T=!0,b=null):u===m&&(T=!0,b=f.route.hydrateFallbackElement||null)));let C=t.concat(r.slice(0,m+1)),I=()=>{let D;return y?D=S:T?D=b:f.route.Component?D=et.createElement(f.route.Component,null):f.route.element?D=f.route.element:D=h,et.createElement(UD,{match:f,routeContext:{outlet:h,matches:C,isDataRoute:e!=null},children:D})};return e&&(f.route.ErrorBoundary||f.route.errorElement||m===0)?et.createElement(OD,{location:e.location,revalidation:e.revalidation,component:S,error:y,children:I(),routeContext:{outlet:null,matches:C,isDataRoute:!0},unstable_onError:n}):I()},null)}function ov(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function BD(i){let t=et.useContext(Sc);return Re(t,ov(i)),t}function FD(i){let t=et.useContext(Lp);return Re(t,ov(i)),t}function HD(i){let t=et.useContext(Bs);return Re(t,ov(i)),t}function av(i){let t=HD(i),e=t.matches[t.matches.length-1];return Re(e.route.id,`${i} can only be used on routes that contain a unique "id"`),e.route.id}function GD(){return av("useRouteId")}function qD(){let i=et.useContext(rv),t=FD("useRouteError"),e=av("useRouteError");return i!==void 0?i:t.errors?.[e]}function zD(){let{router:i}=BD("useNavigate"),t=av("useNavigate"),e=et.useRef(!1);return rI(()=>{e.current=!0}),et.useCallback(async(s,r={})=>{Vi(e.current,sI),e.current&&(typeof s=="number"?i.navigate(s):await i.navigate(s,{fromRouteId:t,...r}))},[i,t])}var eS={};function aI(i,t,e){!t&&!eS[i]&&(eS[i]=!0,Vi(!1,e))}et.memo($D);function $D({routes:i,future:t,state:e,unstable_onError:n}){return oI(i,void 0,e,n,t)}function YD({to:i,replace:t,state:e,relative:n}){Re(wc(),"<Navigate> may be used only in the context of a <Router> component.");let{static:s}=et.useContext(rs);Vi(!s,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:r}=et.useContext(Bs),{pathname:a}=ko(),c=Op(),u=sv(i,iv(r),a,n==="path"),h=JSON.stringify(u);return et.useEffect(()=>{c(JSON.parse(h),{replace:t,state:e,relative:n})},[c,h,n,t,e]),null}function Of(i){Re(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function WD({basename:i="/",children:t=null,location:e,navigationType:n="POP",navigator:s,static:r=!1}){Re(!wc(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=i.replace(/^\/*/,"/"),c=et.useMemo(()=>({basename:a,navigator:s,static:r,future:{}}),[a,s,r]);typeof e=="string"&&(e=Ba(e));let{pathname:u="/",search:h="",hash:f="",state:m=null,key:y="default"}=e,T=et.useMemo(()=>{let S=vr(u,a);return S==null?null:{location:{pathname:S,search:h,hash:f,state:m,key:y},navigationType:n}},[a,u,h,f,m,y,n]);return Vi(T!=null,`<Router basename="${a}"> is not able to match the URL "${u}${h}${f}" because it does not start with the basename, so the <Router> won't render anything.`),T==null?null:et.createElement(rs.Provider,{value:c},et.createElement(Ih.Provider,{children:t,value:T}))}function KD({children:i,location:t}){return ND(t_(i),t)}function t_(i,t=[]){let e=[];return et.Children.forEach(i,(n,s)=>{if(!et.isValidElement(n))return;let r=[...t,s];if(n.type===et.Fragment){e.push.apply(e,t_(n.props.children,r));return}Re(n.type===Of,`[${typeof n.type=="string"?n.type:n.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Re(!n.props.index||!n.props.children,"An index route cannot have child routes.");let a={id:n.props.id||r.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,middleware:n.props.middleware,loader:n.props.loader,action:n.props.action,hydrateFallbackElement:n.props.hydrateFallbackElement,HydrateFallback:n.props.HydrateFallback,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.hasErrorBoundary===!0||n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(a.children=t_(n.props.children,r)),e.push(a)}),e}var Uf="get",Vf="application/x-www-form-urlencoded";function Up(i){return i!=null&&typeof i.tagName=="string"}function XD(i){return Up(i)&&i.tagName.toLowerCase()==="button"}function JD(i){return Up(i)&&i.tagName.toLowerCase()==="form"}function QD(i){return Up(i)&&i.tagName.toLowerCase()==="input"}function jD(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function ZD(i,t){return i.button===0&&(!t||t==="_self")&&!jD(i)}var pf=null;function tN(){if(pf===null)try{new FormData(document.createElement("form"),0),pf=!1}catch{pf=!0}return pf}var eN=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function by(i){return i!=null&&!eN.has(i)?(Vi(!1,`"${i}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Vf}"`),null):i}function nN(i,t){let e,n,s,r,a;if(JD(i)){let c=i.getAttribute("action");n=c?vr(c,t):null,e=i.getAttribute("method")||Uf,s=by(i.getAttribute("enctype"))||Vf,r=new FormData(i)}else if(XD(i)||QD(i)&&(i.type==="submit"||i.type==="image")){let c=i.form;if(c==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let u=i.getAttribute("formaction")||c.getAttribute("action");if(n=u?vr(u,t):null,e=i.getAttribute("formmethod")||c.getAttribute("method")||Uf,s=by(i.getAttribute("formenctype"))||by(c.getAttribute("enctype"))||Vf,r=new FormData(c,i),!tN()){let{name:h,type:f,value:m}=i;if(f==="image"){let y=h?`${h}.`:"";r.append(`${y}x`,"0"),r.append(`${y}y`,"0")}else h&&r.append(h,m)}}else{if(Up(i))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');e=Uf,n=null,s=Vf,a=i}return r&&s==="text/plain"&&(a=r,r=void 0),{action:n,method:e.toLowerCase(),encType:s,formData:r,body:a}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function lv(i,t){if(i===!1||i===null||typeof i>"u")throw new Error(t)}function iN(i,t,e){let n=typeof i=="string"?new URL(i,typeof window>"u"?"server://singlefetch/":window.location.origin):i;return n.pathname==="/"?n.pathname=`_root.${e}`:t&&vr(n.pathname,t)==="/"?n.pathname=`${t.replace(/\/$/,"")}/_root.${e}`:n.pathname=`${n.pathname.replace(/\/$/,"")}.${e}`,n}async function sN(i,t){if(i.id in t)return t[i.id];try{let e=await import(i.module);return t[i.id]=e,e}catch(e){return console.error(`Error loading route module \`${i.module}\`, reloading page...`),console.error(e),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function rN(i){return i==null?!1:i.href==null?i.rel==="preload"&&typeof i.imageSrcSet=="string"&&typeof i.imageSizes=="string":typeof i.rel=="string"&&typeof i.href=="string"}async function oN(i,t,e){let n=await Promise.all(i.map(async s=>{let r=t.routes[s.route.id];if(r){let a=await sN(r,e);return a.links?a.links():[]}return[]}));return uN(n.flat(1).filter(rN).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function nS(i,t,e,n,s,r){let a=(u,h)=>e[h]?u.route.id!==e[h].route.id:!0,c=(u,h)=>e[h].pathname!==u.pathname||e[h].route.path?.endsWith("*")&&e[h].params["*"]!==u.params["*"];return r==="assets"?t.filter((u,h)=>a(u,h)||c(u,h)):r==="data"?t.filter((u,h)=>{let f=n.routes[u.route.id];if(!f||!f.hasLoader)return!1;if(a(u,h)||c(u,h))return!0;if(u.route.shouldRevalidate){let m=u.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:e[0]?.params||{},nextUrl:new URL(i,window.origin),nextParams:u.params,defaultShouldRevalidate:!0});if(typeof m=="boolean")return m}return!0}):[]}function aN(i,t,{includeHydrateFallback:e}={}){return lN(i.map(n=>{let s=t.routes[n.route.id];if(!s)return[];let r=[s.module];return s.clientActionModule&&(r=r.concat(s.clientActionModule)),s.clientLoaderModule&&(r=r.concat(s.clientLoaderModule)),e&&s.hydrateFallbackModule&&(r=r.concat(s.hydrateFallbackModule)),s.imports&&(r=r.concat(s.imports)),r}).flat(1))}function lN(i){return[...new Set(i)]}function cN(i){let t={},e=Object.keys(i).sort();for(let n of e)t[n]=i[n];return t}function uN(i,t){let e=new Set;return new Set(t),i.reduce((n,s)=>{let r=JSON.stringify(cN(s));return e.has(r)||(e.add(r),n.push({key:r,link:s})),n},[])}function lI(){let i=et.useContext(Sc);return lv(i,"You must render this element inside a <DataRouterContext.Provider> element"),i}function hN(){let i=et.useContext(Lp);return lv(i,"You must render this element inside a <DataRouterStateContext.Provider> element"),i}var cv=et.createContext(void 0);cv.displayName="FrameworkContext";function cI(){let i=et.useContext(cv);return lv(i,"You must render this element inside a <HydratedRouter> element"),i}function dN(i,t){let e=et.useContext(cv),[n,s]=et.useState(!1),[r,a]=et.useState(!1),{onFocus:c,onBlur:u,onMouseEnter:h,onMouseLeave:f,onTouchStart:m}=t,y=et.useRef(null);et.useEffect(()=>{if(i==="render"&&a(!0),i==="viewport"){let b=I=>{I.forEach(D=>{a(D.isIntersecting)})},C=new IntersectionObserver(b,{threshold:.5});return y.current&&C.observe(y.current),()=>{C.disconnect()}}},[i]),et.useEffect(()=>{if(n){let b=setTimeout(()=>{a(!0)},100);return()=>{clearTimeout(b)}}},[n]);let T=()=>{s(!0)},S=()=>{s(!1),a(!1)};return e?i!=="intent"?[r,y,{}]:[r,y,{onFocus:Fu(c,T),onBlur:Fu(u,S),onMouseEnter:Fu(h,T),onMouseLeave:Fu(f,S),onTouchStart:Fu(m,T)}]:[!1,y,{}]}function Fu(i,t){return e=>{i&&i(e),e.defaultPrevented||t(e)}}function fN({page:i,...t}){let{router:e}=lI(),n=et.useMemo(()=>ZC(e.routes,i,e.basename),[e.routes,i,e.basename]);return n?et.createElement(mN,{page:i,matches:n,...t}):null}function pN(i){let{manifest:t,routeModules:e}=cI(),[n,s]=et.useState([]);return et.useEffect(()=>{let r=!1;return oN(i,t,e).then(a=>{r||s(a)}),()=>{r=!0}},[i,t,e]),n}function mN({page:i,matches:t,...e}){let n=ko(),{manifest:s,routeModules:r}=cI(),{basename:a}=lI(),{loaderData:c,matches:u}=hN(),h=et.useMemo(()=>nS(i,t,u,s,n,"data"),[i,t,u,s,n]),f=et.useMemo(()=>nS(i,t,u,s,n,"assets"),[i,t,u,s,n]),m=et.useMemo(()=>{if(i===n.pathname+n.search+n.hash)return[];let S=new Set,b=!1;if(t.forEach(I=>{let D=s.routes[I.route.id];!D||!D.hasLoader||(!h.some(P=>P.route.id===I.route.id)&&I.route.id in c&&r[I.route.id]?.shouldRevalidate||D.hasClientLoader?b=!0:S.add(I.route.id))}),S.size===0)return[];let C=iN(i,a,"data");return b&&S.size>0&&C.searchParams.set("_routes",t.filter(I=>S.has(I.route.id)).map(I=>I.route.id).join(",")),[C.pathname+C.search]},[a,c,n,s,h,t,i,r]),y=et.useMemo(()=>aN(f,s),[f,s]),T=pN(f);return et.createElement(et.Fragment,null,m.map(S=>et.createElement("link",{key:S,rel:"prefetch",as:"fetch",href:S,...e})),y.map(S=>et.createElement("link",{key:S,rel:"modulepreload",href:S,...e})),T.map(({key:S,link:b})=>et.createElement("link",{key:S,nonce:e.nonce,...b})))}function gN(...i){return t=>{i.forEach(e=>{typeof e=="function"?e(t):e!=null&&(e.current=t)})}}var uI=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{uI&&(window.__reactRouterVersion="7.9.2")}catch{}function yN({basename:i,children:t,window:e}){let n=et.useRef();n.current==null&&(n.current=sD({window:e,v5Compat:!0}));let s=n.current,[r,a]=et.useState({action:s.action,location:s.location}),c=et.useCallback(u=>{et.startTransition(()=>a(u))},[a]);return et.useLayoutEffect(()=>s.listen(c),[s,c]),et.createElement(WD,{basename:i,children:t,location:r.location,navigationType:r.action,navigator:s})}var hI=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,dI=et.forwardRef(function({onClick:t,discover:e="render",prefetch:n="none",relative:s,reloadDocument:r,replace:a,state:c,target:u,to:h,preventScrollReset:f,viewTransition:m,...y},T){let{basename:S}=et.useContext(rs),b=typeof h=="string"&&hI.test(h),C,I=!1;if(typeof h=="string"&&b&&(C=h,uI))try{let k=new URL(window.location.href),V=h.startsWith("//")?new URL(k.protocol+h):new URL(h),U=vr(V.pathname,S);V.origin===k.origin&&U!=null?h=U+V.search+V.hash:I=!0}catch{Vi(!1,`<Link to="${h}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let D=xD(h,{relative:s}),[P,H,F]=dN(n,y),G=TN(h,{replace:a,state:c,target:u,preventScrollReset:f,relative:s,viewTransition:m});function N(k){t&&t(k),k.defaultPrevented||G(k)}let x=et.createElement("a",{...y,...F,href:C||D,onClick:I||r?t:N,ref:gN(T,H),target:u,"data-discover":!b&&e==="render"?"true":void 0});return P&&!b?et.createElement(et.Fragment,null,x,et.createElement(fN,{page:D})):x});dI.displayName="Link";var _N=et.forwardRef(function({"aria-current":t="page",caseSensitive:e=!1,className:n="",end:s=!1,style:r,to:a,viewTransition:c,children:u,...h},f){let m=Rh(a,{relative:h.relative}),y=ko(),T=et.useContext(Lp),{navigator:S,basename:b}=et.useContext(rs),C=T!=null&&CN(m)&&c===!0,I=S.encodeLocation?S.encodeLocation(m).pathname:m.pathname,D=y.pathname,P=T&&T.navigation&&T.navigation.location?T.navigation.location.pathname:null;e||(D=D.toLowerCase(),P=P?P.toLowerCase():null,I=I.toLowerCase()),P&&b&&(P=vr(P,b)||P);const H=I!=="/"&&I.endsWith("/")?I.length-1:I.length;let F=D===I||!s&&D.startsWith(I)&&D.charAt(H)==="/",G=P!=null&&(P===I||!s&&P.startsWith(I)&&P.charAt(I.length)==="/"),N={isActive:F,isPending:G,isTransitioning:C},x=F?t:void 0,k;typeof n=="function"?k=n(N):k=[n,F?"active":null,G?"pending":null,C?"transitioning":null].filter(Boolean).join(" ");let V=typeof r=="function"?r(N):r;return et.createElement(dI,{...h,"aria-current":x,className:k,ref:f,style:V,to:a,viewTransition:c},typeof u=="function"?u(N):u)});_N.displayName="NavLink";var vN=et.forwardRef(({discover:i="render",fetcherKey:t,navigate:e,reloadDocument:n,replace:s,state:r,method:a=Uf,action:c,onSubmit:u,relative:h,preventScrollReset:f,viewTransition:m,...y},T)=>{let S=wN(),b=bN(c,{relative:h}),C=a.toLowerCase()==="get"?"get":"post",I=typeof c=="string"&&hI.test(c),D=P=>{if(u&&u(P),P.defaultPrevented)return;P.preventDefault();let H=P.nativeEvent.submitter,F=H?.getAttribute("formmethod")||a;S(H||P.currentTarget,{fetcherKey:t,method:F,navigate:e,replace:s,state:r,relative:h,preventScrollReset:f,viewTransition:m})};return et.createElement("form",{ref:T,method:C,action:b,onSubmit:n?u:D,...y,"data-discover":!I&&i==="render"?"true":void 0})});vN.displayName="Form";function EN(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function fI(i){let t=et.useContext(Sc);return Re(t,EN(i)),t}function TN(i,{target:t,replace:e,state:n,preventScrollReset:s,relative:r,viewTransition:a}={}){let c=Op(),u=ko(),h=Rh(i,{relative:r});return et.useCallback(f=>{if(ZD(f,t)){f.preventDefault();let m=e!==void 0?e:fh(u)===fh(h);c(i,{replace:m,state:n,preventScrollReset:s,relative:r,viewTransition:a})}},[u,c,h,e,n,t,i,s,r,a])}var AN=0,SN=()=>`__${String(++AN)}__`;function wN(){let{router:i}=fI("useSubmit"),{basename:t}=et.useContext(rs),e=GD();return et.useCallback(async(n,s={})=>{let{action:r,method:a,encType:c,formData:u,body:h}=nN(n,t);if(s.navigate===!1){let f=s.fetcherKey||SN();await i.fetch(f,e,s.action||r,{preventScrollReset:s.preventScrollReset,formData:u,body:h,formMethod:s.method||a,formEncType:s.encType||c,flushSync:s.flushSync})}else await i.navigate(s.action||r,{preventScrollReset:s.preventScrollReset,formData:u,body:h,formMethod:s.method||a,formEncType:s.encType||c,replace:s.replace,state:s.state,fromRouteId:e,flushSync:s.flushSync,viewTransition:s.viewTransition})},[i,t,e])}function bN(i,{relative:t}={}){let{basename:e}=et.useContext(rs),n=et.useContext(Bs);Re(n,"useFormAction must be used inside a RouteContext");let[s]=n.matches.slice(-1),r={...Rh(i||".",{relative:t})},a=ko();if(i==null){r.search=a.search;let c=new URLSearchParams(r.search),u=c.getAll("index");if(u.some(f=>f==="")){c.delete("index"),u.filter(m=>m).forEach(m=>c.append("index",m));let f=c.toString();r.search=f?`?${f}`:""}}return(!i||i===".")&&s.route.index&&(r.search=r.search?r.search.replace(/^\?/,"?index&"):"?index"),e!=="/"&&(r.pathname=r.pathname==="/"?e:yr([e,r.pathname])),fh(r)}function CN(i,{relative:t}={}){let e=et.useContext(iI);Re(e!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=fI("useViewTransitionState"),s=Rh(i,{relative:t});if(!e.isTransitioning)return!1;let r=vr(e.currentLocation.pathname,n)||e.currentLocation.pathname,a=vr(e.nextLocation.pathname,n)||e.nextLocation.pathname;return tp(s.pathname,a)!=null||tp(s.pathname,r)!=null}const IN="/Notify/assets/thewall-p_J-mzaK.png";var pI={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},iS=Ma.createContext&&Ma.createContext(pI),RN=["attr","size","title"];function MN(i,t){if(i==null)return{};var e=PN(i,t),n,s;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);for(s=0;s<r.length;s++)n=r[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(i,n)&&(e[n]=i[n])}return e}function PN(i,t){if(i==null)return{};var e={};for(var n in i)if(Object.prototype.hasOwnProperty.call(i,n)){if(t.indexOf(n)>=0)continue;e[n]=i[n]}return e}function ep(){return ep=Object.assign?Object.assign.bind():function(i){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(i[n]=e[n])}return i},ep.apply(this,arguments)}function sS(i,t){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(i,s).enumerable})),e.push.apply(e,n)}return e}function np(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?sS(Object(e),!0).forEach(function(n){xN(i,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):sS(Object(e)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(e,n))})}return i}function xN(i,t,e){return t=DN(t),t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}function DN(i){var t=NN(i,"string");return typeof t=="symbol"?t:t+""}function NN(i,t){if(typeof i!="object"||!i)return i;var e=i[Symbol.toPrimitive];if(e!==void 0){var n=e.call(i,t);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(i)}function mI(i){return i&&i.map((t,e)=>Ma.createElement(t.tag,np({key:e},t.attr),mI(t.child)))}function Fs(i){return t=>Ma.createElement(kN,ep({attr:np({},i.attr)},t),mI(i.child))}function kN(i){var t=e=>{var{attr:n,size:s,title:r}=i,a=MN(i,RN),c=s||e.size||"1em",u;return e.className&&(u=e.className),i.className&&(u=(u?u+" ":"")+i.className),Ma.createElement("svg",ep({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},e.attr,n,a,{className:u,style:np(np({color:i.color||e.color},e.style),i.style),height:c,width:c,xmlns:"http://www.w3.org/2000/svg"}),r&&Ma.createElement("title",null,r),i.children)};return iS!==void 0?Ma.createElement(iS.Consumer,null,e=>t(e)):t(pI)}function LN(i){return Fs({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M336 208v-95a80 80 0 0 0-160 0v95"},child:[]},{tag:"rect",attr:{width:"320",height:"272",x:"96",y:"208",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",rx:"48",ry:"48"},child:[]}]})(i)}function ON(i){return Fs({attr:{viewBox:"0 0 512 512"},child:[{tag:"rect",attr:{width:"416",height:"320",x:"48",y:"96",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",rx:"40",ry:"40"},child:[]},{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"m112 160 144 112 144-112"},child:[]}]})(i)}function UN(i){return Fs({attr:{viewBox:"0 0 24 24"},child:[{tag:"g",attr:{id:"User"},child:[{tag:"g",attr:{},child:[{tag:"path",attr:{d:"M17.438,21.937H6.562a2.5,2.5,0,0,1-2.5-2.5V18.61c0-3.969,3.561-7.2,7.938-7.2s7.938,3.229,7.938,7.2v.827A2.5,2.5,0,0,1,17.438,21.937ZM12,12.412c-3.826,0-6.938,2.78-6.938,6.2v.827a1.5,1.5,0,0,0,1.5,1.5H17.438a1.5,1.5,0,0,0,1.5-1.5V18.61C18.938,15.192,15.826,12.412,12,12.412Z"},child:[]},{tag:"path",attr:{d:"M12,9.911a3.924,3.924,0,1,1,3.923-3.924A3.927,3.927,0,0,1,12,9.911Zm0-6.847a2.924,2.924,0,1,0,2.923,2.923A2.926,2.926,0,0,0,12,3.064Z"},child:[]}]}]}]})(i)}const VN=()=>{};var rS={};const gI=function(i){const t=[];let e=0;for(let n=0;n<i.length;n++){let s=i.charCodeAt(n);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&n+1<i.length&&(i.charCodeAt(n+1)&64512)===56320?(s=65536+((s&1023)<<10)+(i.charCodeAt(++n)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},BN=function(i){const t=[];let e=0,n=0;for(;e<i.length;){const s=i[e++];if(s<128)t[n++]=String.fromCharCode(s);else if(s>191&&s<224){const r=i[e++];t[n++]=String.fromCharCode((s&31)<<6|r&63)}else if(s>239&&s<365){const r=i[e++],a=i[e++],c=i[e++],u=((s&7)<<18|(r&63)<<12|(a&63)<<6|c&63)-65536;t[n++]=String.fromCharCode(55296+(u>>10)),t[n++]=String.fromCharCode(56320+(u&1023))}else{const r=i[e++],a=i[e++];t[n++]=String.fromCharCode((s&15)<<12|(r&63)<<6|a&63)}}return t.join("")},yI={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(i,t){if(!Array.isArray(i))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let s=0;s<i.length;s+=3){const r=i[s],a=s+1<i.length,c=a?i[s+1]:0,u=s+2<i.length,h=u?i[s+2]:0,f=r>>2,m=(r&3)<<4|c>>4;let y=(c&15)<<2|h>>6,T=h&63;u||(T=64,a||(y=64)),n.push(e[f],e[m],e[y],e[T])}return n.join("")},encodeString(i,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(i):this.encodeByteArray(gI(i),t)},decodeString(i,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(i):BN(this.decodeStringToByteArray(i,t))},decodeStringToByteArray(i,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let s=0;s<i.length;){const r=e[i.charAt(s++)],c=s<i.length?e[i.charAt(s)]:0;++s;const h=s<i.length?e[i.charAt(s)]:64;++s;const m=s<i.length?e[i.charAt(s)]:64;if(++s,r==null||c==null||h==null||m==null)throw new FN;const y=r<<2|c>>4;if(n.push(y),h!==64){const T=c<<4&240|h>>2;if(n.push(T),m!==64){const S=h<<6&192|m;n.push(S)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let i=0;i<this.ENCODED_VALS.length;i++)this.byteToCharMap_[i]=this.ENCODED_VALS.charAt(i),this.charToByteMap_[this.byteToCharMap_[i]]=i,this.byteToCharMapWebSafe_[i]=this.ENCODED_VALS_WEBSAFE.charAt(i),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]]=i,i>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)]=i,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)]=i)}}};class FN extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const HN=function(i){const t=gI(i);return yI.encodeByteArray(t,!0)},ip=function(i){return HN(i).replace(/\./g,"")},_I=function(i){try{return yI.decodeString(i,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function GN(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const qN=()=>GN().__FIREBASE_DEFAULTS__,zN=()=>{if(typeof process>"u"||typeof rS>"u")return;const i=rS.__FIREBASE_DEFAULTS__;if(i)return JSON.parse(i)},$N=()=>{if(typeof document>"u")return;let i;try{i=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=i&&_I(i[1]);return t&&JSON.parse(t)},Vp=()=>{try{return VN()||qN()||zN()||$N()}catch(i){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${i}`);return}},vI=i=>Vp()?.emulatorHosts?.[i],EI=i=>{const t=vI(i);if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const n=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),n]:[t.substring(0,e),n]},TI=()=>Vp()?.config,AI=i=>Vp()?.[`_${i}`];class YN{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,n))}}}function Fa(i){try{return(i.startsWith("http://")||i.startsWith("https://")?new URL(i).hostname:i).endsWith(".cloudworkstations.dev")}catch{return!1}}async function uv(i){return(await fetch(i,{credentials:"include"})).ok}function SI(i,t){if(i.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e={alg:"none",type:"JWT"},n=t||"demo-project",s=i.iat||0,r=i.sub||i.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${n}`,aud:n,iat:s,exp:s+3600,auth_time:s,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}},...i};return[ip(JSON.stringify(e)),ip(JSON.stringify(a)),""].join(".")}const oh={};function WN(){const i={prod:[],emulator:[]};for(const t of Object.keys(oh))oh[t]?i.emulator.push(t):i.prod.push(t);return i}function KN(i){let t=document.getElementById(i),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",i),e=!0),{created:e,element:t}}let oS=!1;function hv(i,t){if(typeof window>"u"||typeof document>"u"||!Fa(window.location.host)||oh[i]===t||oh[i]||oS)return;oh[i]=t;function e(y){return`__firebase__banner__${y}`}const n="__firebase__banner",r=WN().prod.length>0;function a(){const y=document.getElementById(n);y&&y.remove()}function c(y){y.style.display="flex",y.style.background="#7faaf0",y.style.position="fixed",y.style.bottom="5px",y.style.left="5px",y.style.padding=".5em",y.style.borderRadius="5px",y.style.alignItems="center"}function u(y,T){y.setAttribute("width","24"),y.setAttribute("id",T),y.setAttribute("height","24"),y.setAttribute("viewBox","0 0 24 24"),y.setAttribute("fill","none"),y.style.marginLeft="-6px"}function h(){const y=document.createElement("span");return y.style.cursor="pointer",y.style.marginLeft="16px",y.style.fontSize="24px",y.innerHTML=" &times;",y.onclick=()=>{oS=!0,a()},y}function f(y,T){y.setAttribute("id",T),y.innerText="Learn more",y.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",y.setAttribute("target","__blank"),y.style.paddingLeft="5px",y.style.textDecoration="underline"}function m(){const y=KN(n),T=e("text"),S=document.getElementById(T)||document.createElement("span"),b=e("learnmore"),C=document.getElementById(b)||document.createElement("a"),I=e("preprendIcon"),D=document.getElementById(I)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(y.created){const P=y.element;c(P),f(C,b);const H=h();u(D,I),P.append(D,S,C,H),document.body.appendChild(P)}r?(S.innerText="Preview backend disconnected.",D.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(D.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,S.innerText="Preview backend running in this workspace."),S.setAttribute("id",T)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",m):m()}function Fn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function XN(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Fn())}function JN(){const i=Vp()?.forceEnvironment;if(i==="node")return!0;if(i==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function QN(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function jN(){const i=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof i=="object"&&i.id!==void 0}function ZN(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function tk(){const i=Fn();return i.indexOf("MSIE ")>=0||i.indexOf("Trident/")>=0}function ek(){return!JN()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function nk(){try{return typeof indexedDB=="object"}catch{return!1}}function ik(){return new Promise((i,t)=>{try{let e=!0;const n="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(n);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(n),i(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{t(s.error?.message||"")}}catch(e){t(e)}})}const sk="FirebaseError";class Hs extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name=sk,Object.setPrototypeOf(this,Hs.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Mh.prototype.create)}}class Mh{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},s=`${this.service}/${t}`,r=this.errors[t],a=r?rk(r,n):"Error",c=`${this.serviceName}: ${a} (${s}).`;return new Hs(s,c,n)}}function rk(i,t){return i.replace(ok,(e,n)=>{const s=t[n];return s!=null?String(s):`<${n}?>`})}const ok=/\{\$([^}]+)}/g;function ak(i){for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t))return!1;return!0}function Er(i,t){if(i===t)return!0;const e=Object.keys(i),n=Object.keys(t);for(const s of e){if(!n.includes(s))return!1;const r=i[s],a=t[s];if(aS(r)&&aS(a)){if(!Er(r,a))return!1}else if(r!==a)return!1}for(const s of n)if(!e.includes(s))return!1;return!0}function aS(i){return i!==null&&typeof i=="object"}function Ph(i){const t=[];for(const[e,n]of Object.entries(i))Array.isArray(n)?n.forEach(s=>{t.push(encodeURIComponent(e)+"="+encodeURIComponent(s))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function Ju(i){const t={};return i.replace(/^\?/,"").split("&").forEach(n=>{if(n){const[s,r]=n.split("=");t[decodeURIComponent(s)]=decodeURIComponent(r)}}),t}function Qu(i){const t=i.indexOf("?");if(!t)return"";const e=i.indexOf("#",t);return i.substring(t,e>0?e:void 0)}function lk(i,t){const e=new ck(i,t);return e.subscribe.bind(e)}class ck{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(()=>{t(this)}).catch(n=>{this.error(n)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,e,n){let s;if(t===void 0&&e===void 0&&n===void 0)throw new Error("Missing Observer.");uk(t,["next","error","complete"])?s=t:s={next:t,error:e,complete:n},s.next===void 0&&(s.next=Cy),s.error===void 0&&(s.error=Cy),s.complete===void 0&&(s.complete=Cy);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),r}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{e(this.observers[t])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function uk(i,t){if(typeof i!="object"||i===null)return!1;for(const e of t)if(e in i&&typeof i[e]=="function")return!0;return!1}function Cy(){}function vn(i){return i&&i._delegate?i._delegate:i}class bo{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const Aa="[DEFAULT]";class hk{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const n=new YN;if(this.instancesDeferred.set(e,n),this.isInitialized(e)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:e});s&&n.resolve(s)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){const e=this.normalizeInstanceIdentifier(t?.identifier),n=t?.optional??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(s){if(n)return null;throw s}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(fk(t))try{this.getOrInitializeService({instanceIdentifier:Aa})}catch{}for(const[e,n]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(e);try{const r=this.getOrInitializeService({instanceIdentifier:s});n.resolve(r)}catch{}}}}clearInstance(t=Aa){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=Aa){return this.instances.has(t)}getOptions(t=Aa){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[r,a]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(r);n===c&&a.resolve(s)}return s}onInit(t,e){const n=this.normalizeInstanceIdentifier(e),s=this.onInitCallbacks.get(n)??new Set;s.add(t),this.onInitCallbacks.set(n,s);const r=this.instances.get(n);return r&&t(r,n),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const s of n)try{s(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:dk(t),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch{}return n||null}normalizeInstanceIdentifier(t=Aa){return this.component?this.component.multipleInstances?t:Aa:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function dk(i){return i===Aa?void 0:i}function fk(i){return i.instantiationMode==="EAGER"}class pk{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new hk(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}var Qt;(function(i){i[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT"})(Qt||(Qt={}));const mk={debug:Qt.DEBUG,verbose:Qt.VERBOSE,info:Qt.INFO,warn:Qt.WARN,error:Qt.ERROR,silent:Qt.SILENT},gk=Qt.INFO,yk={[Qt.DEBUG]:"log",[Qt.VERBOSE]:"log",[Qt.INFO]:"info",[Qt.WARN]:"warn",[Qt.ERROR]:"error"},_k=(i,t,...e)=>{if(t<i.logLevel)return;const n=new Date().toISOString(),s=yk[t];if(s)console[s](`[${n}]  ${i.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class dv{constructor(t){this.name=t,this._logLevel=gk,this._logHandler=_k,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Qt))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?mk[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Qt.DEBUG,...t),this._logHandler(this,Qt.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Qt.VERBOSE,...t),this._logHandler(this,Qt.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Qt.INFO,...t),this._logHandler(this,Qt.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Qt.WARN,...t),this._logHandler(this,Qt.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Qt.ERROR,...t),this._logHandler(this,Qt.ERROR,...t)}}const vk=(i,t)=>t.some(e=>i instanceof e);let lS,cS;function Ek(){return lS||(lS=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Tk(){return cS||(cS=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const wI=new WeakMap,e_=new WeakMap,bI=new WeakMap,Iy=new WeakMap,fv=new WeakMap;function Ak(i){const t=new Promise((e,n)=>{const s=()=>{i.removeEventListener("success",r),i.removeEventListener("error",a)},r=()=>{e(To(i.result)),s()},a=()=>{n(i.error),s()};i.addEventListener("success",r),i.addEventListener("error",a)});return t.then(e=>{e instanceof IDBCursor&&wI.set(e,i)}).catch(()=>{}),fv.set(t,i),t}function Sk(i){if(e_.has(i))return;const t=new Promise((e,n)=>{const s=()=>{i.removeEventListener("complete",r),i.removeEventListener("error",a),i.removeEventListener("abort",a)},r=()=>{e(),s()},a=()=>{n(i.error||new DOMException("AbortError","AbortError")),s()};i.addEventListener("complete",r),i.addEventListener("error",a),i.addEventListener("abort",a)});e_.set(i,t)}let n_={get(i,t,e){if(i instanceof IDBTransaction){if(t==="done")return e_.get(i);if(t==="objectStoreNames")return i.objectStoreNames||bI.get(i);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return To(i[t])},set(i,t,e){return i[t]=e,!0},has(i,t){return i instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in i}};function wk(i){n_=i(n_)}function bk(i){return i===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const n=i.call(Ry(this),t,...e);return bI.set(n,t.sort?t.sort():[t]),To(n)}:Tk().includes(i)?function(...t){return i.apply(Ry(this),t),To(wI.get(this))}:function(...t){return To(i.apply(Ry(this),t))}}function Ck(i){return typeof i=="function"?bk(i):(i instanceof IDBTransaction&&Sk(i),vk(i,Ek())?new Proxy(i,n_):i)}function To(i){if(i instanceof IDBRequest)return Ak(i);if(Iy.has(i))return Iy.get(i);const t=Ck(i);return t!==i&&(Iy.set(i,t),fv.set(t,i)),t}const Ry=i=>fv.get(i);function Ik(i,t,{blocked:e,upgrade:n,blocking:s,terminated:r}={}){const a=indexedDB.open(i,t),c=To(a);return n&&a.addEventListener("upgradeneeded",u=>{n(To(a.result),u.oldVersion,u.newVersion,To(a.transaction),u)}),e&&a.addEventListener("blocked",u=>e(u.oldVersion,u.newVersion,u)),c.then(u=>{r&&u.addEventListener("close",()=>r()),s&&u.addEventListener("versionchange",h=>s(h.oldVersion,h.newVersion,h))}).catch(()=>{}),c}const Rk=["get","getKey","getAll","getAllKeys","count"],Mk=["put","add","delete","clear"],My=new Map;function uS(i,t){if(!(i instanceof IDBDatabase&&!(t in i)&&typeof t=="string"))return;if(My.get(t))return My.get(t);const e=t.replace(/FromIndex$/,""),n=t!==e,s=Mk.includes(e);if(!(e in(n?IDBIndex:IDBObjectStore).prototype)||!(s||Rk.includes(e)))return;const r=async function(a,...c){const u=this.transaction(a,s?"readwrite":"readonly");let h=u.store;return n&&(h=h.index(c.shift())),(await Promise.all([h[e](...c),s&&u.done]))[0]};return My.set(t,r),r}wk(i=>({...i,get:(t,e,n)=>uS(t,e)||i.get(t,e,n),has:(t,e)=>!!uS(t,e)||i.has(t,e)}));class Pk{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(xk(e)){const n=e.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(e=>e).join(" ")}}function xk(i){return i.getComponent()?.type==="VERSION"}const i_="@firebase/app",hS="0.14.3";const Tr=new dv("@firebase/app"),Dk="@firebase/app-compat",Nk="@firebase/analytics-compat",kk="@firebase/analytics",Lk="@firebase/app-check-compat",Ok="@firebase/app-check",Uk="@firebase/auth",Vk="@firebase/auth-compat",Bk="@firebase/database",Fk="@firebase/data-connect",Hk="@firebase/database-compat",Gk="@firebase/functions",qk="@firebase/functions-compat",zk="@firebase/installations",$k="@firebase/installations-compat",Yk="@firebase/messaging",Wk="@firebase/messaging-compat",Kk="@firebase/performance",Xk="@firebase/performance-compat",Jk="@firebase/remote-config",Qk="@firebase/remote-config-compat",jk="@firebase/storage",Zk="@firebase/storage-compat",tL="@firebase/firestore",eL="@firebase/ai",nL="@firebase/firestore-compat",iL="firebase",sL="12.3.0";const s_="[DEFAULT]",rL={[i_]:"fire-core",[Dk]:"fire-core-compat",[kk]:"fire-analytics",[Nk]:"fire-analytics-compat",[Ok]:"fire-app-check",[Lk]:"fire-app-check-compat",[Uk]:"fire-auth",[Vk]:"fire-auth-compat",[Bk]:"fire-rtdb",[Fk]:"fire-data-connect",[Hk]:"fire-rtdb-compat",[Gk]:"fire-fn",[qk]:"fire-fn-compat",[zk]:"fire-iid",[$k]:"fire-iid-compat",[Yk]:"fire-fcm",[Wk]:"fire-fcm-compat",[Kk]:"fire-perf",[Xk]:"fire-perf-compat",[Jk]:"fire-rc",[Qk]:"fire-rc-compat",[jk]:"fire-gcs",[Zk]:"fire-gcs-compat",[tL]:"fire-fst",[nL]:"fire-fst-compat",[eL]:"fire-vertex","fire-js":"fire-js",[iL]:"fire-js-all"};const sp=new Map,oL=new Map,r_=new Map;function dS(i,t){try{i.container.addComponent(t)}catch(e){Tr.debug(`Component ${t.name} failed to register with FirebaseApp ${i.name}`,e)}}function xa(i){const t=i.name;if(r_.has(t))return Tr.debug(`There were multiple attempts to register component ${t}.`),!1;r_.set(t,i);for(const e of sp.values())dS(e,i);for(const e of oL.values())dS(e,i);return!0}function Bp(i,t){const e=i.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),i.container.getProvider(t)}function yi(i){return i==null?!1:i.settings!==void 0}const aL={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ao=new Mh("app","Firebase",aL);class lL{constructor(t,e,n){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new bo("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Ao.create("app-deleted",{appName:this._name})}}const Ha=sL;function CI(i,t={}){let e=i;typeof t!="object"&&(t={name:t});const n={name:s_,automaticDataCollectionEnabled:!0,...t},s=n.name;if(typeof s!="string"||!s)throw Ao.create("bad-app-name",{appName:String(s)});if(e||(e=TI()),!e)throw Ao.create("no-options");const r=sp.get(s);if(r){if(Er(e,r.options)&&Er(n,r.config))return r;throw Ao.create("duplicate-app",{appName:s})}const a=new pk(s);for(const u of r_.values())a.addComponent(u);const c=new lL(e,n,a);return sp.set(s,c),c}function pv(i=s_){const t=sp.get(i);if(!t&&i===s_&&TI())return CI();if(!t)throw Ao.create("no-app",{appName:i});return t}function Rs(i,t,e){let n=rL[i]??i;e&&(n+=`-${e}`);const s=n.match(/\s|\//),r=t.match(/\s|\//);if(s||r){const a=[`Unable to register library "${n}" with version "${t}":`];s&&a.push(`library name "${n}" contains illegal characters (whitespace or "/")`),s&&r&&a.push("and"),r&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Tr.warn(a.join(" "));return}xa(new bo(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}const cL="firebase-heartbeat-database",uL=1,ph="firebase-heartbeat-store";let Py=null;function II(){return Py||(Py=Ik(cL,uL,{upgrade:(i,t)=>{switch(t){case 0:try{i.createObjectStore(ph)}catch(e){console.warn(e)}}}}).catch(i=>{throw Ao.create("idb-open",{originalErrorMessage:i.message})})),Py}async function hL(i){try{const e=(await II()).transaction(ph),n=await e.objectStore(ph).get(RI(i));return await e.done,n}catch(t){if(t instanceof Hs)Tr.warn(t.message);else{const e=Ao.create("idb-get",{originalErrorMessage:t?.message});Tr.warn(e.message)}}}async function fS(i,t){try{const n=(await II()).transaction(ph,"readwrite");await n.objectStore(ph).put(t,RI(i)),await n.done}catch(e){if(e instanceof Hs)Tr.warn(e.message);else{const n=Ao.create("idb-set",{originalErrorMessage:e?.message});Tr.warn(n.message)}}}function RI(i){return`${i.name}!${i.options.appId}`}const dL=1024,fL=30;class pL{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new gL(e),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=pS();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(s=>s.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:e}),this._heartbeatsCache.heartbeats.length>fL){const s=yL(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){Tr.warn(t)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=pS(),{heartbeatsToSend:e,unsentEntries:n}=mL(this._heartbeatsCache.heartbeats),s=ip(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return Tr.warn(t),""}}}function pS(){return new Date().toISOString().substring(0,10)}function mL(i,t=dL){const e=[];let n=i.slice();for(const s of i){const r=e.find(a=>a.agent===s.agent);if(r){if(r.dates.push(s.date),mS(e)>t){r.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),mS(e)>t){e.pop();break}n=n.slice(1)}return{heartbeatsToSend:e,unsentEntries:n}}class gL{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return nk()?ik().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await hL(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const n=await this.read();return fS(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const n=await this.read();return fS(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}else return}}function mS(i){return ip(JSON.stringify({version:2,heartbeats:i})).length}function yL(i){if(i.length===0)return-1;let t=0,e=i[0].date;for(let n=1;n<i.length;n++)i[n].date<e&&(e=i[n].date,t=n);return t}function _L(i){xa(new bo("platform-logger",t=>new Pk(t),"PRIVATE")),xa(new bo("heartbeat",t=>new pL(t),"PRIVATE")),Rs(i_,hS,i),Rs(i_,hS,"esm2020"),Rs("fire-js","")}_L("");var vL="firebase",EL="12.3.0";Rs(vL,EL,"app");function MI(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const TL=MI,PI=new Mh("auth","Firebase",MI());const rp=new dv("@firebase/auth");function AL(i,...t){rp.logLevel<=Qt.WARN&&rp.warn(`Auth (${Ha}): ${i}`,...t)}function Bf(i,...t){rp.logLevel<=Qt.ERROR&&rp.error(`Auth (${Ha}): ${i}`,...t)}function ss(i,...t){throw mv(i,...t)}function Ms(i,...t){return mv(i,...t)}function xI(i,t,e){const n={...TL(),[t]:e};return new Mh("auth","Firebase",n).create(t,{appName:i.name})}function _r(i){return xI(i,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function mv(i,...t){if(typeof i!="string"){const e=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=i.name),i._errorFactory.create(e,...n)}return PI.create(i,...t)}function Nt(i,t,...e){if(!i)throw mv(t,...e)}function mr(i){const t="INTERNAL ASSERTION FAILED: "+i;throw Bf(t),new Error(t)}function Ar(i,t){i||mr(t)}function o_(){return typeof self<"u"&&self.location?.href||""}function SL(){return gS()==="http:"||gS()==="https:"}function gS(){return typeof self<"u"&&self.location?.protocol||null}function wL(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(SL()||jN()||"connection"in navigator)?navigator.onLine:!0}function bL(){if(typeof navigator>"u")return null;const i=navigator;return i.languages&&i.languages[0]||i.language||null}class xh{constructor(t,e){this.shortDelay=t,this.longDelay=e,Ar(e>t,"Short delay should be less than long delay!"),this.isMobile=XN()||ZN()}get(){return wL()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function gv(i,t){Ar(i.emulator,"Emulator should always be set here");const{url:e}=i.emulator;return t?`${e}${t.startsWith("/")?t.slice(1):t}`:e}class DI{static initialize(t,e,n){this.fetchImpl=t,e&&(this.headersImpl=e),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;mr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;mr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;mr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const CL={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const IL=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],RL=new xh(3e4,6e4);function Lo(i,t){return i.tenantId&&!t.tenantId?{...t,tenantId:i.tenantId}:t}async function Oo(i,t,e,n,s={}){return NI(i,s,async()=>{let r={},a={};n&&(t==="GET"?a=n:r={body:JSON.stringify(n)});const c=Ph({key:i.config.apiKey,...a}).slice(1),u=await i._getAdditionalHeaders();u["Content-Type"]="application/json",i.languageCode&&(u["X-Firebase-Locale"]=i.languageCode);const h={method:t,headers:u,...r};return QN()||(h.referrerPolicy="no-referrer"),i.emulatorConfig&&Fa(i.emulatorConfig.host)&&(h.credentials="include"),DI.fetch()(await kI(i,i.config.apiHost,e,c),h)})}async function NI(i,t,e){i._canInitEmulator=!1;const n={...CL,...t};try{const s=new PL(i),r=await Promise.race([e(),s.promise]);s.clearNetworkTimeout();const a=await r.json();if("needConfirmation"in a)throw mf(i,"account-exists-with-different-credential",a);if(r.ok&&!("errorMessage"in a))return a;{const c=r.ok?a.errorMessage:a.error.message,[u,h]=c.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw mf(i,"credential-already-in-use",a);if(u==="EMAIL_EXISTS")throw mf(i,"email-already-in-use",a);if(u==="USER_DISABLED")throw mf(i,"user-disabled",a);const f=n[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw xI(i,f,h);ss(i,f)}}catch(s){if(s instanceof Hs)throw s;ss(i,"network-request-failed",{message:String(s)})}}async function Dh(i,t,e,n,s={}){const r=await Oo(i,t,e,n,s);return"mfaPendingCredential"in r&&ss(i,"multi-factor-auth-required",{_serverResponse:r}),r}async function kI(i,t,e,n){const s=`${t}${e}?${n}`,r=i,a=r.config.emulator?gv(i.config,s):`${i.config.apiScheme}://${s}`;return IL.includes(e)&&(await r._persistenceManagerAvailable,r._getPersistenceType()==="COOKIE")?r._getPersistence()._getFinalTarget(a).toString():a}function ML(i){switch(i){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class PL{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((e,n)=>{this.timer=setTimeout(()=>n(Ms(this.auth,"network-request-failed")),RL.get())})}}function mf(i,t,e){const n={appName:i.name};e.email&&(n.email=e.email),e.phoneNumber&&(n.phoneNumber=e.phoneNumber);const s=Ms(i,t,n);return s.customData._tokenResponse=e,s}function yS(i){return i!==void 0&&i.enterprise!==void 0}class xL{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const e of this.recaptchaEnforcementState)if(e.provider&&e.provider===t)return ML(e.enforcementState);return null}isProviderEnabled(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function DL(i,t){return Oo(i,"GET","/v2/recaptchaConfig",Lo(i,t))}async function NL(i,t){return Oo(i,"POST","/v1/accounts:delete",t)}async function op(i,t){return Oo(i,"POST","/v1/accounts:lookup",t)}function ah(i){if(i)try{const t=new Date(Number(i));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function kL(i,t=!1){const e=vn(i),n=await e.getIdToken(t),s=yv(n);Nt(s&&s.exp&&s.auth_time&&s.iat,e.auth,"internal-error");const r=typeof s.firebase=="object"?s.firebase:void 0,a=r?.sign_in_provider;return{claims:s,token:n,authTime:ah(xy(s.auth_time)),issuedAtTime:ah(xy(s.iat)),expirationTime:ah(xy(s.exp)),signInProvider:a||null,signInSecondFactor:r?.sign_in_second_factor||null}}function xy(i){return Number(i)*1e3}function yv(i){const[t,e,n]=i.split(".");if(t===void 0||e===void 0||n===void 0)return Bf("JWT malformed, contained fewer than 3 sections"),null;try{const s=_I(e);return s?JSON.parse(s):(Bf("Failed to decode base64 JWT payload"),null)}catch(s){return Bf("Caught error parsing JWT payload as JSON",s?.toString()),null}}function _S(i){const t=yv(i);return Nt(t,"internal-error"),Nt(typeof t.exp<"u","internal-error"),Nt(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}async function mh(i,t,e=!1){if(e)return t;try{return await t}catch(n){throw n instanceof Hs&&LL(n)&&i.auth.currentUser===i&&await i.auth.signOut(),n}}function LL({code:i}){return i==="auth/user-disabled"||i==="auth/user-token-expired"}class OL{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){if(t){const e=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),e}else{this.errorBackoff=3e4;const n=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,n)}}schedule(t=!1){if(!this.isRunning)return;const e=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},e)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){t?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class a_{constructor(t,e){this.createdAt=t,this.lastLoginAt=e,this._initializeTime()}_initializeTime(){this.lastSignInTime=ah(this.lastLoginAt),this.creationTime=ah(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ap(i){const t=i.auth,e=await i.getIdToken(),n=await mh(i,op(t,{idToken:e}));Nt(n?.users.length,t,"internal-error");const s=n.users[0];i._notifyReloadListener(s);const r=s.providerUserInfo?.length?LI(s.providerUserInfo):[],a=VL(i.providerData,r),c=i.isAnonymous,u=!(i.email&&s.passwordHash)&&!a?.length,h=c?u:!1,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new a_(s.createdAt,s.lastLoginAt),isAnonymous:h};Object.assign(i,f)}async function UL(i){const t=vn(i);await ap(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function VL(i,t){return[...i.filter(n=>!t.some(s=>s.providerId===n.providerId)),...t]}function LI(i){return i.map(({providerId:t,...e})=>({providerId:t,uid:e.rawId||"",displayName:e.displayName||null,email:e.email||null,phoneNumber:e.phoneNumber||null,photoURL:e.photoUrl||null}))}async function BL(i,t){const e=await NI(i,{},async()=>{const n=Ph({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:s,apiKey:r}=i.config,a=await kI(i,s,"/v1/token",`key=${r}`),c=await i._getAdditionalHeaders();c["Content-Type"]="application/x-www-form-urlencoded";const u={method:"POST",headers:c,body:n};return i.emulatorConfig&&Fa(i.emulatorConfig.host)&&(u.credentials="include"),DI.fetch()(a,u)});return{accessToken:e.access_token,expiresIn:e.expires_in,refreshToken:e.refresh_token}}async function FL(i,t){return Oo(i,"POST","/v2/accounts:revokeToken",Lo(i,t))}class Zl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Nt(t.idToken,"internal-error"),Nt(typeof t.idToken<"u","internal-error"),Nt(typeof t.refreshToken<"u","internal-error");const e="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):_S(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}updateFromIdToken(t){Nt(t.length!==0,"internal-error");const e=_S(t);this.updateTokensAndExpiration(t,null,e)}async getToken(t,e=!1){return!e&&this.accessToken&&!this.isExpired?this.accessToken:(Nt(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,e){const{accessToken:n,refreshToken:s,expiresIn:r}=await BL(t,e);this.updateTokensAndExpiration(n,s,Number(r))}updateTokensAndExpiration(t,e,n){this.refreshToken=e||null,this.accessToken=t||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(t,e){const{refreshToken:n,accessToken:s,expirationTime:r}=e,a=new Zl;return n&&(Nt(typeof n=="string","internal-error",{appName:t}),a.refreshToken=n),s&&(Nt(typeof s=="string","internal-error",{appName:t}),a.accessToken=s),r&&(Nt(typeof r=="number","internal-error",{appName:t}),a.expirationTime=r),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new Zl,this.toJSON())}_performRefresh(){return mr("not implemented")}}function ho(i,t){Nt(typeof i=="string"||typeof i>"u","internal-error",{appName:t})}class ji{constructor({uid:t,auth:e,stsTokenManager:n,...s}){this.providerId="firebase",this.proactiveRefresh=new OL(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=e,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new a_(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(t){const e=await mh(this,this.stsTokenManager.getToken(this.auth,t));return Nt(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(t){return kL(this,t)}reload(){return UL(this)}_assign(t){this!==t&&(Nt(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(e=>({...e})),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const e=new ji({...this,auth:t,stsTokenManager:this.stsTokenManager._clone()});return e.metadata._copy(this.metadata),e}_onReload(t){Nt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,e=!1){let n=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),n=!0),e&&await ap(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(yi(this.auth.app))return Promise.reject(_r(this.auth));const t=await this.getIdToken();return await mh(this,NL(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>({...t})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,e){const n=e.displayName??void 0,s=e.email??void 0,r=e.phoneNumber??void 0,a=e.photoURL??void 0,c=e.tenantId??void 0,u=e._redirectEventId??void 0,h=e.createdAt??void 0,f=e.lastLoginAt??void 0,{uid:m,emailVerified:y,isAnonymous:T,providerData:S,stsTokenManager:b}=e;Nt(m&&b,t,"internal-error");const C=Zl.fromJSON(this.name,b);Nt(typeof m=="string",t,"internal-error"),ho(n,t.name),ho(s,t.name),Nt(typeof y=="boolean",t,"internal-error"),Nt(typeof T=="boolean",t,"internal-error"),ho(r,t.name),ho(a,t.name),ho(c,t.name),ho(u,t.name),ho(h,t.name),ho(f,t.name);const I=new ji({uid:m,auth:t,email:s,emailVerified:y,displayName:n,isAnonymous:T,photoURL:a,phoneNumber:r,tenantId:c,stsTokenManager:C,createdAt:h,lastLoginAt:f});return S&&Array.isArray(S)&&(I.providerData=S.map(D=>({...D}))),u&&(I._redirectEventId=u),I}static async _fromIdTokenResponse(t,e,n=!1){const s=new Zl;s.updateFromServerResponse(e);const r=new ji({uid:e.localId,auth:t,stsTokenManager:s,isAnonymous:n});return await ap(r),r}static async _fromGetAccountInfoResponse(t,e,n){const s=e.users[0];Nt(s.localId!==void 0,"internal-error");const r=s.providerUserInfo!==void 0?LI(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!r?.length,c=new Zl;c.updateFromIdToken(n);const u=new ji({uid:s.localId,auth:t,stsTokenManager:c,isAnonymous:a}),h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:r,metadata:new a_(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!r?.length};return Object.assign(u,h),u}}const vS=new Map;function gr(i){Ar(i instanceof Function,"Expected a class definition");let t=vS.get(i);return t?(Ar(t instanceof i,"Instance stored in cache mismatched with class"),t):(t=new i,vS.set(i,t),t)}class OI{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,e){this.storage[t]=e}async _get(t){const e=this.storage[t];return e===void 0?null:e}async _remove(t){delete this.storage[t]}_addListener(t,e){}_removeListener(t,e){}}OI.type="NONE";const ES=OI;function Ff(i,t,e){return`firebase:${i}:${t}:${e}`}class tc{constructor(t,e,n){this.persistence=t,this.auth=e,this.userKey=n;const{config:s,name:r}=this.auth;this.fullUserKey=Ff(this.userKey,s.apiKey,r),this.fullPersistenceKey=Ff("persistence",s.apiKey,r),this.boundEventHandler=e._onStorageEvent.bind(e),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);if(!t)return null;if(typeof t=="string"){const e=await op(this.auth,{idToken:t}).catch(()=>{});return e?ji._fromGetAccountInfoResponse(this.auth,e,t):null}return ji._fromJSON(this.auth,t)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const e=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,e)return this.setCurrentUser(e)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,e,n="authUser"){if(!e.length)return new tc(gr(ES),t,n);const s=(await Promise.all(e.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let r=s[0]||gr(ES);const a=Ff(n,t.config.apiKey,t.name);let c=null;for(const h of e)try{const f=await h._get(a);if(f){let m;if(typeof f=="string"){const y=await op(t,{idToken:f}).catch(()=>{});if(!y)break;m=await ji._fromGetAccountInfoResponse(t,y,f)}else m=ji._fromJSON(t,f);h!==r&&(c=m),r=h;break}}catch{}const u=s.filter(h=>h._shouldAllowMigration);return!r._shouldAllowMigration||!u.length?new tc(r,t,n):(r=u[0],c&&await r._set(a,c.toJSON()),await Promise.all(e.map(async h=>{if(h!==r)try{await h._remove(a)}catch{}})),new tc(r,t,n))}}function TS(i){const t=i.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(FI(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(UI(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(GI(t))return"Blackberry";if(qI(t))return"Webos";if(VI(t))return"Safari";if((t.includes("chrome/")||BI(t))&&!t.includes("edge/"))return"Chrome";if(HI(t))return"Android";{const e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=i.match(e);if(n?.length===2)return n[1]}return"Other"}function UI(i=Fn()){return/firefox\//i.test(i)}function VI(i=Fn()){const t=i.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function BI(i=Fn()){return/crios\//i.test(i)}function FI(i=Fn()){return/iemobile/i.test(i)}function HI(i=Fn()){return/android/i.test(i)}function GI(i=Fn()){return/blackberry/i.test(i)}function qI(i=Fn()){return/webos/i.test(i)}function _v(i=Fn()){return/iphone|ipad|ipod/i.test(i)||/macintosh/i.test(i)&&/mobile/i.test(i)}function HL(i=Fn()){return _v(i)&&!!window.navigator?.standalone}function GL(){return tk()&&document.documentMode===10}function zI(i=Fn()){return _v(i)||HI(i)||qI(i)||GI(i)||/windows phone/i.test(i)||FI(i)}function $I(i,t=[]){let e;switch(i){case"Browser":e=TS(Fn());break;case"Worker":e=`${TS(Fn())}-${i}`;break;default:e=i}const n=t.length?t.join(","):"FirebaseCore-web";return`${e}/JsCore/${Ha}/${n}`}class qL{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,e){const n=r=>new Promise((a,c)=>{try{const u=t(r);a(u)}catch(u){c(u)}});n.onAbort=e,this.queue.push(n);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const e=[];try{for(const n of this.queue)await n(t),n.onAbort&&e.push(n.onAbort)}catch(n){e.reverse();for(const s of e)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n?.message})}}}async function zL(i,t={}){return Oo(i,"GET","/v2/passwordPolicy",Lo(i,t))}const $L=6;class YL{constructor(t){const e=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=e.minPasswordLength??$L,e.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=e.maxPasswordLength),e.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=e.containsLowercaseCharacter),e.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=e.containsUppercaseCharacter),e.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=e.containsNumericCharacter),e.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=e.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=t.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=t.forceUpgradeOnSignin??!1,this.schemaVersion=t.schemaVersion}validatePassword(t){const e={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,e),this.validatePasswordCharacterOptions(t,e),e.isValid&&(e.isValid=e.meetsMinPasswordLength??!0),e.isValid&&(e.isValid=e.meetsMaxPasswordLength??!0),e.isValid&&(e.isValid=e.containsLowercaseLetter??!0),e.isValid&&(e.isValid=e.containsUppercaseLetter??!0),e.isValid&&(e.isValid=e.containsNumericCharacter??!0),e.isValid&&(e.isValid=e.containsNonAlphanumericCharacter??!0),e}validatePasswordLengthOptions(t,e){const n=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;n&&(e.meetsMinPasswordLength=t.length>=n),s&&(e.meetsMaxPasswordLength=t.length<=s)}validatePasswordCharacterOptions(t,e){this.updatePasswordCharacterOptionsStatuses(e,!1,!1,!1,!1);let n;for(let s=0;s<t.length;s++)n=t.charAt(s),this.updatePasswordCharacterOptionsStatuses(e,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(t,e,n,s,r){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=e)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=r))}}class WL{constructor(t,e,n,s){this.app=t,this.heartbeatServiceProvider=e,this.appCheckServiceProvider=n,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new AS(this),this.idTokenSubscription=new AS(this),this.beforeStateQueue=new qL(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=PI,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(r=>this._resolvePersistenceManagerAvailable=r)}_initializeWithPersistence(t,e){return e&&(this._popupRedirectResolver=gr(e)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await tc.create(this,t),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(e),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const e=await op(this,{idToken:t}),n=await ji._fromGetAccountInfoResponse(this,e,t);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){if(yi(this.app)){const r=this.app.settings.authIdToken;return r?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(r).then(a,a))}):this.directlySetCurrentUser(null)}const e=await this.assertedPersistence.getCurrentUser();let n=e,s=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const r=this.redirectUser?._redirectEventId,a=n?._redirectEventId,c=await this.tryRedirectSignIn(t);(!r||r===a)&&c?.user&&(n=c.user,s=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(n)}catch(r){n=e,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(r))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return Nt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(t){let e=null;try{e=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return e}async reloadAndSetCurrentUserOrClear(t){try{await ap(t)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=bL()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(yi(this.app))return Promise.reject(_r(this));const e=t?vn(t):null;return e&&Nt(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(e&&e._clone(this))}async _updateCurrentUser(t,e=!1){if(!this._deleted)return t&&Nt(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),e||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return yi(this.app)?Promise.reject(_r(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return yi(this.app)?Promise.reject(_r(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(gr(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const e=this._getPasswordPolicyInternal();return e.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):e.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await zL(this),e=new YL(t);this.tenantId===null?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(t){this._errorFactory=new Mh("auth","Firebase",t())}onAuthStateChanged(t,e,n){return this.registerStateListener(this.authStateSubscription,t,e,n)}beforeAuthStateChanged(t,e){return this.beforeStateQueue.pushCallback(t,e)}onIdTokenChanged(t,e,n){return this.registerStateListener(this.idTokenSubscription,t,e,n)}authStateReady(){return new Promise((t,e)=>{if(this.currentUser)t();else{const n=this.onAuthStateChanged(()=>{n(),t()},e)}})}async revokeAccessToken(t){if(this.currentUser){const e=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:e};this.tenantId!=null&&(n.tenantId=this.tenantId),await FL(this,n)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(t,e){const n=await this.getOrInitRedirectPersistenceManager(e);return t===null?n.removeCurrentUser():n.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const e=t&&gr(t)||this._popupRedirectResolver;Nt(e,this,"argument-error"),this.redirectPersistenceManager=await tc.create(this,[gr(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===t?this._currentUser:this.redirectUser?._redirectEventId===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const t=this.currentUser?.uid??null;this.lastNotifiedUid!==t&&(this.lastNotifiedUid=t,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,e,n,s){if(this._deleted)return()=>{};const r=typeof e=="function"?e:e.next.bind(e);let a=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(Nt(c,this,"internal-error"),c.then(()=>{a||r(this.currentUser)}),typeof e=="function"){const u=t.addObserver(e,n,s);return()=>{a=!0,u()}}else{const u=t.addObserver(e);return()=>{a=!0,u()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Nt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=$I(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const e=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();e&&(t["X-Firebase-Client"]=e);const n=await this._getAppCheckToken();return n&&(t["X-Firebase-AppCheck"]=n),t}async _getAppCheckToken(){if(yi(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return t?.error&&AL(`Error while retrieving App Check token: ${t.error}`),t?.token}}function Ga(i){return vn(i)}class AS{constructor(t){this.auth=t,this.observer=null,this.addObserver=lk(e=>this.observer=e)}get next(){return Nt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Fp={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function KL(i){Fp=i}function YI(i){return Fp.loadJS(i)}function XL(){return Fp.recaptchaEnterpriseScript}function JL(){return Fp.gapiScript}function QL(i){return`__${i}${Math.floor(Math.random()*1e6)}`}class jL{constructor(){this.enterprise=new ZL}ready(t){t()}execute(t,e){return Promise.resolve("token")}render(t,e){return""}}class ZL{ready(t){t()}execute(t,e){return Promise.resolve("token")}render(t,e){return""}}const t2="recaptcha-enterprise",WI="NO_RECAPTCHA";class e2{constructor(t){this.type=t2,this.auth=Ga(t)}async verify(t="verify",e=!1){async function n(r){if(!e){if(r.tenantId==null&&r._agentRecaptchaConfig!=null)return r._agentRecaptchaConfig.siteKey;if(r.tenantId!=null&&r._tenantRecaptchaConfigs[r.tenantId]!==void 0)return r._tenantRecaptchaConfigs[r.tenantId].siteKey}return new Promise(async(a,c)=>{DL(r,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{const h=new xL(u);return r.tenantId==null?r._agentRecaptchaConfig=h:r._tenantRecaptchaConfigs[r.tenantId]=h,a(h.siteKey)}}).catch(u=>{c(u)})})}function s(r,a,c){const u=window.grecaptcha;yS(u)?u.enterprise.ready(()=>{u.enterprise.execute(r,{action:t}).then(h=>{a(h)}).catch(()=>{a(WI)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new jL().execute("siteKey",{action:"verify"}):new Promise((r,a)=>{n(this.auth).then(c=>{if(!e&&yS(window.grecaptcha))s(c,r,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let u=XL();u.length!==0&&(u+=c),YI(u).then(()=>{s(c,r,a)}).catch(h=>{a(h)})}}).catch(c=>{a(c)})})}}async function SS(i,t,e,n=!1,s=!1){const r=new e2(i);let a;if(s)a=WI;else try{a=await r.verify(e)}catch{a=await r.verify(e,!0)}const c={...t};if(e==="mfaSmsEnrollment"||e==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in c){const u=c.phoneEnrollmentInfo.phoneNumber,h=c.phoneEnrollmentInfo.recaptchaToken;Object.assign(c,{phoneEnrollmentInfo:{phoneNumber:u,recaptchaToken:h,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in c){const u=c.phoneSignInInfo.recaptchaToken;Object.assign(c,{phoneSignInInfo:{recaptchaToken:u,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return c}return n?Object.assign(c,{captchaResp:a}):Object.assign(c,{captchaResponse:a}),Object.assign(c,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(c,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),c}async function l_(i,t,e,n,s){if(i._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const r=await SS(i,t,e,e==="getOobCode");return n(i,r)}else return n(i,t).catch(async r=>{if(r.code==="auth/missing-recaptcha-token"){console.log(`${e} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await SS(i,t,e,e==="getOobCode");return n(i,a)}else return Promise.reject(r)})}function n2(i,t){const e=Bp(i,"auth");if(e.isInitialized()){const s=e.getImmediate(),r=e.getOptions();if(Er(r,t??{}))return s;ss(s,"already-initialized")}return e.initialize({options:t})}function i2(i,t){const e=t?.persistence||[],n=(Array.isArray(e)?e:[e]).map(gr);t?.errorMap&&i._updateErrorMap(t.errorMap),i._initializeWithPersistence(n,t?.popupRedirectResolver)}function s2(i,t,e){const n=Ga(i);Nt(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");const s=!1,r=KI(t),{host:a,port:c}=r2(t),u=c===null?"":`:${c}`,h={url:`${r}//${a}${u}/`},f=Object.freeze({host:a,port:c,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!n._canInitEmulator){Nt(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),Nt(Er(h,n.config.emulator)&&Er(f,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=h,n.emulatorConfig=f,n.settings.appVerificationDisabledForTesting=!0,Fa(a)?(uv(`${r}//${a}${u}`),hv("Auth",!0)):o2()}function KI(i){const t=i.indexOf(":");return t<0?"":i.substr(0,t+1)}function r2(i){const t=KI(i),e=/(\/\/)?([^?#/]+)/.exec(i.substr(t.length));if(!e)return{host:"",port:null};const n=e[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(n);if(s){const r=s[1];return{host:r,port:wS(n.substr(r.length+1))}}else{const[r,a]=n.split(":");return{host:r,port:wS(a)}}}function wS(i){if(!i)return null;const t=Number(i);return isNaN(t)?null:t}function o2(){function i(){const t=document.createElement("p"),e=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",e.position="fixed",e.width="100%",e.backgroundColor="#ffffff",e.border=".1em solid #000000",e.color="#b50000",e.bottom="0px",e.left="0px",e.margin="0px",e.zIndex="10000",e.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",i):i())}class vv{constructor(t,e){this.providerId=t,this.signInMethod=e}toJSON(){return mr("not implemented")}_getIdTokenResponse(t){return mr("not implemented")}_linkToIdToken(t,e){return mr("not implemented")}_getReauthenticationResolver(t){return mr("not implemented")}}async function a2(i,t){return Oo(i,"POST","/v1/accounts:signUp",t)}async function l2(i,t){return Dh(i,"POST","/v1/accounts:signInWithPassword",Lo(i,t))}async function c2(i,t){return Dh(i,"POST","/v1/accounts:signInWithEmailLink",Lo(i,t))}async function u2(i,t){return Dh(i,"POST","/v1/accounts:signInWithEmailLink",Lo(i,t))}class gh extends vv{constructor(t,e,n,s=null){super("password",n),this._email=t,this._password=e,this._tenantId=s}static _fromEmailAndPassword(t,e){return new gh(t,e,"password")}static _fromEmailAndCode(t,e,n=null){return new gh(t,e,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const e=typeof t=="string"?JSON.parse(t):t;if(e?.email&&e?.password){if(e.signInMethod==="password")return this._fromEmailAndPassword(e.email,e.password);if(e.signInMethod==="emailLink")return this._fromEmailAndCode(e.email,e.password,e.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":const e={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return l_(t,e,"signInWithPassword",l2);case"emailLink":return c2(t,{email:this._email,oobCode:this._password});default:ss(t,"internal-error")}}async _linkToIdToken(t,e){switch(this.signInMethod){case"password":const n={idToken:e,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return l_(t,n,"signUpPassword",a2);case"emailLink":return u2(t,{idToken:e,email:this._email,oobCode:this._password});default:ss(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}async function ec(i,t){return Dh(i,"POST","/v1/accounts:signInWithIdp",Lo(i,t))}const h2="http://localhost";class Da extends vv{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const e=new Da(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(e.idToken=t.idToken),t.accessToken&&(e.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(e.nonce=t.nonce),t.pendingToken&&(e.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(e.accessToken=t.oauthToken,e.secret=t.oauthTokenSecret):ss("argument-error"),e}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const e=typeof t=="string"?JSON.parse(t):t,{providerId:n,signInMethod:s,...r}=e;if(!n||!s)return null;const a=new Da(n,s);return a.idToken=r.idToken||void 0,a.accessToken=r.accessToken||void 0,a.secret=r.secret,a.nonce=r.nonce,a.pendingToken=r.pendingToken||null,a}_getIdTokenResponse(t){const e=this.buildRequest();return ec(t,e)}_linkToIdToken(t,e){const n=this.buildRequest();return n.idToken=e,ec(t,n)}_getReauthenticationResolver(t){const e=this.buildRequest();return e.autoCreate=!1,ec(t,e)}buildRequest(){const t={requestUri:h2,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const e={};this.idToken&&(e.id_token=this.idToken),this.accessToken&&(e.access_token=this.accessToken),this.secret&&(e.oauth_token_secret=this.secret),e.providerId=this.providerId,this.nonce&&!this.pendingToken&&(e.nonce=this.nonce),t.postBody=Ph(e)}return t}}function d2(i){switch(i){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function f2(i){const t=Ju(Qu(i)).link,e=t?Ju(Qu(t)).deep_link_id:null,n=Ju(Qu(i)).deep_link_id;return(n?Ju(Qu(n)).link:null)||n||e||t||i}class Ev{constructor(t){const e=Ju(Qu(t)),n=e.apiKey??null,s=e.oobCode??null,r=d2(e.mode??null);Nt(n&&s&&r,"argument-error"),this.apiKey=n,this.operation=r,this.code=s,this.continueUrl=e.continueUrl??null,this.languageCode=e.lang??null,this.tenantId=e.tenantId??null}static parseLink(t){const e=f2(t);try{return new Ev(e)}catch{return null}}}class bc{constructor(){this.providerId=bc.PROVIDER_ID}static credential(t,e){return gh._fromEmailAndPassword(t,e)}static credentialWithLink(t,e){const n=Ev.parseLink(e);return Nt(n,"argument-error"),gh._fromEmailAndCode(t,n.code,n.tenantId)}}bc.PROVIDER_ID="password";bc.EMAIL_PASSWORD_SIGN_IN_METHOD="password";bc.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class XI{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}class Nh extends XI{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}class fo extends Nh{constructor(){super("facebook.com")}static credential(t){return Da._fromParams({providerId:fo.PROVIDER_ID,signInMethod:fo.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return fo.credentialFromTaggedObject(t)}static credentialFromError(t){return fo.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return fo.credential(t.oauthAccessToken)}catch{return null}}}fo.FACEBOOK_SIGN_IN_METHOD="facebook.com";fo.PROVIDER_ID="facebook.com";class po extends Nh{constructor(){super("google.com"),this.addScope("profile")}static credential(t,e){return Da._fromParams({providerId:po.PROVIDER_ID,signInMethod:po.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:e})}static credentialFromResult(t){return po.credentialFromTaggedObject(t)}static credentialFromError(t){return po.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:e,oauthAccessToken:n}=t;if(!e&&!n)return null;try{return po.credential(e,n)}catch{return null}}}po.GOOGLE_SIGN_IN_METHOD="google.com";po.PROVIDER_ID="google.com";class mo extends Nh{constructor(){super("github.com")}static credential(t){return Da._fromParams({providerId:mo.PROVIDER_ID,signInMethod:mo.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return mo.credentialFromTaggedObject(t)}static credentialFromError(t){return mo.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return mo.credential(t.oauthAccessToken)}catch{return null}}}mo.GITHUB_SIGN_IN_METHOD="github.com";mo.PROVIDER_ID="github.com";class go extends Nh{constructor(){super("twitter.com")}static credential(t,e){return Da._fromParams({providerId:go.PROVIDER_ID,signInMethod:go.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:e})}static credentialFromResult(t){return go.credentialFromTaggedObject(t)}static credentialFromError(t){return go.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:e,oauthTokenSecret:n}=t;if(!e||!n)return null;try{return go.credential(e,n)}catch{return null}}}go.TWITTER_SIGN_IN_METHOD="twitter.com";go.PROVIDER_ID="twitter.com";async function p2(i,t){return Dh(i,"POST","/v1/accounts:signUp",Lo(i,t))}class Na{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,e,n,s=!1){const r=await ji._fromIdTokenResponse(t,n,s),a=bS(n);return new Na({user:r,providerId:a,_tokenResponse:n,operationType:e})}static async _forOperation(t,e,n){await t._updateTokensIfNecessary(n,!0);const s=bS(n);return new Na({user:t,providerId:s,_tokenResponse:n,operationType:e})}}function bS(i){return i.providerId?i.providerId:"phoneNumber"in i?"phone":null}class lp extends Hs{constructor(t,e,n,s){super(e.code,e.message),this.operationType=n,this.user=s,Object.setPrototypeOf(this,lp.prototype),this.customData={appName:t.name,tenantId:t.tenantId??void 0,_serverResponse:e.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(t,e,n,s){return new lp(t,e,n,s)}}function JI(i,t,e,n){return(t==="reauthenticate"?e._getReauthenticationResolver(i):e._getIdTokenResponse(i)).catch(r=>{throw r.code==="auth/multi-factor-auth-required"?lp._fromErrorAndOperation(i,r,t,n):r})}async function m2(i,t,e=!1){const n=await mh(i,t._linkToIdToken(i.auth,await i.getIdToken()),e);return Na._forOperation(i,"link",n)}async function g2(i,t,e=!1){const{auth:n}=i;if(yi(n.app))return Promise.reject(_r(n));const s="reauthenticate";try{const r=await mh(i,JI(n,s,t,i),e);Nt(r.idToken,n,"internal-error");const a=yv(r.idToken);Nt(a,n,"internal-error");const{sub:c}=a;return Nt(i.uid===c,n,"user-mismatch"),Na._forOperation(i,s,r)}catch(r){throw r?.code==="auth/user-not-found"&&ss(n,"user-mismatch"),r}}async function QI(i,t,e=!1){if(yi(i.app))return Promise.reject(_r(i));const n="signIn",s=await JI(i,n,t),r=await Na._fromIdTokenResponse(i,n,s);return e||await i._updateCurrentUser(r.user),r}async function y2(i,t){return QI(Ga(i),t)}async function jI(i){const t=Ga(i);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function _2(i,t,e){if(yi(i.app))return Promise.reject(_r(i));const n=Ga(i),a=await l_(n,{returnSecureToken:!0,email:t,password:e,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",p2).catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&jI(i),u}),c=await Na._fromIdTokenResponse(n,"signIn",a);return await n._updateCurrentUser(c.user),c}function v2(i,t,e){return yi(i.app)?Promise.reject(_r(i)):y2(vn(i),bc.credential(t,e)).catch(async n=>{throw n.code==="auth/password-does-not-meet-requirements"&&jI(i),n})}function E2(i,t,e,n){return vn(i).onIdTokenChanged(t,e,n)}function T2(i,t,e){return vn(i).beforeAuthStateChanged(t,e)}function A2(i,t,e,n){return vn(i).onAuthStateChanged(t,e,n)}function S2(i){return vn(i).signOut()}const cp="__sak";class ZI{constructor(t,e){this.storageRetriever=t,this.type=e}_isAvailable(){try{return this.storage?(this.storage.setItem(cp,"1"),this.storage.removeItem(cp),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,e){return this.storage.setItem(t,JSON.stringify(e)),Promise.resolve()}_get(t){const e=this.storage.getItem(t);return Promise.resolve(e?JSON.parse(e):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}const w2=1e3,b2=10;class tR extends ZI{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,e)=>this.onStorageEvent(t,e),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=zI(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const e of Object.keys(this.listeners)){const n=this.storage.getItem(e),s=this.localCache[e];n!==s&&t(e,s,n)}}onStorageEvent(t,e=!1){if(!t.key){this.forAllChangedKeys((a,c,u)=>{this.notifyListeners(a,u)});return}const n=t.key;e?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(n);!e&&this.localCache[n]===a||this.notifyListeners(n,a)},r=this.storage.getItem(n);GL()&&r!==t.newValue&&t.newValue!==t.oldValue?setTimeout(s,b2):s()}notifyListeners(t,e){this.localCache[t]=e;const n=this.listeners[t];if(n)for(const s of Array.from(n))s(e&&JSON.parse(e))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,e,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:e,newValue:n}),!0)})},w2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,e){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,e){await super._set(t,e),this.localCache[t]=JSON.stringify(e)}async _get(t){const e=await super._get(t);return this.localCache[t]=JSON.stringify(e),e}async _remove(t){await super._remove(t),delete this.localCache[t]}}tR.type="LOCAL";const C2=tR;class eR extends ZI{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,e){}_removeListener(t,e){}}eR.type="SESSION";const nR=eR;function I2(i){return Promise.all(i.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(e){return{fulfilled:!1,reason:e}}}))}class Hp{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const e=this.receivers.find(s=>s.isListeningto(t));if(e)return e;const n=new Hp(t);return this.receivers.push(n),n}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const e=t,{eventId:n,eventType:s,data:r}=e.data,a=this.handlersMap[s];if(!a?.size)return;e.ports[0].postMessage({status:"ack",eventId:n,eventType:s});const c=Array.from(a).map(async h=>h(e.origin,r)),u=await I2(c);e.ports[0].postMessage({status:"done",eventId:n,eventType:s,response:u})}_subscribe(t,e){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(e)}_unsubscribe(t,e){this.handlersMap[t]&&e&&this.handlersMap[t].delete(e),(!e||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Hp.receivers=[];function Tv(i="",t=10){let e="";for(let n=0;n<t;n++)e+=Math.floor(Math.random()*10);return i+e}class R2{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,e,n=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let r,a;return new Promise((c,u)=>{const h=Tv("",20);s.port1.start();const f=setTimeout(()=>{u(new Error("unsupported_event"))},n);a={messageChannel:s,onMessage(m){const y=m;if(y.data.eventId===h)switch(y.data.status){case"ack":clearTimeout(f),r=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),c(y.data.response);break;default:clearTimeout(f),clearTimeout(r),u(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:t,eventId:h,data:e},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function Ps(){return window}function M2(i){Ps().location.href=i}function iR(){return typeof Ps().WorkerGlobalScope<"u"&&typeof Ps().importScripts=="function"}async function P2(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function x2(){return navigator?.serviceWorker?.controller||null}function D2(){return iR()?self:null}const sR="firebaseLocalStorageDb",N2=1,up="firebaseLocalStorage",rR="fbase_key";class kh{constructor(t){this.request=t}toPromise(){return new Promise((t,e)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{e(this.request.error)})})}}function Gp(i,t){return i.transaction([up],t?"readwrite":"readonly").objectStore(up)}function k2(){const i=indexedDB.deleteDatabase(sR);return new kh(i).toPromise()}function c_(){const i=indexedDB.open(sR,N2);return new Promise((t,e)=>{i.addEventListener("error",()=>{e(i.error)}),i.addEventListener("upgradeneeded",()=>{const n=i.result;try{n.createObjectStore(up,{keyPath:rR})}catch(s){e(s)}}),i.addEventListener("success",async()=>{const n=i.result;n.objectStoreNames.contains(up)?t(n):(n.close(),await k2(),t(await c_()))})})}async function CS(i,t,e){const n=Gp(i,!0).put({[rR]:t,value:e});return new kh(n).toPromise()}async function L2(i,t){const e=Gp(i,!1).get(t),n=await new kh(e).toPromise();return n===void 0?null:n.value}function IS(i,t){const e=Gp(i,!0).delete(t);return new kh(e).toPromise()}const O2=800,U2=3;class oR{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await c_(),this.db)}async _withRetries(t){let e=0;for(;;)try{const n=await this._openDb();return await t(n)}catch(n){if(e++>U2)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return iR()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Hp._getInstance(D2()),this.receiver._subscribe("keyChanged",async(t,e)=>({keyProcessed:(await this._poll()).includes(e.key)})),this.receiver._subscribe("ping",async(t,e)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await P2(),!this.activeServiceWorker)return;this.sender=new R2(this.activeServiceWorker);const t=await this.sender._send("ping",{},800);t&&t[0]?.fulfilled&&t[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||x2()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await c_();return await CS(t,cp,"1"),await IS(t,cp),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,e){return this._withPendingWrite(async()=>(await this._withRetries(n=>CS(n,t,e)),this.localCache[t]=e,this.notifyServiceWorker(t)))}async _get(t){const e=await this._withRetries(n=>L2(n,t));return this.localCache[t]=e,e}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(e=>IS(e,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(s=>{const r=Gp(s,!1).getAll();return new kh(r).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const e=[],n=new Set;if(t.length!==0)for(const{fbase_key:s,value:r}of t)n.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(r)&&(this.notifyListeners(s,r),e.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!n.has(s)&&(this.notifyListeners(s,null),e.push(s));return e}notifyListeners(t,e){this.localCache[t]=e;const n=this.listeners[t];if(n)for(const s of Array.from(n))s(e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),O2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,e){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}oR.type="LOCAL";const V2=oR;new xh(3e4,6e4);function B2(i,t){return t?gr(t):(Nt(i._popupRedirectResolver,i,"argument-error"),i._popupRedirectResolver)}class Av extends vv{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return ec(t,this._buildIdpRequest())}_linkToIdToken(t,e){return ec(t,this._buildIdpRequest(e))}_getReauthenticationResolver(t){return ec(t,this._buildIdpRequest())}_buildIdpRequest(t){const e={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(e.idToken=t),e}}function F2(i){return QI(i.auth,new Av(i),i.bypassAuthState)}function H2(i){const{auth:t,user:e}=i;return Nt(e,t,"internal-error"),g2(e,new Av(i),i.bypassAuthState)}async function G2(i){const{auth:t,user:e}=i;return Nt(e,t,"internal-error"),m2(e,new Av(i),i.bypassAuthState)}class aR{constructor(t,e,n,s,r=!1){this.auth=t,this.resolver=n,this.user=s,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(e)?e:[e]}execute(){return new Promise(async(t,e)=>{this.pendingPromise={resolve:t,reject:e};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(t){const{urlResponse:e,sessionId:n,postBody:s,tenantId:r,error:a,type:c}=t;if(a){this.reject(a);return}const u={auth:this.auth,requestUri:e,sessionId:n,tenantId:r||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(u))}catch(h){this.reject(h)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return F2;case"linkViaPopup":case"linkViaRedirect":return G2;case"reauthViaPopup":case"reauthViaRedirect":return H2;default:ss(this.auth,"internal-error")}}resolve(t){Ar(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Ar(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const q2=new xh(2e3,1e4);class Wl extends aR{constructor(t,e,n,s,r){super(t,e,s,r),this.provider=n,this.authWindow=null,this.pollId=null,Wl.currentPopupAction&&Wl.currentPopupAction.cancel(),Wl.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return Nt(t,this.auth,"internal-error"),t}async onExecution(){Ar(this.filter.length===1,"Popup operations only handle one event");const t=Tv();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(Ms(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Ms(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Wl.currentPopupAction=null}pollUserCancellation(){const t=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ms(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,q2.get())};t()}}Wl.currentPopupAction=null;const z2="pendingRedirect",Hf=new Map;class $2 extends aR{constructor(t,e,n=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],e,void 0,n),this.eventId=null}async execute(){let t=Hf.get(this.auth._key());if(!t){try{const n=await Y2(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(n)}catch(e){t=()=>Promise.reject(e)}Hf.set(this.auth._key(),t)}return this.bypassAuthState||Hf.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const e=await this.auth._redirectUserForId(t.eventId);if(e)return this.user=e,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Y2(i,t){const e=X2(t),n=K2(i);if(!await n._isAvailable())return!1;const s=await n._get(e)==="true";return await n._remove(e),s}function W2(i,t){Hf.set(i._key(),t)}function K2(i){return gr(i._redirectPersistence)}function X2(i){return Ff(z2,i.config.apiKey,i.name)}async function J2(i,t,e=!1){if(yi(i.app))return Promise.reject(_r(i));const n=Ga(i),s=B2(n,t),a=await new $2(n,s,e).execute();return a&&!e&&(delete a.user._redirectEventId,await n._persistUserIfCurrent(a.user),await n._setRedirectUser(null,t)),a}const Q2=600*1e3;class j2{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let e=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(t,n)&&(e=!0,this.sendToConsumer(t,n),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!Z2(t)||(this.hasHandledPotentialRedirect=!0,e||(this.queuedRedirectEvent=t,e=!0)),e}sendToConsumer(t,e){if(t.error&&!lR(t)){const n=t.error.code?.split("auth/")[1]||"internal-error";e.onError(Ms(this.auth,n))}else e.onAuthEvent(t)}isEventForConsumer(t,e){const n=e.eventId===null||!!t.eventId&&t.eventId===e.eventId;return e.filter.includes(t.type)&&n}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=Q2&&this.cachedEventUids.clear(),this.cachedEventUids.has(RS(t))}saveEventToCache(t){this.cachedEventUids.add(RS(t)),this.lastProcessedEventTime=Date.now()}}function RS(i){return[i.type,i.eventId,i.sessionId,i.tenantId].filter(t=>t).join("-")}function lR({type:i,error:t}){return i==="unknown"&&t?.code==="auth/no-auth-event"}function Z2(i){switch(i.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return lR(i);default:return!1}}async function tO(i,t={}){return Oo(i,"GET","/v1/projects",t)}const eO=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,nO=/^https?/;async function iO(i){if(i.config.emulator)return;const{authorizedDomains:t}=await tO(i);for(const e of t)try{if(sO(e))return}catch{}ss(i,"unauthorized-domain")}function sO(i){const t=o_(),{protocol:e,hostname:n}=new URL(t);if(i.startsWith("chrome-extension://")){const a=new URL(i);return a.hostname===""&&n===""?e==="chrome-extension:"&&i.replace("chrome-extension://","")===t.replace("chrome-extension://",""):e==="chrome-extension:"&&a.hostname===n}if(!nO.test(e))return!1;if(eO.test(i))return n===i;const s=i.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(n)}const rO=new xh(3e4,6e4);function MS(){const i=Ps().___jsl;if(i?.H){for(const t of Object.keys(i.H))if(i.H[t].r=i.H[t].r||[],i.H[t].L=i.H[t].L||[],i.H[t].r=[...i.H[t].L],i.CP)for(let e=0;e<i.CP.length;e++)i.CP[e]=null}}function oO(i){return new Promise((t,e)=>{function n(){MS(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{MS(),e(Ms(i,"network-request-failed"))},timeout:rO.get()})}if(Ps().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else if(Ps().gapi?.load)n();else{const s=QL("iframefcb");return Ps()[s]=()=>{gapi.load?n():e(Ms(i,"network-request-failed"))},YI(`${JL()}?onload=${s}`).catch(r=>e(r))}}).catch(t=>{throw Gf=null,t})}let Gf=null;function aO(i){return Gf=Gf||oO(i),Gf}const lO=new xh(5e3,15e3),cO="__/auth/iframe",uO="emulator/auth/iframe",hO={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},dO=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function fO(i){const t=i.config;Nt(t.authDomain,i,"auth-domain-config-required");const e=t.emulator?gv(t,uO):`https://${i.config.authDomain}/${cO}`,n={apiKey:t.apiKey,appName:i.name,v:Ha},s=dO.get(i.config.apiHost);s&&(n.eid=s);const r=i._getFrameworks();return r.length&&(n.fw=r.join(",")),`${e}?${Ph(n).slice(1)}`}async function pO(i){const t=await aO(i),e=Ps().gapi;return Nt(e,i,"internal-error"),t.open({where:document.body,url:fO(i),messageHandlersFilter:e.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:hO,dontclear:!0},n=>new Promise(async(s,r)=>{await n.restyle({setHideOnLeave:!1});const a=Ms(i,"network-request-failed"),c=Ps().setTimeout(()=>{r(a)},lO.get());function u(){Ps().clearTimeout(c),s(n)}n.ping(u).then(u,()=>{r(a)})}))}const mO={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},gO=500,yO=600,_O="_blank",vO="http://localhost";class PS{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function EO(i,t,e,n=gO,s=yO){const r=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-n)/2,0).toString();let c="";const u={...mO,width:n.toString(),height:s.toString(),top:r,left:a},h=Fn().toLowerCase();e&&(c=BI(h)?_O:e),UI(h)&&(t=t||vO,u.scrollbars="yes");const f=Object.entries(u).reduce((y,[T,S])=>`${y}${T}=${S},`,"");if(HL(h)&&c!=="_self")return TO(t||"",c),new PS(null);const m=window.open(t||"",c,f);Nt(m,i,"popup-blocked");try{m.focus()}catch{}return new PS(m)}function TO(i,t){const e=document.createElement("a");e.href=i,e.target=t;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(n)}const AO="__/auth/handler",SO="emulator/auth/handler",wO=encodeURIComponent("fac");async function xS(i,t,e,n,s,r){Nt(i.config.authDomain,i,"auth-domain-config-required"),Nt(i.config.apiKey,i,"invalid-api-key");const a={apiKey:i.config.apiKey,appName:i.name,authType:e,redirectUrl:n,v:Ha,eventId:s};if(t instanceof XI){t.setDefaultLanguage(i.languageCode),a.providerId=t.providerId||"",ak(t.getCustomParameters())||(a.customParameters=JSON.stringify(t.getCustomParameters()));for(const[f,m]of Object.entries({}))a[f]=m}if(t instanceof Nh){const f=t.getScopes().filter(m=>m!=="");f.length>0&&(a.scopes=f.join(","))}i.tenantId&&(a.tid=i.tenantId);const c=a;for(const f of Object.keys(c))c[f]===void 0&&delete c[f];const u=await i._getAppCheckToken(),h=u?`#${wO}=${encodeURIComponent(u)}`:"";return`${bO(i)}?${Ph(c).slice(1)}${h}`}function bO({config:i}){return i.emulator?gv(i,SO):`https://${i.authDomain}/${AO}`}const Dy="webStorageSupport";class CO{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=nR,this._completeRedirectFn=J2,this._overrideRedirectResult=W2}async _openPopup(t,e,n,s){Ar(this.eventManagers[t._key()]?.manager,"_initialize() not called before _openPopup()");const r=await xS(t,e,n,o_(),s);return EO(t,r,Tv())}async _openRedirect(t,e,n,s){await this._originValidation(t);const r=await xS(t,e,n,o_(),s);return M2(r),new Promise(()=>{})}_initialize(t){const e=t._key();if(this.eventManagers[e]){const{manager:s,promise:r}=this.eventManagers[e];return s?Promise.resolve(s):(Ar(r,"If manager is not set, promise should be"),r)}const n=this.initAndGetManager(t);return this.eventManagers[e]={promise:n},n.catch(()=>{delete this.eventManagers[e]}),n}async initAndGetManager(t){const e=await pO(t),n=new j2(t);return e.register("authEvent",s=>(Nt(s?.authEvent,t,"invalid-auth-event"),{status:n.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=e,n}_isIframeWebStorageSupported(t,e){this.iframes[t._key()].send(Dy,{type:Dy},s=>{const r=s?.[0]?.[Dy];r!==void 0&&e(!!r),ss(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const e=t._key();return this.originValidationPromises[e]||(this.originValidationPromises[e]=iO(t)),this.originValidationPromises[e]}get _shouldInitProactively(){return zI()||VI()||_v()}}const IO=CO;var DS="@firebase/auth",NS="1.11.0";class RO{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const e=this.auth.onIdTokenChanged(n=>{t(n?.stsTokenManager.accessToken||null)});this.internalListeners.set(t,e),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const e=this.internalListeners.get(t);e&&(this.internalListeners.delete(t),e(),this.updateProactiveRefresh())}assertAuthConfigured(){Nt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function MO(i){switch(i){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function PO(i){xa(new bo("auth",(t,{options:e})=>{const n=t.getProvider("app").getImmediate(),s=t.getProvider("heartbeat"),r=t.getProvider("app-check-internal"),{apiKey:a,authDomain:c}=n.options;Nt(a&&!a.includes(":"),"invalid-api-key",{appName:n.name});const u={apiKey:a,authDomain:c,clientPlatform:i,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:$I(i)},h=new WL(n,s,r,u);return i2(h,e),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,e,n)=>{t.getProvider("auth-internal").initialize()})),xa(new bo("auth-internal",t=>{const e=Ga(t.getProvider("auth").getImmediate());return(n=>new RO(n))(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),Rs(DS,NS,MO(i)),Rs(DS,NS,"esm2020")}const xO=300,DO=AI("authIdTokenMaxAge")||xO;let kS=null;const NO=i=>async t=>{const e=t&&await t.getIdTokenResult(),n=e&&(new Date().getTime()-Date.parse(e.issuedAtTime))/1e3;if(n&&n>DO)return;const s=e?.token;kS!==s&&(kS=s,await fetch(i,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function kO(i=pv()){const t=Bp(i,"auth");if(t.isInitialized())return t.getImmediate();const e=n2(i,{popupRedirectResolver:IO,persistence:[V2,C2,nR]}),n=AI("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const r=new URL(n,location.origin);if(location.origin===r.origin){const a=NO(r.toString());T2(e,a,()=>a(e.currentUser)),E2(e,c=>a(c))}}const s=vI("auth");return s&&s2(e,`http://${s}`),e}function LO(){return document.getElementsByTagName("head")?.[0]??document}KL({loadJS(i){return new Promise((t,e)=>{const n=document.createElement("script");n.setAttribute("src",i),n.onload=t,n.onerror=s=>{const r=Ms("internal-error");r.customData=s,e(r)},n.type="text/javascript",n.charset="UTF-8",LO().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});PO("Browser");var LS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var So,cR;(function(){var i;function t(N,x){function k(){}k.prototype=x.prototype,N.F=x.prototype,N.prototype=new k,N.prototype.constructor=N,N.D=function(V,U,$){for(var B=Array(arguments.length-2),vt=2;vt<arguments.length;vt++)B[vt-2]=arguments[vt];return x.prototype[U].apply(V,B)}}function e(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}t(n,e),n.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(N,x,k){k||(k=0);const V=Array(16);if(typeof x=="string")for(var U=0;U<16;++U)V[U]=x.charCodeAt(k++)|x.charCodeAt(k++)<<8|x.charCodeAt(k++)<<16|x.charCodeAt(k++)<<24;else for(U=0;U<16;++U)V[U]=x[k++]|x[k++]<<8|x[k++]<<16|x[k++]<<24;x=N.g[0],k=N.g[1],U=N.g[2];let $=N.g[3],B;B=x+($^k&(U^$))+V[0]+3614090360&4294967295,x=k+(B<<7&4294967295|B>>>25),B=$+(U^x&(k^U))+V[1]+3905402710&4294967295,$=x+(B<<12&4294967295|B>>>20),B=U+(k^$&(x^k))+V[2]+606105819&4294967295,U=$+(B<<17&4294967295|B>>>15),B=k+(x^U&($^x))+V[3]+3250441966&4294967295,k=U+(B<<22&4294967295|B>>>10),B=x+($^k&(U^$))+V[4]+4118548399&4294967295,x=k+(B<<7&4294967295|B>>>25),B=$+(U^x&(k^U))+V[5]+1200080426&4294967295,$=x+(B<<12&4294967295|B>>>20),B=U+(k^$&(x^k))+V[6]+2821735955&4294967295,U=$+(B<<17&4294967295|B>>>15),B=k+(x^U&($^x))+V[7]+4249261313&4294967295,k=U+(B<<22&4294967295|B>>>10),B=x+($^k&(U^$))+V[8]+1770035416&4294967295,x=k+(B<<7&4294967295|B>>>25),B=$+(U^x&(k^U))+V[9]+2336552879&4294967295,$=x+(B<<12&4294967295|B>>>20),B=U+(k^$&(x^k))+V[10]+4294925233&4294967295,U=$+(B<<17&4294967295|B>>>15),B=k+(x^U&($^x))+V[11]+2304563134&4294967295,k=U+(B<<22&4294967295|B>>>10),B=x+($^k&(U^$))+V[12]+1804603682&4294967295,x=k+(B<<7&4294967295|B>>>25),B=$+(U^x&(k^U))+V[13]+4254626195&4294967295,$=x+(B<<12&4294967295|B>>>20),B=U+(k^$&(x^k))+V[14]+2792965006&4294967295,U=$+(B<<17&4294967295|B>>>15),B=k+(x^U&($^x))+V[15]+1236535329&4294967295,k=U+(B<<22&4294967295|B>>>10),B=x+(U^$&(k^U))+V[1]+4129170786&4294967295,x=k+(B<<5&4294967295|B>>>27),B=$+(k^U&(x^k))+V[6]+3225465664&4294967295,$=x+(B<<9&4294967295|B>>>23),B=U+(x^k&($^x))+V[11]+643717713&4294967295,U=$+(B<<14&4294967295|B>>>18),B=k+($^x&(U^$))+V[0]+3921069994&4294967295,k=U+(B<<20&4294967295|B>>>12),B=x+(U^$&(k^U))+V[5]+3593408605&4294967295,x=k+(B<<5&4294967295|B>>>27),B=$+(k^U&(x^k))+V[10]+38016083&4294967295,$=x+(B<<9&4294967295|B>>>23),B=U+(x^k&($^x))+V[15]+3634488961&4294967295,U=$+(B<<14&4294967295|B>>>18),B=k+($^x&(U^$))+V[4]+3889429448&4294967295,k=U+(B<<20&4294967295|B>>>12),B=x+(U^$&(k^U))+V[9]+568446438&4294967295,x=k+(B<<5&4294967295|B>>>27),B=$+(k^U&(x^k))+V[14]+3275163606&4294967295,$=x+(B<<9&4294967295|B>>>23),B=U+(x^k&($^x))+V[3]+4107603335&4294967295,U=$+(B<<14&4294967295|B>>>18),B=k+($^x&(U^$))+V[8]+1163531501&4294967295,k=U+(B<<20&4294967295|B>>>12),B=x+(U^$&(k^U))+V[13]+2850285829&4294967295,x=k+(B<<5&4294967295|B>>>27),B=$+(k^U&(x^k))+V[2]+4243563512&4294967295,$=x+(B<<9&4294967295|B>>>23),B=U+(x^k&($^x))+V[7]+1735328473&4294967295,U=$+(B<<14&4294967295|B>>>18),B=k+($^x&(U^$))+V[12]+2368359562&4294967295,k=U+(B<<20&4294967295|B>>>12),B=x+(k^U^$)+V[5]+4294588738&4294967295,x=k+(B<<4&4294967295|B>>>28),B=$+(x^k^U)+V[8]+2272392833&4294967295,$=x+(B<<11&4294967295|B>>>21),B=U+($^x^k)+V[11]+1839030562&4294967295,U=$+(B<<16&4294967295|B>>>16),B=k+(U^$^x)+V[14]+4259657740&4294967295,k=U+(B<<23&4294967295|B>>>9),B=x+(k^U^$)+V[1]+2763975236&4294967295,x=k+(B<<4&4294967295|B>>>28),B=$+(x^k^U)+V[4]+1272893353&4294967295,$=x+(B<<11&4294967295|B>>>21),B=U+($^x^k)+V[7]+4139469664&4294967295,U=$+(B<<16&4294967295|B>>>16),B=k+(U^$^x)+V[10]+3200236656&4294967295,k=U+(B<<23&4294967295|B>>>9),B=x+(k^U^$)+V[13]+681279174&4294967295,x=k+(B<<4&4294967295|B>>>28),B=$+(x^k^U)+V[0]+3936430074&4294967295,$=x+(B<<11&4294967295|B>>>21),B=U+($^x^k)+V[3]+3572445317&4294967295,U=$+(B<<16&4294967295|B>>>16),B=k+(U^$^x)+V[6]+76029189&4294967295,k=U+(B<<23&4294967295|B>>>9),B=x+(k^U^$)+V[9]+3654602809&4294967295,x=k+(B<<4&4294967295|B>>>28),B=$+(x^k^U)+V[12]+3873151461&4294967295,$=x+(B<<11&4294967295|B>>>21),B=U+($^x^k)+V[15]+530742520&4294967295,U=$+(B<<16&4294967295|B>>>16),B=k+(U^$^x)+V[2]+3299628645&4294967295,k=U+(B<<23&4294967295|B>>>9),B=x+(U^(k|~$))+V[0]+4096336452&4294967295,x=k+(B<<6&4294967295|B>>>26),B=$+(k^(x|~U))+V[7]+1126891415&4294967295,$=x+(B<<10&4294967295|B>>>22),B=U+(x^($|~k))+V[14]+2878612391&4294967295,U=$+(B<<15&4294967295|B>>>17),B=k+($^(U|~x))+V[5]+4237533241&4294967295,k=U+(B<<21&4294967295|B>>>11),B=x+(U^(k|~$))+V[12]+1700485571&4294967295,x=k+(B<<6&4294967295|B>>>26),B=$+(k^(x|~U))+V[3]+2399980690&4294967295,$=x+(B<<10&4294967295|B>>>22),B=U+(x^($|~k))+V[10]+4293915773&4294967295,U=$+(B<<15&4294967295|B>>>17),B=k+($^(U|~x))+V[1]+2240044497&4294967295,k=U+(B<<21&4294967295|B>>>11),B=x+(U^(k|~$))+V[8]+1873313359&4294967295,x=k+(B<<6&4294967295|B>>>26),B=$+(k^(x|~U))+V[15]+4264355552&4294967295,$=x+(B<<10&4294967295|B>>>22),B=U+(x^($|~k))+V[6]+2734768916&4294967295,U=$+(B<<15&4294967295|B>>>17),B=k+($^(U|~x))+V[13]+1309151649&4294967295,k=U+(B<<21&4294967295|B>>>11),B=x+(U^(k|~$))+V[4]+4149444226&4294967295,x=k+(B<<6&4294967295|B>>>26),B=$+(k^(x|~U))+V[11]+3174756917&4294967295,$=x+(B<<10&4294967295|B>>>22),B=U+(x^($|~k))+V[2]+718787259&4294967295,U=$+(B<<15&4294967295|B>>>17),B=k+($^(U|~x))+V[9]+3951481745&4294967295,N.g[0]=N.g[0]+x&4294967295,N.g[1]=N.g[1]+(U+(B<<21&4294967295|B>>>11))&4294967295,N.g[2]=N.g[2]+U&4294967295,N.g[3]=N.g[3]+$&4294967295}n.prototype.v=function(N,x){x===void 0&&(x=N.length);const k=x-this.blockSize,V=this.C;let U=this.h,$=0;for(;$<x;){if(U==0)for(;$<=k;)s(this,N,$),$+=this.blockSize;if(typeof N=="string"){for(;$<x;)if(V[U++]=N.charCodeAt($++),U==this.blockSize){s(this,V),U=0;break}}else for(;$<x;)if(V[U++]=N[$++],U==this.blockSize){s(this,V),U=0;break}}this.h=U,this.o+=x},n.prototype.A=function(){var N=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);N[0]=128;for(var x=1;x<N.length-8;++x)N[x]=0;x=this.o*8;for(var k=N.length-8;k<N.length;++k)N[k]=x&255,x/=256;for(this.v(N),N=Array(16),x=0,k=0;k<4;++k)for(let V=0;V<32;V+=8)N[x++]=this.g[k]>>>V&255;return N};function r(N,x){var k=c;return Object.prototype.hasOwnProperty.call(k,N)?k[N]:k[N]=x(N)}function a(N,x){this.h=x;const k=[];let V=!0;for(let U=N.length-1;U>=0;U--){const $=N[U]|0;V&&$==x||(k[U]=$,V=!1)}this.g=k}var c={};function u(N){return-128<=N&&N<128?r(N,function(x){return new a([x|0],x<0?-1:0)}):new a([N|0],N<0?-1:0)}function h(N){if(isNaN(N)||!isFinite(N))return m;if(N<0)return C(h(-N));const x=[];let k=1;for(let V=0;N>=k;V++)x[V]=N/k|0,k*=4294967296;return new a(x,0)}function f(N,x){if(N.length==0)throw Error("number format error: empty string");if(x=x||10,x<2||36<x)throw Error("radix out of range: "+x);if(N.charAt(0)=="-")return C(f(N.substring(1),x));if(N.indexOf("-")>=0)throw Error('number format error: interior "-" character');const k=h(Math.pow(x,8));let V=m;for(let $=0;$<N.length;$+=8){var U=Math.min(8,N.length-$);const B=parseInt(N.substring($,$+U),x);U<8?(U=h(Math.pow(x,U)),V=V.j(U).add(h(B))):(V=V.j(k),V=V.add(h(B)))}return V}var m=u(0),y=u(1),T=u(16777216);i=a.prototype,i.m=function(){if(b(this))return-C(this).m();let N=0,x=1;for(let k=0;k<this.g.length;k++){const V=this.i(k);N+=(V>=0?V:4294967296+V)*x,x*=4294967296}return N},i.toString=function(N){if(N=N||10,N<2||36<N)throw Error("radix out of range: "+N);if(S(this))return"0";if(b(this))return"-"+C(this).toString(N);const x=h(Math.pow(N,6));var k=this;let V="";for(;;){const U=H(k,x).g;k=I(k,U.j(x));let $=((k.g.length>0?k.g[0]:k.h)>>>0).toString(N);if(k=U,S(k))return $+V;for(;$.length<6;)$="0"+$;V=$+V}},i.i=function(N){return N<0?0:N<this.g.length?this.g[N]:this.h};function S(N){if(N.h!=0)return!1;for(let x=0;x<N.g.length;x++)if(N.g[x]!=0)return!1;return!0}function b(N){return N.h==-1}i.l=function(N){return N=I(this,N),b(N)?-1:S(N)?0:1};function C(N){const x=N.g.length,k=[];for(let V=0;V<x;V++)k[V]=~N.g[V];return new a(k,~N.h).add(y)}i.abs=function(){return b(this)?C(this):this},i.add=function(N){const x=Math.max(this.g.length,N.g.length),k=[];let V=0;for(let U=0;U<=x;U++){let $=V+(this.i(U)&65535)+(N.i(U)&65535),B=($>>>16)+(this.i(U)>>>16)+(N.i(U)>>>16);V=B>>>16,$&=65535,B&=65535,k[U]=B<<16|$}return new a(k,k[k.length-1]&-2147483648?-1:0)};function I(N,x){return N.add(C(x))}i.j=function(N){if(S(this)||S(N))return m;if(b(this))return b(N)?C(this).j(C(N)):C(C(this).j(N));if(b(N))return C(this.j(C(N)));if(this.l(T)<0&&N.l(T)<0)return h(this.m()*N.m());const x=this.g.length+N.g.length,k=[];for(var V=0;V<2*x;V++)k[V]=0;for(V=0;V<this.g.length;V++)for(let U=0;U<N.g.length;U++){const $=this.i(V)>>>16,B=this.i(V)&65535,vt=N.i(U)>>>16,It=N.i(U)&65535;k[2*V+2*U]+=B*It,D(k,2*V+2*U),k[2*V+2*U+1]+=$*It,D(k,2*V+2*U+1),k[2*V+2*U+1]+=B*vt,D(k,2*V+2*U+1),k[2*V+2*U+2]+=$*vt,D(k,2*V+2*U+2)}for(N=0;N<x;N++)k[N]=k[2*N+1]<<16|k[2*N];for(N=x;N<2*x;N++)k[N]=0;return new a(k,0)};function D(N,x){for(;(N[x]&65535)!=N[x];)N[x+1]+=N[x]>>>16,N[x]&=65535,x++}function P(N,x){this.g=N,this.h=x}function H(N,x){if(S(x))throw Error("division by zero");if(S(N))return new P(m,m);if(b(N))return x=H(C(N),x),new P(C(x.g),C(x.h));if(b(x))return x=H(N,C(x)),new P(C(x.g),x.h);if(N.g.length>30){if(b(N)||b(x))throw Error("slowDivide_ only works with positive integers.");for(var k=y,V=x;V.l(N)<=0;)k=F(k),V=F(V);var U=G(k,1),$=G(V,1);for(V=G(V,2),k=G(k,2);!S(V);){var B=$.add(V);B.l(N)<=0&&(U=U.add(k),$=B),V=G(V,1),k=G(k,1)}return x=I(N,U.j(x)),new P(U,x)}for(U=m;N.l(x)>=0;){for(k=Math.max(1,Math.floor(N.m()/x.m())),V=Math.ceil(Math.log(k)/Math.LN2),V=V<=48?1:Math.pow(2,V-48),$=h(k),B=$.j(x);b(B)||B.l(N)>0;)k-=V,$=h(k),B=$.j(x);S($)&&($=y),U=U.add($),N=I(N,B)}return new P(U,N)}i.B=function(N){return H(this,N).h},i.and=function(N){const x=Math.max(this.g.length,N.g.length),k=[];for(let V=0;V<x;V++)k[V]=this.i(V)&N.i(V);return new a(k,this.h&N.h)},i.or=function(N){const x=Math.max(this.g.length,N.g.length),k=[];for(let V=0;V<x;V++)k[V]=this.i(V)|N.i(V);return new a(k,this.h|N.h)},i.xor=function(N){const x=Math.max(this.g.length,N.g.length),k=[];for(let V=0;V<x;V++)k[V]=this.i(V)^N.i(V);return new a(k,this.h^N.h)};function F(N){const x=N.g.length+1,k=[];for(let V=0;V<x;V++)k[V]=N.i(V)<<1|N.i(V-1)>>>31;return new a(k,N.h)}function G(N,x){const k=x>>5;x%=32;const V=N.g.length-k,U=[];for(let $=0;$<V;$++)U[$]=x>0?N.i($+k)>>>x|N.i($+k+1)<<32-x:N.i($+k);return new a(U,N.h)}n.prototype.digest=n.prototype.A,n.prototype.reset=n.prototype.u,n.prototype.update=n.prototype.v,cR=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=f,So=a}).apply(typeof LS<"u"?LS:typeof self<"u"?self:typeof window<"u"?window:{});var gf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var uR,ju,hR,qf,u_,dR,fR,pR;(function(){var i,t=Object.defineProperty;function e(v){v=[typeof globalThis=="object"&&globalThis,v,typeof window=="object"&&window,typeof self=="object"&&self,typeof gf=="object"&&gf];for(var w=0;w<v.length;++w){var R=v[w];if(R&&R.Math==Math)return R}throw Error("Cannot find global object")}var n=e(this);function s(v,w){if(w)t:{var R=n;v=v.split(".");for(var O=0;O<v.length-1;O++){var J=v[O];if(!(J in R))break t;R=R[J]}v=v[v.length-1],O=R[v],w=w(O),w!=O&&w!=null&&t(R,v,{configurable:!0,writable:!0,value:w})}}s("Symbol.dispose",function(v){return v||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(v){return v||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(v){return v||function(w){var R=[],O;for(O in w)Object.prototype.hasOwnProperty.call(w,O)&&R.push([O,w[O]]);return R}});var r=r||{},a=this||self;function c(v){var w=typeof v;return w=="object"&&v!=null||w=="function"}function u(v,w,R){return v.call.apply(v.bind,arguments)}function h(v,w,R){return h=u,h.apply(null,arguments)}function f(v,w){var R=Array.prototype.slice.call(arguments,1);return function(){var O=R.slice();return O.push.apply(O,arguments),v.apply(this,O)}}function m(v,w){function R(){}R.prototype=w.prototype,v.Z=w.prototype,v.prototype=new R,v.prototype.constructor=v,v.Ob=function(O,J,tt){for(var pt=Array(arguments.length-2),Bt=2;Bt<arguments.length;Bt++)pt[Bt-2]=arguments[Bt];return w.prototype[J].apply(O,pt)}}var y=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?v=>v&&AsyncContext.Snapshot.wrap(v):v=>v;function T(v){const w=v.length;if(w>0){const R=Array(w);for(let O=0;O<w;O++)R[O]=v[O];return R}return[]}function S(v,w){for(let O=1;O<arguments.length;O++){const J=arguments[O];var R=typeof J;if(R=R!="object"?R:J?Array.isArray(J)?"array":R:"null",R=="array"||R=="object"&&typeof J.length=="number"){R=v.length||0;const tt=J.length||0;v.length=R+tt;for(let pt=0;pt<tt;pt++)v[R+pt]=J[pt]}else v.push(J)}}class b{constructor(w,R){this.i=w,this.j=R,this.h=0,this.g=null}get(){let w;return this.h>0?(this.h--,w=this.g,this.g=w.next,w.next=null):w=this.i(),w}}function C(v){a.setTimeout(()=>{throw v},0)}function I(){var v=N;let w=null;return v.g&&(w=v.g,v.g=v.g.next,v.g||(v.h=null),w.next=null),w}class D{constructor(){this.h=this.g=null}add(w,R){const O=P.get();O.set(w,R),this.h?this.h.next=O:this.g=O,this.h=O}}var P=new b(()=>new H,v=>v.reset());class H{constructor(){this.next=this.g=this.h=null}set(w,R){this.h=w,this.g=R,this.next=null}reset(){this.next=this.g=this.h=null}}let F,G=!1,N=new D,x=()=>{const v=Promise.resolve(void 0);F=()=>{v.then(k)}};function k(){for(var v;v=I();){try{v.h.call(v.g)}catch(R){C(R)}var w=P;w.j(v),w.h<100&&(w.h++,v.next=w.g,w.g=v)}G=!1}function V(){this.u=this.u,this.C=this.C}V.prototype.u=!1,V.prototype.dispose=function(){this.u||(this.u=!0,this.N())},V.prototype[Symbol.dispose]=function(){this.dispose()},V.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function U(v,w){this.type=v,this.g=this.target=w,this.defaultPrevented=!1}U.prototype.h=function(){this.defaultPrevented=!0};var $=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var v=!1,w=Object.defineProperty({},"passive",{get:function(){v=!0}});try{const R=()=>{};a.addEventListener("test",R,w),a.removeEventListener("test",R,w)}catch{}return v})();function B(v){return/^[\s\xa0]*$/.test(v)}function vt(v,w){U.call(this,v?v.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,v&&this.init(v,w)}m(vt,U),vt.prototype.init=function(v,w){const R=this.type=v.type,O=v.changedTouches&&v.changedTouches.length?v.changedTouches[0]:null;this.target=v.target||v.srcElement,this.g=w,w=v.relatedTarget,w||(R=="mouseover"?w=v.fromElement:R=="mouseout"&&(w=v.toElement)),this.relatedTarget=w,O?(this.clientX=O.clientX!==void 0?O.clientX:O.pageX,this.clientY=O.clientY!==void 0?O.clientY:O.pageY,this.screenX=O.screenX||0,this.screenY=O.screenY||0):(this.clientX=v.clientX!==void 0?v.clientX:v.pageX,this.clientY=v.clientY!==void 0?v.clientY:v.pageY,this.screenX=v.screenX||0,this.screenY=v.screenY||0),this.button=v.button,this.key=v.key||"",this.ctrlKey=v.ctrlKey,this.altKey=v.altKey,this.shiftKey=v.shiftKey,this.metaKey=v.metaKey,this.pointerId=v.pointerId||0,this.pointerType=v.pointerType,this.state=v.state,this.i=v,v.defaultPrevented&&vt.Z.h.call(this)},vt.prototype.h=function(){vt.Z.h.call(this);const v=this.i;v.preventDefault?v.preventDefault():v.returnValue=!1};var It="closure_listenable_"+(Math.random()*1e6|0),W=0;function nt(v,w,R,O,J){this.listener=v,this.proxy=null,this.src=w,this.type=R,this.capture=!!O,this.ha=J,this.key=++W,this.da=this.fa=!1}function ft(v){v.da=!0,v.listener=null,v.proxy=null,v.src=null,v.ha=null}function xt(v,w,R){for(const O in v)w.call(R,v[O],O,v)}function z(v,w){for(const R in v)w.call(void 0,v[R],R,v)}function ot(v){const w={};for(const R in v)w[R]=v[R];return w}const dt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ht(v,w){let R,O;for(let J=1;J<arguments.length;J++){O=arguments[J];for(R in O)v[R]=O[R];for(let tt=0;tt<dt.length;tt++)R=dt[tt],Object.prototype.hasOwnProperty.call(O,R)&&(v[R]=O[R])}}function _t(v){this.src=v,this.g={},this.h=0}_t.prototype.add=function(v,w,R,O,J){const tt=v.toString();v=this.g[tt],v||(v=this.g[tt]=[],this.h++);const pt=St(v,w,O,J);return pt>-1?(w=v[pt],R||(w.fa=!1)):(w=new nt(w,this.src,tt,!!O,J),w.fa=R,v.push(w)),w};function Ot(v,w){const R=w.type;if(R in v.g){var O=v.g[R],J=Array.prototype.indexOf.call(O,w,void 0),tt;(tt=J>=0)&&Array.prototype.splice.call(O,J,1),tt&&(ft(w),v.g[R].length==0&&(delete v.g[R],v.h--))}}function St(v,w,R,O){for(let J=0;J<v.length;++J){const tt=v[J];if(!tt.da&&tt.listener==w&&tt.capture==!!R&&tt.ha==O)return J}return-1}var $t="closure_lm_"+(Math.random()*1e6|0),Wt={};function Xe(v,w,R,O,J){if(Array.isArray(w)){for(let tt=0;tt<w.length;tt++)Xe(v,w[tt],R,O,J);return null}return R=Ka(R),v&&v[It]?v.J(w,R,c(O)?!!O.capture:!1,J):qs(v,w,R,!1,O,J)}function qs(v,w,R,O,J,tt){if(!w)throw Error("Invalid event type");const pt=c(J)?!!J.capture:!!J;let Bt=se(v);if(Bt||(v[$t]=Bt=new _t(v)),R=Bt.add(w,R,O,pt,tt),R.proxy)return R;if(O=vi(),R.proxy=O,O.src=v,O.listener=R,v.addEventListener)$||(J=pt),J===void 0&&(J=!1),v.addEventListener(w.toString(),O,J);else if(v.attachEvent)v.attachEvent(mt(w.toString()),O);else if(v.addListener&&v.removeListener)v.addListener(O);else throw Error("addEventListener and attachEvent are unavailable.");return R}function vi(){function v(R){return w.call(v.src,v.listener,R)}const w=wt;return v}function Ei(v,w,R,O,J){if(Array.isArray(w))for(var tt=0;tt<w.length;tt++)Ei(v,w[tt],R,O,J);else O=c(O)?!!O.capture:!!O,R=Ka(R),v&&v[It]?(v=v.i,tt=String(w).toString(),tt in v.g&&(w=v.g[tt],R=St(w,R,O,J),R>-1&&(ft(w[R]),Array.prototype.splice.call(w,R,1),w.length==0&&(delete v.g[tt],v.h--)))):v&&(v=se(v))&&(w=v.g[w.toString()],v=-1,w&&(v=St(w,R,O,J)),(R=v>-1?w[v]:null)&&ct(R))}function ct(v){if(typeof v!="number"&&v&&!v.da){var w=v.src;if(w&&w[It])Ot(w.i,v);else{var R=v.type,O=v.proxy;w.removeEventListener?w.removeEventListener(R,O,v.capture):w.detachEvent?w.detachEvent(mt(R),O):w.addListener&&w.removeListener&&w.removeListener(O),(R=se(w))?(Ot(R,v),R.h==0&&(R.src=null,w[$t]=null)):ft(v)}}}function mt(v){return v in Wt?Wt[v]:Wt[v]="on"+v}function wt(v,w){if(v.da)v=!0;else{w=new vt(w,this);const R=v.listener,O=v.ha||v.src;v.fa&&ct(v),v=R.call(O,w)}return v}function se(v){return v=v[$t],v instanceof _t?v:null}var Ve="__closure_events_fn_"+(Math.random()*1e9>>>0);function Ka(v){return typeof v=="function"?v:(v[Ve]||(v[Ve]=function(w){return v.handleEvent(w)}),v[Ve])}function rn(){V.call(this),this.i=new _t(this),this.M=this,this.G=null}m(rn,V),rn.prototype[It]=!0,rn.prototype.removeEventListener=function(v,w,R,O){Ei(this,v,w,R,O)};function hn(v,w){var R,O=v.G;if(O)for(R=[];O;O=O.G)R.push(O);if(v=v.M,O=w.type||w,typeof w=="string")w=new U(w,v);else if(w instanceof U)w.target=w.target||v;else{var J=w;w=new U(O,v),ht(w,J)}J=!0;let tt,pt;if(R)for(pt=R.length-1;pt>=0;pt--)tt=w.g=R[pt],J=zs(tt,O,!0,w)&&J;if(tt=w.g=v,J=zs(tt,O,!0,w)&&J,J=zs(tt,O,!1,w)&&J,R)for(pt=0;pt<R.length;pt++)tt=w.g=R[pt],J=zs(tt,O,!1,w)&&J}rn.prototype.N=function(){if(rn.Z.N.call(this),this.i){var v=this.i;for(const w in v.g){const R=v.g[w];for(let O=0;O<R.length;O++)ft(R[O]);delete v.g[w],v.h--}}this.G=null},rn.prototype.J=function(v,w,R,O){return this.i.add(String(v),w,!1,R,O)},rn.prototype.K=function(v,w,R,O){return this.i.add(String(v),w,!0,R,O)};function zs(v,w,R,O){if(w=v.i.g[String(w)],!w)return!0;w=w.concat();let J=!0;for(let tt=0;tt<w.length;++tt){const pt=w[tt];if(pt&&!pt.da&&pt.capture==R){const Bt=pt.listener,Se=pt.ha||pt.src;pt.fa&&Ot(v.i,pt),J=Bt.call(Se,O)!==!1&&J}}return J&&!O.defaultPrevented}function vm(v,w){if(typeof v!="function")if(v&&typeof v.handleEvent=="function")v=h(v.handleEvent,v);else throw Error("Invalid listener argument");return Number(w)>2147483647?-1:a.setTimeout(v,w||0)}function kc(v){v.g=vm(()=>{v.g=null,v.i&&(v.i=!1,kc(v))},v.l);const w=v.h;v.h=null,v.m.apply(null,w)}class Em extends V{constructor(w,R){super(),this.m=w,this.l=R,this.h=null,this.i=!1,this.g=null}j(w){this.h=arguments,this.g?this.i=!0:kc(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Fo(v){V.call(this),this.h=v,this.g={}}m(Fo,V);var Rr=[];function Dn(v){xt(v.g,function(w,R){this.g.hasOwnProperty(R)&&ct(w)},v),v.g={}}Fo.prototype.N=function(){Fo.Z.N.call(this),Dn(this)},Fo.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ti=a.JSON.stringify,Hn=a.JSON.parse,Tm=class{stringify(v){return a.JSON.stringify(v,void 0)}parse(v){return a.JSON.parse(v,void 0)}};function Xh(){}function Jh(){}var as={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Mr(){U.call(this,"d")}m(Mr,U);function Hi(){U.call(this,"c")}m(Hi,U);var Ai={},Pr=null;function Xa(){return Pr=Pr||new rn}Ai.Ia="serverreachability";function Lc(v){U.call(this,Ai.Ia,v)}m(Lc,U);function xr(v){const w=Xa();hn(w,new Lc(w))}Ai.STAT_EVENT="statevent";function Ja(v,w){U.call(this,Ai.STAT_EVENT,v),this.stat=w}m(Ja,U);function Be(v){const w=Xa();hn(w,new Ja(w,v))}Ai.Ja="timingevent";function Qh(v,w){U.call(this,Ai.Ja,v),this.size=w}m(Qh,U);function Dr(v,w){if(typeof v!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){v()},w)}function Nr(){this.g=!0}Nr.prototype.ua=function(){this.g=!1};function Oc(v,w,R,O,J,tt){v.info(function(){if(v.g)if(tt){var pt="",Bt=tt.split("&");for(let he=0;he<Bt.length;he++){var Se=Bt[he].split("=");if(Se.length>1){const Ge=Se[0];Se=Se[1];const oi=Ge.split("_");pt=oi.length>=2&&oi[1]=="type"?pt+(Ge+"="+Se+"&"):pt+(Ge+"=redacted&")}}}else pt=null;else pt=tt;return"XMLHTTP REQ ("+O+") [attempt "+J+"]: "+w+`
`+R+`
`+pt})}function Uc(v,w,R,O,J,tt,pt){v.info(function(){return"XMLHTTP RESP ("+O+") [ attempt "+J+"]: "+w+`
`+R+`
`+tt+" "+pt})}function $s(v,w,R,O){v.info(function(){return"XMLHTTP TEXT ("+w+"): "+ls(v,R)+(O?" "+O:"")})}function Am(v,w){v.info(function(){return"TIMEOUT: "+w})}Nr.prototype.info=function(){};function ls(v,w){if(!v.g)return w;if(!w)return null;try{const tt=JSON.parse(w);if(tt){for(v=0;v<tt.length;v++)if(Array.isArray(tt[v])){var R=tt[v];if(!(R.length<2)){var O=R[1];if(Array.isArray(O)&&!(O.length<1)){var J=O[0];if(J!="noop"&&J!="stop"&&J!="close")for(let pt=1;pt<O.length;pt++)O[pt]=""}}}}return Ti(tt)}catch{return w}}var Fe={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Tn={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Ys;function Ho(){}m(Ho,Xh),Ho.prototype.g=function(){return new XMLHttpRequest},Ys=new Ho;function Go(v){return encodeURIComponent(String(v))}function Sm(v){var w=1;v=v.split(":");const R=[];for(;w>0&&v.length;)R.push(v.shift()),w--;return v.length&&R.push(v.join(":")),R}function Gi(v,w,R,O){this.j=v,this.i=w,this.l=R,this.S=O||1,this.V=new Fo(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new kr}function kr(){this.i=null,this.g="",this.h=!1}var Qa={},cs={};function us(v,w,R){v.M=1,v.A=Ks(Me(w)),v.u=R,v.R=!0,Lr(v,null)}function Lr(v,w){v.F=Date.now(),qo(v),v.B=Me(v.A);var R=v.B,O=v.S;Array.isArray(O)||(O=[String(O)]),ed(R.i,"t",O),v.C=0,R=v.j.L,v.h=new kr,v.g=al(v.j,R?w:null,!v.u),v.P>0&&(v.O=new Em(h(v.Y,v,v.g),v.P)),w=v.V,R=v.g,O=v.ba;var J="readystatechange";Array.isArray(J)||(J&&(Rr[0]=J.toString()),J=Rr);for(let tt=0;tt<J.length;tt++){const pt=Xe(R,J[tt],O||w.handleEvent,!1,w.h||w);if(!pt)break;w.g[pt.key]=pt}w=v.J?ot(v.J):{},v.u?(v.v||(v.v="POST"),w["Content-Type"]="application/x-www-form-urlencoded",v.g.ea(v.B,v.v,v.u,w)):(v.v="GET",v.g.ea(v.B,v.v,null,w)),xr(),Oc(v.i,v.v,v.B,v.l,v.S,v.u)}Gi.prototype.ba=function(v){v=v.target;const w=this.O;w&&Nn(v)==3?w.j():this.Y(v)},Gi.prototype.Y=function(v){try{if(v==this.g)t:{const Bt=Nn(this.g),Se=this.g.ya(),he=this.g.ca();if(!(Bt<3)&&(Bt!=3||this.g&&(this.h.h||this.g.la()||ta(this.g)))){this.K||Bt!=4||Se==7||(Se==8||he<=0?xr(3):xr(2)),ds(this);var w=this.g.ca();this.X=w;var R=Or(this);if(this.o=w==200,Uc(this.i,this.v,this.B,this.l,this.S,Bt,w),this.o){if(this.U&&!this.L){e:{if(this.g){var O,J=this.g;if((O=J.g?J.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(O)){var tt=O;break e}}tt=null}if(v=tt)$s(this.i,this.l,v,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ja(this,v);else{this.o=!1,this.m=3,Be(12),fs(this),zo(this);break t}}if(this.R){v=!0;let Ge;for(;!this.K&&this.C<R.length;)if(Ge=jh(this,R),Ge==cs){Bt==4&&(this.m=4,Be(14),v=!1),$s(this.i,this.l,null,"[Incomplete Response]");break}else if(Ge==Qa){this.m=4,Be(15),$s(this.i,this.l,R,"[Invalid Chunk]"),v=!1;break}else $s(this.i,this.l,Ge,null),ja(this,Ge);if(He(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Bt!=4||R.length!=0||this.h.h||(this.m=1,Be(16),v=!1),this.o=this.o&&v,!v)$s(this.i,this.l,R,"[Invalid Chunked Response]"),fs(this),zo(this);else if(R.length>0&&!this.W){this.W=!0;var pt=this.j;pt.g==this&&pt.aa&&!pt.P&&(pt.j.info("Great, no buffering proxy detected. Bytes received: "+R.length),Wc(pt),pt.P=!0,Be(11))}}else $s(this.i,this.l,R,null),ja(this,R);Bt==4&&fs(this),this.o&&!this.K&&(Bt==4?Kc(this.j,this):(this.o=!1,qo(this)))}else ea(this.g),w==400&&R.indexOf("Unknown SID")>0?(this.m=3,Be(12)):(this.m=0,Be(13)),fs(this),zo(this)}}}catch{}finally{}};function Or(v){if(!He(v))return v.g.la();const w=ta(v.g);if(w==="")return"";let R="";const O=w.length,J=Nn(v.g)==4;if(!v.h.i){if(typeof TextDecoder>"u")return fs(v),zo(v),"";v.h.i=new a.TextDecoder}for(let tt=0;tt<O;tt++)v.h.h=!0,R+=v.h.i.decode(w[tt],{stream:!(J&&tt==O-1)});return w.length=0,v.h.g+=R,v.C=0,v.h.g}function He(v){return v.g?v.v=="GET"&&v.M!=2&&v.j.Aa:!1}function jh(v,w){var R=v.C,O=w.indexOf(`
`,R);return O==-1?cs:(R=Number(w.substring(R,O)),isNaN(R)?Qa:(O+=1,O+R>w.length?cs:(w=w.slice(O,O+R),v.C=O+R,w)))}Gi.prototype.cancel=function(){this.K=!0,fs(this)};function qo(v){v.T=Date.now()+v.H,hs(v,v.H)}function hs(v,w){if(v.D!=null)throw Error("WatchDog timer not null");v.D=Dr(h(v.aa,v),w)}function ds(v){v.D&&(a.clearTimeout(v.D),v.D=null)}Gi.prototype.aa=function(){this.D=null;const v=Date.now();v-this.T>=0?(Am(this.i,this.B),this.M!=2&&(xr(),Be(17)),fs(this),this.m=2,zo(this)):hs(this,this.T-v)};function zo(v){v.j.I==0||v.K||Kc(v.j,v)}function fs(v){ds(v);var w=v.O;w&&typeof w.dispose=="function"&&w.dispose(),v.O=null,Dn(v.V),v.g&&(w=v.g,v.g=null,w.abort(),w.dispose())}function ja(v,w){try{var R=v.j;if(R.I!=0&&(R.g==v||Wo(R.h,v))){if(!v.L&&Wo(R.h,v)&&R.I==3){try{var O=R.Ba.g.parse(w)}catch{O=null}if(Array.isArray(O)&&O.length==3){var J=O;if(J[0]==0){t:if(!R.v){if(R.g)if(R.g.F+3e3<v.F)ol(R),ps(R);else break t;Yc(R),Be(18)}}else R.xa=J[1],0<R.xa-R.K&&J[2]<37500&&R.F&&R.A==0&&!R.C&&(R.C=Dr(h(R.Va,R),6e3));Si(R.h)<=1&&R.ta&&(R.ta=void 0)}else Qs(R,11)}else if((v.L||R.g==v)&&ol(R),!B(w))for(J=R.Ba.g.parse(w),w=0;w<J.length;w++){let he=J[w];const Ge=he[0];if(!(Ge<=R.K))if(R.K=Ge,he=he[1],R.I==2)if(he[0]=="c"){R.M=he[1],R.ba=he[2];const oi=he[3];oi!=null&&(R.ka=oi,R.j.info("VER="+R.ka));const ms=he[4];ms!=null&&(R.za=ms,R.j.info("SVER="+R.za));const $i=he[5];$i!=null&&typeof $i=="number"&&$i>0&&(O=1.5*$i,R.O=O,R.j.info("backChannelRequestTimeoutMs_="+O)),O=R;const Yi=v.g;if(Yi){const Wi=Yi.g?Yi.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Wi){var tt=O.h;tt.g||Wi.indexOf("spdy")==-1&&Wi.indexOf("quic")==-1&&Wi.indexOf("h2")==-1||(tt.j=tt.l,tt.g=new Set,tt.h&&(Za(tt,tt.h),tt.h=null))}if(O.G){const Jc=Yi.g?Yi.g.getResponseHeader("X-HTTP-Session-Id"):null;Jc&&(O.wa=Jc,pe(O.J,O.G,Jc))}}R.I=3,R.l&&R.l.ra(),R.aa&&(R.T=Date.now()-v.F,R.j.info("Handshake RTT: "+R.T+"ms")),O=R;var pt=v;if(O.na=ud(O,O.L?O.ba:null,O.W),pt.L){Ws(O.h,pt);var Bt=pt,Se=O.O;Se&&(Bt.H=Se),Bt.D&&(ds(Bt),qo(Bt)),O.g=pt}else od(O);R.i.length>0&&ra(R)}else he[0]!="stop"&&he[0]!="close"||Qs(R,7);else R.I==3&&(he[0]=="stop"||he[0]=="close"?he[0]=="stop"?Qs(R,7):ia(R):he[0]!="noop"&&R.l&&R.l.qa(he),R.A=0)}}xr(4)}catch{}}var wm=class{constructor(v,w){this.g=v,this.map=w}};function $o(v){this.l=v||10,a.PerformanceNavigationTiming?(v=a.performance.getEntriesByType("navigation"),v=v.length>0&&(v[0].nextHopProtocol=="hq"||v[0].nextHopProtocol=="h2")):v=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=v?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Yo(v){return v.h?!0:v.g?v.g.size>=v.j:!1}function Si(v){return v.h?1:v.g?v.g.size:0}function Wo(v,w){return v.h?v.h==w:v.g?v.g.has(w):!1}function Za(v,w){v.g?v.g.add(w):v.h=w}function Ws(v,w){v.h&&v.h==w?v.h=null:v.g&&v.g.has(w)&&v.g.delete(w)}$o.prototype.cancel=function(){if(this.i=tl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const v of this.g.values())v.cancel();this.g.clear()}};function tl(v){if(v.h!=null)return v.i.concat(v.h.G);if(v.g!=null&&v.g.size!==0){let w=v.i;for(const R of v.g.values())w=w.concat(R.G);return w}return T(v.i)}var el=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function bm(v,w){if(v){v=v.split("&");for(let R=0;R<v.length;R++){const O=v[R].indexOf("=");let J,tt=null;O>=0?(J=v[R].substring(0,O),tt=v[R].substring(O+1)):J=v[R],w(J,tt?decodeURIComponent(tt.replace(/\+/g," ")):"")}}}function qi(v){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let w;v instanceof qi?(this.l=v.l,Ur(this,v.j),this.o=v.o,this.g=v.g,Ko(this,v.u),this.h=v.h,Vr(this,nd(v.i)),this.m=v.m):v&&(w=String(v).match(el))?(this.l=!1,Ur(this,w[1]||"",!0),this.o=Xo(w[2]||""),this.g=Xo(w[3]||"",!0),Ko(this,w[4]),this.h=Xo(w[5]||"",!0),Vr(this,w[6]||"",!0),this.m=Xo(w[7]||"")):(this.l=!1,this.i=new wi(null,this.l))}qi.prototype.toString=function(){const v=[];var w=this.j;w&&v.push(dn(w,Bc,!0),":");var R=this.g;return(R||w=="file")&&(v.push("//"),(w=this.o)&&v.push(dn(w,Bc,!0),"@"),v.push(Go(R).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),R=this.u,R!=null&&v.push(":",String(R))),(R=this.h)&&(this.g&&R.charAt(0)!="/"&&v.push("/"),v.push(dn(R,R.charAt(0)=="/"?Br:Fc,!0))),(R=this.i.toString())&&v.push("?",R),(R=this.m)&&v.push("#",dn(R,td)),v.join("")},qi.prototype.resolve=function(v){const w=Me(this);let R=!!v.j;R?Ur(w,v.j):R=!!v.o,R?w.o=v.o:R=!!v.g,R?w.g=v.g:R=v.u!=null;var O=v.h;if(R)Ko(w,v.u);else if(R=!!v.h){if(O.charAt(0)!="/")if(this.g&&!this.h)O="/"+O;else{var J=w.h.lastIndexOf("/");J!=-1&&(O=w.h.slice(0,J+1)+O)}if(J=O,J==".."||J==".")O="";else if(J.indexOf("./")!=-1||J.indexOf("/.")!=-1){O=J.lastIndexOf("/",0)==0,J=J.split("/");const tt=[];for(let pt=0;pt<J.length;){const Bt=J[pt++];Bt=="."?O&&pt==J.length&&tt.push(""):Bt==".."?((tt.length>1||tt.length==1&&tt[0]!="")&&tt.pop(),O&&pt==J.length&&tt.push("")):(tt.push(Bt),O=!0)}O=tt.join("/")}else O=J}return R?w.h=O:R=v.i.toString()!=="",R?Vr(w,nd(v.i)):R=!!v.m,R&&(w.m=v.m),w};function Me(v){return new qi(v)}function Ur(v,w,R){v.j=R?Xo(w,!0):w,v.j&&(v.j=v.j.replace(/:$/,""))}function Ko(v,w){if(w){if(w=Number(w),isNaN(w)||w<0)throw Error("Bad port number "+w);v.u=w}else v.u=null}function Vr(v,w,R){w instanceof wi?(v.i=w,qc(v.i,v.l)):(R||(w=dn(w,Zh)),v.i=new wi(w,v.l))}function pe(v,w,R){v.i.set(w,R)}function Ks(v){return pe(v,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),v}function Xo(v,w){return v?w?decodeURI(v.replace(/%25/g,"%2525")):decodeURIComponent(v):""}function dn(v,w,R){return typeof v=="string"?(v=encodeURI(v).replace(w,Vc),R&&(v=v.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),v):null}function Vc(v){return v=v.charCodeAt(0),"%"+(v>>4&15).toString(16)+(v&15).toString(16)}var Bc=/[#\/\?@]/g,Fc=/[#\?:]/g,Br=/[#\?]/g,Zh=/[#\?@]/g,td=/#/g;function wi(v,w){this.h=this.g=null,this.i=v||null,this.j=!!w}function Xs(v){v.g||(v.g=new Map,v.h=0,v.i&&bm(v.i,function(w,R){v.add(decodeURIComponent(w.replace(/\+/g," ")),R)}))}i=wi.prototype,i.add=function(v,w){Xs(this),this.i=null,v=zi(this,v);let R=this.g.get(v);return R||this.g.set(v,R=[]),R.push(w),this.h+=1,this};function Hc(v,w){Xs(v),w=zi(v,w),v.g.has(w)&&(v.i=null,v.h-=v.g.get(w).length,v.g.delete(w))}function Gc(v,w){return Xs(v),w=zi(v,w),v.g.has(w)}i.forEach=function(v,w){Xs(this),this.g.forEach(function(R,O){R.forEach(function(J){v.call(w,J,O,this)},this)},this)};function nl(v,w){Xs(v);let R=[];if(typeof w=="string")Gc(v,w)&&(R=R.concat(v.g.get(zi(v,w))));else for(v=Array.from(v.g.values()),w=0;w<v.length;w++)R=R.concat(v[w]);return R}i.set=function(v,w){return Xs(this),this.i=null,v=zi(this,v),Gc(this,v)&&(this.h-=this.g.get(v).length),this.g.set(v,[w]),this.h+=1,this},i.get=function(v,w){return v?(v=nl(this,v),v.length>0?String(v[0]):w):w};function ed(v,w,R){Hc(v,w),R.length>0&&(v.i=null,v.g.set(zi(v,w),T(R)),v.h+=R.length)}i.toString=function(){if(this.i)return this.i;if(!this.g)return"";const v=[],w=Array.from(this.g.keys());for(let O=0;O<w.length;O++){var R=w[O];const J=Go(R);R=nl(this,R);for(let tt=0;tt<R.length;tt++){let pt=J;R[tt]!==""&&(pt+="="+Go(R[tt])),v.push(pt)}}return this.i=v.join("&")};function nd(v){const w=new wi;return w.i=v.i,v.g&&(w.g=new Map(v.g),w.h=v.h),w}function zi(v,w){return w=String(w),v.j&&(w=w.toLowerCase()),w}function qc(v,w){w&&!v.j&&(Xs(v),v.i=null,v.g.forEach(function(R,O){const J=O.toLowerCase();O!=J&&(Hc(this,O),ed(this,J,R))},v)),v.j=w}function zc(v,w){const R=new Nr;if(a.Image){const O=new Image;O.onload=f(Gn,R,"TestLoadImage: loaded",!0,w,O),O.onerror=f(Gn,R,"TestLoadImage: error",!1,w,O),O.onabort=f(Gn,R,"TestLoadImage: abort",!1,w,O),O.ontimeout=f(Gn,R,"TestLoadImage: timeout",!1,w,O),a.setTimeout(function(){O.ontimeout&&O.ontimeout()},1e4),O.src=v}else w(!1)}function Fr(v,w){const R=new Nr,O=new AbortController,J=setTimeout(()=>{O.abort(),Gn(R,"TestPingServer: timeout",!1,w)},1e4);fetch(v,{signal:O.signal}).then(tt=>{clearTimeout(J),tt.ok?Gn(R,"TestPingServer: ok",!0,w):Gn(R,"TestPingServer: server error",!1,w)}).catch(()=>{clearTimeout(J),Gn(R,"TestPingServer: error",!1,w)})}function Gn(v,w,R,O,J){try{J&&(J.onload=null,J.onerror=null,J.onabort=null,J.ontimeout=null),O(R)}catch{}}function id(){this.g=new Tm}function Jo(v){this.i=v.Sb||null,this.h=v.ab||!1}m(Jo,Xh),Jo.prototype.g=function(){return new Qo(this.i,this.h)};function Qo(v,w){rn.call(this),this.H=v,this.o=w,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}m(Qo,rn),i=Qo.prototype,i.open=function(v,w){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=v,this.D=w,this.readyState=1,Js(this)},i.send=function(v){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const w={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};v&&(w.body=v),(this.H||a).fetch(new Request(this.D,w)).then(this.Pa.bind(this),this.ga.bind(this))},i.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,qn(this)),this.readyState=0},i.Pa=function(v){if(this.g&&(this.l=v,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=v.headers,this.readyState=2,Js(this)),this.g&&(this.readyState=3,Js(this),this.g)))if(this.responseType==="arraybuffer")v.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in v){if(this.j=v.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Hr(this)}else v.text().then(this.Oa.bind(this),this.ga.bind(this))};function Hr(v){v.j.read().then(v.Ma.bind(v)).catch(v.ga.bind(v))}i.Ma=function(v){if(this.g){if(this.o&&v.value)this.response.push(v.value);else if(!this.o){var w=v.value?v.value:new Uint8Array(0);(w=this.B.decode(w,{stream:!v.done}))&&(this.response=this.responseText+=w)}v.done?qn(this):Js(this),this.readyState==3&&Hr(this)}},i.Oa=function(v){this.g&&(this.response=this.responseText=v,qn(this))},i.Na=function(v){this.g&&(this.response=v,qn(this))},i.ga=function(){this.g&&qn(this)};function qn(v){v.readyState=4,v.l=null,v.j=null,v.B=null,Js(v)}i.setRequestHeader=function(v,w){this.A.append(v,w)},i.getResponseHeader=function(v){return this.h&&this.h.get(v.toLowerCase())||""},i.getAllResponseHeaders=function(){if(!this.h)return"";const v=[],w=this.h.entries();for(var R=w.next();!R.done;)R=R.value,v.push(R[0]+": "+R[1]),R=w.next();return v.join(`\r
`)};function Js(v){v.onreadystatechange&&v.onreadystatechange.call(v)}Object.defineProperty(Qo.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(v){this.m=v?"include":"same-origin"}});function Gr(v){let w="";return xt(v,function(R,O){w+=O,w+=":",w+=R,w+=`\r
`}),w}function bi(v,w,R){t:{for(O in R){var O=!1;break t}O=!0}O||(R=Gr(R),typeof v=="string"?R!=null&&Go(R):pe(v,w,R))}function Te(v){rn.call(this),this.headers=new Map,this.L=v||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}m(Te,rn);var il=/^https?$/i,sd=["POST","PUT"];i=Te.prototype,i.Fa=function(v){this.H=v},i.ea=function(v,w,R,O){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+v);w=w?w.toUpperCase():"GET",this.D=v,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Ys.g(),this.g.onreadystatechange=y(h(this.Ca,this));try{this.B=!0,this.g.open(w,String(v),!0),this.B=!1}catch(tt){jo(this,tt);return}if(v=R||"",R=new Map(this.headers),O)if(Object.getPrototypeOf(O)===Object.prototype)for(var J in O)R.set(J,O[J]);else if(typeof O.keys=="function"&&typeof O.get=="function")for(const tt of O.keys())R.set(tt,O.get(tt));else throw Error("Unknown input type for opt_headers: "+String(O));O=Array.from(R.keys()).find(tt=>tt.toLowerCase()=="content-type"),J=a.FormData&&v instanceof a.FormData,!(Array.prototype.indexOf.call(sd,w,void 0)>=0)||O||J||R.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[tt,pt]of R)this.g.setRequestHeader(tt,pt);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(v),this.v=!1}catch(tt){jo(this,tt)}};function jo(v,w){v.h=!1,v.g&&(v.j=!0,v.g.abort(),v.j=!1),v.l=w,v.o=5,Zo(v),on(v)}function Zo(v){v.A||(v.A=!0,hn(v,"complete"),hn(v,"error"))}i.abort=function(v){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=v||7,hn(this,"complete"),hn(this,"abort"),on(this))},i.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),on(this,!0)),Te.Z.N.call(this)},i.Ca=function(){this.u||(this.B||this.v||this.j?$c(this):this.Xa())},i.Xa=function(){$c(this)};function $c(v){if(v.h&&typeof r<"u"){if(v.v&&Nn(v)==4)setTimeout(v.Ca.bind(v),0);else if(hn(v,"readystatechange"),Nn(v)==4){v.h=!1;try{const tt=v.ca();t:switch(tt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var w=!0;break t;default:w=!1}var R;if(!(R=w)){var O;if(O=tt===0){let pt=String(v.D).match(el)[1]||null;!pt&&a.self&&a.self.location&&(pt=a.self.location.protocol.slice(0,-1)),O=!il.test(pt?pt.toLowerCase():"")}R=O}if(R)hn(v,"complete"),hn(v,"success");else{v.o=6;try{var J=Nn(v)>2?v.g.statusText:""}catch{J=""}v.l=J+" ["+v.ca()+"]",Zo(v)}}finally{on(v)}}}}function on(v,w){if(v.g){v.m&&(clearTimeout(v.m),v.m=null);const R=v.g;v.g=null,w||hn(v,"ready");try{R.onreadystatechange=null}catch{}}}i.isActive=function(){return!!this.g};function Nn(v){return v.g?v.g.readyState:0}i.ca=function(){try{return Nn(this)>2?this.g.status:-1}catch{return-1}},i.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},i.La=function(v){if(this.g){var w=this.g.responseText;return v&&w.indexOf(v)==0&&(w=w.substring(v.length)),Hn(w)}};function ta(v){try{if(!v.g)return null;if("response"in v.g)return v.g.response;switch(v.F){case"":case"text":return v.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in v.g)return v.g.mozResponseArrayBuffer}return null}catch{return null}}function ea(v){const w={};v=(v.g&&Nn(v)>=2&&v.g.getAllResponseHeaders()||"").split(`\r
`);for(let O=0;O<v.length;O++){if(B(v[O]))continue;var R=Sm(v[O]);const J=R[0];if(R=R[1],typeof R!="string")continue;R=R.trim();const tt=w[J]||[];w[J]=tt,tt.push(R)}z(w,function(O){return O.join(", ")})}i.ya=function(){return this.o},i.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function na(v,w,R){return R&&R.internalChannelParams&&R.internalChannelParams[v]||w}function sl(v){this.za=0,this.i=[],this.j=new Nr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=na("failFast",!1,v),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=na("baseRetryDelayMs",5e3,v),this.Za=na("retryDelaySeedMs",1e4,v),this.Ta=na("forwardChannelMaxRetries",2,v),this.va=na("forwardChannelRequestTimeoutMs",2e4,v),this.ma=v&&v.xmlHttpFactory||void 0,this.Ua=v&&v.Rb||void 0,this.Aa=v&&v.useFetchStreams||!1,this.O=void 0,this.L=v&&v.supportsCrossDomainXhr||!1,this.M="",this.h=new $o(v&&v.concurrentRequestLimit),this.Ba=new id,this.S=v&&v.fastHandshake||!1,this.R=v&&v.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=v&&v.Pb||!1,v&&v.ua&&this.j.ua(),v&&v.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&v&&v.detectBufferingProxy||!1,this.ia=void 0,v&&v.longPollingTimeout&&v.longPollingTimeout>0&&(this.ia=v.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}i=sl.prototype,i.ka=8,i.I=1,i.connect=function(v,w,R,O){Be(0),this.W=v,this.H=w||{},R&&O!==void 0&&(this.H.OSID=R,this.H.OAID=O),this.F=this.X,this.J=ud(this,null,this.W),ra(this)};function ia(v){if(sa(v),v.I==3){var w=v.V++,R=Me(v.J);if(pe(R,"SID",v.M),pe(R,"RID",w),pe(R,"TYPE","terminate"),oa(v,R),w=new Gi(v,v.j,w),w.M=2,w.A=Ks(Me(R)),R=!1,a.navigator&&a.navigator.sendBeacon)try{R=a.navigator.sendBeacon(w.A.toString(),"")}catch{}!R&&a.Image&&(new Image().src=w.A,R=!0),R||(w.g=al(w.j,null),w.g.ea(w.A)),w.F=Date.now(),qo(w)}cd(v)}function ps(v){v.g&&(Wc(v),v.g.cancel(),v.g=null)}function sa(v){ps(v),v.v&&(a.clearTimeout(v.v),v.v=null),ol(v),v.h.cancel(),v.m&&(typeof v.m=="number"&&a.clearTimeout(v.m),v.m=null)}function ra(v){if(!Yo(v.h)&&!v.m){v.m=!0;var w=v.Ea;F||x(),G||(F(),G=!0),N.add(w,v),v.D=0}}function Cm(v,w){return Si(v.h)>=v.h.j-(v.m?1:0)?!1:v.m?(v.i=w.G.concat(v.i),!0):v.I==1||v.I==2||v.D>=(v.Sa?0:v.Ta)?!1:(v.m=Dr(h(v.Ea,v,w),ld(v,v.D)),v.D++,!0)}i.Ea=function(v){if(this.m)if(this.m=null,this.I==1){if(!v){this.V=Math.floor(Math.random()*1e5),v=this.V++;const J=new Gi(this,this.j,v);let tt=this.o;if(this.U&&(tt?(tt=ot(tt),ht(tt,this.U)):tt=this.U),this.u!==null||this.R||(J.J=tt,tt=null),this.S)t:{for(var w=0,R=0;R<this.i.length;R++){e:{var O=this.i[R];if("__data__"in O.map&&(O=O.map.__data__,typeof O=="string")){O=O.length;break e}O=void 0}if(O===void 0)break;if(w+=O,w>4096){w=R;break t}if(w===4096||R===this.i.length-1){w=R+1;break t}}w=1e3}else w=1e3;w=rl(this,J,w),R=Me(this.J),pe(R,"RID",v),pe(R,"CVER",22),this.G&&pe(R,"X-HTTP-Session-Id",this.G),oa(this,R),tt&&(this.R?w="headers="+Go(Gr(tt))+"&"+w:this.u&&bi(R,this.u,tt)),Za(this.h,J),this.Ra&&pe(R,"TYPE","init"),this.S?(pe(R,"$req",w),pe(R,"SID","null"),J.U=!0,us(J,R,null)):us(J,R,w),this.I=2}}else this.I==3&&(v?rd(this,v):this.i.length==0||Yo(this.h)||rd(this))};function rd(v,w){var R;w?R=w.l:R=v.V++;const O=Me(v.J);pe(O,"SID",v.M),pe(O,"RID",R),pe(O,"AID",v.K),oa(v,O),v.u&&v.o&&bi(O,v.u,v.o),R=new Gi(v,v.j,R,v.D+1),v.u===null&&(R.J=v.o),w&&(v.i=w.G.concat(v.i)),w=rl(v,R,1e3),R.H=Math.round(v.va*.5)+Math.round(v.va*.5*Math.random()),Za(v.h,R),us(R,O,w)}function oa(v,w){v.H&&xt(v.H,function(R,O){pe(w,O,R)}),v.l&&xt({},function(R,O){pe(w,O,R)})}function rl(v,w,R){R=Math.min(v.i.length,R);const O=v.l?h(v.l.Ka,v.l,v):null;t:{var J=v.i;let Bt=-1;for(;;){const Se=["count="+R];Bt==-1?R>0?(Bt=J[0].g,Se.push("ofs="+Bt)):Bt=0:Se.push("ofs="+Bt);let he=!0;for(let Ge=0;Ge<R;Ge++){var tt=J[Ge].g;const oi=J[Ge].map;if(tt-=Bt,tt<0)Bt=Math.max(0,J[Ge].g-100),he=!1;else try{tt="req"+tt+"_"||"";try{var pt=oi instanceof Map?oi:Object.entries(oi);for(const[ms,$i]of pt){let Yi=$i;c($i)&&(Yi=Ti($i)),Se.push(tt+ms+"="+encodeURIComponent(Yi))}}catch(ms){throw Se.push(tt+"type="+encodeURIComponent("_badmap")),ms}}catch{O&&O(oi)}}if(he){pt=Se.join("&");break t}}pt=void 0}return v=v.i.splice(0,R),w.G=v,pt}function od(v){if(!v.g&&!v.v){v.Y=1;var w=v.Da;F||x(),G||(F(),G=!0),N.add(w,v),v.A=0}}function Yc(v){return v.g||v.v||v.A>=3?!1:(v.Y++,v.v=Dr(h(v.Da,v),ld(v,v.A)),v.A++,!0)}i.Da=function(){if(this.v=null,ad(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var v=4*this.T;this.j.info("BP detection timer enabled: "+v),this.B=Dr(h(this.Wa,this),v)}},i.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Be(10),ps(this),ad(this))};function Wc(v){v.B!=null&&(a.clearTimeout(v.B),v.B=null)}function ad(v){v.g=new Gi(v,v.j,"rpc",v.Y),v.u===null&&(v.g.J=v.o),v.g.P=0;var w=Me(v.na);pe(w,"RID","rpc"),pe(w,"SID",v.M),pe(w,"AID",v.K),pe(w,"CI",v.F?"0":"1"),!v.F&&v.ia&&pe(w,"TO",v.ia),pe(w,"TYPE","xmlhttp"),oa(v,w),v.u&&v.o&&bi(w,v.u,v.o),v.O&&(v.g.H=v.O);var R=v.g;v=v.ba,R.M=1,R.A=Ks(Me(w)),R.u=null,R.R=!0,Lr(R,v)}i.Va=function(){this.C!=null&&(this.C=null,ps(this),Yc(this),Be(19))};function ol(v){v.C!=null&&(a.clearTimeout(v.C),v.C=null)}function Kc(v,w){var R=null;if(v.g==w){ol(v),Wc(v),v.g=null;var O=2}else if(Wo(v.h,w))R=w.G,Ws(v.h,w),O=1;else return;if(v.I!=0){if(w.o)if(O==1){R=w.u?w.u.length:0,w=Date.now()-w.F;var J=v.D;O=Xa(),hn(O,new Qh(O,R)),ra(v)}else od(v);else if(J=w.m,J==3||J==0&&w.X>0||!(O==1&&Cm(v,w)||O==2&&Yc(v)))switch(R&&R.length>0&&(w=v.h,w.i=w.i.concat(R)),J){case 1:Qs(v,5);break;case 4:Qs(v,10);break;case 3:Qs(v,6);break;default:Qs(v,2)}}}function ld(v,w){let R=v.Qa+Math.floor(Math.random()*v.Za);return v.isActive()||(R*=2),R*w}function Qs(v,w){if(v.j.info("Error code "+w),w==2){var R=h(v.bb,v),O=v.Ua;const J=!O;O=new qi(O||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Ur(O,"https"),Ks(O),J?zc(O.toString(),R):Fr(O.toString(),R)}else Be(2);v.I=0,v.l&&v.l.pa(w),cd(v),sa(v)}i.bb=function(v){v?(this.j.info("Successfully pinged google.com"),Be(2)):(this.j.info("Failed to ping google.com"),Be(1))};function cd(v){if(v.I=0,v.ja=[],v.l){const w=tl(v.h);(w.length!=0||v.i.length!=0)&&(S(v.ja,w),S(v.ja,v.i),v.h.i.length=0,T(v.i),v.i.length=0),v.l.oa()}}function ud(v,w,R){var O=R instanceof qi?Me(R):new qi(R);if(O.g!="")w&&(O.g=w+"."+O.g),Ko(O,O.u);else{var J=a.location;O=J.protocol,w=w?w+"."+J.hostname:J.hostname,J=+J.port;const tt=new qi(null);O&&Ur(tt,O),w&&(tt.g=w),J&&Ko(tt,J),R&&(tt.h=R),O=tt}return R=v.G,w=v.wa,R&&w&&pe(O,R,w),pe(O,"VER",v.ka),oa(v,O),O}function al(v,w,R){if(w&&!v.L)throw Error("Can't create secondary domain capable XhrIo object.");return w=v.Aa&&!v.ma?new Te(new Jo({ab:R})):new Te(v.ma),w.Fa(v.L),w}i.isActive=function(){return!!this.l&&this.l.isActive(this)};function hd(){}i=hd.prototype,i.ra=function(){},i.qa=function(){},i.pa=function(){},i.oa=function(){},i.isActive=function(){return!0},i.Ka=function(){};function ll(){}ll.prototype.g=function(v,w){return new zn(v,w)};function zn(v,w){rn.call(this),this.g=new sl(w),this.l=v,this.h=w&&w.messageUrlParams||null,v=w&&w.messageHeaders||null,w&&w.clientProtocolHeaderRequired&&(v?v["X-Client-Protocol"]="webchannel":v={"X-Client-Protocol":"webchannel"}),this.g.o=v,v=w&&w.initMessageHeaders||null,w&&w.messageContentType&&(v?v["X-WebChannel-Content-Type"]=w.messageContentType:v={"X-WebChannel-Content-Type":w.messageContentType}),w&&w.sa&&(v?v["X-WebChannel-Client-Profile"]=w.sa:v={"X-WebChannel-Client-Profile":w.sa}),this.g.U=v,(v=w&&w.Qb)&&!B(v)&&(this.g.u=v),this.A=w&&w.supportsCrossDomainXhr||!1,this.v=w&&w.sendRawJson||!1,(w=w&&w.httpSessionIdParam)&&!B(w)&&(this.g.G=w,v=this.h,v!==null&&w in v&&(v=this.h,w in v&&delete v[w])),this.j=new qr(this)}m(zn,rn),zn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},zn.prototype.close=function(){ia(this.g)},zn.prototype.o=function(v){var w=this.g;if(typeof v=="string"){var R={};R.__data__=v,v=R}else this.v&&(R={},R.__data__=Ti(v),v=R);w.i.push(new wm(w.Ya++,v)),w.I==3&&ra(w)},zn.prototype.N=function(){this.g.l=null,delete this.j,ia(this.g),delete this.g,zn.Z.N.call(this)};function Xc(v){Mr.call(this),v.__headers__&&(this.headers=v.__headers__,this.statusCode=v.__status__,delete v.__headers__,delete v.__status__);var w=v.__sm__;if(w){t:{for(const R in w){v=R;break t}v=void 0}(this.i=v)&&(v=this.i,w=w!==null&&v in w?w[v]:void 0),this.data=w}else this.data=v}m(Xc,Mr);function dd(){Hi.call(this),this.status=1}m(dd,Hi);function qr(v){this.g=v}m(qr,hd),qr.prototype.ra=function(){hn(this.g,"a")},qr.prototype.qa=function(v){hn(this.g,new Xc(v))},qr.prototype.pa=function(v){hn(this.g,new dd)},qr.prototype.oa=function(){hn(this.g,"b")},ll.prototype.createWebChannel=ll.prototype.g,zn.prototype.send=zn.prototype.o,zn.prototype.open=zn.prototype.m,zn.prototype.close=zn.prototype.close,pR=function(){return new ll},fR=function(){return Xa()},dR=Ai,u_={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Fe.NO_ERROR=0,Fe.TIMEOUT=8,Fe.HTTP_ERROR=6,qf=Fe,Tn.COMPLETE="complete",hR=Tn,Jh.EventType=as,as.OPEN="a",as.CLOSE="b",as.ERROR="c",as.MESSAGE="d",rn.prototype.listen=rn.prototype.J,ju=Jh,Te.prototype.listenOnce=Te.prototype.K,Te.prototype.getLastError=Te.prototype.Ha,Te.prototype.getLastErrorCode=Te.prototype.ya,Te.prototype.getStatus=Te.prototype.ca,Te.prototype.getResponseJson=Te.prototype.La,Te.prototype.getResponseText=Te.prototype.la,Te.prototype.send=Te.prototype.ea,Te.prototype.setWithCredentials=Te.prototype.Fa,uR=Te}).apply(typeof gf<"u"?gf:typeof self<"u"?self:typeof window<"u"?window:{});const OS="@firebase/firestore",US="4.9.2";class Un{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Un.UNAUTHENTICATED=new Un(null),Un.GOOGLE_CREDENTIALS=new Un("google-credentials-uid"),Un.FIRST_PARTY=new Un("first-party-uid"),Un.MOCK_USER=new Un("mock-user");let Cc="12.3.0";const ka=new dv("@firebase/firestore");function Vl(){return ka.logLevel}function yt(i,...t){if(ka.logLevel<=Qt.DEBUG){const e=t.map(Sv);ka.debug(`Firestore (${Cc}): ${i}`,...e)}}function Sr(i,...t){if(ka.logLevel<=Qt.ERROR){const e=t.map(Sv);ka.error(`Firestore (${Cc}): ${i}`,...e)}}function dc(i,...t){if(ka.logLevel<=Qt.WARN){const e=t.map(Sv);ka.warn(`Firestore (${Cc}): ${i}`,...e)}}function Sv(i){if(typeof i=="string")return i;try{return(function(e){return JSON.stringify(e)})(i)}catch{return i}}function kt(i,t,e){let n="Unexpected state";typeof t=="string"?n=t:e=t,mR(i,n,e)}function mR(i,t,e){let n=`FIRESTORE (${Cc}) INTERNAL ASSERTION FAILED: ${t} (ID: ${i.toString(16)})`;if(e!==void 0)try{n+=" CONTEXT: "+JSON.stringify(e)}catch{n+=" CONTEXT: "+e}throw Sr(n),new Error(n)}function ue(i,t,e,n){let s="Unexpected state";typeof e=="string"?s=e:n=e,i||mR(t,s,n)}function Gt(i,t){return i}const ut={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class bt extends Hs{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class wo{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class gR{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class OO{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Un.UNAUTHENTICATED)))}shutdown(){}}class UO{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class VO{constructor(t){this.t=t,this.currentUser=Un.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){ue(this.o===void 0,42304);let n=this.i;const s=u=>this.i!==n?(n=this.i,e(u)):Promise.resolve();let r=new wo;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new wo,t.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const u=r;t.enqueueRetryable((async()=>{await u.promise,await s(this.currentUser)}))},c=u=>{yt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((u=>c(u))),setTimeout((()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?c(u):(yt("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new wo)}}),0),a()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((n=>this.i!==t?(yt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(ue(typeof n.accessToken=="string",31837,{l:n}),new gR(n.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return ue(t===null||typeof t=="string",2055,{h:t}),new Un(t)}}class BO{constructor(t,e,n){this.P=t,this.T=e,this.I=n,this.type="FirstParty",this.user=Un.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class FO{constructor(t,e,n){this.P=t,this.T=e,this.I=n}getToken(){return Promise.resolve(new BO(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable((()=>e(Un.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class VS{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class HO{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,yi(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){ue(this.o===void 0,3512);const n=r=>{r.error!=null&&yt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${r.error.message}`);const a=r.token!==this.m;return this.m=r.token,yt("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(r.token):Promise.resolve()};this.o=r=>{t.enqueueRetryable((()=>n(r)))};const s=r=>{yt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=r,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((r=>s(r))),setTimeout((()=>{if(!this.appCheck){const r=this.V.getImmediate({optional:!0});r?s(r):yt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new VS(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((e=>e?(ue(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new VS(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function GO(i){const t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(i);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let n=0;n<i;n++)e[n]=Math.floor(256*Math.random());return e}class wv{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const s=GO(40);for(let r=0;r<s.length;++r)n.length<20&&s[r]<e&&(n+=t.charAt(s[r]%62))}return n}}function jt(i,t){return i<t?-1:i>t?1:0}function h_(i,t){const e=Math.min(i.length,t.length);for(let n=0;n<e;n++){const s=i.charAt(n),r=t.charAt(n);if(s!==r)return Ny(s)===Ny(r)?jt(s,r):Ny(s)?1:-1}return jt(i.length,t.length)}const qO=55296,zO=57343;function Ny(i){const t=i.charCodeAt(0);return t>=qO&&t<=zO}function fc(i,t,e){return i.length===t.length&&i.every(((n,s)=>e(n,t[s])))}const BS="__name__";class Cs{constructor(t,e,n){e===void 0?e=0:e>t.length&&kt(637,{offset:e,range:t.length}),n===void 0?n=t.length-e:n>t.length-e&&kt(1746,{length:n,range:t.length-e}),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return Cs.comparator(this,t)===0}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Cs?t.forEach((n=>{e.push(n)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const r=Cs.compareSegments(t.get(s),e.get(s));if(r!==0)return r}return jt(t.length,e.length)}static compareSegments(t,e){const n=Cs.isNumericId(t),s=Cs.isNumericId(e);return n&&!s?-1:!n&&s?1:n&&s?Cs.extractNumericId(t).compare(Cs.extractNumericId(e)):h_(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return So.fromString(t.substring(4,t.length-2))}}class De extends Cs{construct(t,e,n){return new De(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new bt(ut.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((s=>s.length>0)))}return new De(e)}static emptyPath(){return new De([])}}const $O=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Mn extends Cs{construct(t,e,n){return new Mn(t,e,n)}static isValidIdentifier(t){return $O.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Mn.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===BS}static keyField(){return new Mn([BS])}static fromServerFormat(t){const e=[];let n="",s=0;const r=()=>{if(n.length===0)throw new bt(ut.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let a=!1;for(;s<t.length;){const c=t[s];if(c==="\\"){if(s+1===t.length)throw new bt(ut.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const u=t[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new bt(ut.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,s+=2}else c==="`"?(a=!a,s++):c!=="."||a?(n+=c,s++):(r(),s++)}if(r(),a)throw new bt(ut.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Mn(e)}static emptyPath(){return new Mn([])}}class Mt{constructor(t){this.path=t}static fromPath(t){return new Mt(De.fromString(t))}static fromName(t){return new Mt(De.fromString(t).popFirst(5))}static empty(){return new Mt(De.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&De.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return De.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new Mt(new De(t.slice()))}}function YO(i,t,e){if(!e)throw new bt(ut.INVALID_ARGUMENT,`Function ${i}() cannot be called with an empty ${t}.`)}function WO(i,t,e,n){if(t===!0&&n===!0)throw new bt(ut.INVALID_ARGUMENT,`${i} and ${e} cannot be used together.`)}function FS(i){if(!Mt.isDocumentKey(i))throw new bt(ut.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${i} has ${i.length}.`)}function yR(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}function bv(i){if(i===void 0)return"undefined";if(i===null)return"null";if(typeof i=="string")return i.length>20&&(i=`${i.substring(0,20)}...`),JSON.stringify(i);if(typeof i=="number"||typeof i=="boolean")return""+i;if(typeof i=="object"){if(i instanceof Array)return"an array";{const t=(function(n){return n.constructor?n.constructor.name:null})(i);return t?`a custom ${t} object`:"an object"}}return typeof i=="function"?"a function":kt(12329,{type:typeof i})}function ts(i,t){if("_delegate"in i&&(i=i._delegate),!(i instanceof t)){if(t.name===i.constructor.name)throw new bt(ut.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=bv(i);throw new bt(ut.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return i}function nn(i,t){const e={typeString:i};return t&&(e.value=t),e}function Lh(i,t){if(!yR(i))throw new bt(ut.INVALID_ARGUMENT,"JSON must be an object");let e;for(const n in t)if(t[n]){const s=t[n].typeString,r="value"in t[n]?{value:t[n].value}:void 0;if(!(n in i)){e=`JSON missing required field: '${n}'`;break}const a=i[n];if(s&&typeof a!==s){e=`JSON field '${n}' must be a ${s}.`;break}if(r!==void 0&&a!==r.value){e=`Expected '${n}' field to equal '${r.value}'`;break}}if(e)throw new bt(ut.INVALID_ARGUMENT,e);return!0}const HS=-62135596800,GS=1e6;class we{static now(){return we.fromMillis(Date.now())}static fromDate(t){return we.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor((t-1e3*e)*GS);return new we(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new bt(ut.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new bt(ut.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<HS)throw new bt(ut.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new bt(ut.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/GS}_compareTo(t){return this.seconds===t.seconds?jt(this.nanoseconds,t.nanoseconds):jt(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:we._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(Lh(t,we._jsonSchema))return new we(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-HS;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}we._jsonSchemaVersion="firestore/timestamp/1.0",we._jsonSchema={type:nn("string",we._jsonSchemaVersion),seconds:nn("number"),nanoseconds:nn("number")};class Vt{static fromTimestamp(t){return new Vt(t)}static min(){return new Vt(new we(0,0))}static max(){return new Vt(new we(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const yh=-1;function KO(i,t){const e=i.toTimestamp().seconds,n=i.toTimestamp().nanoseconds+1,s=Vt.fromTimestamp(n===1e9?new we(e+1,0):new we(e,n));return new Co(s,Mt.empty(),t)}function XO(i){return new Co(i.readTime,i.key,yh)}class Co{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Co(Vt.min(),Mt.empty(),yh)}static max(){return new Co(Vt.max(),Mt.empty(),yh)}}function JO(i,t){let e=i.readTime.compareTo(t.readTime);return e!==0?e:(e=Mt.comparator(i.documentKey,t.documentKey),e!==0?e:jt(i.largestBatchId,t.largestBatchId))}const QO="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class jO{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function Ic(i){if(i.code!==ut.FAILED_PRECONDITION||i.message!==QO)throw i;yt("LocalStore","Unexpectedly lost primary lease")}class lt{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&kt(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new lt(((n,s)=>{this.nextCallback=r=>{this.wrapSuccess(t,r).next(n,s)},this.catchCallback=r=>{this.wrapFailure(e,r).next(n,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof lt?e:lt.resolve(e)}catch(e){return lt.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):lt.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):lt.reject(e)}static resolve(t){return new lt(((e,n)=>{e(t)}))}static reject(t){return new lt(((e,n)=>{n(t)}))}static waitFor(t){return new lt(((e,n)=>{let s=0,r=0,a=!1;t.forEach((c=>{++s,c.next((()=>{++r,a&&r===s&&e()}),(u=>n(u)))})),a=!0,r===s&&e()}))}static or(t){let e=lt.resolve(!1);for(const n of t)e=e.next((s=>s?lt.resolve(s):n()));return e}static forEach(t,e){const n=[];return t.forEach(((s,r)=>{n.push(e.call(this,s,r))})),this.waitFor(n)}static mapArray(t,e){return new lt(((n,s)=>{const r=t.length,a=new Array(r);let c=0;for(let u=0;u<r;u++){const h=u;e(t[h]).next((f=>{a[h]=f,++c,c===r&&n(a)}),(f=>s(f)))}}))}static doWhile(t,e){return new lt(((n,s)=>{const r=()=>{t()===!0?e().next((()=>{r()}),s):n()};r()}))}}function ZO(i){const t=i.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function Rc(i){return i.name==="IndexedDbTransactionError"}class qp{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=n=>this.ae(n),this.ue=n=>e.writeSequenceNumber(n))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}qp.ce=-1;const Cv=-1;function zp(i){return i==null}function hp(i){return i===0&&1/i==-1/0}function tU(i){return typeof i=="number"&&Number.isInteger(i)&&!hp(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER}const _R="";function eU(i){let t="";for(let e=0;e<i.length;e++)t.length>0&&(t=qS(t)),t=nU(i.get(e),t);return qS(t)}function nU(i,t){let e=t;const n=i.length;for(let s=0;s<n;s++){const r=i.charAt(s);switch(r){case"\0":e+="";break;case _R:e+="";break;default:e+=r}}return e}function qS(i){return i+_R+""}function zS(i){let t=0;for(const e in i)Object.prototype.hasOwnProperty.call(i,e)&&t++;return t}function Uo(i,t){for(const e in i)Object.prototype.hasOwnProperty.call(i,e)&&t(e,i[e])}function vR(i){for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t))return!1;return!0}class ke{constructor(t,e){this.comparator=t,this.root=e||In.EMPTY}insert(t,e){return new ke(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,In.BLACK,null,null))}remove(t){return new ke(this.comparator,this.root.remove(t,this.comparator).copy(null,null,In.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(n===0)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(t,n.key);if(s===0)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new yf(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new yf(this.root,t,this.comparator,!1)}getReverseIterator(){return new yf(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new yf(this.root,t,this.comparator,!0)}}class yf{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let r=1;for(;!t.isEmpty();)if(r=e?n(t.key,e):1,e&&s&&(r*=-1),r<0)t=this.isReverse?t.left:t.right;else{if(r===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class In{constructor(t,e,n,s,r){this.key=t,this.value=e,this.color=n??In.RED,this.left=s??In.EMPTY,this.right=r??In.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,r){return new In(t??this.key,e??this.value,n??this.color,s??this.left,r??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this;const r=n(t,s.key);return s=r<0?s.copy(null,null,null,s.left.insert(t,e,n),null):r===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return In.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return In.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,In.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,In.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw kt(43730,{key:this.key,value:this.value});if(this.right.isRed())throw kt(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw kt(27949);return t+(this.isRed()?0:1)}}In.EMPTY=null,In.RED=!0,In.BLACK=!1;In.EMPTY=new class{constructor(){this.size=0}get key(){throw kt(57766)}get value(){throw kt(16141)}get color(){throw kt(16727)}get left(){throw kt(29726)}get right(){throw kt(36894)}copy(t,e,n,s,r){return this}insert(t,e,n){return new In(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class un{constructor(t){this.comparator=t,this.data=new ke(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new $S(this.data.getIterator())}getIteratorFrom(t){return new $S(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((n=>{e=e.add(n)})),e}isEqual(t){if(!(t instanceof un)||this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const s=e.getNext().key,r=n.getNext().key;if(this.comparator(s,r)!==0)return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new un(this.comparator);return e.data=t,e}}class $S{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class _i{constructor(t){this.fields=t,t.sort(Mn.comparator)}static empty(){return new _i([])}unionWith(t){let e=new un(Mn.comparator);for(const n of this.fields)e=e.add(n);for(const n of t)e=e.add(n);return new _i(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return fc(this.fields,t.fields,((e,n)=>e.isEqual(n)))}}class ER extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class xn{constructor(t){this.binaryString=t}static fromBase64String(t){const e=(function(s){try{return atob(s)}catch(r){throw typeof DOMException<"u"&&r instanceof DOMException?new ER("Invalid base64 string: "+r):r}})(t);return new xn(e)}static fromUint8Array(t){const e=(function(s){let r="";for(let a=0;a<s.length;++a)r+=String.fromCharCode(s[a]);return r})(t);return new xn(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(e){return btoa(e)})(this.binaryString)}toUint8Array(){return(function(e){const n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return jt(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}xn.EMPTY_BYTE_STRING=new xn("");const iU=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Io(i){if(ue(!!i,39018),typeof i=="string"){let t=0;const e=iU.exec(i);if(ue(!!e,46558,{timestamp:i}),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}const n=new Date(i);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:Ke(i.seconds),nanos:Ke(i.nanos)}}function Ke(i){return typeof i=="number"?i:typeof i=="string"?Number(i):0}function Ro(i){return typeof i=="string"?xn.fromBase64String(i):xn.fromUint8Array(i)}const TR="server_timestamp",AR="__type__",SR="__previous_value__",wR="__local_write_time__";function Iv(i){return(i?.mapValue?.fields||{})[AR]?.stringValue===TR}function $p(i){const t=i.mapValue.fields[SR];return Iv(t)?$p(t):t}function _h(i){const t=Io(i.mapValue.fields[wR].timestampValue);return new we(t.seconds,t.nanos)}class sU{constructor(t,e,n,s,r,a,c,u,h,f){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=r,this.forceLongPolling=a,this.autoDetectLongPolling=c,this.longPollingOptions=u,this.useFetchStreams=h,this.isUsingEmulator=f}}const dp="(default)";class vh{constructor(t,e){this.projectId=t,this.database=e||dp}static empty(){return new vh("","")}get isDefaultDatabase(){return this.database===dp}isEqual(t){return t instanceof vh&&t.projectId===this.projectId&&t.database===this.database}}const bR="__type__",rU="__max__",_f={mapValue:{}},CR="__vector__",fp="value";function Mo(i){return"nullValue"in i?0:"booleanValue"in i?1:"integerValue"in i||"doubleValue"in i?2:"timestampValue"in i?3:"stringValue"in i?5:"bytesValue"in i?6:"referenceValue"in i?7:"geoPointValue"in i?8:"arrayValue"in i?9:"mapValue"in i?Iv(i)?4:aU(i)?9007199254740991:oU(i)?10:11:kt(28295,{value:i})}function Ls(i,t){if(i===t)return!0;const e=Mo(i);if(e!==Mo(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return i.booleanValue===t.booleanValue;case 4:return _h(i).isEqual(_h(t));case 3:return(function(s,r){if(typeof s.timestampValue=="string"&&typeof r.timestampValue=="string"&&s.timestampValue.length===r.timestampValue.length)return s.timestampValue===r.timestampValue;const a=Io(s.timestampValue),c=Io(r.timestampValue);return a.seconds===c.seconds&&a.nanos===c.nanos})(i,t);case 5:return i.stringValue===t.stringValue;case 6:return(function(s,r){return Ro(s.bytesValue).isEqual(Ro(r.bytesValue))})(i,t);case 7:return i.referenceValue===t.referenceValue;case 8:return(function(s,r){return Ke(s.geoPointValue.latitude)===Ke(r.geoPointValue.latitude)&&Ke(s.geoPointValue.longitude)===Ke(r.geoPointValue.longitude)})(i,t);case 2:return(function(s,r){if("integerValue"in s&&"integerValue"in r)return Ke(s.integerValue)===Ke(r.integerValue);if("doubleValue"in s&&"doubleValue"in r){const a=Ke(s.doubleValue),c=Ke(r.doubleValue);return a===c?hp(a)===hp(c):isNaN(a)&&isNaN(c)}return!1})(i,t);case 9:return fc(i.arrayValue.values||[],t.arrayValue.values||[],Ls);case 10:case 11:return(function(s,r){const a=s.mapValue.fields||{},c=r.mapValue.fields||{};if(zS(a)!==zS(c))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(c[u]===void 0||!Ls(a[u],c[u])))return!1;return!0})(i,t);default:return kt(52216,{left:i})}}function Eh(i,t){return(i.values||[]).find((e=>Ls(e,t)))!==void 0}function pc(i,t){if(i===t)return 0;const e=Mo(i),n=Mo(t);if(e!==n)return jt(e,n);switch(e){case 0:case 9007199254740991:return 0;case 1:return jt(i.booleanValue,t.booleanValue);case 2:return(function(r,a){const c=Ke(r.integerValue||r.doubleValue),u=Ke(a.integerValue||a.doubleValue);return c<u?-1:c>u?1:c===u?0:isNaN(c)?isNaN(u)?0:-1:1})(i,t);case 3:return YS(i.timestampValue,t.timestampValue);case 4:return YS(_h(i),_h(t));case 5:return h_(i.stringValue,t.stringValue);case 6:return(function(r,a){const c=Ro(r),u=Ro(a);return c.compareTo(u)})(i.bytesValue,t.bytesValue);case 7:return(function(r,a){const c=r.split("/"),u=a.split("/");for(let h=0;h<c.length&&h<u.length;h++){const f=jt(c[h],u[h]);if(f!==0)return f}return jt(c.length,u.length)})(i.referenceValue,t.referenceValue);case 8:return(function(r,a){const c=jt(Ke(r.latitude),Ke(a.latitude));return c!==0?c:jt(Ke(r.longitude),Ke(a.longitude))})(i.geoPointValue,t.geoPointValue);case 9:return WS(i.arrayValue,t.arrayValue);case 10:return(function(r,a){const c=r.fields||{},u=a.fields||{},h=c[fp]?.arrayValue,f=u[fp]?.arrayValue,m=jt(h?.values?.length||0,f?.values?.length||0);return m!==0?m:WS(h,f)})(i.mapValue,t.mapValue);case 11:return(function(r,a){if(r===_f.mapValue&&a===_f.mapValue)return 0;if(r===_f.mapValue)return 1;if(a===_f.mapValue)return-1;const c=r.fields||{},u=Object.keys(c),h=a.fields||{},f=Object.keys(h);u.sort(),f.sort();for(let m=0;m<u.length&&m<f.length;++m){const y=h_(u[m],f[m]);if(y!==0)return y;const T=pc(c[u[m]],h[f[m]]);if(T!==0)return T}return jt(u.length,f.length)})(i.mapValue,t.mapValue);default:throw kt(23264,{he:e})}}function YS(i,t){if(typeof i=="string"&&typeof t=="string"&&i.length===t.length)return jt(i,t);const e=Io(i),n=Io(t),s=jt(e.seconds,n.seconds);return s!==0?s:jt(e.nanos,n.nanos)}function WS(i,t){const e=i.values||[],n=t.values||[];for(let s=0;s<e.length&&s<n.length;++s){const r=pc(e[s],n[s]);if(r)return r}return jt(e.length,n.length)}function mc(i){return d_(i)}function d_(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?(function(e){const n=Io(e);return`time(${n.seconds},${n.nanos})`})(i.timestampValue):"stringValue"in i?i.stringValue:"bytesValue"in i?(function(e){return Ro(e).toBase64()})(i.bytesValue):"referenceValue"in i?(function(e){return Mt.fromName(e).toString()})(i.referenceValue):"geoPointValue"in i?(function(e){return`geo(${e.latitude},${e.longitude})`})(i.geoPointValue):"arrayValue"in i?(function(e){let n="[",s=!0;for(const r of e.values||[])s?s=!1:n+=",",n+=d_(r);return n+"]"})(i.arrayValue):"mapValue"in i?(function(e){const n=Object.keys(e.fields||{}).sort();let s="{",r=!0;for(const a of n)r?r=!1:s+=",",s+=`${a}:${d_(e.fields[a])}`;return s+"}"})(i.mapValue):kt(61005,{value:i})}function zf(i){switch(Mo(i)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=$p(i);return t?16+zf(t):16;case 5:return 2*i.stringValue.length;case 6:return Ro(i.bytesValue).approximateByteSize();case 7:return i.referenceValue.length;case 9:return(function(n){return(n.values||[]).reduce(((s,r)=>s+zf(r)),0)})(i.arrayValue);case 10:case 11:return(function(n){let s=0;return Uo(n.fields,((r,a)=>{s+=r.length+zf(a)})),s})(i.mapValue);default:throw kt(13486,{value:i})}}function f_(i){return!!i&&"integerValue"in i}function Rv(i){return!!i&&"arrayValue"in i}function KS(i){return!!i&&"nullValue"in i}function XS(i){return!!i&&"doubleValue"in i&&isNaN(Number(i.doubleValue))}function $f(i){return!!i&&"mapValue"in i}function oU(i){return(i?.mapValue?.fields||{})[bR]?.stringValue===CR}function lh(i){if(i.geoPointValue)return{geoPointValue:{...i.geoPointValue}};if(i.timestampValue&&typeof i.timestampValue=="object")return{timestampValue:{...i.timestampValue}};if(i.mapValue){const t={mapValue:{fields:{}}};return Uo(i.mapValue.fields,((e,n)=>t.mapValue.fields[e]=lh(n))),t}if(i.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(i.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=lh(i.arrayValue.values[e]);return t}return{...i}}function aU(i){return(((i.mapValue||{}).fields||{}).__type__||{}).stringValue===rU}class ri{constructor(t){this.value=t}static empty(){return new ri({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!$f(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=lh(e)}setAll(t){let e=Mn.emptyPath(),n={},s=[];t.forEach(((a,c)=>{if(!e.isImmediateParentOf(c)){const u=this.getFieldsMap(e);this.applyChanges(u,n,s),n={},s=[],e=c.popLast()}a?n[c.lastSegment()]=lh(a):s.push(c.lastSegment())}));const r=this.getFieldsMap(e);this.applyChanges(r,n,s)}delete(t){const e=this.field(t.popLast());$f(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ls(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];$f(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){Uo(e,((s,r)=>t[s]=r));for(const s of n)delete t[s]}clone(){return new ri(lh(this.value))}}function IR(i){const t=[];return Uo(i.fields,((e,n)=>{const s=new Mn([e]);if($f(n)){const r=IR(n.mapValue).fields;if(r.length===0)t.push(s);else for(const a of r)t.push(s.child(a))}else t.push(s)})),new _i(t)}class Vn{constructor(t,e,n,s,r,a,c){this.key=t,this.documentType=e,this.version=n,this.readTime=s,this.createTime=r,this.data=a,this.documentState=c}static newInvalidDocument(t){return new Vn(t,0,Vt.min(),Vt.min(),Vt.min(),ri.empty(),0)}static newFoundDocument(t,e,n,s){return new Vn(t,1,e,Vt.min(),n,s,0)}static newNoDocument(t,e){return new Vn(t,2,e,Vt.min(),Vt.min(),ri.empty(),0)}static newUnknownDocument(t,e){return new Vn(t,3,e,Vt.min(),Vt.min(),ri.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(Vt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=ri.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=ri.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Vt.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof Vn&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Vn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class pp{constructor(t,e){this.position=t,this.inclusive=e}}function JS(i,t,e){let n=0;for(let s=0;s<i.position.length;s++){const r=t[s],a=i.position[s];if(r.field.isKeyField()?n=Mt.comparator(Mt.fromName(a.referenceValue),e.key):n=pc(a,e.data.field(r.field)),r.dir==="desc"&&(n*=-1),n!==0)break}return n}function QS(i,t){if(i===null)return t===null;if(t===null||i.inclusive!==t.inclusive||i.position.length!==t.position.length)return!1;for(let e=0;e<i.position.length;e++)if(!Ls(i.position[e],t.position[e]))return!1;return!0}class mp{constructor(t,e="asc"){this.field=t,this.dir=e}}function lU(i,t){return i.dir===t.dir&&i.field.isEqual(t.field)}class RR{}class cn extends RR{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,n):new uU(t,e,n):e==="array-contains"?new fU(t,n):e==="in"?new pU(t,n):e==="not-in"?new mU(t,n):e==="array-contains-any"?new gU(t,n):new cn(t,e,n)}static createKeyFieldInFilter(t,e,n){return e==="in"?new hU(t,n):new dU(t,n)}matches(t){const e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(pc(e,this.value)):e!==null&&Mo(this.value)===Mo(e)&&this.matchesComparison(pc(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return kt(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Os extends RR{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new Os(t,e)}matches(t){return MR(this)?this.filters.find((e=>!e.matches(t)))===void 0:this.filters.find((e=>e.matches(t)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function MR(i){return i.op==="and"}function PR(i){return cU(i)&&MR(i)}function cU(i){for(const t of i.filters)if(t instanceof Os)return!1;return!0}function p_(i){if(i instanceof cn)return i.field.canonicalString()+i.op.toString()+mc(i.value);if(PR(i))return i.filters.map((t=>p_(t))).join(",");{const t=i.filters.map((e=>p_(e))).join(",");return`${i.op}(${t})`}}function xR(i,t){return i instanceof cn?(function(n,s){return s instanceof cn&&n.op===s.op&&n.field.isEqual(s.field)&&Ls(n.value,s.value)})(i,t):i instanceof Os?(function(n,s){return s instanceof Os&&n.op===s.op&&n.filters.length===s.filters.length?n.filters.reduce(((r,a,c)=>r&&xR(a,s.filters[c])),!0):!1})(i,t):void kt(19439)}function DR(i){return i instanceof cn?(function(e){return`${e.field.canonicalString()} ${e.op} ${mc(e.value)}`})(i):i instanceof Os?(function(e){return e.op.toString()+" {"+e.getFilters().map(DR).join(" ,")+"}"})(i):"Filter"}class uU extends cn{constructor(t,e,n){super(t,e,n),this.key=Mt.fromName(n.referenceValue)}matches(t){const e=Mt.comparator(t.key,this.key);return this.matchesComparison(e)}}class hU extends cn{constructor(t,e){super(t,"in",e),this.keys=NR("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class dU extends cn{constructor(t,e){super(t,"not-in",e),this.keys=NR("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function NR(i,t){return(t.arrayValue?.values||[]).map((e=>Mt.fromName(e.referenceValue)))}class fU extends cn{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Rv(e)&&Eh(e.arrayValue,this.value)}}class pU extends cn{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return e!==null&&Eh(this.value.arrayValue,e)}}class mU extends cn{constructor(t,e){super(t,"not-in",e)}matches(t){if(Eh(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!Eh(this.value.arrayValue,e)}}class gU extends cn{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Rv(e)||!e.arrayValue.values)&&e.arrayValue.values.some((n=>Eh(this.value.arrayValue,n)))}}class yU{constructor(t,e=null,n=[],s=[],r=null,a=null,c=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=r,this.startAt=a,this.endAt=c,this.Te=null}}function jS(i,t=null,e=[],n=[],s=null,r=null,a=null){return new yU(i,t,e,n,s,r,a)}function Mv(i){const t=Gt(i);if(t.Te===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((n=>p_(n))).join(","),e+="|ob:",e+=t.orderBy.map((n=>(function(r){return r.field.canonicalString()+r.dir})(n))).join(","),zp(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((n=>mc(n))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((n=>mc(n))).join(",")),t.Te=e}return t.Te}function Pv(i,t){if(i.limit!==t.limit||i.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<i.orderBy.length;e++)if(!lU(i.orderBy[e],t.orderBy[e]))return!1;if(i.filters.length!==t.filters.length)return!1;for(let e=0;e<i.filters.length;e++)if(!xR(i.filters[e],t.filters[e]))return!1;return i.collectionGroup===t.collectionGroup&&!!i.path.isEqual(t.path)&&!!QS(i.startAt,t.startAt)&&QS(i.endAt,t.endAt)}function m_(i){return Mt.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0}class Yp{constructor(t,e=null,n=[],s=[],r=null,a="F",c=null,u=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=r,this.limitType=a,this.startAt=c,this.endAt=u,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function _U(i,t,e,n,s,r,a,c){return new Yp(i,t,e,n,s,r,a,c)}function Wp(i){return new Yp(i)}function ZS(i){return i.filters.length===0&&i.limit===null&&i.startAt==null&&i.endAt==null&&(i.explicitOrderBy.length===0||i.explicitOrderBy.length===1&&i.explicitOrderBy[0].field.isKeyField())}function vU(i){return i.collectionGroup!==null}function ch(i){const t=Gt(i);if(t.Ie===null){t.Ie=[];const e=new Set;for(const r of t.explicitOrderBy)t.Ie.push(r),e.add(r.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let c=new un(Mn.comparator);return a.filters.forEach((u=>{u.getFlattenedFilters().forEach((h=>{h.isInequality()&&(c=c.add(h.field))}))})),c})(t).forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.Ie.push(new mp(r,n))})),e.has(Mn.keyField().canonicalString())||t.Ie.push(new mp(Mn.keyField(),n))}return t.Ie}function xs(i){const t=Gt(i);return t.Ee||(t.Ee=EU(t,ch(i))),t.Ee}function EU(i,t){if(i.limitType==="F")return jS(i.path,i.collectionGroup,t,i.filters,i.limit,i.startAt,i.endAt);{t=t.map((s=>{const r=s.dir==="desc"?"asc":"desc";return new mp(s.field,r)}));const e=i.endAt?new pp(i.endAt.position,i.endAt.inclusive):null,n=i.startAt?new pp(i.startAt.position,i.startAt.inclusive):null;return jS(i.path,i.collectionGroup,t,i.filters,i.limit,e,n)}}function g_(i,t,e){return new Yp(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),t,e,i.startAt,i.endAt)}function Kp(i,t){return Pv(xs(i),xs(t))&&i.limitType===t.limitType}function kR(i){return`${Mv(xs(i))}|lt:${i.limitType}`}function Bl(i){return`Query(target=${(function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map((s=>DR(s))).join(", ")}]`),zp(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map((s=>mc(s))).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map((s=>mc(s))).join(",")),`Target(${n})`})(xs(i))}; limitType=${i.limitType})`}function Xp(i,t){return t.isFoundDocument()&&(function(n,s){const r=s.key.path;return n.collectionGroup!==null?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(r):Mt.isDocumentKey(n.path)?n.path.isEqual(r):n.path.isImmediateParentOf(r)})(i,t)&&(function(n,s){for(const r of ch(n))if(!r.field.isKeyField()&&s.data.field(r.field)===null)return!1;return!0})(i,t)&&(function(n,s){for(const r of n.filters)if(!r.matches(s))return!1;return!0})(i,t)&&(function(n,s){return!(n.startAt&&!(function(a,c,u){const h=JS(a,c,u);return a.inclusive?h<=0:h<0})(n.startAt,ch(n),s)||n.endAt&&!(function(a,c,u){const h=JS(a,c,u);return a.inclusive?h>=0:h>0})(n.endAt,ch(n),s))})(i,t)}function TU(i){return i.collectionGroup||(i.path.length%2==1?i.path.lastSegment():i.path.get(i.path.length-2))}function LR(i){return(t,e)=>{let n=!1;for(const s of ch(i)){const r=AU(s,t,e);if(r!==0)return r;n=n||s.field.isKeyField()}return 0}}function AU(i,t,e){const n=i.field.isKeyField()?Mt.comparator(t.key,e.key):(function(r,a,c){const u=a.data.field(r),h=c.data.field(r);return u!==null&&h!==null?pc(u,h):kt(42886)})(i.field,t,e);switch(i.dir){case"asc":return n;case"desc":return-1*n;default:return kt(19790,{direction:i.dir})}}class qa{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(n!==void 0){for(const[s,r]of n)if(this.equalsFn(s,t))return r}}has(t){return this.get(t)!==void 0}set(t,e){const n=this.mapKeyFn(t),s=this.inner[n];if(s===void 0)return this.inner[n]=[[t,e]],void this.innerSize++;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],t))return void(s[r]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(n===void 0)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return n.length===1?delete this.inner[e]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(t){Uo(this.inner,((e,n)=>{for(const[s,r]of n)t(s,r)}))}isEmpty(){return vR(this.inner)}size(){return this.innerSize}}const SU=new ke(Mt.comparator);function wr(){return SU}const OR=new ke(Mt.comparator);function Zu(...i){let t=OR;for(const e of i)t=t.insert(e.key,e);return t}function UR(i){let t=OR;return i.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function wa(){return uh()}function VR(){return uh()}function uh(){return new qa((i=>i.toString()),((i,t)=>i.isEqual(t)))}const wU=new ke(Mt.comparator),bU=new un(Mt.comparator);function Zt(...i){let t=bU;for(const e of i)t=t.add(e);return t}const CU=new un(jt);function IU(){return CU}function xv(i,t){if(i.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:hp(t)?"-0":t}}function BR(i){return{integerValue:""+i}}function RU(i,t){return tU(t)?BR(t):xv(i,t)}class Jp{constructor(){this._=void 0}}function MU(i,t,e){return i instanceof gp?(function(s,r){const a={fields:{[AR]:{stringValue:TR},[wR]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return r&&Iv(r)&&(r=$p(r)),r&&(a.fields[SR]=r),{mapValue:a}})(e,t):i instanceof gc?HR(i,t):i instanceof yc?GR(i,t):(function(s,r){const a=FR(s,r),c=tw(a)+tw(s.Ae);return f_(a)&&f_(s.Ae)?BR(c):xv(s.serializer,c)})(i,t)}function PU(i,t,e){return i instanceof gc?HR(i,t):i instanceof yc?GR(i,t):e}function FR(i,t){return i instanceof yp?(function(n){return f_(n)||(function(r){return!!r&&"doubleValue"in r})(n)})(t)?t:{integerValue:0}:null}class gp extends Jp{}class gc extends Jp{constructor(t){super(),this.elements=t}}function HR(i,t){const e=qR(t);for(const n of i.elements)e.some((s=>Ls(s,n)))||e.push(n);return{arrayValue:{values:e}}}class yc extends Jp{constructor(t){super(),this.elements=t}}function GR(i,t){let e=qR(t);for(const n of i.elements)e=e.filter((s=>!Ls(s,n)));return{arrayValue:{values:e}}}class yp extends Jp{constructor(t,e){super(),this.serializer=t,this.Ae=e}}function tw(i){return Ke(i.integerValue||i.doubleValue)}function qR(i){return Rv(i)&&i.arrayValue.values?i.arrayValue.values.slice():[]}class zR{constructor(t,e){this.field=t,this.transform=e}}function xU(i,t){return i.field.isEqual(t.field)&&(function(n,s){return n instanceof gc&&s instanceof gc||n instanceof yc&&s instanceof yc?fc(n.elements,s.elements,Ls):n instanceof yp&&s instanceof yp?Ls(n.Ae,s.Ae):n instanceof gp&&s instanceof gp})(i.transform,t.transform)}class DU{constructor(t,e){this.version=t,this.transformResults=e}}class es{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new es}static exists(t){return new es(void 0,t)}static updateTime(t){return new es(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Yf(i,t){return i.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(i.updateTime):i.exists===void 0||i.exists===t.isFoundDocument()}class Qp{}function $R(i,t){if(!i.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return i.isNoDocument()?new Dv(i.key,es.none()):new Oh(i.key,i.data,es.none());{const e=i.data,n=ri.empty();let s=new un(Mn.comparator);for(let r of t.fields)if(!s.has(r)){let a=e.field(r);a===null&&r.length>1&&(r=r.popLast(),a=e.field(r)),a===null?n.delete(r):n.set(r,a),s=s.add(r)}return new Vo(i.key,n,new _i(s.toArray()),es.none())}}function NU(i,t,e){i instanceof Oh?(function(s,r,a){const c=s.value.clone(),u=nw(s.fieldTransforms,r,a.transformResults);c.setAll(u),r.convertToFoundDocument(a.version,c).setHasCommittedMutations()})(i,t,e):i instanceof Vo?(function(s,r,a){if(!Yf(s.precondition,r))return void r.convertToUnknownDocument(a.version);const c=nw(s.fieldTransforms,r,a.transformResults),u=r.data;u.setAll(YR(s)),u.setAll(c),r.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(i,t,e):(function(s,r,a){r.convertToNoDocument(a.version).setHasCommittedMutations()})(0,t,e)}function hh(i,t,e,n){return i instanceof Oh?(function(r,a,c,u){if(!Yf(r.precondition,a))return c;const h=r.value.clone(),f=iw(r.fieldTransforms,u,a);return h.setAll(f),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),null})(i,t,e,n):i instanceof Vo?(function(r,a,c,u){if(!Yf(r.precondition,a))return c;const h=iw(r.fieldTransforms,u,a),f=a.data;return f.setAll(YR(r)),f.setAll(h),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),c===null?null:c.unionWith(r.fieldMask.fields).unionWith(r.fieldTransforms.map((m=>m.field)))})(i,t,e,n):(function(r,a,c){return Yf(r.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):c})(i,t,e)}function kU(i,t){let e=null;for(const n of i.fieldTransforms){const s=t.data.field(n.field),r=FR(n.transform,s||null);r!=null&&(e===null&&(e=ri.empty()),e.set(n.field,r))}return e||null}function ew(i,t){return i.type===t.type&&!!i.key.isEqual(t.key)&&!!i.precondition.isEqual(t.precondition)&&!!(function(n,s){return n===void 0&&s===void 0||!(!n||!s)&&fc(n,s,((r,a)=>xU(r,a)))})(i.fieldTransforms,t.fieldTransforms)&&(i.type===0?i.value.isEqual(t.value):i.type!==1||i.data.isEqual(t.data)&&i.fieldMask.isEqual(t.fieldMask))}class Oh extends Qp{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Vo extends Qp{constructor(t,e,n,s,r=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function YR(i){const t=new Map;return i.fieldMask.fields.forEach((e=>{if(!e.isEmpty()){const n=i.data.field(e);t.set(e,n)}})),t}function nw(i,t,e){const n=new Map;ue(i.length===e.length,32656,{Re:e.length,Ve:i.length});for(let s=0;s<e.length;s++){const r=i[s],a=r.transform,c=t.data.field(r.field);n.set(r.field,PU(a,c,e[s]))}return n}function iw(i,t,e){const n=new Map;for(const s of i){const r=s.transform,a=e.data.field(s.field);n.set(s.field,MU(r,a,t))}return n}class Dv extends Qp{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class LU extends Qp{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class OU{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let s=0;s<this.mutations.length;s++){const r=this.mutations[s];r.key.isEqual(t.key)&&NU(r,t,n[s])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=hh(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=hh(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=VR();return this.mutations.forEach((s=>{const r=t.get(s.key),a=r.overlayedDocument;let c=this.applyToLocalView(a,r.mutatedFields);c=e.has(s.key)?null:c;const u=$R(a,c);u!==null&&n.set(s.key,u),a.isValidDocument()||a.convertToNoDocument(Vt.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),Zt())}isEqual(t){return this.batchId===t.batchId&&fc(this.mutations,t.mutations,((e,n)=>ew(e,n)))&&fc(this.baseMutations,t.baseMutations,((e,n)=>ew(e,n)))}}class Nv{constructor(t,e,n,s){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=s}static from(t,e,n){ue(t.mutations.length===n.length,58842,{me:t.mutations.length,fe:n.length});let s=(function(){return wU})();const r=t.mutations;for(let a=0;a<r.length;a++)s=s.insert(r[a].key,n[a].version);return new Nv(t,e,n,s)}}class UU{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class VU{constructor(t,e){this.count=t,this.unchangedNames=e}}var tn,ie;function BU(i){switch(i){case ut.OK:return kt(64938);case ut.CANCELLED:case ut.UNKNOWN:case ut.DEADLINE_EXCEEDED:case ut.RESOURCE_EXHAUSTED:case ut.INTERNAL:case ut.UNAVAILABLE:case ut.UNAUTHENTICATED:return!1;case ut.INVALID_ARGUMENT:case ut.NOT_FOUND:case ut.ALREADY_EXISTS:case ut.PERMISSION_DENIED:case ut.FAILED_PRECONDITION:case ut.ABORTED:case ut.OUT_OF_RANGE:case ut.UNIMPLEMENTED:case ut.DATA_LOSS:return!0;default:return kt(15467,{code:i})}}function WR(i){if(i===void 0)return Sr("GRPC error has no .code"),ut.UNKNOWN;switch(i){case tn.OK:return ut.OK;case tn.CANCELLED:return ut.CANCELLED;case tn.UNKNOWN:return ut.UNKNOWN;case tn.DEADLINE_EXCEEDED:return ut.DEADLINE_EXCEEDED;case tn.RESOURCE_EXHAUSTED:return ut.RESOURCE_EXHAUSTED;case tn.INTERNAL:return ut.INTERNAL;case tn.UNAVAILABLE:return ut.UNAVAILABLE;case tn.UNAUTHENTICATED:return ut.UNAUTHENTICATED;case tn.INVALID_ARGUMENT:return ut.INVALID_ARGUMENT;case tn.NOT_FOUND:return ut.NOT_FOUND;case tn.ALREADY_EXISTS:return ut.ALREADY_EXISTS;case tn.PERMISSION_DENIED:return ut.PERMISSION_DENIED;case tn.FAILED_PRECONDITION:return ut.FAILED_PRECONDITION;case tn.ABORTED:return ut.ABORTED;case tn.OUT_OF_RANGE:return ut.OUT_OF_RANGE;case tn.UNIMPLEMENTED:return ut.UNIMPLEMENTED;case tn.DATA_LOSS:return ut.DATA_LOSS;default:return kt(39323,{code:i})}}(ie=tn||(tn={}))[ie.OK=0]="OK",ie[ie.CANCELLED=1]="CANCELLED",ie[ie.UNKNOWN=2]="UNKNOWN",ie[ie.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ie[ie.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ie[ie.NOT_FOUND=5]="NOT_FOUND",ie[ie.ALREADY_EXISTS=6]="ALREADY_EXISTS",ie[ie.PERMISSION_DENIED=7]="PERMISSION_DENIED",ie[ie.UNAUTHENTICATED=16]="UNAUTHENTICATED",ie[ie.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ie[ie.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ie[ie.ABORTED=10]="ABORTED",ie[ie.OUT_OF_RANGE=11]="OUT_OF_RANGE",ie[ie.UNIMPLEMENTED=12]="UNIMPLEMENTED",ie[ie.INTERNAL=13]="INTERNAL",ie[ie.UNAVAILABLE=14]="UNAVAILABLE",ie[ie.DATA_LOSS=15]="DATA_LOSS";function FU(){return new TextEncoder}const HU=new So([4294967295,4294967295],0);function sw(i){const t=FU().encode(i),e=new cR;return e.update(t),new Uint8Array(e.digest())}function rw(i){const t=new DataView(i.buffer),e=t.getUint32(0,!0),n=t.getUint32(4,!0),s=t.getUint32(8,!0),r=t.getUint32(12,!0);return[new So([e,n],0),new So([s,r],0)]}class kv{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new th(`Invalid padding: ${e}`);if(n<0)throw new th(`Invalid hash count: ${n}`);if(t.length>0&&this.hashCount===0)throw new th(`Invalid hash count: ${n}`);if(t.length===0&&e!==0)throw new th(`Invalid padding when bitmap length is 0: ${e}`);this.ge=8*t.length-e,this.pe=So.fromNumber(this.ge)}ye(t,e,n){let s=t.add(e.multiply(So.fromNumber(n)));return s.compare(HU)===1&&(s=new So([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.ge===0)return!1;const e=sw(t),[n,s]=rw(e);for(let r=0;r<this.hashCount;r++){const a=this.ye(n,s,r);if(!this.we(a))return!1}return!0}static create(t,e,n){const s=t%8==0?0:8-t%8,r=new Uint8Array(Math.ceil(t/8)),a=new kv(r,s,e);return n.forEach((c=>a.insert(c))),a}insert(t){if(this.ge===0)return;const e=sw(t),[n,s]=rw(e);for(let r=0;r<this.hashCount;r++){const a=this.ye(n,s,r);this.Se(a)}}Se(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class th extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class jp{constructor(t,e,n,s,r){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const s=new Map;return s.set(t,Uh.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new jp(Vt.min(),s,new ke(jt),wr(),Zt())}}class Uh{constructor(t,e,n,s,r){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new Uh(n,e,Zt(),Zt(),Zt())}}class Wf{constructor(t,e,n,s){this.be=t,this.removedTargetIds=e,this.key=n,this.De=s}}class KR{constructor(t,e){this.targetId=t,this.Ce=e}}class XR{constructor(t,e,n=xn.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class ow{constructor(){this.ve=0,this.Fe=aw(),this.Me=xn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=Zt(),e=Zt(),n=Zt();return this.Fe.forEach(((s,r)=>{switch(r){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:kt(38017,{changeType:r})}})),new Uh(this.Me,this.xe,t,e,n)}qe(){this.Oe=!1,this.Fe=aw()}Qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,ue(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class GU{constructor(t){this.Ge=t,this.ze=new Map,this.je=wr(),this.Je=vf(),this.He=vf(),this.Ye=new ke(jt)}Ze(t){for(const e of t.be)t.De&&t.De.isFoundDocument()?this.Xe(e,t.De):this.et(e,t.key,t.De);for(const e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,(e=>{const n=this.nt(e);switch(t.state){case 0:this.rt(e)&&n.Le(t.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(t.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(n.We(),n.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),n.Le(t.resumeToken));break;default:kt(56790,{state:t.state})}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach(((n,s)=>{this.rt(s)&&e(s)}))}st(t){const e=t.targetId,n=t.Ce.count,s=this.ot(e);if(s){const r=s.target;if(m_(r))if(n===0){const a=new Mt(r.path);this.et(e,a,Vn.newNoDocument(a,Vt.min()))}else ue(n===1,20013,{expectedCount:n});else{const a=this._t(e);if(a!==n){const c=this.ut(t),u=c?this.ct(c,t,a):1;if(u!==0){this.it(e);const h=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(e,h)}}}}}ut(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:r=0}=e;let a,c;try{a=Ro(n).toUint8Array()}catch(u){if(u instanceof ER)return dc("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{c=new kv(a,s,r)}catch(u){return dc(u instanceof th?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return c.ge===0?null:c}ct(t,e,n){return e.Ce.count===n-this.Pt(t,e.targetId)?0:2}Pt(t,e){const n=this.Ge.getRemoteKeysForTarget(e);let s=0;return n.forEach((r=>{const a=this.Ge.ht(),c=`projects/${a.projectId}/databases/${a.database}/documents/${r.path.canonicalString()}`;t.mightContain(c)||(this.et(e,r,null),s++)})),s}Tt(t){const e=new Map;this.ze.forEach(((r,a)=>{const c=this.ot(a);if(c){if(r.current&&m_(c.target)){const u=new Mt(c.target.path);this.It(u).has(a)||this.Et(a,u)||this.et(a,u,Vn.newNoDocument(u,t))}r.Be&&(e.set(a,r.ke()),r.qe())}}));let n=Zt();this.He.forEach(((r,a)=>{let c=!0;a.forEachWhile((u=>{const h=this.ot(u);return!h||h.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)})),c&&(n=n.add(r))})),this.je.forEach(((r,a)=>a.setReadTime(t)));const s=new jp(t,e,this.Ye,this.je,n);return this.je=wr(),this.Je=vf(),this.He=vf(),this.Ye=new ke(jt),s}Xe(t,e){if(!this.rt(t))return;const n=this.Et(t,e.key)?2:0;this.nt(t).Qe(e.key,n),this.je=this.je.insert(e.key,e),this.Je=this.Je.insert(e.key,this.It(e.key).add(t)),this.He=this.He.insert(e.key,this.dt(e.key).add(t))}et(t,e,n){if(!this.rt(t))return;const s=this.nt(t);this.Et(t,e)?s.Qe(e,1):s.$e(e),this.He=this.He.insert(e,this.dt(e).delete(t)),this.He=this.He.insert(e,this.dt(e).add(t)),n&&(this.je=this.je.insert(e,n))}removeTarget(t){this.ze.delete(t)}_t(t){const e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let e=this.ze.get(t);return e||(e=new ow,this.ze.set(t,e)),e}dt(t){let e=this.He.get(t);return e||(e=new un(jt),this.He=this.He.insert(t,e)),e}It(t){let e=this.Je.get(t);return e||(e=new un(jt),this.Je=this.Je.insert(t,e)),e}rt(t){const e=this.ot(t)!==null;return e||yt("WatchChangeAggregator","Detected inactive target",t),e}ot(t){const e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new ow),this.Ge.getRemoteKeysForTarget(t).forEach((e=>{this.et(t,e,null)}))}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}}function vf(){return new ke(Mt.comparator)}function aw(){return new ke(Mt.comparator)}const qU={asc:"ASCENDING",desc:"DESCENDING"},zU={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},$U={and:"AND",or:"OR"};class YU{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function y_(i,t){return i.useProto3Json||zp(t)?t:{value:t}}function _p(i,t){return i.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function JR(i,t){return i.useProto3Json?t.toBase64():t.toUint8Array()}function WU(i,t){return _p(i,t.toTimestamp())}function Ds(i){return ue(!!i,49232),Vt.fromTimestamp((function(e){const n=Io(e);return new we(n.seconds,n.nanos)})(i))}function Lv(i,t){return __(i,t).canonicalString()}function __(i,t){const e=(function(s){return new De(["projects",s.projectId,"databases",s.database])})(i).child("documents");return t===void 0?e:e.child(t)}function QR(i){const t=De.fromString(i);return ue(n1(t),10190,{key:t.toString()}),t}function v_(i,t){return Lv(i.databaseId,t.path)}function ky(i,t){const e=QR(t);if(e.get(1)!==i.databaseId.projectId)throw new bt(ut.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+i.databaseId.projectId);if(e.get(3)!==i.databaseId.database)throw new bt(ut.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+i.databaseId.database);return new Mt(ZR(e))}function jR(i,t){return Lv(i.databaseId,t)}function KU(i){const t=QR(i);return t.length===4?De.emptyPath():ZR(t)}function E_(i){return new De(["projects",i.databaseId.projectId,"databases",i.databaseId.database]).canonicalString()}function ZR(i){return ue(i.length>4&&i.get(4)==="documents",29091,{key:i.toString()}),i.popFirst(5)}function lw(i,t,e){return{name:v_(i,t),fields:e.value.mapValue.fields}}function XU(i,t){let e;if("targetChange"in t){t.targetChange;const n=(function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:kt(39313,{state:h})})(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],r=(function(h,f){return h.useProto3Json?(ue(f===void 0||typeof f=="string",58123),xn.fromBase64String(f||"")):(ue(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),xn.fromUint8Array(f||new Uint8Array))})(i,t.targetChange.resumeToken),a=t.targetChange.cause,c=a&&(function(h){const f=h.code===void 0?ut.UNKNOWN:WR(h.code);return new bt(f,h.message||"")})(a);e=new XR(n,s,r,c||null)}else if("documentChange"in t){t.documentChange;const n=t.documentChange;n.document,n.document.name,n.document.updateTime;const s=ky(i,n.document.name),r=Ds(n.document.updateTime),a=n.document.createTime?Ds(n.document.createTime):Vt.min(),c=new ri({mapValue:{fields:n.document.fields}}),u=Vn.newFoundDocument(s,r,a,c),h=n.targetIds||[],f=n.removedTargetIds||[];e=new Wf(h,f,u.key,u)}else if("documentDelete"in t){t.documentDelete;const n=t.documentDelete;n.document;const s=ky(i,n.document),r=n.readTime?Ds(n.readTime):Vt.min(),a=Vn.newNoDocument(s,r),c=n.removedTargetIds||[];e=new Wf([],c,a.key,a)}else if("documentRemove"in t){t.documentRemove;const n=t.documentRemove;n.document;const s=ky(i,n.document),r=n.removedTargetIds||[];e=new Wf([],r,s,null)}else{if(!("filter"in t))return kt(11601,{Rt:t});{t.filter;const n=t.filter;n.targetId;const{count:s=0,unchangedNames:r}=n,a=new VU(s,r),c=n.targetId;e=new KR(c,a)}}return e}function JU(i,t){let e;if(t instanceof Oh)e={update:lw(i,t.key,t.value)};else if(t instanceof Dv)e={delete:v_(i,t.key)};else if(t instanceof Vo)e={update:lw(i,t.key,t.data),updateMask:rV(t.fieldMask)};else{if(!(t instanceof LU))return kt(16599,{Vt:t.type});e={verify:v_(i,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map((n=>(function(r,a){const c=a.transform;if(c instanceof gp)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof gc)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof yc)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof yp)return{fieldPath:a.field.canonicalString(),increment:c.Ae};throw kt(20930,{transform:a.transform})})(0,n)))),t.precondition.isNone||(e.currentDocument=(function(s,r){return r.updateTime!==void 0?{updateTime:WU(s,r.updateTime)}:r.exists!==void 0?{exists:r.exists}:kt(27497)})(i,t.precondition)),e}function QU(i,t){return i&&i.length>0?(ue(t!==void 0,14353),i.map((e=>(function(s,r){let a=s.updateTime?Ds(s.updateTime):Ds(r);return a.isEqual(Vt.min())&&(a=Ds(r)),new DU(a,s.transformResults||[])})(e,t)))):[]}function jU(i,t){return{documents:[jR(i,t.path)]}}function ZU(i,t){const e={structuredQuery:{}},n=t.path;let s;t.collectionGroup!==null?(s=n,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=n.popLast(),e.structuredQuery.from=[{collectionId:n.lastSegment()}]),e.parent=jR(i,s);const r=(function(h){if(h.length!==0)return e1(Os.create(h,"and"))})(t.filters);r&&(e.structuredQuery.where=r);const a=(function(h){if(h.length!==0)return h.map((f=>(function(y){return{field:Fl(y.field),direction:nV(y.dir)}})(f)))})(t.orderBy);a&&(e.structuredQuery.orderBy=a);const c=y_(i,t.limit);return c!==null&&(e.structuredQuery.limit=c),t.startAt&&(e.structuredQuery.startAt=(function(h){return{before:h.inclusive,values:h.position}})(t.startAt)),t.endAt&&(e.structuredQuery.endAt=(function(h){return{before:!h.inclusive,values:h.position}})(t.endAt)),{ft:e,parent:s}}function tV(i){let t=KU(i.parent);const e=i.structuredQuery,n=e.from?e.from.length:0;let s=null;if(n>0){ue(n===1,65062);const f=e.from[0];f.allDescendants?s=f.collectionId:t=t.child(f.collectionId)}let r=[];e.where&&(r=(function(m){const y=t1(m);return y instanceof Os&&PR(y)?y.getFilters():[y]})(e.where));let a=[];e.orderBy&&(a=(function(m){return m.map((y=>(function(S){return new mp(Hl(S.field),(function(C){switch(C){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(S.direction))})(y)))})(e.orderBy));let c=null;e.limit&&(c=(function(m){let y;return y=typeof m=="object"?m.value:m,zp(y)?null:y})(e.limit));let u=null;e.startAt&&(u=(function(m){const y=!!m.before,T=m.values||[];return new pp(T,y)})(e.startAt));let h=null;return e.endAt&&(h=(function(m){const y=!m.before,T=m.values||[];return new pp(T,y)})(e.endAt)),_U(t,s,a,r,c,"F",u,h)}function eV(i,t){const e=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return kt(28987,{purpose:s})}})(t.purpose);return e==null?null:{"goog-listen-tags":e}}function t1(i){return i.unaryFilter!==void 0?(function(e){switch(e.unaryFilter.op){case"IS_NAN":const n=Hl(e.unaryFilter.field);return cn.create(n,"==",{doubleValue:NaN});case"IS_NULL":const s=Hl(e.unaryFilter.field);return cn.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Hl(e.unaryFilter.field);return cn.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Hl(e.unaryFilter.field);return cn.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return kt(61313);default:return kt(60726)}})(i):i.fieldFilter!==void 0?(function(e){return cn.create(Hl(e.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return kt(58110);default:return kt(50506)}})(e.fieldFilter.op),e.fieldFilter.value)})(i):i.compositeFilter!==void 0?(function(e){return Os.create(e.compositeFilter.filters.map((n=>t1(n))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return kt(1026)}})(e.compositeFilter.op))})(i):kt(30097,{filter:i})}function nV(i){return qU[i]}function iV(i){return zU[i]}function sV(i){return $U[i]}function Fl(i){return{fieldPath:i.canonicalString()}}function Hl(i){return Mn.fromServerFormat(i.fieldPath)}function e1(i){return i instanceof cn?(function(e){if(e.op==="=="){if(XS(e.value))return{unaryFilter:{field:Fl(e.field),op:"IS_NAN"}};if(KS(e.value))return{unaryFilter:{field:Fl(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(XS(e.value))return{unaryFilter:{field:Fl(e.field),op:"IS_NOT_NAN"}};if(KS(e.value))return{unaryFilter:{field:Fl(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Fl(e.field),op:iV(e.op),value:e.value}}})(i):i instanceof Os?(function(e){const n=e.getFilters().map((s=>e1(s)));return n.length===1?n[0]:{compositeFilter:{op:sV(e.op),filters:n}}})(i):kt(54877,{filter:i})}function rV(i){const t=[];return i.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function n1(i){return i.length>=4&&i.get(0)==="projects"&&i.get(2)==="databases"}class vo{constructor(t,e,n,s,r=Vt.min(),a=Vt.min(),c=xn.EMPTY_BYTE_STRING,u=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=c,this.expectedCount=u}withSequenceNumber(t){return new vo(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new vo(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new vo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new vo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class oV{constructor(t){this.yt=t}}function aV(i){const t=tV({parent:i.parent,structuredQuery:i.structuredQuery});return i.limitType==="LAST"?g_(t,t.limit,"L"):t}class lV{constructor(){this.Cn=new cV}addToCollectionParentIndex(t,e){return this.Cn.add(e),lt.resolve()}getCollectionParents(t,e){return lt.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return lt.resolve()}deleteFieldIndex(t,e){return lt.resolve()}deleteAllFieldIndexes(t){return lt.resolve()}createTargetIndexes(t,e){return lt.resolve()}getDocumentsMatchingTarget(t,e){return lt.resolve(null)}getIndexType(t,e){return lt.resolve(0)}getFieldIndexes(t,e){return lt.resolve([])}getNextCollectionGroupToUpdate(t){return lt.resolve(null)}getMinOffset(t,e){return lt.resolve(Co.min())}getMinOffsetFromCollectionGroup(t,e){return lt.resolve(Co.min())}updateCollectionGroup(t,e,n){return lt.resolve()}updateIndexEntries(t,e){return lt.resolve()}}class cV{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new un(De.comparator),r=!s.has(n);return this.index[e]=s.add(n),r}has(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new un(De.comparator)).toArray()}}const cw={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},i1=41943040;class si{static withCacheSize(t){return new si(t,si.DEFAULT_COLLECTION_PERCENTILE,si.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}}si.DEFAULT_COLLECTION_PERCENTILE=10,si.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,si.DEFAULT=new si(i1,si.DEFAULT_COLLECTION_PERCENTILE,si.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),si.DISABLED=new si(-1,0,0);class _c{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new _c(0)}static cr(){return new _c(-1)}}const uw="LruGarbageCollector",uV=1048576;function hw([i,t],[e,n]){const s=jt(i,e);return s===0?jt(t,n):s}class hV{constructor(t){this.Ir=t,this.buffer=new un(hw),this.Er=0}dr(){return++this.Er}Ar(t){const e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{const n=this.buffer.last();hw(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}}get maxValue(){return this.buffer.last()[0]}}class dV{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(t){yt(uw,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Rc(e)?yt(uw,"Ignoring IndexedDB error during garbage collection: ",e):await Ic(e)}await this.Vr(3e5)}))}}class fV{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next((n=>Math.floor(e/100*n)))}nthSequenceNumber(t,e){if(e===0)return lt.resolve(qp.ce);const n=new hV(e);return this.mr.forEachTarget(t,(s=>n.Ar(s.sequenceNumber))).next((()=>this.mr.pr(t,(s=>n.Ar(s))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.mr.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(yt("LruGarbageCollector","Garbage collection skipped; disabled"),lt.resolve(cw)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(yt("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),cw):this.yr(t,e)))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let n,s,r,a,c,u,h;const f=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((m=>(m>this.params.maximumSequenceNumbersToCollect?(yt("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),s=this.params.maximumSequenceNumbersToCollect):s=m,a=Date.now(),this.nthSequenceNumber(t,s)))).next((m=>(n=m,c=Date.now(),this.removeTargets(t,n,e)))).next((m=>(r=m,u=Date.now(),this.removeOrphanedDocuments(t,n)))).next((m=>(h=Date.now(),Vl()<=Qt.DEBUG&&yt("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${s} in `+(c-a)+`ms
	Removed ${r} targets in `+(u-c)+`ms
	Removed ${m} documents in `+(h-u)+`ms
Total Duration: ${h-f}ms`),lt.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:r,documentsRemoved:m}))))}}function pV(i,t){return new fV(i,t)}class mV{constructor(){this.changes=new qa((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Vn.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return n!==void 0?lt.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class gV{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class yV{constructor(t,e,n,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=s}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((s=>(n=s,this.remoteDocumentCache.getEntry(t,e)))).next((s=>(n!==null&&hh(n.mutation,s,_i.empty(),we.now()),s)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((n=>this.getLocalViewOfDocuments(t,n,Zt()).next((()=>n))))}getLocalViewOfDocuments(t,e,n=Zt()){const s=wa();return this.populateOverlays(t,s,e).next((()=>this.computeViews(t,e,s,n).next((r=>{let a=Zu();return r.forEach(((c,u)=>{a=a.insert(c,u.overlayedDocument)})),a}))))}getOverlayedDocuments(t,e){const n=wa();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,Zt())))}populateOverlays(t,e,n){const s=[];return n.forEach((r=>{e.has(r)||s.push(r)})),this.documentOverlayCache.getOverlays(t,s).next((r=>{r.forEach(((a,c)=>{e.set(a,c)}))}))}computeViews(t,e,n,s){let r=wr();const a=uh(),c=(function(){return uh()})();return e.forEach(((u,h)=>{const f=n.get(h.key);s.has(h.key)&&(f===void 0||f.mutation instanceof Vo)?r=r.insert(h.key,h):f!==void 0?(a.set(h.key,f.mutation.getFieldMask()),hh(f.mutation,h,f.mutation.getFieldMask(),we.now())):a.set(h.key,_i.empty())})),this.recalculateAndSaveOverlays(t,r).next((u=>(u.forEach(((h,f)=>a.set(h,f))),e.forEach(((h,f)=>c.set(h,new gV(f,a.get(h)??null)))),c)))}recalculateAndSaveOverlays(t,e){const n=uh();let s=new ke(((a,c)=>a-c)),r=Zt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((a=>{for(const c of a)c.keys().forEach((u=>{const h=e.get(u);if(h===null)return;let f=n.get(u)||_i.empty();f=c.applyToLocalView(h,f),n.set(u,f);const m=(s.get(c.batchId)||Zt()).add(u);s=s.insert(c.batchId,m)}))})).next((()=>{const a=[],c=s.getReverseIterator();for(;c.hasNext();){const u=c.getNext(),h=u.key,f=u.value,m=VR();f.forEach((y=>{if(!r.has(y)){const T=$R(e.get(y),n.get(y));T!==null&&m.set(y,T),r=r.add(y)}})),a.push(this.documentOverlayCache.saveOverlays(t,h,m))}return lt.waitFor(a)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((n=>this.recalculateAndSaveOverlays(t,n)))}getDocumentsMatchingQuery(t,e,n,s){return(function(a){return Mt.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):vU(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,s):this.getDocumentsMatchingCollectionQuery(t,e,n,s)}getNextDocuments(t,e,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,s).next((r=>{const a=s-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,s-r.size):lt.resolve(wa());let c=yh,u=r;return a.next((h=>lt.forEach(h,((f,m)=>(c<m.largestBatchId&&(c=m.largestBatchId),r.get(f)?lt.resolve():this.remoteDocumentCache.getEntry(t,f).next((y=>{u=u.insert(f,y)}))))).next((()=>this.populateOverlays(t,h,r))).next((()=>this.computeViews(t,u,h,Zt()))).next((f=>({batchId:c,changes:UR(f)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new Mt(e)).next((n=>{let s=Zu();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,s){const r=e.collectionGroup;let a=Zu();return this.indexManager.getCollectionParents(t,r).next((c=>lt.forEach(c,(u=>{const h=(function(m,y){return new Yp(y,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)})(e,u.child(r));return this.getDocumentsMatchingCollectionQuery(t,h,n,s).next((f=>{f.forEach(((m,y)=>{a=a.insert(m,y)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(t,e,n,s){let r;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((a=>(r=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,r,s)))).next((a=>{r.forEach(((u,h)=>{const f=h.getKey();a.get(f)===null&&(a=a.insert(f,Vn.newInvalidDocument(f)))}));let c=Zu();return a.forEach(((u,h)=>{const f=r.get(u);f!==void 0&&hh(f.mutation,h,_i.empty(),we.now()),Xp(e,h)&&(c=c.insert(u,h))})),c}))}}class _V{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return lt.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,(function(s){return{id:s.id,version:s.version,createTime:Ds(s.createTime)}})(e)),lt.resolve()}getNamedQuery(t,e){return lt.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,(function(s){return{name:s.name,query:aV(s.bundledQuery),readTime:Ds(s.readTime)}})(e)),lt.resolve()}}class vV{constructor(){this.overlays=new ke(Mt.comparator),this.qr=new Map}getOverlay(t,e){return lt.resolve(this.overlays.get(e))}getOverlays(t,e){const n=wa();return lt.forEach(e,(s=>this.getOverlay(t,s).next((r=>{r!==null&&n.set(s,r)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((s,r)=>{this.St(t,e,r)})),lt.resolve()}removeOverlaysForBatchId(t,e,n){const s=this.qr.get(n);return s!==void 0&&(s.forEach((r=>this.overlays=this.overlays.remove(r))),this.qr.delete(n)),lt.resolve()}getOverlaysForCollection(t,e,n){const s=wa(),r=e.length+1,a=new Mt(e.child("")),c=this.overlays.getIteratorFrom(a);for(;c.hasNext();){const u=c.getNext().value,h=u.getKey();if(!e.isPrefixOf(h.path))break;h.path.length===r&&u.largestBatchId>n&&s.set(u.getKey(),u)}return lt.resolve(s)}getOverlaysForCollectionGroup(t,e,n,s){let r=new ke(((h,f)=>h-f));const a=this.overlays.getIterator();for(;a.hasNext();){const h=a.getNext().value;if(h.getKey().getCollectionGroup()===e&&h.largestBatchId>n){let f=r.get(h.largestBatchId);f===null&&(f=wa(),r=r.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}const c=wa(),u=r.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach(((h,f)=>c.set(h,f))),!(c.size()>=s)););return lt.resolve(c)}St(t,e,n){const s=this.overlays.get(n.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(n.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new UU(e,n));let r=this.qr.get(e);r===void 0&&(r=Zt(),this.qr.set(e,r)),this.qr.set(e,r.add(n.key))}}class EV{constructor(){this.sessionToken=xn.EMPTY_BYTE_STRING}getSessionToken(t){return lt.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,lt.resolve()}}class Ov{constructor(){this.Qr=new un(_n.$r),this.Ur=new un(_n.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){const n=new _n(t,e);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(t,e){t.forEach((n=>this.addReference(n,e)))}removeReference(t,e){this.Gr(new _n(t,e))}zr(t,e){t.forEach((n=>this.removeReference(n,e)))}jr(t){const e=new Mt(new De([])),n=new _n(e,t),s=new _n(e,t+1),r=[];return this.Ur.forEachInRange([n,s],(a=>{this.Gr(a),r.push(a.key)})),r}Jr(){this.Qr.forEach((t=>this.Gr(t)))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){const e=new Mt(new De([])),n=new _n(e,t),s=new _n(e,t+1);let r=Zt();return this.Ur.forEachInRange([n,s],(a=>{r=r.add(a.key)})),r}containsKey(t){const e=new _n(t,0),n=this.Qr.firstAfterOrEqual(e);return n!==null&&t.isEqual(n.key)}}class _n{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return Mt.comparator(t.key,e.key)||jt(t.Yr,e.Yr)}static Kr(t,e){return jt(t.Yr,e.Yr)||Mt.comparator(t.key,e.key)}}class TV{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new un(_n.$r)}checkEmpty(t){return lt.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,n,s){const r=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new OU(r,e,n,s);this.mutationQueue.push(a);for(const c of s)this.Zr=this.Zr.add(new _n(c.key,r)),this.indexManager.addToCollectionParentIndex(t,c.key.path.popLast());return lt.resolve(a)}lookupMutationBatch(t,e){return lt.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=this.ei(n),r=s<0?0:s;return lt.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return lt.resolve(this.mutationQueue.length===0?Cv:this.tr-1)}getAllMutationBatches(t){return lt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new _n(e,0),s=new _n(e,Number.POSITIVE_INFINITY),r=[];return this.Zr.forEachInRange([n,s],(a=>{const c=this.Xr(a.Yr);r.push(c)})),lt.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new un(jt);return e.forEach((s=>{const r=new _n(s,0),a=new _n(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([r,a],(c=>{n=n.add(c.Yr)}))})),lt.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1;let r=n;Mt.isDocumentKey(r)||(r=r.child(""));const a=new _n(new Mt(r),0);let c=new un(jt);return this.Zr.forEachWhile((u=>{const h=u.key.path;return!!n.isPrefixOf(h)&&(h.length===s&&(c=c.add(u.Yr)),!0)}),a),lt.resolve(this.ti(c))}ti(t){const e=[];return t.forEach((n=>{const s=this.Xr(n);s!==null&&e.push(s)})),e}removeMutationBatch(t,e){ue(this.ni(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Zr;return lt.forEach(e.mutations,(s=>{const r=new _n(s.key,e.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.Zr=n}))}ir(t){}containsKey(t,e){const n=new _n(e,0),s=this.Zr.firstAfterOrEqual(n);return lt.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,lt.resolve()}ni(t,e){return this.ei(t)}ei(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Xr(t){const e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class AV{constructor(t){this.ri=t,this.docs=(function(){return new ke(Mt.comparator)})(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,s=this.docs.get(n),r=s?s.size:0,a=this.ri(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:a}),this.size+=a-r,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return lt.resolve(n?n.document.mutableCopy():Vn.newInvalidDocument(e))}getEntries(t,e){let n=wr();return e.forEach((s=>{const r=this.docs.get(s);n=n.insert(s,r?r.document.mutableCopy():Vn.newInvalidDocument(s))})),lt.resolve(n)}getDocumentsMatchingQuery(t,e,n,s){let r=wr();const a=e.path,c=new Mt(a.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(c);for(;u.hasNext();){const{key:h,value:{document:f}}=u.getNext();if(!a.isPrefixOf(h.path))break;h.path.length>a.length+1||JO(XO(f),n)<=0||(s.has(f.key)||Xp(e,f))&&(r=r.insert(f.key,f.mutableCopy()))}return lt.resolve(r)}getAllFromCollectionGroup(t,e,n,s){kt(9500)}ii(t,e){return lt.forEach(this.docs,(n=>e(n)))}newChangeBuffer(t){return new SV(this)}getSize(t){return lt.resolve(this.size)}}class SV extends mV{constructor(t){super(),this.Nr=t}applyChanges(t){const e=[];return this.changes.forEach(((n,s)=>{s.isValidDocument()?e.push(this.Nr.addEntry(t,s)):this.Nr.removeEntry(n)})),lt.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}}class wV{constructor(t){this.persistence=t,this.si=new qa((e=>Mv(e)),Pv),this.lastRemoteSnapshotVersion=Vt.min(),this.highestTargetId=0,this.oi=0,this._i=new Ov,this.targetCount=0,this.ai=_c.ur()}forEachTarget(t,e){return this.si.forEach(((n,s)=>e(s))),lt.resolve()}getLastRemoteSnapshotVersion(t){return lt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return lt.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),lt.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.oi&&(this.oi=e),lt.resolve()}Pr(t){this.si.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.ai=new _c(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,lt.resolve()}updateTargetData(t,e){return this.Pr(e),lt.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,lt.resolve()}removeTargets(t,e,n){let s=0;const r=[];return this.si.forEach(((a,c)=>{c.sequenceNumber<=e&&n.get(c.targetId)===null&&(this.si.delete(a),r.push(this.removeMatchingKeysForTargetId(t,c.targetId)),s++)})),lt.waitFor(r).next((()=>s))}getTargetCount(t){return lt.resolve(this.targetCount)}getTargetData(t,e){const n=this.si.get(e)||null;return lt.resolve(n)}addMatchingKeys(t,e,n){return this._i.Wr(e,n),lt.resolve()}removeMatchingKeys(t,e,n){this._i.zr(e,n);const s=this.persistence.referenceDelegate,r=[];return s&&e.forEach((a=>{r.push(s.markPotentiallyOrphaned(t,a))})),lt.waitFor(r)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),lt.resolve()}getMatchingKeysForTargetId(t,e){const n=this._i.Hr(e);return lt.resolve(n)}containsKey(t,e){return lt.resolve(this._i.containsKey(e))}}class s1{constructor(t,e){this.ui={},this.overlays={},this.ci=new qp(0),this.li=!1,this.li=!0,this.hi=new EV,this.referenceDelegate=t(this),this.Pi=new wV(this),this.indexManager=new lV,this.remoteDocumentCache=(function(s){return new AV(s)})((n=>this.referenceDelegate.Ti(n))),this.serializer=new oV(e),this.Ii=new _V(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new vV,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.ui[t.toKey()];return n||(n=new TV(e,this.referenceDelegate),this.ui[t.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,n){yt("MemoryPersistence","Starting transaction:",t);const s=new bV(this.ci.next());return this.referenceDelegate.Ei(),n(s).next((r=>this.referenceDelegate.di(s).next((()=>r)))).toPromise().then((r=>(s.raiseOnCommittedEvent(),r)))}Ai(t,e){return lt.or(Object.values(this.ui).map((n=>()=>n.containsKey(t,e))))}}class bV extends jO{constructor(t){super(),this.currentSequenceNumber=t}}class Uv{constructor(t){this.persistence=t,this.Ri=new Ov,this.Vi=null}static mi(t){return new Uv(t)}get fi(){if(this.Vi)return this.Vi;throw kt(60996)}addReference(t,e,n){return this.Ri.addReference(n,e),this.fi.delete(n.toString()),lt.resolve()}removeReference(t,e,n){return this.Ri.removeReference(n,e),this.fi.add(n.toString()),lt.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),lt.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach((s=>this.fi.add(s.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((s=>{s.forEach((r=>this.fi.add(r.toString())))})).next((()=>n.removeTargetData(t,e)))}Ei(){this.Vi=new Set}di(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return lt.forEach(this.fi,(n=>{const s=Mt.fromPath(n);return this.gi(t,s).next((r=>{r||e.removeEntry(s,Vt.min())}))})).next((()=>(this.Vi=null,e.apply(t))))}updateLimboDocument(t,e){return this.gi(t,e).next((n=>{n?this.fi.delete(e.toString()):this.fi.add(e.toString())}))}Ti(t){return 0}gi(t,e){return lt.or([()=>lt.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}}class vp{constructor(t,e){this.persistence=t,this.pi=new qa((n=>eU(n.path)),((n,s)=>n.isEqual(s))),this.garbageCollector=pV(this,e)}static mi(t,e){return new vp(t,e)}Ei(){}di(t){return lt.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){const e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next((n=>e.next((s=>n+s))))}wr(t){let e=0;return this.pr(t,(n=>{e++})).next((()=>e))}pr(t,e){return lt.forEach(this.pi,((n,s)=>this.br(t,n,s).next((r=>r?lt.resolve():e(s)))))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0;const s=this.persistence.getRemoteDocumentCache(),r=s.newChangeBuffer();return s.ii(t,(a=>this.br(t,a,e).next((c=>{c||(n++,r.removeEntry(a,Vt.min()))})))).next((()=>r.apply(t))).next((()=>n))}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),lt.resolve()}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),lt.resolve()}removeReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),lt.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),lt.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=zf(t.data.value)),e}br(t,e,n){return lt.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const s=this.pi.get(e);return lt.resolve(s!==void 0&&s>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class Vv{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Es=n,this.ds=s}static As(t,e){let n=Zt(),s=Zt();for(const r of e.docChanges)switch(r.type){case 0:n=n.add(r.doc.key);break;case 1:s=s.add(r.doc.key)}return new Vv(t,e.fromCache,n,s)}}class CV{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class IV{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return ek()?8:ZO(Fn())>0?6:4})()}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,n,s){const r={result:null};return this.ys(t,e).next((a=>{r.result=a})).next((()=>{if(!r.result)return this.ws(t,e,s,n).next((a=>{r.result=a}))})).next((()=>{if(r.result)return;const a=new CV;return this.Ss(t,e,a).next((c=>{if(r.result=c,this.Vs)return this.bs(t,e,a,c.size)}))})).next((()=>r.result))}bs(t,e,n,s){return n.documentReadCount<this.fs?(Vl()<=Qt.DEBUG&&yt("QueryEngine","SDK will not create cache indexes for query:",Bl(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),lt.resolve()):(Vl()<=Qt.DEBUG&&yt("QueryEngine","Query:",Bl(e),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.gs*s?(Vl()<=Qt.DEBUG&&yt("QueryEngine","The SDK decides to create cache indexes for query:",Bl(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,xs(e))):lt.resolve())}ys(t,e){if(ZS(e))return lt.resolve(null);let n=xs(e);return this.indexManager.getIndexType(t,n).next((s=>s===0?null:(e.limit!==null&&s===1&&(e=g_(e,null,"F"),n=xs(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((r=>{const a=Zt(...r);return this.ps.getDocuments(t,a).next((c=>this.indexManager.getMinOffset(t,n).next((u=>{const h=this.Ds(e,c);return this.Cs(e,h,a,u.readTime)?this.ys(t,g_(e,null,"F")):this.vs(t,h,e,u)}))))})))))}ws(t,e,n,s){return ZS(e)||s.isEqual(Vt.min())?lt.resolve(null):this.ps.getDocuments(t,n).next((r=>{const a=this.Ds(e,r);return this.Cs(e,a,n,s)?lt.resolve(null):(Vl()<=Qt.DEBUG&&yt("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Bl(e)),this.vs(t,a,e,KO(s,yh)).next((c=>c)))}))}Ds(t,e){let n=new un(LR(t));return e.forEach(((s,r)=>{Xp(t,r)&&(n=n.add(r))})),n}Cs(t,e,n,s){if(t.limit===null)return!1;if(n.size!==e.size)return!0;const r=t.limitType==="F"?e.last():e.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(s)>0)}Ss(t,e,n){return Vl()<=Qt.DEBUG&&yt("QueryEngine","Using full collection scan to execute query:",Bl(e)),this.ps.getDocumentsMatchingQuery(t,e,Co.min(),n)}vs(t,e,n,s){return this.ps.getDocumentsMatchingQuery(t,n,s).next((r=>(e.forEach((a=>{r=r.insert(a.key,a)})),r)))}}const Bv="LocalStore",RV=3e8;class MV{constructor(t,e,n,s){this.persistence=t,this.Fs=e,this.serializer=s,this.Ms=new ke(jt),this.xs=new qa((r=>Mv(r)),Pv),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(n)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new yV(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ms)))}}function PV(i,t,e,n){return new MV(i,t,e,n)}async function r1(i,t){const e=Gt(i);return await e.persistence.runTransaction("Handle user change","readonly",(n=>{let s;return e.mutationQueue.getAllMutationBatches(n).next((r=>(s=r,e.Bs(t),e.mutationQueue.getAllMutationBatches(n)))).next((r=>{const a=[],c=[];let u=Zt();for(const h of s){a.push(h.batchId);for(const f of h.mutations)u=u.add(f.key)}for(const h of r){c.push(h.batchId);for(const f of h.mutations)u=u.add(f.key)}return e.localDocuments.getDocuments(n,u).next((h=>({Ls:h,removedBatchIds:a,addedBatchIds:c})))}))}))}function xV(i,t){const e=Gt(i);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",(n=>{const s=t.batch.keys(),r=e.Ns.newChangeBuffer({trackRemovals:!0});return(function(c,u,h,f){const m=h.batch,y=m.keys();let T=lt.resolve();return y.forEach((S=>{T=T.next((()=>f.getEntry(u,S))).next((b=>{const C=h.docVersions.get(S);ue(C!==null,48541),b.version.compareTo(C)<0&&(m.applyToRemoteDocument(b,h),b.isValidDocument()&&(b.setReadTime(h.commitVersion),f.addEntry(b)))}))})),T.next((()=>c.mutationQueue.removeMutationBatch(u,m)))})(e,n,t,r).next((()=>r.apply(n))).next((()=>e.mutationQueue.performConsistencyCheck(n))).next((()=>e.documentOverlayCache.removeOverlaysForBatchId(n,s,t.batch.batchId))).next((()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,(function(c){let u=Zt();for(let h=0;h<c.mutationResults.length;++h)c.mutationResults[h].transformResults.length>0&&(u=u.add(c.batch.mutations[h].key));return u})(t)))).next((()=>e.localDocuments.getDocuments(n,s)))}))}function o1(i){const t=Gt(i);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Pi.getLastRemoteSnapshotVersion(e)))}function DV(i,t){const e=Gt(i),n=t.snapshotVersion;let s=e.Ms;return e.persistence.runTransaction("Apply remote event","readwrite-primary",(r=>{const a=e.Ns.newChangeBuffer({trackRemovals:!0});s=e.Ms;const c=[];t.targetChanges.forEach(((f,m)=>{const y=s.get(m);if(!y)return;c.push(e.Pi.removeMatchingKeys(r,f.removedDocuments,m).next((()=>e.Pi.addMatchingKeys(r,f.addedDocuments,m))));let T=y.withSequenceNumber(r.currentSequenceNumber);t.targetMismatches.get(m)!==null?T=T.withResumeToken(xn.EMPTY_BYTE_STRING,Vt.min()).withLastLimboFreeSnapshotVersion(Vt.min()):f.resumeToken.approximateByteSize()>0&&(T=T.withResumeToken(f.resumeToken,n)),s=s.insert(m,T),(function(b,C,I){return b.resumeToken.approximateByteSize()===0||C.snapshotVersion.toMicroseconds()-b.snapshotVersion.toMicroseconds()>=RV?!0:I.addedDocuments.size+I.modifiedDocuments.size+I.removedDocuments.size>0})(y,T,f)&&c.push(e.Pi.updateTargetData(r,T))}));let u=wr(),h=Zt();if(t.documentUpdates.forEach((f=>{t.resolvedLimboDocuments.has(f)&&c.push(e.persistence.referenceDelegate.updateLimboDocument(r,f))})),c.push(NV(r,a,t.documentUpdates).next((f=>{u=f.ks,h=f.qs}))),!n.isEqual(Vt.min())){const f=e.Pi.getLastRemoteSnapshotVersion(r).next((m=>e.Pi.setTargetsMetadata(r,r.currentSequenceNumber,n)));c.push(f)}return lt.waitFor(c).next((()=>a.apply(r))).next((()=>e.localDocuments.getLocalViewOfDocuments(r,u,h))).next((()=>u))})).then((r=>(e.Ms=s,r)))}function NV(i,t,e){let n=Zt(),s=Zt();return e.forEach((r=>n=n.add(r))),t.getEntries(i,n).next((r=>{let a=wr();return e.forEach(((c,u)=>{const h=r.get(c);u.isFoundDocument()!==h.isFoundDocument()&&(s=s.add(c)),u.isNoDocument()&&u.version.isEqual(Vt.min())?(t.removeEntry(c,u.readTime),a=a.insert(c,u)):!h.isValidDocument()||u.version.compareTo(h.version)>0||u.version.compareTo(h.version)===0&&h.hasPendingWrites?(t.addEntry(u),a=a.insert(c,u)):yt(Bv,"Ignoring outdated watch update for ",c,". Current version:",h.version," Watch version:",u.version)})),{ks:a,qs:s}}))}function kV(i,t){const e=Gt(i);return e.persistence.runTransaction("Get next mutation batch","readonly",(n=>(t===void 0&&(t=Cv),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t))))}function LV(i,t){const e=Gt(i);return e.persistence.runTransaction("Allocate target","readwrite",(n=>{let s;return e.Pi.getTargetData(n,t).next((r=>r?(s=r,lt.resolve(s)):e.Pi.allocateTargetId(n).next((a=>(s=new vo(t,a,"TargetPurposeListen",n.currentSequenceNumber),e.Pi.addTargetData(n,s).next((()=>s)))))))})).then((n=>{const s=e.Ms.get(n.targetId);return(s===null||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.Ms=e.Ms.insert(n.targetId,n),e.xs.set(t,n.targetId)),n}))}async function T_(i,t,e){const n=Gt(i),s=n.Ms.get(t),r=e?"readwrite":"readwrite-primary";try{e||await n.persistence.runTransaction("Release target",r,(a=>n.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!Rc(a))throw a;yt(Bv,`Failed to update sequence numbers for target ${t}: ${a}`)}n.Ms=n.Ms.remove(t),n.xs.delete(s.target)}function dw(i,t,e){const n=Gt(i);let s=Vt.min(),r=Zt();return n.persistence.runTransaction("Execute query","readwrite",(a=>(function(u,h,f){const m=Gt(u),y=m.xs.get(f);return y!==void 0?lt.resolve(m.Ms.get(y)):m.Pi.getTargetData(h,f)})(n,a,xs(t)).next((c=>{if(c)return s=c.lastLimboFreeSnapshotVersion,n.Pi.getMatchingKeysForTargetId(a,c.targetId).next((u=>{r=u}))})).next((()=>n.Fs.getDocumentsMatchingQuery(a,t,e?s:Vt.min(),e?r:Zt()))).next((c=>(OV(n,TU(t),c),{documents:c,Qs:r})))))}function OV(i,t,e){let n=i.Os.get(t)||Vt.min();e.forEach(((s,r)=>{r.readTime.compareTo(n)>0&&(n=r.readTime)})),i.Os.set(t,n)}class fw{constructor(){this.activeTargetIds=IU()}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class UV{constructor(){this.Mo=new fw,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,n){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new fw,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class VV{Oo(t){}shutdown(){}}const pw="ConnectivityMonitor";class mw{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){yt(pw,"Network connectivity changed: AVAILABLE");for(const t of this.qo)t(0)}ko(){yt(pw,"Network connectivity changed: UNAVAILABLE");for(const t of this.qo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Ef=null;function A_(){return Ef===null?Ef=(function(){return 268435456+Math.round(2147483648*Math.random())})():Ef++,"0x"+Ef.toString(16)}const Ly="RestConnection",BV={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class FV{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko=`projects/${n}/databases/${s}`,this.Wo=this.databaseId.database===dp?`project_id=${n}`:`project_id=${n}&database_id=${s}`}Go(t,e,n,s,r){const a=A_(),c=this.zo(t,e.toUriEncodedString());yt(Ly,`Sending RPC '${t}' ${a}:`,c,n);const u={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(u,s,r);const{host:h}=new URL(c),f=Fa(h);return this.Jo(t,c,u,n,f).then((m=>(yt(Ly,`Received RPC '${t}' ${a}: `,m),m)),(m=>{throw dc(Ly,`RPC '${t}' ${a} failed with error: `,m,"url: ",c,"request:",n),m}))}Ho(t,e,n,s,r,a){return this.Go(t,e,n,s,r)}jo(t,e,n){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Cc})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((s,r)=>t[r]=s)),n&&n.headers.forEach(((s,r)=>t[r]=s))}zo(t,e){const n=BV[t];return`${this.Uo}/v1/${e}:${n}`}terminate(){}}class HV{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}}const On="WebChannelConnection";class GV extends FV{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,n,s,r){const a=A_();return new Promise(((c,u)=>{const h=new uR;h.setWithCredentials(!0),h.listenOnce(hR.COMPLETE,(()=>{try{switch(h.getLastErrorCode()){case qf.NO_ERROR:const m=h.getResponseJson();yt(On,`XHR for RPC '${t}' ${a} received:`,JSON.stringify(m)),c(m);break;case qf.TIMEOUT:yt(On,`RPC '${t}' ${a} timed out`),u(new bt(ut.DEADLINE_EXCEEDED,"Request time out"));break;case qf.HTTP_ERROR:const y=h.getStatus();if(yt(On,`RPC '${t}' ${a} failed with status:`,y,"response text:",h.getResponseText()),y>0){let T=h.getResponseJson();Array.isArray(T)&&(T=T[0]);const S=T?.error;if(S&&S.status&&S.message){const b=(function(I){const D=I.toLowerCase().replace(/_/g,"-");return Object.values(ut).indexOf(D)>=0?D:ut.UNKNOWN})(S.status);u(new bt(b,S.message))}else u(new bt(ut.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new bt(ut.UNAVAILABLE,"Connection failed."));break;default:kt(9055,{l_:t,streamId:a,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{yt(On,`RPC '${t}' ${a} completed.`)}}));const f=JSON.stringify(s);yt(On,`RPC '${t}' ${a} sending request:`,s),h.send(e,"POST",f,n,15)}))}T_(t,e,n){const s=A_(),r=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=pR(),c=fR(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.jo(u.initMessageHeaders,e,n),u.encodeInitMessageHeaders=!0;const f=r.join("");yt(On,`Creating RPC '${t}' stream ${s}: ${f}`,u);const m=a.createWebChannel(f,u);this.I_(m);let y=!1,T=!1;const S=new HV({Yo:C=>{T?yt(On,`Not sending because RPC '${t}' stream ${s} is closed:`,C):(y||(yt(On,`Opening RPC '${t}' stream ${s} transport.`),m.open(),y=!0),yt(On,`RPC '${t}' stream ${s} sending:`,C),m.send(C))},Zo:()=>m.close()}),b=(C,I,D)=>{C.listen(I,(P=>{try{D(P)}catch(H){setTimeout((()=>{throw H}),0)}}))};return b(m,ju.EventType.OPEN,(()=>{T||(yt(On,`RPC '${t}' stream ${s} transport opened.`),S.o_())})),b(m,ju.EventType.CLOSE,(()=>{T||(T=!0,yt(On,`RPC '${t}' stream ${s} transport closed`),S.a_(),this.E_(m))})),b(m,ju.EventType.ERROR,(C=>{T||(T=!0,dc(On,`RPC '${t}' stream ${s} transport errored. Name:`,C.name,"Message:",C.message),S.a_(new bt(ut.UNAVAILABLE,"The operation could not be completed")))})),b(m,ju.EventType.MESSAGE,(C=>{if(!T){const I=C.data[0];ue(!!I,16349);const D=I,P=D?.error||D[0]?.error;if(P){yt(On,`RPC '${t}' stream ${s} received error:`,P);const H=P.status;let F=(function(x){const k=tn[x];if(k!==void 0)return WR(k)})(H),G=P.message;F===void 0&&(F=ut.INTERNAL,G="Unknown error status: "+H+" with message "+P.message),T=!0,S.a_(new bt(F,G)),m.close()}else yt(On,`RPC '${t}' stream ${s} received:`,I),S.u_(I)}})),b(c,dR.STAT_EVENT,(C=>{C.stat===u_.PROXY?yt(On,`RPC '${t}' stream ${s} detected buffering proxy`):C.stat===u_.NOPROXY&&yt(On,`RPC '${t}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{S.__()}),0),S}terminate(){this.c_.forEach((t=>t.close())),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter((e=>e===t))}}function Oy(){return typeof document<"u"?document:null}function Zp(i){return new YU(i,!0)}class a1{constructor(t,e,n=1e3,s=1.5,r=6e4){this.Mi=t,this.timerId=e,this.d_=n,this.A_=s,this.R_=r,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();const e=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),s=Math.max(0,e-n);s>0&&yt("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),t()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const gw="PersistentStream";class l1{constructor(t,e,n,s,r,a,c,u){this.Mi=t,this.S_=n,this.b_=s,this.connection=r,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=c,this.listener=u,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new a1(t,e)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(t){this.Q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():e&&e.code===ut.RESOURCE_EXHAUSTED?(Sr(e.toString()),Sr("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===ut.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.r_(e)}K_(){}auth(){this.state=1;const t=this.W_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([n,s])=>{this.D_===e&&this.G_(n,s)}),(n=>{t((()=>{const s=new bt(ut.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(s)}))}))}G_(t,e){const n=this.W_(this.D_);this.stream=this.j_(t,e),this.stream.Xo((()=>{n((()=>this.listener.Xo()))})),this.stream.t_((()=>{n((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{n((()=>this.z_(s)))})),this.stream.onMessage((s=>{n((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(t){return yt(gw,`close with error: ${t}`),this.stream=null,this.close(4,t)}W_(t){return e=>{this.Mi.enqueueAndForget((()=>this.D_===t?e():(yt(gw,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class qV extends l1{constructor(t,e,n,s,r,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,a),this.serializer=r}j_(t,e){return this.connection.T_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();const e=XU(this.serializer,t),n=(function(r){if(!("targetChange"in r))return Vt.min();const a=r.targetChange;return a.targetIds&&a.targetIds.length?Vt.min():a.readTime?Ds(a.readTime):Vt.min()})(t);return this.listener.H_(e,n)}Y_(t){const e={};e.database=E_(this.serializer),e.addTarget=(function(r,a){let c;const u=a.target;if(c=m_(u)?{documents:jU(r,u)}:{query:ZU(r,u).ft},c.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){c.resumeToken=JR(r,a.resumeToken);const h=y_(r,a.expectedCount);h!==null&&(c.expectedCount=h)}else if(a.snapshotVersion.compareTo(Vt.min())>0){c.readTime=_p(r,a.snapshotVersion.toTimestamp());const h=y_(r,a.expectedCount);h!==null&&(c.expectedCount=h)}return c})(this.serializer,t);const n=eV(this.serializer,t);n&&(e.labels=n),this.q_(e)}Z_(t){const e={};e.database=E_(this.serializer),e.removeTarget=t,this.q_(e)}}class zV extends l1{constructor(t,e,n,s,r,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,a),this.serializer=r}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}J_(t){return ue(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,ue(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){ue(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const e=QU(t.writeResults,t.commitTime),n=Ds(t.commitTime);return this.listener.na(n,e)}ra(){const t={};t.database=E_(this.serializer),this.q_(t)}ea(t){const e={streamToken:this.lastStreamToken,writes:t.map((n=>JU(this.serializer,n)))};this.q_(e)}}class $V{}class YV extends $V{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new bt(ut.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,n,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,a])=>this.connection.Go(t,__(e,n),s,r,a))).catch((r=>{throw r.name==="FirebaseError"?(r.code===ut.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new bt(ut.UNKNOWN,r.toString())}))}Ho(t,e,n,s,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,c])=>this.connection.Ho(t,__(e,n),s,a,c,r))).catch((a=>{throw a.name==="FirebaseError"?(a.code===ut.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new bt(ut.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class WV{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Sr(e),this.aa=!1):yt("OnlineStateTracker",e)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const La="RemoteStore";class KV{constructor(t,e,n,s,r){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=r,this.Aa.Oo((a=>{n.enqueueAndForget((async()=>{za(this)&&(yt(La,"Restarting streams for network reachability change."),await(async function(u){const h=Gt(u);h.Ea.add(4),await Vh(h),h.Ra.set("Unknown"),h.Ea.delete(4),await tm(h)})(this))}))})),this.Ra=new WV(n,s)}}async function tm(i){if(za(i))for(const t of i.da)await t(!0)}async function Vh(i){for(const t of i.da)await t(!1)}function c1(i,t){const e=Gt(i);e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),qv(e)?Gv(e):Mc(e).O_()&&Hv(e,t))}function Fv(i,t){const e=Gt(i),n=Mc(e);e.Ia.delete(t),n.O_()&&u1(e,t),e.Ia.size===0&&(n.O_()?n.L_():za(e)&&e.Ra.set("Unknown"))}function Hv(i,t){if(i.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Vt.min())>0){const e=i.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}Mc(i).Y_(t)}function u1(i,t){i.Va.Ue(t),Mc(i).Z_(t)}function Gv(i){i.Va=new GU({getRemoteKeysForTarget:t=>i.remoteSyncer.getRemoteKeysForTarget(t),At:t=>i.Ia.get(t)||null,ht:()=>i.datastore.serializer.databaseId}),Mc(i).start(),i.Ra.ua()}function qv(i){return za(i)&&!Mc(i).x_()&&i.Ia.size>0}function za(i){return Gt(i).Ea.size===0}function h1(i){i.Va=void 0}async function XV(i){i.Ra.set("Online")}async function JV(i){i.Ia.forEach(((t,e)=>{Hv(i,t)}))}async function QV(i,t){h1(i),qv(i)?(i.Ra.ha(t),Gv(i)):i.Ra.set("Unknown")}async function jV(i,t,e){if(i.Ra.set("Online"),t instanceof XR&&t.state===2&&t.cause)try{await(async function(s,r){const a=r.cause;for(const c of r.targetIds)s.Ia.has(c)&&(await s.remoteSyncer.rejectListen(c,a),s.Ia.delete(c),s.Va.removeTarget(c))})(i,t)}catch(n){yt(La,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await Ep(i,n)}else if(t instanceof Wf?i.Va.Ze(t):t instanceof KR?i.Va.st(t):i.Va.tt(t),!e.isEqual(Vt.min()))try{const n=await o1(i.localStore);e.compareTo(n)>=0&&await(function(r,a){const c=r.Va.Tt(a);return c.targetChanges.forEach(((u,h)=>{if(u.resumeToken.approximateByteSize()>0){const f=r.Ia.get(h);f&&r.Ia.set(h,f.withResumeToken(u.resumeToken,a))}})),c.targetMismatches.forEach(((u,h)=>{const f=r.Ia.get(u);if(!f)return;r.Ia.set(u,f.withResumeToken(xn.EMPTY_BYTE_STRING,f.snapshotVersion)),u1(r,u);const m=new vo(f.target,u,h,f.sequenceNumber);Hv(r,m)})),r.remoteSyncer.applyRemoteEvent(c)})(i,e)}catch(n){yt(La,"Failed to raise snapshot:",n),await Ep(i,n)}}async function Ep(i,t,e){if(!Rc(t))throw t;i.Ea.add(1),await Vh(i),i.Ra.set("Offline"),e||(e=()=>o1(i.localStore)),i.asyncQueue.enqueueRetryable((async()=>{yt(La,"Retrying IndexedDB access"),await e(),i.Ea.delete(1),await tm(i)}))}function d1(i,t){return t().catch((e=>Ep(i,e,t)))}async function em(i){const t=Gt(i),e=Po(t);let n=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:Cv;for(;ZV(t);)try{const s=await kV(t.localStore,n);if(s===null){t.Ta.length===0&&e.L_();break}n=s.batchId,tB(t,s)}catch(s){await Ep(t,s)}f1(t)&&p1(t)}function ZV(i){return za(i)&&i.Ta.length<10}function tB(i,t){i.Ta.push(t);const e=Po(i);e.O_()&&e.X_&&e.ea(t.mutations)}function f1(i){return za(i)&&!Po(i).x_()&&i.Ta.length>0}function p1(i){Po(i).start()}async function eB(i){Po(i).ra()}async function nB(i){const t=Po(i);for(const e of i.Ta)t.ea(e.mutations)}async function iB(i,t,e){const n=i.Ta.shift(),s=Nv.from(n,t,e);await d1(i,(()=>i.remoteSyncer.applySuccessfulWrite(s))),await em(i)}async function sB(i,t){t&&Po(i).X_&&await(async function(n,s){if((function(a){return BU(a)&&a!==ut.ABORTED})(s.code)){const r=n.Ta.shift();Po(n).B_(),await d1(n,(()=>n.remoteSyncer.rejectFailedWrite(r.batchId,s))),await em(n)}})(i,t),f1(i)&&p1(i)}async function yw(i,t){const e=Gt(i);e.asyncQueue.verifyOperationInProgress(),yt(La,"RemoteStore received new credentials");const n=za(e);e.Ea.add(3),await Vh(e),n&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await tm(e)}async function rB(i,t){const e=Gt(i);t?(e.Ea.delete(2),await tm(e)):t||(e.Ea.add(2),await Vh(e),e.Ra.set("Unknown"))}function Mc(i){return i.ma||(i.ma=(function(e,n,s){const r=Gt(e);return r.sa(),new qV(n,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,s)})(i.datastore,i.asyncQueue,{Xo:XV.bind(null,i),t_:JV.bind(null,i),r_:QV.bind(null,i),H_:jV.bind(null,i)}),i.da.push((async t=>{t?(i.ma.B_(),qv(i)?Gv(i):i.Ra.set("Unknown")):(await i.ma.stop(),h1(i))}))),i.ma}function Po(i){return i.fa||(i.fa=(function(e,n,s){const r=Gt(e);return r.sa(),new zV(n,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,s)})(i.datastore,i.asyncQueue,{Xo:()=>Promise.resolve(),t_:eB.bind(null,i),r_:sB.bind(null,i),ta:nB.bind(null,i),na:iB.bind(null,i)}),i.da.push((async t=>{t?(i.fa.B_(),await em(i)):(await i.fa.stop(),i.Ta.length>0&&(yt(La,`Stopping write stream with ${i.Ta.length} pending writes`),i.Ta=[]))}))),i.fa}class zv{constructor(t,e,n,s,r){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=r,this.deferred=new wo,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,s,r){const a=Date.now()+n,c=new zv(t,e,a,s,r);return c.start(n),c}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new bt(ut.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function $v(i,t){if(Sr("AsyncQueue",`${t}: ${i}`),Rc(i))return new bt(ut.UNAVAILABLE,`${t}: ${i}`);throw i}class nc{static emptySet(t){return new nc(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||Mt.comparator(e.key,n.key):(e,n)=>Mt.comparator(e.key,n.key),this.keyedMap=Zu(),this.sortedSet=new ke(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof nc)||this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const s=e.getNext().key,r=n.getNext().key;if(!s.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){const n=new nc;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class _w{constructor(){this.ga=new ke(Mt.comparator)}track(t){const e=t.doc.key,n=this.ga.get(e);n?t.type!==0&&n.type===3?this.ga=this.ga.insert(e,t):t.type===3&&n.type!==1?this.ga=this.ga.insert(e,{type:n.type,doc:t.doc}):t.type===2&&n.type===2?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):t.type===2&&n.type===0?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):t.type===1&&n.type===0?this.ga=this.ga.remove(e):t.type===1&&n.type===2?this.ga=this.ga.insert(e,{type:1,doc:n.doc}):t.type===0&&n.type===1?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):kt(63341,{Rt:t,pa:n}):this.ga=this.ga.insert(e,t)}ya(){const t=[];return this.ga.inorderTraversal(((e,n)=>{t.push(n)})),t}}class vc{constructor(t,e,n,s,r,a,c,u,h){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=r,this.fromCache=a,this.syncStateChanged=c,this.excludesMetadataChanges=u,this.hasCachedResults=h}static fromInitialDocuments(t,e,n,s,r){const a=[];return e.forEach((c=>{a.push({type:0,doc:c})})),new vc(t,e,nc.emptySet(e),a,n,s,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Kp(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==n[s].type||!e[s].doc.isEqual(n[s].doc))return!1;return!0}}class oB{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((t=>t.Da()))}}class aB{constructor(){this.queries=vw(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(e,n){const s=Gt(e),r=s.queries;s.queries=vw(),r.forEach(((a,c)=>{for(const u of c.Sa)u.onError(n)}))})(this,new bt(ut.ABORTED,"Firestore shutting down"))}}function vw(){return new qa((i=>kR(i)),Kp)}async function m1(i,t){const e=Gt(i);let n=3;const s=t.query;let r=e.queries.get(s);r?!r.ba()&&t.Da()&&(n=2):(r=new oB,n=t.Da()?0:1);try{switch(n){case 0:r.wa=await e.onListen(s,!0);break;case 1:r.wa=await e.onListen(s,!1);break;case 2:await e.onFirstRemoteStoreListen(s)}}catch(a){const c=$v(a,`Initialization of query '${Bl(t.query)}' failed`);return void t.onError(c)}e.queries.set(s,r),r.Sa.push(t),t.va(e.onlineState),r.wa&&t.Fa(r.wa)&&Yv(e)}async function g1(i,t){const e=Gt(i),n=t.query;let s=3;const r=e.queries.get(n);if(r){const a=r.Sa.indexOf(t);a>=0&&(r.Sa.splice(a,1),r.Sa.length===0?s=t.Da()?0:1:!r.ba()&&t.Da()&&(s=2))}switch(s){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function lB(i,t){const e=Gt(i);let n=!1;for(const s of t){const r=s.query,a=e.queries.get(r);if(a){for(const c of a.Sa)c.Fa(s)&&(n=!0);a.wa=s}}n&&Yv(e)}function cB(i,t,e){const n=Gt(i),s=n.queries.get(t);if(s)for(const r of s.Sa)r.onError(e);n.queries.delete(t)}function Yv(i){i.Ca.forEach((t=>{t.next()}))}var S_,Ew;(Ew=S_||(S_={})).Ma="default",Ew.Cache="cache";class y1{constructor(t,e,n){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(t){if(!this.options.includeMetadataChanges){const n=[];for(const s of t.docChanges)s.type!==3&&n.push(s);t=new vc(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache||!this.Da())return!0;const n=e!=="Offline";return(!this.options.qa||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Ba(t){if(t.docChanges.length>0)return!0;const e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}ka(t){t=vc.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==S_.Cache}}class _1{constructor(t){this.key=t}}class v1{constructor(t){this.key=t}}class uB{constructor(t,e){this.query=t,this.Ya=e,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Zt(),this.mutatedKeys=Zt(),this.eu=LR(t),this.tu=new nc(this.eu)}get nu(){return this.Ya}ru(t,e){const n=e?e.iu:new _w,s=e?e.tu:this.tu;let r=e?e.mutatedKeys:this.mutatedKeys,a=s,c=!1;const u=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,h=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((f,m)=>{const y=s.get(f),T=Xp(this.query,m)?m:null,S=!!y&&this.mutatedKeys.has(y.key),b=!!T&&(T.hasLocalMutations||this.mutatedKeys.has(T.key)&&T.hasCommittedMutations);let C=!1;y&&T?y.data.isEqual(T.data)?S!==b&&(n.track({type:3,doc:T}),C=!0):this.su(y,T)||(n.track({type:2,doc:T}),C=!0,(u&&this.eu(T,u)>0||h&&this.eu(T,h)<0)&&(c=!0)):!y&&T?(n.track({type:0,doc:T}),C=!0):y&&!T&&(n.track({type:1,doc:y}),C=!0,(u||h)&&(c=!0)),C&&(T?(a=a.add(T),r=b?r.add(f):r.delete(f)):(a=a.delete(f),r=r.delete(f)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),r=r.delete(f.key),n.track({type:1,doc:f})}return{tu:a,iu:n,Cs:c,mutatedKeys:r}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,s){const r=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const a=t.iu.ya();a.sort(((f,m)=>(function(T,S){const b=C=>{switch(C){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return kt(20277,{Rt:C})}};return b(T)-b(S)})(f.type,m.type)||this.eu(f.doc,m.doc))),this.ou(n),s=s??!1;const c=e&&!s?this._u():[],u=this.Xa.size===0&&this.current&&!s?1:0,h=u!==this.Za;return this.Za=u,a.length!==0||h?{snapshot:new vc(this.query,t.tu,r,a,t.mutatedKeys,u===0,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:c}:{au:c}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new _w,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach((e=>this.Ya=this.Ya.add(e))),t.modifiedDocuments.forEach((e=>{})),t.removedDocuments.forEach((e=>this.Ya=this.Ya.delete(e))),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Xa;this.Xa=Zt(),this.tu.forEach((n=>{this.uu(n.key)&&(this.Xa=this.Xa.add(n.key))}));const e=[];return t.forEach((n=>{this.Xa.has(n)||e.push(new v1(n))})),this.Xa.forEach((n=>{t.has(n)||e.push(new _1(n))})),e}cu(t){this.Ya=t.Qs,this.Xa=Zt();const e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return vc.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Wv="SyncEngine";class hB{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class dB{constructor(t){this.key=t,this.hu=!1}}class fB{constructor(t,e,n,s,r,a){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=r,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new qa((c=>kR(c)),Kp),this.Iu=new Map,this.Eu=new Set,this.du=new ke(Mt.comparator),this.Au=new Map,this.Ru=new Ov,this.Vu={},this.mu=new Map,this.fu=_c.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function pB(i,t,e=!0){const n=b1(i);let s;const r=n.Tu.get(t);return r?(n.sharedClientState.addLocalQueryTarget(r.targetId),s=r.view.lu()):s=await E1(n,t,e,!0),s}async function mB(i,t){const e=b1(i);await E1(e,t,!0,!1)}async function E1(i,t,e,n){const s=await LV(i.localStore,xs(t)),r=s.targetId,a=i.sharedClientState.addLocalQueryTarget(r,e);let c;return n&&(c=await gB(i,t,r,a==="current",s.resumeToken)),i.isPrimaryClient&&e&&c1(i.remoteStore,s),c}async function gB(i,t,e,n,s){i.pu=(m,y,T)=>(async function(b,C,I,D){let P=C.view.ru(I);P.Cs&&(P=await dw(b.localStore,C.query,!1).then((({documents:N})=>C.view.ru(N,P))));const H=D&&D.targetChanges.get(C.targetId),F=D&&D.targetMismatches.get(C.targetId)!=null,G=C.view.applyChanges(P,b.isPrimaryClient,H,F);return Aw(b,C.targetId,G.au),G.snapshot})(i,m,y,T);const r=await dw(i.localStore,t,!0),a=new uB(t,r.Qs),c=a.ru(r.documents),u=Uh.createSynthesizedTargetChangeForCurrentChange(e,n&&i.onlineState!=="Offline",s),h=a.applyChanges(c,i.isPrimaryClient,u);Aw(i,e,h.au);const f=new hB(t,e,a);return i.Tu.set(t,f),i.Iu.has(e)?i.Iu.get(e).push(t):i.Iu.set(e,[t]),h.snapshot}async function yB(i,t,e){const n=Gt(i),s=n.Tu.get(t),r=n.Iu.get(s.targetId);if(r.length>1)return n.Iu.set(s.targetId,r.filter((a=>!Kp(a,t)))),void n.Tu.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await T_(n.localStore,s.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(s.targetId),e&&Fv(n.remoteStore,s.targetId),w_(n,s.targetId)})).catch(Ic)):(w_(n,s.targetId),await T_(n.localStore,s.targetId,!0))}async function _B(i,t){const e=Gt(i),n=e.Tu.get(t),s=e.Iu.get(n.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),Fv(e.remoteStore,n.targetId))}async function vB(i,t,e){const n=CB(i);try{const s=await(function(a,c){const u=Gt(a),h=we.now(),f=c.reduce(((T,S)=>T.add(S.key)),Zt());let m,y;return u.persistence.runTransaction("Locally write mutations","readwrite",(T=>{let S=wr(),b=Zt();return u.Ns.getEntries(T,f).next((C=>{S=C,S.forEach(((I,D)=>{D.isValidDocument()||(b=b.add(I))}))})).next((()=>u.localDocuments.getOverlayedDocuments(T,S))).next((C=>{m=C;const I=[];for(const D of c){const P=kU(D,m.get(D.key).overlayedDocument);P!=null&&I.push(new Vo(D.key,P,IR(P.value.mapValue),es.exists(!0)))}return u.mutationQueue.addMutationBatch(T,h,I,c)})).next((C=>{y=C;const I=C.applyToLocalDocumentSet(m,b);return u.documentOverlayCache.saveOverlays(T,C.batchId,I)}))})).then((()=>({batchId:y.batchId,changes:UR(m)})))})(n.localStore,t);n.sharedClientState.addPendingMutation(s.batchId),(function(a,c,u){let h=a.Vu[a.currentUser.toKey()];h||(h=new ke(jt)),h=h.insert(c,u),a.Vu[a.currentUser.toKey()]=h})(n,s.batchId,e),await Bh(n,s.changes),await em(n.remoteStore)}catch(s){const r=$v(s,"Failed to persist write");e.reject(r)}}async function T1(i,t){const e=Gt(i);try{const n=await DV(e.localStore,t);t.targetChanges.forEach(((s,r)=>{const a=e.Au.get(r);a&&(ue(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?ue(a.hu,14607):s.removedDocuments.size>0&&(ue(a.hu,42227),a.hu=!1))})),await Bh(e,n,t)}catch(n){await Ic(n)}}function Tw(i,t,e){const n=Gt(i);if(n.isPrimaryClient&&e===0||!n.isPrimaryClient&&e===1){const s=[];n.Tu.forEach(((r,a)=>{const c=a.view.va(t);c.snapshot&&s.push(c.snapshot)})),(function(a,c){const u=Gt(a);u.onlineState=c;let h=!1;u.queries.forEach(((f,m)=>{for(const y of m.Sa)y.va(c)&&(h=!0)})),h&&Yv(u)})(n.eventManager,t),s.length&&n.Pu.H_(s),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}async function EB(i,t,e){const n=Gt(i);n.sharedClientState.updateQueryState(t,"rejected",e);const s=n.Au.get(t),r=s&&s.key;if(r){let a=new ke(Mt.comparator);a=a.insert(r,Vn.newNoDocument(r,Vt.min()));const c=Zt().add(r),u=new jp(Vt.min(),new Map,new ke(jt),a,c);await T1(n,u),n.du=n.du.remove(r),n.Au.delete(t),Kv(n)}else await T_(n.localStore,t,!1).then((()=>w_(n,t,e))).catch(Ic)}async function TB(i,t){const e=Gt(i),n=t.batch.batchId;try{const s=await xV(e.localStore,t);S1(e,n,null),A1(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),await Bh(e,s)}catch(s){await Ic(s)}}async function AB(i,t,e){const n=Gt(i);try{const s=await(function(a,c){const u=Gt(a);return u.persistence.runTransaction("Reject batch","readwrite-primary",(h=>{let f;return u.mutationQueue.lookupMutationBatch(h,c).next((m=>(ue(m!==null,37113),f=m.keys(),u.mutationQueue.removeMutationBatch(h,m)))).next((()=>u.mutationQueue.performConsistencyCheck(h))).next((()=>u.documentOverlayCache.removeOverlaysForBatchId(h,f,c))).next((()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f))).next((()=>u.localDocuments.getDocuments(h,f)))}))})(n.localStore,t);S1(n,t,e),A1(n,t),n.sharedClientState.updateMutationState(t,"rejected",e),await Bh(n,s)}catch(s){await Ic(s)}}function A1(i,t){(i.mu.get(t)||[]).forEach((e=>{e.resolve()})),i.mu.delete(t)}function S1(i,t,e){const n=Gt(i);let s=n.Vu[n.currentUser.toKey()];if(s){const r=s.get(t);r&&(e?r.reject(e):r.resolve(),s=s.remove(t)),n.Vu[n.currentUser.toKey()]=s}}function w_(i,t,e=null){i.sharedClientState.removeLocalQueryTarget(t);for(const n of i.Iu.get(t))i.Tu.delete(n),e&&i.Pu.yu(n,e);i.Iu.delete(t),i.isPrimaryClient&&i.Ru.jr(t).forEach((n=>{i.Ru.containsKey(n)||w1(i,n)}))}function w1(i,t){i.Eu.delete(t.path.canonicalString());const e=i.du.get(t);e!==null&&(Fv(i.remoteStore,e),i.du=i.du.remove(t),i.Au.delete(e),Kv(i))}function Aw(i,t,e){for(const n of e)n instanceof _1?(i.Ru.addReference(n.key,t),SB(i,n)):n instanceof v1?(yt(Wv,"Document no longer in limbo: "+n.key),i.Ru.removeReference(n.key,t),i.Ru.containsKey(n.key)||w1(i,n.key)):kt(19791,{wu:n})}function SB(i,t){const e=t.key,n=e.path.canonicalString();i.du.get(e)||i.Eu.has(n)||(yt(Wv,"New document in limbo: "+e),i.Eu.add(n),Kv(i))}function Kv(i){for(;i.Eu.size>0&&i.du.size<i.maxConcurrentLimboResolutions;){const t=i.Eu.values().next().value;i.Eu.delete(t);const e=new Mt(De.fromString(t)),n=i.fu.next();i.Au.set(n,new dB(e)),i.du=i.du.insert(e,n),c1(i.remoteStore,new vo(xs(Wp(e.path)),n,"TargetPurposeLimboResolution",qp.ce))}}async function Bh(i,t,e){const n=Gt(i),s=[],r=[],a=[];n.Tu.isEmpty()||(n.Tu.forEach(((c,u)=>{a.push(n.pu(u,t,e).then((h=>{if((h||e)&&n.isPrimaryClient){const f=h?!h.fromCache:e?.targetChanges.get(u.targetId)?.current;n.sharedClientState.updateQueryState(u.targetId,f?"current":"not-current")}if(h){s.push(h);const f=Vv.As(u.targetId,h);r.push(f)}})))})),await Promise.all(a),n.Pu.H_(s),await(async function(u,h){const f=Gt(u);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",(m=>lt.forEach(h,(y=>lt.forEach(y.Es,(T=>f.persistence.referenceDelegate.addReference(m,y.targetId,T))).next((()=>lt.forEach(y.ds,(T=>f.persistence.referenceDelegate.removeReference(m,y.targetId,T)))))))))}catch(m){if(!Rc(m))throw m;yt(Bv,"Failed to update sequence numbers: "+m)}for(const m of h){const y=m.targetId;if(!m.fromCache){const T=f.Ms.get(y),S=T.snapshotVersion,b=T.withLastLimboFreeSnapshotVersion(S);f.Ms=f.Ms.insert(y,b)}}})(n.localStore,r))}async function wB(i,t){const e=Gt(i);if(!e.currentUser.isEqual(t)){yt(Wv,"User change. New user:",t.toKey());const n=await r1(e.localStore,t);e.currentUser=t,(function(r,a){r.mu.forEach((c=>{c.forEach((u=>{u.reject(new bt(ut.CANCELLED,a))}))})),r.mu.clear()})(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await Bh(e,n.Ls)}}function bB(i,t){const e=Gt(i),n=e.Au.get(t);if(n&&n.hu)return Zt().add(n.key);{let s=Zt();const r=e.Iu.get(t);if(!r)return s;for(const a of r){const c=e.Tu.get(a);s=s.unionWith(c.view.nu)}return s}}function b1(i){const t=Gt(i);return t.remoteStore.remoteSyncer.applyRemoteEvent=T1.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=bB.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=EB.bind(null,t),t.Pu.H_=lB.bind(null,t.eventManager),t.Pu.yu=cB.bind(null,t.eventManager),t}function CB(i){const t=Gt(i);return t.remoteStore.remoteSyncer.applySuccessfulWrite=TB.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=AB.bind(null,t),t}class Tp{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=Zp(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,e){return null}Mu(t,e){return null}vu(t){return PV(this.persistence,new IV,t.initialUser,this.serializer)}Cu(t){return new s1(Uv.mi,this.serializer)}Du(t){return new UV}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Tp.provider={build:()=>new Tp};class IB extends Tp{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){ue(this.persistence.referenceDelegate instanceof vp,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new dV(n,t.asyncQueue,e)}Cu(t){const e=this.cacheSizeBytes!==void 0?si.withCacheSize(this.cacheSizeBytes):si.DEFAULT;return new s1((n=>vp.mi(n,e)),this.serializer)}}class b_{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>Tw(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=wB.bind(null,this.syncEngine),await rB(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return(function(){return new aB})()}createDatastore(t){const e=Zp(t.databaseInfo.databaseId),n=(function(r){return new GV(r)})(t.databaseInfo);return(function(r,a,c,u){return new YV(r,a,c,u)})(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return(function(n,s,r,a,c){return new KV(n,s,r,a,c)})(this.localStore,this.datastore,t.asyncQueue,(e=>Tw(this.syncEngine,e,0)),(function(){return mw.v()?new mw:new VV})())}createSyncEngine(t,e){return(function(s,r,a,c,u,h,f){const m=new fB(s,r,a,c,u,h);return f&&(m.gu=!0),m})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){await(async function(e){const n=Gt(e);yt(La,"RemoteStore shutting down."),n.Ea.add(5),await Vh(n),n.Aa.shutdown(),n.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}b_.provider={build:()=>new b_};class C1{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):Sr("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout((()=>{this.muted||t(e)}),0)}}const xo="FirestoreClient";class RB{constructor(t,e,n,s,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=Un.UNAUTHENTICATED,this.clientId=wv.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(n,(async a=>{yt(xo,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(n,(a=>(yt(xo,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new wo;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=$v(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Uy(i,t){i.asyncQueue.verifyOperationInProgress(),yt(xo,"Initializing OfflineComponentProvider");const e=i.configuration;await t.initialize(e);let n=e.initialUser;i.setCredentialChangeListener((async s=>{n.isEqual(s)||(await r1(t.localStore,s),n=s)})),t.persistence.setDatabaseDeletedListener((()=>i.terminate())),i._offlineComponents=t}async function Sw(i,t){i.asyncQueue.verifyOperationInProgress();const e=await MB(i);yt(xo,"Initializing OnlineComponentProvider"),await t.initialize(e,i.configuration),i.setCredentialChangeListener((n=>yw(t.remoteStore,n))),i.setAppCheckTokenChangeListener(((n,s)=>yw(t.remoteStore,s))),i._onlineComponents=t}async function MB(i){if(!i._offlineComponents)if(i._uninitializedComponentsProvider){yt(xo,"Using user provided OfflineComponentProvider");try{await Uy(i,i._uninitializedComponentsProvider._offline)}catch(t){const e=t;if(!(function(s){return s.name==="FirebaseError"?s.code===ut.FAILED_PRECONDITION||s.code===ut.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(e))throw e;dc("Error using user provided cache. Falling back to memory cache: "+e),await Uy(i,new Tp)}}else yt(xo,"Using default OfflineComponentProvider"),await Uy(i,new IB(void 0));return i._offlineComponents}async function I1(i){return i._onlineComponents||(i._uninitializedComponentsProvider?(yt(xo,"Using user provided OnlineComponentProvider"),await Sw(i,i._uninitializedComponentsProvider._online)):(yt(xo,"Using default OnlineComponentProvider"),await Sw(i,new b_))),i._onlineComponents}function PB(i){return I1(i).then((t=>t.syncEngine))}async function C_(i){const t=await I1(i),e=t.eventManager;return e.onListen=pB.bind(null,t.syncEngine),e.onUnlisten=yB.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=mB.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=_B.bind(null,t.syncEngine),e}function xB(i,t,e={}){const n=new wo;return i.asyncQueue.enqueueAndForget((async()=>(function(r,a,c,u,h){const f=new C1({next:y=>{f.Nu(),a.enqueueAndForget((()=>g1(r,m)));const T=y.docs.has(c);!T&&y.fromCache?h.reject(new bt(ut.UNAVAILABLE,"Failed to get document because the client is offline.")):T&&y.fromCache&&u&&u.source==="server"?h.reject(new bt(ut.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(y)},error:y=>h.reject(y)}),m=new y1(Wp(c.path),f,{includeMetadataChanges:!0,qa:!0});return m1(r,m)})(await C_(i),i.asyncQueue,t,e,n))),n.promise}function R1(i){const t={};return i.timeoutSeconds!==void 0&&(t.timeoutSeconds=i.timeoutSeconds),t}const ww=new Map;const M1="firestore.googleapis.com",bw=!0;class Cw{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new bt(ut.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=M1,this.ssl=bw}else this.host=t.host,this.ssl=t.ssl??bw;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=i1;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<uV)throw new bt(ut.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}WO("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=R1(t.experimentalLongPollingOptions??{}),(function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new bt(ut.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new bt(ut.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new bt(ut.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(function(n,s){return n.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Xv{constructor(t,e,n,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Cw({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new bt(ut.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new bt(ut.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Cw(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=(function(n){if(!n)return new OO;switch(n.type){case"firstParty":return new FO(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new bt(ut.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(e){const n=ww.get(e);n&&(yt("ComponentProvider","Removing Datastore"),ww.delete(e),n.terminate())})(this),Promise.resolve()}}function DB(i,t,e,n={}){i=ts(i,Xv);const s=Fa(t),r=i._getSettings(),a={...r,emulatorOptions:i._getEmulatorOptions()},c=`${t}:${e}`;s&&(uv(`https://${c}`),hv("Firestore",!0)),r.host!==M1&&r.host!==c&&dc("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u={...r,host:c,ssl:s,emulatorOptions:n};if(!Er(u,a)&&(i._setSettings(u),n.mockUserToken)){let h,f;if(typeof n.mockUserToken=="string")h=n.mockUserToken,f=Un.MOCK_USER;else{h=SI(n.mockUserToken,i._app?.options.projectId);const m=n.mockUserToken.sub||n.mockUserToken.user_id;if(!m)throw new bt(ut.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new Un(m)}i._authCredentials=new UO(new gR(h,f))}}class nm{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new nm(this.firestore,t,this._query)}}class sn{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Th(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new sn(this.firestore,t,this._key)}toJSON(){return{type:sn._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,n){if(Lh(e,sn._jsonSchema))return new sn(t,n||null,new Mt(De.fromString(e.referencePath)))}}sn._jsonSchemaVersion="firestore/documentReference/1.0",sn._jsonSchema={type:nn("string",sn._jsonSchemaVersion),referencePath:nn("string")};class Th extends nm{constructor(t,e,n){super(t,e,Wp(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new sn(this.firestore,null,new Mt(t))}withConverter(t){return new Th(this.firestore,t,this._path)}}function $e(i,t,...e){if(i=vn(i),arguments.length===1&&(t=wv.newId()),YO("doc","path",t),i instanceof Xv){const n=De.fromString(t,...e);return FS(n),new sn(i,null,new Mt(n))}{if(!(i instanceof sn||i instanceof Th))throw new bt(ut.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=i._path.child(De.fromString(t,...e));return FS(n),new sn(i.firestore,i instanceof Th?i.converter:null,new Mt(n))}}const Iw="AsyncQueue";class Rw{constructor(t=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new a1(this,"async_queue_retry"),this._c=()=>{const n=Oy();n&&yt(Iw,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=t;const e=Oy();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const e=Oy();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise((()=>{}));const e=new wo;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Xu.push(t),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!Rc(t))throw t;yt(Iw,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(t){const e=this.ac.then((()=>(this.rc=!0,t().catch((n=>{throw this.nc=n,this.rc=!1,Sr("INTERNAL UNHANDLED ERROR: ",Mw(n)),n})).then((n=>(this.rc=!1,n))))));return this.ac=e,e}enqueueAfterDelay(t,e,n){this.uc(),this.oc.indexOf(t)>-1&&(e=0);const s=zv.createAndSchedule(this,t,e,n,(r=>this.hc(r)));return this.tc.push(s),s}uc(){this.nc&&kt(47125,{Pc:Mw(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do t=this.ac,await t;while(t!==this.ac)}Ic(t){for(const e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then((()=>{this.tc.sort(((e,n)=>e.targetTimeMs-n.targetTimeMs));for(const e of this.tc)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Tc()}))}dc(t){this.oc.push(t)}hc(t){const e=this.tc.indexOf(t);this.tc.splice(e,1)}}function Mw(i){let t=i.message||"";return i.stack&&(t=i.stack.includes(i.message)?i.stack:i.message+`
`+i.stack),t}function Pw(i){return(function(e,n){if(typeof e!="object"||e===null)return!1;const s=e;for(const r of n)if(r in s&&typeof s[r]=="function")return!0;return!1})(i,["next","error","complete"])}class Oa extends Xv{constructor(t,e,n,s){super(t,e,n,s),this.type="firestore",this._queue=new Rw,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new Rw(t),this._firestoreClient=void 0,await t}}}function NB(i,t){const e=typeof i=="object"?i:pv(),n=typeof i=="string"?i:dp,s=Bp(e,"firestore").getImmediate({identifier:n});if(!s._initialized){const r=EI("firestore");r&&DB(s,...r)}return s}function Jv(i){if(i._terminated)throw new bt(ut.FAILED_PRECONDITION,"The client has already been terminated.");return i._firestoreClient||kB(i),i._firestoreClient}function kB(i){const t=i._freezeSettings(),e=(function(s,r,a,c){return new sU(s,r,a,c.host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,R1(c.experimentalLongPollingOptions),c.useFetchStreams,c.isUsingEmulator)})(i._databaseId,i._app?.options.appId||"",i._persistenceKey,t);i._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(i._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),i._firestoreClient=new RB(i._authCredentials,i._appCheckCredentials,i._queue,e,i._componentsProvider&&(function(s){const r=s?._online.build();return{_offline:s?._offline.build(r),_online:r}})(i._componentsProvider))}class Oi{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Oi(xn.fromBase64String(t))}catch(e){throw new bt(ut.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new Oi(xn.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:Oi._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(Lh(t,Oi._jsonSchema))return Oi.fromBase64String(t.bytes)}}Oi._jsonSchemaVersion="firestore/bytes/1.0",Oi._jsonSchema={type:nn("string",Oi._jsonSchemaVersion),bytes:nn("string")};class im{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new bt(ut.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Mn(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Fh{constructor(t){this._methodName=t}}class Ns{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new bt(ut.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new bt(ut.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return jt(this._lat,t._lat)||jt(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ns._jsonSchemaVersion}}static fromJSON(t){if(Lh(t,Ns._jsonSchema))return new Ns(t.latitude,t.longitude)}}Ns._jsonSchemaVersion="firestore/geoPoint/1.0",Ns._jsonSchema={type:nn("string",Ns._jsonSchemaVersion),latitude:nn("number"),longitude:nn("number")};class ks{constructor(t){this._values=(t||[]).map((e=>e))}toArray(){return this._values.map((t=>t))}isEqual(t){return(function(n,s){if(n.length!==s.length)return!1;for(let r=0;r<n.length;++r)if(n[r]!==s[r])return!1;return!0})(this._values,t._values)}toJSON(){return{type:ks._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(Lh(t,ks._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every((e=>typeof e=="number")))return new ks(t.vectorValues);throw new bt(ut.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}ks._jsonSchemaVersion="firestore/vectorValue/1.0",ks._jsonSchema={type:nn("string",ks._jsonSchemaVersion),vectorValues:nn("object")};const LB=/^__.*__$/;class OB{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return this.fieldMask!==null?new Vo(t,this.data,this.fieldMask,e,this.fieldTransforms):new Oh(t,this.data,e,this.fieldTransforms)}}class P1{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Vo(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function x1(i){switch(i){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw kt(40011,{Ac:i})}}class sm{constructor(t,e,n,s,r,a){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=s,r===void 0&&this.Rc(),this.fieldTransforms=r||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new sm({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(t){const e=this.path?.child(t),n=this.Vc({path:e,fc:!1});return n.gc(t),n}yc(t){const e=this.path?.child(t),n=this.Vc({path:e,fc:!1});return n.Rc(),n}wc(t){return this.Vc({path:void 0,fc:!0})}Sc(t){return Ap(t,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return this.fieldMask.find((e=>t.isPrefixOf(e)))!==void 0||this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))!==void 0}Rc(){if(this.path)for(let t=0;t<this.path.length;t++)this.gc(this.path.get(t))}gc(t){if(t.length===0)throw this.Sc("Document fields must not be empty");if(x1(this.Ac)&&LB.test(t))throw this.Sc('Document fields cannot begin and end with "__"')}}class UB{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Zp(t)}Cc(t,e,n,s=!1){return new sm({Ac:t,methodName:e,Dc:n,path:Mn.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function D1(i){const t=i._freezeSettings(),e=Zp(i._databaseId);return new UB(i._databaseId,!!t.ignoreUndefinedProperties,e)}function VB(i,t,e,n,s,r={}){const a=i.Cc(r.merge||r.mergeFields?2:0,t,e,s);Zv("Data must be an object, but it was:",a,n);const c=k1(n,a);let u,h;if(r.merge)u=new _i(a.fieldMask),h=a.fieldTransforms;else if(r.mergeFields){const f=[];for(const m of r.mergeFields){const y=I_(t,m,e);if(!a.contains(y))throw new bt(ut.INVALID_ARGUMENT,`Field '${y}' is specified in your field mask but missing from your input data.`);O1(f,y)||f.push(y)}u=new _i(f),h=a.fieldTransforms.filter((m=>u.covers(m.field)))}else u=null,h=a.fieldTransforms;return new OB(new ri(c),u,h)}class Hh extends Fh{_toFieldTransform(t){if(t.Ac!==2)throw t.Ac===1?t.Sc(`${this._methodName}() can only appear at the top level of your update data`):t.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof Hh}}function N1(i,t,e){return new sm({Ac:3,Dc:t.settings.Dc,methodName:i._methodName,fc:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class Qv extends Fh{constructor(t,e){super(t),this.vc=e}_toFieldTransform(t){const e=N1(this,t,!0),n=this.vc.map((r=>Pc(r,e))),s=new gc(n);return new zR(t.path,s)}isEqual(t){return t instanceof Qv&&Er(this.vc,t.vc)}}class jv extends Fh{constructor(t,e){super(t),this.vc=e}_toFieldTransform(t){const e=N1(this,t,!0),n=this.vc.map((r=>Pc(r,e))),s=new yc(n);return new zR(t.path,s)}isEqual(t){return t instanceof jv&&Er(this.vc,t.vc)}}function BB(i,t,e,n){const s=i.Cc(1,t,e);Zv("Data must be an object, but it was:",s,n);const r=[],a=ri.empty();Uo(n,((u,h)=>{const f=tE(t,u,e);h=vn(h);const m=s.yc(f);if(h instanceof Hh)r.push(f);else{const y=Pc(h,m);y!=null&&(r.push(f),a.set(f,y))}}));const c=new _i(r);return new P1(a,c,s.fieldTransforms)}function FB(i,t,e,n,s,r){const a=i.Cc(1,t,e),c=[I_(t,n,e)],u=[s];if(r.length%2!=0)throw new bt(ut.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let y=0;y<r.length;y+=2)c.push(I_(t,r[y])),u.push(r[y+1]);const h=[],f=ri.empty();for(let y=c.length-1;y>=0;--y)if(!O1(h,c[y])){const T=c[y];let S=u[y];S=vn(S);const b=a.yc(T);if(S instanceof Hh)h.push(T);else{const C=Pc(S,b);C!=null&&(h.push(T),f.set(T,C))}}const m=new _i(h);return new P1(f,m,a.fieldTransforms)}function Pc(i,t){if(L1(i=vn(i)))return Zv("Unsupported field value:",t,i),k1(i,t);if(i instanceof Fh)return(function(n,s){if(!x1(s.Ac))throw s.Sc(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${n._methodName}() is not currently supported inside arrays`);const r=n._toFieldTransform(s);r&&s.fieldTransforms.push(r)})(i,t),null;if(i===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),i instanceof Array){if(t.settings.fc&&t.Ac!==4)throw t.Sc("Nested arrays are not supported");return(function(n,s){const r=[];let a=0;for(const c of n){let u=Pc(c,s.wc(a));u==null&&(u={nullValue:"NULL_VALUE"}),r.push(u),a++}return{arrayValue:{values:r}}})(i,t)}return(function(n,s){if((n=vn(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return RU(s.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const r=we.fromDate(n);return{timestampValue:_p(s.serializer,r)}}if(n instanceof we){const r=new we(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:_p(s.serializer,r)}}if(n instanceof Ns)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Oi)return{bytesValue:JR(s.serializer,n._byteString)};if(n instanceof sn){const r=s.databaseId,a=n.firestore._databaseId;if(!a.isEqual(r))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:Lv(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof ks)return(function(a,c){return{mapValue:{fields:{[bR]:{stringValue:CR},[fp]:{arrayValue:{values:a.toArray().map((h=>{if(typeof h!="number")throw c.Sc("VectorValues must only contain numeric values.");return xv(c.serializer,h)}))}}}}}})(n,s);throw s.Sc(`Unsupported field value: ${bv(n)}`)})(i,t)}function k1(i,t){const e={};return vR(i)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Uo(i,((n,s)=>{const r=Pc(s,t.mc(n));r!=null&&(e[n]=r)})),{mapValue:{fields:e}}}function L1(i){return!(typeof i!="object"||i===null||i instanceof Array||i instanceof Date||i instanceof we||i instanceof Ns||i instanceof Oi||i instanceof sn||i instanceof Fh||i instanceof ks)}function Zv(i,t,e){if(!L1(e)||!yR(e)){const n=bv(e);throw n==="an object"?t.Sc(i+" a custom object"):t.Sc(i+" "+n)}}function I_(i,t,e){if((t=vn(t))instanceof im)return t._internalPath;if(typeof t=="string")return tE(i,t);throw Ap("Field path arguments must be of type string or ",i,!1,void 0,e)}const HB=new RegExp("[~\\*/\\[\\]]");function tE(i,t,e){if(t.search(HB)>=0)throw Ap(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,i,!1,void 0,e);try{return new im(...t.split("."))._internalPath}catch{throw Ap(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,i,!1,void 0,e)}}function Ap(i,t,e,n,s){const r=n&&!n.isEmpty(),a=s!==void 0;let c=`Function ${t}() called with invalid data`;e&&(c+=" (via `toFirestore()`)"),c+=". ";let u="";return(r||a)&&(u+=" (found",r&&(u+=` in field ${n}`),a&&(u+=` in document ${s}`),u+=")"),new bt(ut.INVALID_ARGUMENT,c+i+u)}function O1(i,t){return i.some((e=>e.isEqual(t)))}class U1{constructor(t,e,n,s,r){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new sn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new GB(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(V1("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}}class GB extends U1{data(){return super.data()}}function V1(i,t){return typeof t=="string"?tE(i,t):t instanceof im?t._internalPath:t._delegate._internalPath}function qB(i){if(i.limitType==="L"&&i.explicitOrderBy.length===0)throw new bt(ut.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class zB{convertValue(t,e="none"){switch(Mo(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ke(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Ro(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw kt(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return Uo(t,((s,r)=>{n[s]=this.convertValue(r,e)})),n}convertVectorValue(t){const e=t.fields?.[fp].arrayValue?.values?.map((n=>Ke(n.doubleValue)));return new ks(e)}convertGeoPoint(t){return new Ns(Ke(t.latitude),Ke(t.longitude))}convertArray(t,e){return(t.values||[]).map((n=>this.convertValue(n,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=$p(t);return n==null?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(_h(t));default:return null}}convertTimestamp(t){const e=Io(t);return new we(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=De.fromString(t);ue(n1(n),9688,{name:t});const s=new vh(n.get(1),n.get(3)),r=new Mt(n.popFirst(5));return s.isEqual(e)||Sr(`Document ${r} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),r}}function $B(i,t,e){let n;return n=i?i.toFirestore(t):t,n}class eh{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Pa extends U1{constructor(t,e,n,s,r,a){super(t,e,n,s,a),this._firestore=t,this._firestoreImpl=t,this.metadata=r}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Kf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(V1("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new bt(ut.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,e={};return e.type=Pa._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}}Pa._jsonSchemaVersion="firestore/documentSnapshot/1.0",Pa._jsonSchema={type:nn("string",Pa._jsonSchemaVersion),bundleSource:nn("string","DocumentSnapshot"),bundleName:nn("string"),bundle:nn("string")};class Kf extends Pa{data(t={}){return super.data(t)}}class ic{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new eh(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Kf(this._firestore,this._userDataWriter,n.key,n,new eh(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new bt(ut.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=(function(s,r){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((c=>{const u=new Kf(s._firestore,s._userDataWriter,c.doc.key,c.doc,new eh(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);return c.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((c=>r||c.type!==3)).map((c=>{const u=new Kf(s._firestore,s._userDataWriter,c.doc.key,c.doc,new eh(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);let h=-1,f=-1;return c.type!==0&&(h=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),c.type!==1&&(a=a.add(c.doc),f=a.indexOf(c.doc.key)),{type:YB(c.type),doc:u,oldIndex:h,newIndex:f}}))}})(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new bt(ut.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=ic._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=wv.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const e=[],n=[],s=[];return this.docs.forEach((r=>{r._document!==null&&(e.push(r._document),n.push(this._userDataWriter.convertObjectMap(r._document.data.value.mapValue.fields,"previous")),s.push(r.ref.path))})),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function YB(i){switch(i){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return kt(61501,{type:i})}}function Gl(i){i=ts(i,sn);const t=ts(i.firestore,Oa);return xB(Jv(t),i._key).then((e=>H1(t,i,e)))}ic._jsonSchemaVersion="firestore/querySnapshot/1.0",ic._jsonSchema={type:nn("string",ic._jsonSchemaVersion),bundleSource:nn("string","QuerySnapshot"),bundleName:nn("string"),bundle:nn("string")};class B1 extends zB{constructor(t){super(),this.firestore=t}convertBytes(t){return new Oi(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new sn(this.firestore,null,e)}}function F1(i,t,e){i=ts(i,sn);const n=ts(i.firestore,Oa),s=$B(i.converter,t);return eE(n,[VB(D1(n),"setDoc",i._key,s,i.converter!==null,e).toMutation(i._key,es.none())])}function pi(i,t,e,...n){i=ts(i,sn);const s=ts(i.firestore,Oa),r=D1(s);let a;return a=typeof(t=vn(t))=="string"||t instanceof im?FB(r,"updateDoc",i._key,t,e,n):BB(r,"updateDoc",i._key,t),eE(s,[a.toMutation(i._key,es.exists(!0))])}function WB(i){return eE(ts(i.firestore,Oa),[new Dv(i._key,es.none())])}function xw(i,...t){i=vn(i);let e={includeMetadataChanges:!1,source:"default"},n=0;typeof t[n]!="object"||Pw(t[n])||(e=t[n++]);const s={includeMetadataChanges:e.includeMetadataChanges,source:e.source};if(Pw(t[n])){const u=t[n];t[n]=u.next?.bind(u),t[n+1]=u.error?.bind(u),t[n+2]=u.complete?.bind(u)}let r,a,c;if(i instanceof sn)a=ts(i.firestore,Oa),c=Wp(i._key.path),r={next:u=>{t[n]&&t[n](H1(a,i,u))},error:t[n+1],complete:t[n+2]};else{const u=ts(i,nm);a=ts(u.firestore,Oa),c=u._query;const h=new B1(a);r={next:f=>{t[n]&&t[n](new ic(a,h,u,f))},error:t[n+1],complete:t[n+2]},qB(i._query)}return(function(h,f,m,y){const T=new C1(y),S=new y1(f,T,m);return h.asyncQueue.enqueueAndForget((async()=>m1(await C_(h),S))),()=>{T.Nu(),h.asyncQueue.enqueueAndForget((async()=>g1(await C_(h),S)))}})(Jv(a),c,s,r)}function eE(i,t){return(function(n,s){const r=new wo;return n.asyncQueue.enqueueAndForget((async()=>vB(await PB(n),s,r))),r.promise})(Jv(i),t)}function H1(i,t,e){const n=e.docs.get(t._key),s=new B1(i);return new Pa(i,s,t._key,n,new eh(e.hasPendingWrites,e.fromCache),t.converter)}function KB(){return new Hh("deleteField")}function Vy(...i){return new Qv("arrayUnion",i)}function By(...i){return new jv("arrayRemove",i)}(function(t,e=!0){(function(s){Cc=s})(Ha),xa(new bo("firestore",((n,{instanceIdentifier:s,options:r})=>{const a=n.getProvider("app").getImmediate(),c=new Oa(new VO(n.getProvider("auth-internal")),new HO(a,n.getProvider("app-check-internal")),(function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new bt(ut.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new vh(h.options.projectId,f)})(a,s),a);return r={useFetchStreams:e,...r},c._setSettings(r),c}),"PUBLIC").setMultipleInstances(!0)),Rs(OS,US,t),Rs(OS,US,"esm2020")})();const G1="firebasestorage.googleapis.com",XB="storageBucket",JB=120*1e3,QB=600*1e3;class Gs extends Hs{constructor(t,e,n=0){super(Fy(t),`Firebase Storage: ${e} (${Fy(t)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Gs.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return Fy(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Us;(function(i){i.UNKNOWN="unknown",i.OBJECT_NOT_FOUND="object-not-found",i.BUCKET_NOT_FOUND="bucket-not-found",i.PROJECT_NOT_FOUND="project-not-found",i.QUOTA_EXCEEDED="quota-exceeded",i.UNAUTHENTICATED="unauthenticated",i.UNAUTHORIZED="unauthorized",i.UNAUTHORIZED_APP="unauthorized-app",i.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",i.INVALID_CHECKSUM="invalid-checksum",i.CANCELED="canceled",i.INVALID_EVENT_NAME="invalid-event-name",i.INVALID_URL="invalid-url",i.INVALID_DEFAULT_BUCKET="invalid-default-bucket",i.NO_DEFAULT_BUCKET="no-default-bucket",i.CANNOT_SLICE_BLOB="cannot-slice-blob",i.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",i.NO_DOWNLOAD_URL="no-download-url",i.INVALID_ARGUMENT="invalid-argument",i.INVALID_ARGUMENT_COUNT="invalid-argument-count",i.APP_DELETED="app-deleted",i.INVALID_ROOT_OPERATION="invalid-root-operation",i.INVALID_FORMAT="invalid-format",i.INTERNAL_ERROR="internal-error",i.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Us||(Us={}));function Fy(i){return"storage/"+i}function jB(){const i="An unknown error occurred, please check the error payload for server response.";return new Gs(Us.UNKNOWN,i)}function ZB(){return new Gs(Us.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function tF(){return new Gs(Us.CANCELED,"User canceled the upload/download.")}function eF(i){return new Gs(Us.INVALID_URL,"Invalid URL '"+i+"'.")}function nF(i){return new Gs(Us.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+i+"'.")}function Dw(i){return new Gs(Us.INVALID_ARGUMENT,i)}function q1(){return new Gs(Us.APP_DELETED,"The Firebase app was deleted.")}function iF(i){return new Gs(Us.INVALID_ROOT_OPERATION,"The operation '"+i+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}class Zi{constructor(t,e){this.bucket=t,this.path_=e}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let n;try{n=Zi.makeFromUrl(t,e)}catch{return new Zi(t,"")}if(n.path==="")return n;throw nF(t)}static makeFromUrl(t,e){let n=null;const s="([A-Za-z0-9.\\-_]+)";function r(H){H.path.charAt(H.path.length-1)==="/"&&(H.path_=H.path_.slice(0,-1))}const a="(/(.*))?$",c=new RegExp("^gs://"+s+a,"i"),u={bucket:1,path:3};function h(H){H.path_=decodeURIComponent(H.path)}const f="v[A-Za-z0-9_]+",m=e.replace(/[.]/g,"\\."),y="(/([^?#]*).*)?$",T=new RegExp(`^https?://${m}/${f}/b/${s}/o${y}`,"i"),S={bucket:1,path:3},b=e===G1?"(?:storage.googleapis.com|storage.cloud.google.com)":e,C="([^?#]*)",I=new RegExp(`^https?://${b}/${s}/${C}`,"i"),P=[{regex:c,indices:u,postModify:r},{regex:T,indices:S,postModify:h},{regex:I,indices:{bucket:1,path:2},postModify:h}];for(let H=0;H<P.length;H++){const F=P[H],G=F.regex.exec(t);if(G){const N=G[F.indices.bucket];let x=G[F.indices.path];x||(x=""),n=new Zi(N,x),F.postModify(n);break}}if(n==null)throw eF(t);return n}}class sF{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}function rF(i,t,e){let n=1,s=null,r=null,a=!1,c=0;function u(){return c===2}let h=!1;function f(...C){h||(h=!0,t.apply(null,C))}function m(C){s=setTimeout(()=>{s=null,i(T,u())},C)}function y(){r&&clearTimeout(r)}function T(C,...I){if(h){y();return}if(C){y(),f.call(null,C,...I);return}if(u()||a){y(),f.call(null,C,...I);return}n<64&&(n*=2);let P;c===1?(c=2,P=0):P=(n+Math.random())*1e3,m(P)}let S=!1;function b(C){S||(S=!0,y(),!h&&(s!==null?(C||(c=2),clearTimeout(s),m(0)):C||(c=1)))}return m(0),r=setTimeout(()=>{a=!0,b(!0)},e),b}function oF(i){i(!1)}function aF(i){return i!==void 0}function Nw(i,t,e,n){if(n<t)throw Dw(`Invalid value for '${i}'. Expected ${t} or greater.`);if(n>e)throw Dw(`Invalid value for '${i}'. Expected ${e} or less.`)}function lF(i){const t=encodeURIComponent;let e="?";for(const n in i)if(i.hasOwnProperty(n)){const s=t(n)+"="+t(i[n]);e=e+s+"&"}return e=e.slice(0,-1),e}var Sp;(function(i){i[i.NO_ERROR=0]="NO_ERROR",i[i.NETWORK_ERROR=1]="NETWORK_ERROR",i[i.ABORT=2]="ABORT"})(Sp||(Sp={}));function cF(i,t){const e=i>=500&&i<600,s=[408,429].indexOf(i)!==-1,r=t.indexOf(i)!==-1;return e||s||r}class uF{constructor(t,e,n,s,r,a,c,u,h,f,m,y=!0,T=!1){this.url_=t,this.method_=e,this.headers_=n,this.body_=s,this.successCodes_=r,this.additionalRetryCodes_=a,this.callback_=c,this.errorCallback_=u,this.timeout_=h,this.progressCallback_=f,this.connectionFactory_=m,this.retry=y,this.isUsingEmulator=T,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((S,b)=>{this.resolve_=S,this.reject_=b,this.start_()})}start_(){const t=(n,s)=>{if(s){n(!1,new Tf(!1,null,!0));return}const r=this.connectionFactory_();this.pendingConnection_=r;const a=c=>{const u=c.loaded,h=c.lengthComputable?c.total:-1;this.progressCallback_!==null&&this.progressCallback_(u,h)};this.progressCallback_!==null&&r.addUploadProgressListener(a),r.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&r.removeUploadProgressListener(a),this.pendingConnection_=null;const c=r.getErrorCode()===Sp.NO_ERROR,u=r.getStatus();if(!c||cF(u,this.additionalRetryCodes_)&&this.retry){const f=r.getErrorCode()===Sp.ABORT;n(!1,new Tf(!1,null,f));return}const h=this.successCodes_.indexOf(u)!==-1;n(!0,new Tf(h,r))})},e=(n,s)=>{const r=this.resolve_,a=this.reject_,c=s.connection;if(s.wasSuccessCode)try{const u=this.callback_(c,c.getResponse());aF(u)?r(u):r()}catch(u){a(u)}else if(c!==null){const u=jB();u.serverResponse=c.getErrorText(),this.errorCallback_?a(this.errorCallback_(c,u)):a(u)}else if(s.canceled){const u=this.appDelete_?q1():tF();a(u)}else{const u=ZB();a(u)}};this.canceled_?e(!1,new Tf(!1,null,!0)):this.backoffId_=rF(t,e,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&oF(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Tf{constructor(t,e,n){this.wasSuccessCode=t,this.connection=e,this.canceled=!!n}}function hF(i,t){t!==null&&t.length>0&&(i.Authorization="Firebase "+t)}function dF(i,t){i["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function fF(i,t){t&&(i["X-Firebase-GMPID"]=t)}function pF(i,t){t!==null&&(i["X-Firebase-AppCheck"]=t)}function mF(i,t,e,n,s,r,a=!0,c=!1){const u=lF(i.urlParams),h=i.url+u,f=Object.assign({},i.headers);return fF(f,t),hF(f,e),dF(f,r),pF(f,n),new uF(h,i.method,f,i.body,i.successCodes,i.additionalRetryCodes,i.handler,i.errorHandler,i.timeout,i.progressCallback,s,a,c)}function gF(i){if(i.length===0)return null;const t=i.lastIndexOf("/");return t===-1?"":i.slice(0,t)}function yF(i){const t=i.lastIndexOf("/",i.length-2);return t===-1?i:i.slice(t+1)}class wp{constructor(t,e){this._service=t,e instanceof Zi?this._location=e:this._location=Zi.makeFromUrl(e,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,e){return new wp(t,e)}get root(){const t=new Zi(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return yF(this._location.path)}get storage(){return this._service}get parent(){const t=gF(this._location.path);if(t===null)return null;const e=new Zi(this._location.bucket,t);return new wp(this._service,e)}_throwIfRoot(t){if(this._location.path==="")throw iF(t)}}function kw(i,t){const e=t?.[XB];return e==null?null:Zi.makeFromBucketSpec(e,i)}function _F(i,t,e,n={}){i.host=`${t}:${e}`;const s=Fa(t);s&&(uv(`https://${i.host}/b`),hv("Storage",!0)),i._isUsingEmulator=!0,i._protocol=s?"https":"http";const{mockUserToken:r}=n;r&&(i._overrideAuthToken=typeof r=="string"?r:SI(r,i.app.options.projectId))}class vF{constructor(t,e,n,s,r,a=!1){this.app=t,this._authProvider=e,this._appCheckProvider=n,this._url=s,this._firebaseVersion=r,this._isUsingEmulator=a,this._bucket=null,this._host=G1,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=JB,this._maxUploadRetryTime=QB,this._requests=new Set,s!=null?this._bucket=Zi.makeFromBucketSpec(s,this._host):this._bucket=kw(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=Zi.makeFromBucketSpec(this._url,t):this._bucket=kw(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){Nw("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){Nw("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const e=await t.getToken();if(e!==null)return e.accessToken}return null}async _getAppCheckToken(){if(yi(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new wp(this,t)}_makeRequest(t,e,n,s,r=!0){if(this._deleted)return new sF(q1());{const a=mF(t,this._appId,n,s,e,this._firebaseVersion,r,this._isUsingEmulator);return this._requests.add(a),a.getPromise().then(()=>this._requests.delete(a),()=>this._requests.delete(a)),a}}async makeRequestWithTokens(t,e){const[n,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,e,n,s).getPromise()}}const Lw="@firebase/storage",Ow="0.14.0";const z1="storage";function EF(i=pv(),t){i=vn(i);const n=Bp(i,z1).getImmediate({identifier:t}),s=EI("storage");return s&&TF(n,...s),n}function TF(i,t,e,n={}){_F(i,t,e,n)}function AF(i,{instanceIdentifier:t}){const e=i.getProvider("app").getImmediate(),n=i.getProvider("auth-internal"),s=i.getProvider("app-check-internal");return new vF(e,n,s,t,Ha)}function SF(){xa(new bo(z1,AF,"PUBLIC").setMultipleInstances(!0)),Rs(Lw,Ow,""),Rs(Lw,Ow,"esm2020")}SF();const wF={apiKey:"AIzaSyAYqDAlqrPjonbsx-I7NZ1lQ4RlBww0uko",authDomain:"notify-f1486.firebaseapp.com",projectId:"notify-f1486",storageBucket:"notify-f1486.firebasestorage.app",messagingSenderId:"697164444805",appId:"1:697164444805:web:8e3afa3fce4b8aa126a5ec",measurementId:"G-F9FD34F7BD"},nE=CI(wF),Ec=kO(nE),Ye=NB(nE);EF(nE);async function bF(i,t,e,n){try{let s;return i=="signup"?(s=(await _2(Ec,e,n)).user,await F1($e(Ye,"users",s.uid),{username:t,email:e,uid:s.uid})):i=="login"&&(s=(await v2(Ec,e,n)).user),"success"}catch(s){return s.code}}async function CF(){if(!Ec.currentUser)throw new Error("No user is logged in");const i=await Gl($e(Ye,"users",Ec.currentUser.uid));let t;return i.exists()?t=i.data():(t=null,console.error("User doc does not exist.")),t}function IF(){S2(Ec).then(()=>{}).catch(i=>{console.error("Error when signing out user:",i)})}const RF={"auth/email-already-exists":"Email already is already in use","auth/invalid-email":"Invalid email","auth/missing-email":"Missing email","auth/missing-password":"Missing password","auth/invalid-credential":"Invalid credential"};function MF(){const i=Op(),[t,e]=et.useState("login"),[n,s]=et.useState(null),[r,a]=et.useState(!1),[c,u]=et.useState(""),[h,f]=et.useState(""),[m,y]=et.useState("");async function T(){if(t=="signup"&&c.length<3){s("Username must be at least three characters long");return}const S=await bF(t,c,h,m);S=="success"&&i("/main"),s(S)}return et.useEffect(()=>{if(!n)return;a(!0);const S=setTimeout(()=>a(!1),5e3),b=setTimeout(()=>s(null),6e3);return()=>{clearTimeout(S),clearTimeout(b)}},[n]),st.jsx("div",{id:"page",style:{backgroundImage:`url(${IN})`,backgroundSize:"cover"},children:st.jsxs("div",{id:"loginBox",children:[st.jsx("h1",{children:"Welcome"}),st.jsxs("div",{id:"usernameDiv",className:t=="signup"?"active":"inactive",children:[st.jsx("input",{type:"text",placeholder:"Username",value:c,onChange:S=>u(S.target.value)}),st.jsx(UN,{})]}),st.jsxs("div",{children:[st.jsx("input",{type:"text",placeholder:"Email",value:h,onChange:S=>f(S.target.value)}),st.jsx(ON,{})]}),st.jsxs("div",{children:[st.jsx("input",{type:"text",placeholder:"Password",value:m,onChange:S=>y(S.target.value)}),st.jsx(LN,{})]}),st.jsx("p",{className:r?"active":"inactive",children:RF[n]||n}),st.jsxs("div",{children:[st.jsx("button",{onClick:T,children:t=="login"?"Login":"Sign up"}),st.jsx("a",{onClick:()=>t=="login"?e("signup"):e("login"),children:t=="login"?"Sign up":"Login"})]})]})})}function Hy(i,t,e,n){function s(r){return r instanceof e?r:new e(function(a){a(r)})}return new(e||(e=Promise))(function(r,a){function c(f){try{h(n.next(f))}catch(m){a(m)}}function u(f){try{h(n.throw(f))}catch(m){a(m)}}function h(f){f.done?r(f.value):s(f.value).then(c,u)}h((n=n.apply(i,[])).next())})}function PF(i,t,e,n){if(typeof t=="function"?i!==t||!n:!t.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?n:e==="a"?n.call(i):n?n.value:t.get(i)}class en extends Error{constructor(t,e=0,n="",s=""){super(t),this.name="AppwriteException",this.message=t,this.code=e,this.type=n,this.response=s}}class fr{constructor(){this.config={endpoint:"https://cloud.appwrite.io/v1",endpointRealtime:"",project:"",jwt:"",locale:"",session:"",devkey:""},this.headers={"x-sdk-name":"Web","x-sdk-platform":"client","x-sdk-language":"web","x-sdk-version":"21.0.0","X-Appwrite-Response-Format":"1.8.0"},this.realtime={socket:void 0,timeout:void 0,heartbeat:void 0,url:"",channels:new Set,subscriptions:new Map,subscriptionsCounter:0,reconnect:!0,reconnectAttempts:0,lastMessage:void 0,connect:()=>{clearTimeout(this.realtime.timeout),this.realtime.timeout=window?.setTimeout(()=>{this.realtime.createSocket()},50)},getTimeout:()=>{switch(!0){case this.realtime.reconnectAttempts<5:return 1e3;case this.realtime.reconnectAttempts<15:return 5e3;case this.realtime.reconnectAttempts<100:return 1e4;default:return 6e4}},createHeartbeat:()=>{this.realtime.heartbeat&&clearTimeout(this.realtime.heartbeat),this.realtime.heartbeat=window?.setInterval(()=>{var t;(t=this.realtime.socket)===null||t===void 0||t.send(JSON.stringify({type:"ping"}))},2e4)},createSocket:()=>{var t,e,n;if(this.realtime.channels.size<1){this.realtime.reconnect=!1,(t=this.realtime.socket)===null||t===void 0||t.close();return}const s=new URLSearchParams;s.set("project",this.config.project),this.realtime.channels.forEach(a=>{s.append("channels[]",a)});const r=this.config.endpointRealtime+"/realtime?"+s.toString();(r!==this.realtime.url||!this.realtime.socket||((e=this.realtime.socket)===null||e===void 0?void 0:e.readyState)>WebSocket.OPEN)&&(this.realtime.socket&&((n=this.realtime.socket)===null||n===void 0?void 0:n.readyState)<WebSocket.CLOSING&&(this.realtime.reconnect=!1,this.realtime.socket.close()),this.realtime.url=r,this.realtime.socket=new WebSocket(r),this.realtime.socket.addEventListener("message",this.realtime.onMessage),this.realtime.socket.addEventListener("open",a=>{this.realtime.reconnectAttempts=0,this.realtime.createHeartbeat()}),this.realtime.socket.addEventListener("close",a=>{var c,u,h;if(!this.realtime.reconnect||((u=(c=this.realtime)===null||c===void 0?void 0:c.lastMessage)===null||u===void 0?void 0:u.type)==="error"&&((h=this.realtime)===null||h===void 0?void 0:h.lastMessage.data).code===1008){this.realtime.reconnect=!0;return}const f=this.realtime.getTimeout();console.error(`Realtime got disconnected. Reconnect will be attempted in ${f/1e3} seconds.`,a.reason),setTimeout(()=>{this.realtime.reconnectAttempts++,this.realtime.createSocket()},f)}))},onMessage:t=>{var e,n;try{const s=JSON.parse(t.data);switch(this.realtime.lastMessage=s,s.type){case"connected":const r=JSON.parse((e=window.localStorage.getItem("cookieFallback"))!==null&&e!==void 0?e:"{}"),a=r?.[`a_session_${this.config.project}`],c=s.data;a&&!c.user&&((n=this.realtime.socket)===null||n===void 0||n.send(JSON.stringify({type:"authentication",data:{session:a}})));break;case"event":let u=s.data;if(u?.channels){if(!u.channels.some(f=>this.realtime.channels.has(f)))return;this.realtime.subscriptions.forEach(f=>{u.channels.some(m=>f.channels.includes(m))&&setTimeout(()=>f.callback(u))})}break;case"pong":break;case"error":throw s.data;default:break}}catch(s){console.error(s)}},cleanUp:t=>{this.realtime.channels.forEach(e=>{t.includes(e)&&(Array.from(this.realtime.subscriptions).some(([s,r])=>r.channels.includes(e))||this.realtime.channels.delete(e))})}}}setEndpoint(t){if(!t.startsWith("http://")&&!t.startsWith("https://"))throw new en("Invalid endpoint URL: "+t);return this.config.endpoint=t,this.config.endpointRealtime=t.replace("https://","wss://").replace("http://","ws://"),this}setEndpointRealtime(t){if(!t.startsWith("ws://")&&!t.startsWith("wss://"))throw new en("Invalid realtime endpoint URL: "+t);return this.config.endpointRealtime=t,this}setProject(t){return this.headers["X-Appwrite-Project"]=t,this.config.project=t,this}setJWT(t){return this.headers["X-Appwrite-JWT"]=t,this.config.jwt=t,this}setLocale(t){return this.headers["X-Appwrite-Locale"]=t,this.config.locale=t,this}setSession(t){return this.headers["X-Appwrite-Session"]=t,this.config.session=t,this}setDevKey(t){return this.headers["X-Appwrite-Dev-Key"]=t,this.config.devkey=t,this}subscribe(t,e){let n=typeof t=="string"?[t]:t;n.forEach(r=>this.realtime.channels.add(r));const s=this.realtime.subscriptionsCounter++;return this.realtime.subscriptions.set(s,{channels:n,callback:e}),this.realtime.connect(),()=>{this.realtime.subscriptions.delete(s),this.realtime.cleanUp(n),this.realtime.connect()}}prepareRequest(t,e,n={},s={}){if(t=t.toUpperCase(),n=Object.assign({},this.headers,n),typeof window<"u"&&window.localStorage){const a=window.localStorage.getItem("cookieFallback");a&&(n["X-Fallback-Cookies"]=a)}let r={method:t,headers:n};if(n["X-Appwrite-Dev-Key"]===void 0&&(r.credentials="include"),t==="GET")for(const[a,c]of Object.entries(fr.flatten(s)))e.searchParams.append(a,c);else switch(n["content-type"]){case"application/json":r.body=JSON.stringify(s);break;case"multipart/form-data":const a=new FormData;for(const[c,u]of Object.entries(s))if(u instanceof File)a.append(c,u,u.name);else if(Array.isArray(u))for(const h of u)a.append(`${c}[]`,h);else a.append(c,u);r.body=a,delete n["content-type"];break}return{uri:e.toString(),options:r}}chunkedUpload(t,e,n={},s={},r){var a;return Hy(this,void 0,void 0,function*(){const[c,u]=(a=Object.entries(s).find(([m,y])=>y instanceof File))!==null&&a!==void 0?a:[];if(!u||!c)throw new Error("File not found in payload");if(u.size<=fr.CHUNK_SIZE)return yield this.call(t,e,n,s);let h=0,f=null;for(;h<u.size;){let m=h+fr.CHUNK_SIZE;m>=u.size&&(m=u.size),n["content-range"]=`bytes ${h}-${m-1}/${u.size}`;const y=u.slice(h,m);let T=Object.assign({},s);T[c]=new File([y],u.name),f=yield this.call(t,e,n,T),r&&typeof r=="function"&&r({$id:f.$id,progress:Math.round(m/u.size*100),sizeUploaded:m,chunksTotal:Math.ceil(u.size/fr.CHUNK_SIZE),chunksUploaded:Math.ceil(m/fr.CHUNK_SIZE)}),f&&f.$id&&(n["x-appwrite-id"]=f.$id),h=m}return f})}ping(){return Hy(this,void 0,void 0,function*(){return this.call("GET",new URL(this.config.endpoint+"/ping"))})}call(t,e,n={},s={},r="json"){var a,c;return Hy(this,void 0,void 0,function*(){const{uri:u,options:h}=this.prepareRequest(t,e,n,s);let f=null;const m=yield fetch(u,h);if(m.type==="opaque")throw new en(`Invalid Origin. Register your new client (${window.location.host}) as a new Web platform on your project console dashboard`,403,"forbidden","");const y=m.headers.get("x-appwrite-warning");if(y&&y.split(";").forEach(S=>console.warn("Warning: "+S)),!((a=m.headers.get("content-type"))===null||a===void 0)&&a.includes("application/json")?f=yield m.json():r==="arrayBuffer"?f=yield m.arrayBuffer():f={message:yield m.text()},400<=m.status){let S="";throw!((c=m.headers.get("content-type"))===null||c===void 0)&&c.includes("application/json")||r==="arrayBuffer"?S=JSON.stringify(f):S=f?.message,new en(f?.message,m.status,f?.type,S)}const T=m.headers.get("X-Fallback-Cookies");return typeof window<"u"&&window.localStorage&&T&&(window.console.warn("Appwrite is using localStorage for session management. Increase your security by adding a custom domain as your API endpoint."),window.localStorage.setItem("cookieFallback",T)),f})}static flatten(t,e=""){let n={};for(const[s,r]of Object.entries(t)){let a=e?e+"["+s+"]":s;Array.isArray(r)?n=Object.assign(Object.assign({},n),fr.flatten(r,a)):n[a]=r}return n}}fr.CHUNK_SIZE=1024*1024*5;class sc{constructor(t){this.client=t}static flatten(t,e=""){let n={};for(const[s,r]of Object.entries(t)){let a=e?e+"["+s+"]":s;Array.isArray(r)?n=Object.assign(Object.assign({},n),sc.flatten(r,a)):n[a]=r}return n}}sc.CHUNK_SIZE=5*1024*1024;class xF{constructor(t){this.client=t}listFiles(t,...e){let n;t&&typeof t=="object"&&!Array.isArray(t)?n=t||{}:n={bucketId:t,queries:e[0],search:e[1]};const s=n.bucketId,r=n.queries,a=n.search;if(typeof s>"u")throw new en('Missing required parameter: "bucketId"');const c="/storage/buckets/{bucketId}/files".replace("{bucketId}",s),u={};typeof r<"u"&&(u.queries=r),typeof a<"u"&&(u.search=a);const h=new URL(this.client.config.endpoint+c),f={};return this.client.call("get",h,f,u)}createFile(t,...e){let n,s;t&&typeof t=="object"&&!Array.isArray(t)?(n=t||{},s=t?.onProgress):(n={bucketId:t,fileId:e[0],file:e[1],permissions:e[2]},s=e[3]);const r=n.bucketId,a=n.fileId,c=n.file,u=n.permissions;if(typeof r>"u")throw new en('Missing required parameter: "bucketId"');if(typeof a>"u")throw new en('Missing required parameter: "fileId"');if(typeof c>"u")throw new en('Missing required parameter: "file"');const h="/storage/buckets/{bucketId}/files".replace("{bucketId}",r),f={};typeof a<"u"&&(f.fileId=a),typeof c<"u"&&(f.file=c),typeof u<"u"&&(f.permissions=u);const m=new URL(this.client.config.endpoint+h),y={"content-type":"multipart/form-data"};return this.client.chunkedUpload("post",m,y,f,s)}getFile(t,...e){let n;t&&typeof t=="object"&&!Array.isArray(t)?n=t||{}:n={bucketId:t,fileId:e[0]};const s=n.bucketId,r=n.fileId;if(typeof s>"u")throw new en('Missing required parameter: "bucketId"');if(typeof r>"u")throw new en('Missing required parameter: "fileId"');const a="/storage/buckets/{bucketId}/files/{fileId}".replace("{bucketId}",s).replace("{fileId}",r),c={},u=new URL(this.client.config.endpoint+a),h={};return this.client.call("get",u,h,c)}updateFile(t,...e){let n;t&&typeof t=="object"&&!Array.isArray(t)?n=t||{}:n={bucketId:t,fileId:e[0],name:e[1],permissions:e[2]};const s=n.bucketId,r=n.fileId,a=n.name,c=n.permissions;if(typeof s>"u")throw new en('Missing required parameter: "bucketId"');if(typeof r>"u")throw new en('Missing required parameter: "fileId"');const u="/storage/buckets/{bucketId}/files/{fileId}".replace("{bucketId}",s).replace("{fileId}",r),h={};typeof a<"u"&&(h.name=a),typeof c<"u"&&(h.permissions=c);const f=new URL(this.client.config.endpoint+u),m={"content-type":"application/json"};return this.client.call("put",f,m,h)}deleteFile(t,...e){let n;t&&typeof t=="object"&&!Array.isArray(t)?n=t||{}:n={bucketId:t,fileId:e[0]};const s=n.bucketId,r=n.fileId;if(typeof s>"u")throw new en('Missing required parameter: "bucketId"');if(typeof r>"u")throw new en('Missing required parameter: "fileId"');const a="/storage/buckets/{bucketId}/files/{fileId}".replace("{bucketId}",s).replace("{fileId}",r),c={},u=new URL(this.client.config.endpoint+a),h={"content-type":"application/json"};return this.client.call("delete",u,h,c)}getFileDownload(t,...e){let n;t&&typeof t=="object"&&!Array.isArray(t)?n=t||{}:n={bucketId:t,fileId:e[0],token:e[1]};const s=n.bucketId,r=n.fileId,a=n.token;if(typeof s>"u")throw new en('Missing required parameter: "bucketId"');if(typeof r>"u")throw new en('Missing required parameter: "fileId"');const c="/storage/buckets/{bucketId}/files/{fileId}/download".replace("{bucketId}",s).replace("{fileId}",r),u={};typeof a<"u"&&(u.token=a);const h=new URL(this.client.config.endpoint+c);u.project=this.client.config.project;for(const[f,m]of Object.entries(sc.flatten(u)))h.searchParams.append(f,m);return h.toString()}getFilePreview(t,...e){let n;t&&typeof t=="object"&&!Array.isArray(t)?n=t||{}:n={bucketId:t,fileId:e[0],width:e[1],height:e[2],gravity:e[3],quality:e[4],borderWidth:e[5],borderColor:e[6],borderRadius:e[7],opacity:e[8],rotation:e[9],background:e[10],output:e[11],token:e[12]};const s=n.bucketId,r=n.fileId,a=n.width,c=n.height,u=n.gravity,h=n.quality,f=n.borderWidth,m=n.borderColor,y=n.borderRadius,T=n.opacity,S=n.rotation,b=n.background,C=n.output,I=n.token;if(typeof s>"u")throw new en('Missing required parameter: "bucketId"');if(typeof r>"u")throw new en('Missing required parameter: "fileId"');const D="/storage/buckets/{bucketId}/files/{fileId}/preview".replace("{bucketId}",s).replace("{fileId}",r),P={};typeof a<"u"&&(P.width=a),typeof c<"u"&&(P.height=c),typeof u<"u"&&(P.gravity=u),typeof h<"u"&&(P.quality=h),typeof f<"u"&&(P.borderWidth=f),typeof m<"u"&&(P.borderColor=m),typeof y<"u"&&(P.borderRadius=y),typeof T<"u"&&(P.opacity=T),typeof S<"u"&&(P.rotation=S),typeof b<"u"&&(P.background=b),typeof C<"u"&&(P.output=C),typeof I<"u"&&(P.token=I);const H=new URL(this.client.config.endpoint+D);P.project=this.client.config.project;for(const[F,G]of Object.entries(sc.flatten(P)))H.searchParams.append(F,G);return H.toString()}getFileView(t,...e){let n;t&&typeof t=="object"&&!Array.isArray(t)?n=t||{}:n={bucketId:t,fileId:e[0],token:e[1]};const s=n.bucketId,r=n.fileId,a=n.token;if(typeof s>"u")throw new en('Missing required parameter: "bucketId"');if(typeof r>"u")throw new en('Missing required parameter: "fileId"');const c="/storage/buckets/{bucketId}/files/{fileId}/view".replace("{bucketId}",s).replace("{fileId}",r),u={};typeof a<"u"&&(u.token=a);const h=new URL(this.client.config.endpoint+c);u.project=this.client.config.project;for(const[f,m]of Object.entries(sc.flatten(u)))h.searchParams.append(f,m);return h.toString()}}var $1,Y1;class Tc{static custom(t){return t}static unique(t=7){const e=PF(Tc,$1,"m",Y1).call(Tc);let n="";for(let s=0;s<t;s++){const r=Math.floor(Math.random()*16).toString(16);n+=r}return e+n}}$1=Tc,Y1=function(){const t=new Date,e=Math.floor(t.getTime()/1e3),n=t.getMilliseconds();return e.toString(16)+n.toString(16).padStart(5,"0")};var Uw;(function(i){i.Totp="totp"})(Uw||(Uw={}));var Vw;(function(i){i.Email="email",i.Phone="phone",i.Totp="totp",i.Recoverycode="recoverycode"})(Vw||(Vw={}));var Bw;(function(i){i.Amazon="amazon",i.Apple="apple",i.Auth0="auth0",i.Authentik="authentik",i.Autodesk="autodesk",i.Bitbucket="bitbucket",i.Bitly="bitly",i.Box="box",i.Dailymotion="dailymotion",i.Discord="discord",i.Disqus="disqus",i.Dropbox="dropbox",i.Etsy="etsy",i.Facebook="facebook",i.Figma="figma",i.Github="github",i.Gitlab="gitlab",i.Google="google",i.Linkedin="linkedin",i.Microsoft="microsoft",i.Notion="notion",i.Oidc="oidc",i.Okta="okta",i.Paypal="paypal",i.PaypalSandbox="paypalSandbox",i.Podio="podio",i.Salesforce="salesforce",i.Slack="slack",i.Spotify="spotify",i.Stripe="stripe",i.Tradeshift="tradeshift",i.TradeshiftBox="tradeshiftBox",i.Twitch="twitch",i.Wordpress="wordpress",i.Yahoo="yahoo",i.Yammer="yammer",i.Yandex="yandex",i.Zoho="zoho",i.Zoom="zoom",i.Mock="mock"})(Bw||(Bw={}));var Fw;(function(i){i.AvantBrowser="aa",i.AndroidWebViewBeta="an",i.GoogleChrome="ch",i.GoogleChromeIOS="ci",i.GoogleChromeMobile="cm",i.Chromium="cr",i.MozillaFirefox="ff",i.Safari="sf",i.MobileSafari="mf",i.MicrosoftEdge="ps",i.MicrosoftEdgeIOS="oi",i.OperaMini="om",i.Opera="op",i.OperaNext="on"})(Fw||(Fw={}));var Hw;(function(i){i.AmericanExpress="amex",i.Argencard="argencard",i.Cabal="cabal",i.Cencosud="cencosud",i.DinersClub="diners",i.Discover="discover",i.Elo="elo",i.Hipercard="hipercard",i.JCB="jcb",i.Mastercard="mastercard",i.Naranja="naranja",i.TarjetaShopping="targeta-shopping",i.UnionPay="unionpay",i.Visa="visa",i.MIR="mir",i.Maestro="maestro",i.Rupay="rupay"})(Hw||(Hw={}));var Gw;(function(i){i.Afghanistan="af",i.Angola="ao",i.Albania="al",i.Andorra="ad",i.UnitedArabEmirates="ae",i.Argentina="ar",i.Armenia="am",i.AntiguaAndBarbuda="ag",i.Australia="au",i.Austria="at",i.Azerbaijan="az",i.Burundi="bi",i.Belgium="be",i.Benin="bj",i.BurkinaFaso="bf",i.Bangladesh="bd",i.Bulgaria="bg",i.Bahrain="bh",i.Bahamas="bs",i.BosniaAndHerzegovina="ba",i.Belarus="by",i.Belize="bz",i.Bolivia="bo",i.Brazil="br",i.Barbados="bb",i.BruneiDarussalam="bn",i.Bhutan="bt",i.Botswana="bw",i.CentralAfricanRepublic="cf",i.Canada="ca",i.Switzerland="ch",i.Chile="cl",i.China="cn",i.CoteDIvoire="ci",i.Cameroon="cm",i.DemocraticRepublicOfTheCongo="cd",i.RepublicOfTheCongo="cg",i.Colombia="co",i.Comoros="km",i.CapeVerde="cv",i.CostaRica="cr",i.Cuba="cu",i.Cyprus="cy",i.CzechRepublic="cz",i.Germany="de",i.Djibouti="dj",i.Dominica="dm",i.Denmark="dk",i.DominicanRepublic="do",i.Algeria="dz",i.Ecuador="ec",i.Egypt="eg",i.Eritrea="er",i.Spain="es",i.Estonia="ee",i.Ethiopia="et",i.Finland="fi",i.Fiji="fj",i.France="fr",i.MicronesiaFederatedStatesOf="fm",i.Gabon="ga",i.UnitedKingdom="gb",i.Georgia="ge",i.Ghana="gh",i.Guinea="gn",i.Gambia="gm",i.GuineaBissau="gw",i.EquatorialGuinea="gq",i.Greece="gr",i.Grenada="gd",i.Guatemala="gt",i.Guyana="gy",i.Honduras="hn",i.Croatia="hr",i.Haiti="ht",i.Hungary="hu",i.Indonesia="id",i.India="in",i.Ireland="ie",i.IranIslamicRepublicOf="ir",i.Iraq="iq",i.Iceland="is",i.Israel="il",i.Italy="it",i.Jamaica="jm",i.Jordan="jo",i.Japan="jp",i.Kazakhstan="kz",i.Kenya="ke",i.Kyrgyzstan="kg",i.Cambodia="kh",i.Kiribati="ki",i.SaintKittsAndNevis="kn",i.SouthKorea="kr",i.Kuwait="kw",i.LaoPeopleSDemocraticRepublic="la",i.Lebanon="lb",i.Liberia="lr",i.Libya="ly",i.SaintLucia="lc",i.Liechtenstein="li",i.SriLanka="lk",i.Lesotho="ls",i.Lithuania="lt",i.Luxembourg="lu",i.Latvia="lv",i.Morocco="ma",i.Monaco="mc",i.Moldova="md",i.Madagascar="mg",i.Maldives="mv",i.Mexico="mx",i.MarshallIslands="mh",i.NorthMacedonia="mk",i.Mali="ml",i.Malta="mt",i.Myanmar="mm",i.Montenegro="me",i.Mongolia="mn",i.Mozambique="mz",i.Mauritania="mr",i.Mauritius="mu",i.Malawi="mw",i.Malaysia="my",i.Namibia="na",i.Niger="ne",i.Nigeria="ng",i.Nicaragua="ni",i.Netherlands="nl",i.Norway="no",i.Nepal="np",i.Nauru="nr",i.NewZealand="nz",i.Oman="om",i.Pakistan="pk",i.Panama="pa",i.Peru="pe",i.Philippines="ph",i.Palau="pw",i.PapuaNewGuinea="pg",i.Poland="pl",i.FrenchPolynesia="pf",i.NorthKorea="kp",i.Portugal="pt",i.Paraguay="py",i.Qatar="qa",i.Romania="ro",i.Russia="ru",i.Rwanda="rw",i.SaudiArabia="sa",i.Sudan="sd",i.Senegal="sn",i.Singapore="sg",i.SolomonIslands="sb",i.SierraLeone="sl",i.ElSalvador="sv",i.SanMarino="sm",i.Somalia="so",i.Serbia="rs",i.SouthSudan="ss",i.SaoTomeAndPrincipe="st",i.Suriname="sr",i.Slovakia="sk",i.Slovenia="si",i.Sweden="se",i.Eswatini="sz",i.Seychelles="sc",i.Syria="sy",i.Chad="td",i.Togo="tg",i.Thailand="th",i.Tajikistan="tj",i.Turkmenistan="tm",i.TimorLeste="tl",i.Tonga="to",i.TrinidadAndTobago="tt",i.Tunisia="tn",i.Turkey="tr",i.Tuvalu="tv",i.Tanzania="tz",i.Uganda="ug",i.Ukraine="ua",i.Uruguay="uy",i.UnitedStates="us",i.Uzbekistan="uz",i.VaticanCity="va",i.SaintVincentAndTheGrenadines="vc",i.Venezuela="ve",i.Vietnam="vn",i.Vanuatu="vu",i.Samoa="ws",i.Yemen="ye",i.SouthAfrica="za",i.Zambia="zm",i.Zimbabwe="zw"})(Gw||(Gw={}));var qw;(function(i){i.GET="GET",i.POST="POST",i.PUT="PUT",i.PATCH="PATCH",i.DELETE="DELETE",i.OPTIONS="OPTIONS",i.HEAD="HEAD"})(qw||(qw={}));var zw;(function(i){i.Center="center",i.Topleft="top-left",i.Top="top",i.Topright="top-right",i.Left="left",i.Right="right",i.Bottomleft="bottom-left",i.Bottom="bottom",i.Bottomright="bottom-right"})(zw||(zw={}));var $w;(function(i){i.Jpg="jpg",i.Jpeg="jpeg",i.Png="png",i.Webp="webp",i.Heic="heic",i.Avif="avif",i.Gif="gif"})($w||($w={}));const W1=new fr;W1.setEndpoint("https://nyc.cloud.appwrite.io/v1").setProject("68e2e9ff001d7ee187b1");const Hu=new xF(W1),Gu="68e2ea3f002ef65184ad";var DF={};let NF,kF;function LF(){return{geminiUrl:NF,vertexUrl:kF}}function OF(i,t,e,n){var s,r;if(!i?.baseUrl){const a=LF();return t?(s=a.vertexUrl)!==null&&s!==void 0?s:e:(r=a.geminiUrl)!==null&&r!==void 0?r:n}return i.baseUrl}class Cr{}function gt(i,t){const e=/\{([^}]+)\}/g;return i.replace(e,(n,s)=>{if(Object.prototype.hasOwnProperty.call(t,s)){const r=t[s];return r!=null?String(r):""}else throw new Error(`Key '${s}' not found in valueMap.`)})}function _(i,t,e){for(let r=0;r<t.length-1;r++){const a=t[r];if(a.endsWith("[]")){const c=a.slice(0,-2);if(!(c in i))if(Array.isArray(e))i[c]=Array.from({length:e.length},()=>({}));else throw new Error(`Value must be a list given an array path ${a}`);if(Array.isArray(i[c])){const u=i[c];if(Array.isArray(e))for(let h=0;h<u.length;h++){const f=u[h];_(f,t.slice(r+1),e[h])}else for(const h of u)_(h,t.slice(r+1),e)}return}else if(a.endsWith("[0]")){const c=a.slice(0,-3);c in i||(i[c]=[{}]);const u=i[c];_(u[0],t.slice(r+1),e);return}(!i[a]||typeof i[a]!="object")&&(i[a]={}),i=i[a]}const n=t[t.length-1],s=i[n];if(s!==void 0){if(!e||typeof e=="object"&&Object.keys(e).length===0||e===s)return;if(typeof s=="object"&&typeof e=="object"&&s!==null&&e!==null)Object.assign(s,e);else throw new Error(`Cannot set value for an existing key. Key: ${n}`)}else n==="_self"&&typeof e=="object"&&e!==null&&!Array.isArray(e)?Object.assign(i,e):i[n]=e}function g(i,t,e=void 0){try{if(t.length===1&&t[0]==="_self")return i;for(let n=0;n<t.length;n++){if(typeof i!="object"||i===null)return e;const s=t[n];if(s.endsWith("[]")){const r=s.slice(0,-2);if(r in i){const a=i[r];return Array.isArray(a)?a.map(c=>g(c,t.slice(n+1),e)):e}else return e}else i=i[s]}return i}catch(n){if(n instanceof TypeError)return e;throw n}}function UF(i,t){for(const[e,n]of Object.entries(t)){const s=e.split("."),r=n.split("."),a=new Set;let c=-1;for(let u=0;u<s.length;u++)if(s[u]==="*"){c=u;break}if(c!==-1&&r.length>c)for(let u=c;u<r.length;u++){const h=r[u];h!=="*"&&!h.endsWith("[]")&&!h.endsWith("[0]")&&a.add(h)}R_(i,s,r,0,a)}}function R_(i,t,e,n,s){if(n>=t.length||typeof i!="object"||i===null)return;const r=t[n];if(r.endsWith("[]")){const a=r.slice(0,-2),c=i;if(a in c&&Array.isArray(c[a]))for(const u of c[a])R_(u,t,e,n+1,s)}else if(r==="*"){if(typeof i=="object"&&i!==null&&!Array.isArray(i)){const a=i,c=Object.keys(a).filter(h=>!h.startsWith("_")&&!s.has(h)),u={};for(const h of c)u[h]=a[h];for(const[h,f]of Object.entries(u)){const m=[];for(const y of e.slice(n))y==="*"?m.push(h):m.push(y);_(a,m,f)}for(const h of c)delete a[h]}}else{const a=i;r in a&&R_(a[r],t,e,n+1,s)}}function iE(i){if(typeof i!="string")throw new Error("fromImageBytes must be a string");return i}function VF(i){const t={},e=g(i,["operationName"]);e!=null&&_(t,["operationName"],e);const n=g(i,["resourceName"]);return n!=null&&_(t,["_url","resourceName"],n),t}function BF(i){const t={},e=g(i,["name"]);e!=null&&_(t,["name"],e);const n=g(i,["metadata"]);n!=null&&_(t,["metadata"],n);const s=g(i,["done"]);s!=null&&_(t,["done"],s);const r=g(i,["error"]);r!=null&&_(t,["error"],r);const a=g(i,["response","generateVideoResponse"]);return a!=null&&_(t,["response"],HF(a)),t}function FF(i){const t={},e=g(i,["name"]);e!=null&&_(t,["name"],e);const n=g(i,["metadata"]);n!=null&&_(t,["metadata"],n);const s=g(i,["done"]);s!=null&&_(t,["done"],s);const r=g(i,["error"]);r!=null&&_(t,["error"],r);const a=g(i,["response"]);return a!=null&&_(t,["response"],GF(a)),t}function HF(i){const t={},e=g(i,["generatedSamples"]);if(e!=null){let r=e;Array.isArray(r)&&(r=r.map(a=>qF(a))),_(t,["generatedVideos"],r)}const n=g(i,["raiMediaFilteredCount"]);n!=null&&_(t,["raiMediaFilteredCount"],n);const s=g(i,["raiMediaFilteredReasons"]);return s!=null&&_(t,["raiMediaFilteredReasons"],s),t}function GF(i){const t={},e=g(i,["videos"]);if(e!=null){let r=e;Array.isArray(r)&&(r=r.map(a=>zF(a))),_(t,["generatedVideos"],r)}const n=g(i,["raiMediaFilteredCount"]);n!=null&&_(t,["raiMediaFilteredCount"],n);const s=g(i,["raiMediaFilteredReasons"]);return s!=null&&_(t,["raiMediaFilteredReasons"],s),t}function qF(i){const t={},e=g(i,["video"]);return e!=null&&_(t,["video"],JF(e)),t}function zF(i){const t={},e=g(i,["_self"]);return e!=null&&_(t,["video"],QF(e)),t}function $F(i){const t={},e=g(i,["operationName"]);return e!=null&&_(t,["_url","operationName"],e),t}function YF(i){const t={},e=g(i,["operationName"]);return e!=null&&_(t,["_url","operationName"],e),t}function WF(i){const t={},e=g(i,["name"]);e!=null&&_(t,["name"],e);const n=g(i,["metadata"]);n!=null&&_(t,["metadata"],n);const s=g(i,["done"]);s!=null&&_(t,["done"],s);const r=g(i,["error"]);r!=null&&_(t,["error"],r);const a=g(i,["response"]);return a!=null&&_(t,["response"],KF(a)),t}function KF(i){const t={},e=g(i,["sdkHttpResponse"]);e!=null&&_(t,["sdkHttpResponse"],e);const n=g(i,["parent"]);n!=null&&_(t,["parent"],n);const s=g(i,["documentName"]);return s!=null&&_(t,["documentName"],s),t}function K1(i){const t={},e=g(i,["name"]);e!=null&&_(t,["name"],e);const n=g(i,["metadata"]);n!=null&&_(t,["metadata"],n);const s=g(i,["done"]);s!=null&&_(t,["done"],s);const r=g(i,["error"]);r!=null&&_(t,["error"],r);const a=g(i,["response"]);return a!=null&&_(t,["response"],XF(a)),t}function XF(i){const t={},e=g(i,["sdkHttpResponse"]);e!=null&&_(t,["sdkHttpResponse"],e);const n=g(i,["parent"]);n!=null&&_(t,["parent"],n);const s=g(i,["documentName"]);return s!=null&&_(t,["documentName"],s),t}function JF(i){const t={},e=g(i,["uri"]);e!=null&&_(t,["uri"],e);const n=g(i,["encodedVideo"]);n!=null&&_(t,["videoBytes"],iE(n));const s=g(i,["encoding"]);return s!=null&&_(t,["mimeType"],s),t}function QF(i){const t={},e=g(i,["gcsUri"]);e!=null&&_(t,["uri"],e);const n=g(i,["bytesBase64Encoded"]);n!=null&&_(t,["videoBytes"],iE(n));const s=g(i,["mimeType"]);return s!=null&&_(t,["mimeType"],s),t}var Yw;(function(i){i.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",i.OUTCOME_OK="OUTCOME_OK",i.OUTCOME_FAILED="OUTCOME_FAILED",i.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Yw||(Yw={}));var Ww;(function(i){i.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",i.PYTHON="PYTHON"})(Ww||(Ww={}));var Kw;(function(i){i.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",i.SILENT="SILENT",i.WHEN_IDLE="WHEN_IDLE",i.INTERRUPT="INTERRUPT"})(Kw||(Kw={}));var Eo;(function(i){i.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",i.STRING="STRING",i.NUMBER="NUMBER",i.INTEGER="INTEGER",i.BOOLEAN="BOOLEAN",i.ARRAY="ARRAY",i.OBJECT="OBJECT",i.NULL="NULL"})(Eo||(Eo={}));var Xw;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.MODE_DYNAMIC="MODE_DYNAMIC"})(Xw||(Xw={}));var Jw;(function(i){i.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",i.SIMPLE_SEARCH="SIMPLE_SEARCH",i.ELASTIC_SEARCH="ELASTIC_SEARCH"})(Jw||(Jw={}));var Qw;(function(i){i.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",i.NO_AUTH="NO_AUTH",i.API_KEY_AUTH="API_KEY_AUTH",i.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",i.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",i.OAUTH="OAUTH",i.OIDC_AUTH="OIDC_AUTH"})(Qw||(Qw={}));var jw;(function(i){i.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",i.HTTP_IN_QUERY="HTTP_IN_QUERY",i.HTTP_IN_HEADER="HTTP_IN_HEADER",i.HTTP_IN_PATH="HTTP_IN_PATH",i.HTTP_IN_BODY="HTTP_IN_BODY",i.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(jw||(jw={}));var Zw;(function(i){i.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",i.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",i.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",i.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(Zw||(Zw={}));var tb;(function(i){i.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",i.LOW="LOW",i.MEDIUM="MEDIUM",i.HIGH="HIGH",i.MINIMAL="MINIMAL"})(tb||(tb={}));var eb;(function(i){i.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",i.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",i.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",i.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",i.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",i.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",i.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",i.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",i.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",i.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",i.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(eb||(eb={}));var nb;(function(i){i.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",i.SEVERITY="SEVERITY",i.PROBABILITY="PROBABILITY"})(nb||(nb={}));var ib;(function(i){i.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",i.BLOCK_NONE="BLOCK_NONE",i.OFF="OFF"})(ib||(ib={}));var sb;(function(i){i.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",i.STOP="STOP",i.MAX_TOKENS="MAX_TOKENS",i.SAFETY="SAFETY",i.RECITATION="RECITATION",i.LANGUAGE="LANGUAGE",i.OTHER="OTHER",i.BLOCKLIST="BLOCKLIST",i.PROHIBITED_CONTENT="PROHIBITED_CONTENT",i.SPII="SPII",i.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",i.IMAGE_SAFETY="IMAGE_SAFETY",i.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",i.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",i.NO_IMAGE="NO_IMAGE",i.IMAGE_RECITATION="IMAGE_RECITATION",i.IMAGE_OTHER="IMAGE_OTHER"})(sb||(sb={}));var rb;(function(i){i.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",i.NEGLIGIBLE="NEGLIGIBLE",i.LOW="LOW",i.MEDIUM="MEDIUM",i.HIGH="HIGH"})(rb||(rb={}));var ob;(function(i){i.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",i.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",i.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",i.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",i.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(ob||(ob={}));var ab;(function(i){i.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",i.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",i.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",i.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",i.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(ab||(ab={}));var lb;(function(i){i.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",i.SAFETY="SAFETY",i.OTHER="OTHER",i.BLOCKLIST="BLOCKLIST",i.PROHIBITED_CONTENT="PROHIBITED_CONTENT",i.IMAGE_SAFETY="IMAGE_SAFETY",i.MODEL_ARMOR="MODEL_ARMOR",i.JAILBREAK="JAILBREAK"})(lb||(lb={}));var cb;(function(i){i.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",i.ON_DEMAND="ON_DEMAND",i.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(cb||(cb={}));var bp;(function(i){i.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",i.TEXT="TEXT",i.IMAGE="IMAGE",i.AUDIO="AUDIO"})(bp||(bp={}));var ub;(function(i){i.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",i.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",i.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",i.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(ub||(ub={}));var hb;(function(i){i.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",i.TUNING_MODE_FULL="TUNING_MODE_FULL",i.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(hb||(hb={}));var db;(function(i){i.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",i.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",i.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",i.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",i.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",i.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",i.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(db||(db={}));var M_;(function(i){i.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",i.JOB_STATE_QUEUED="JOB_STATE_QUEUED",i.JOB_STATE_PENDING="JOB_STATE_PENDING",i.JOB_STATE_RUNNING="JOB_STATE_RUNNING",i.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",i.JOB_STATE_FAILED="JOB_STATE_FAILED",i.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",i.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",i.JOB_STATE_PAUSED="JOB_STATE_PAUSED",i.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",i.JOB_STATE_UPDATING="JOB_STATE_UPDATING",i.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(M_||(M_={}));var fb;(function(i){i.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",i.TUNING_TASK_I2V="TUNING_TASK_I2V",i.TUNING_TASK_T2V="TUNING_TASK_T2V",i.TUNING_TASK_R2V="TUNING_TASK_R2V"})(fb||(fb={}));var pb;(function(i){i.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",i.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",i.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",i.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",i.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(pb||(pb={}));var mb;(function(i){i.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",i.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",i.BALANCED="BALANCED",i.PRIORITIZE_COST="PRIORITIZE_COST"})(mb||(mb={}));var gb;(function(i){i.UNSPECIFIED="UNSPECIFIED",i.BLOCKING="BLOCKING",i.NON_BLOCKING="NON_BLOCKING"})(gb||(gb={}));var yb;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.MODE_DYNAMIC="MODE_DYNAMIC"})(yb||(yb={}));var _b;(function(i){i.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",i.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(_b||(_b={}));var vb;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.AUTO="AUTO",i.ANY="ANY",i.NONE="NONE",i.VALIDATED="VALIDATED"})(vb||(vb={}));var Eb;(function(i){i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",i.BLOCK_NONE="BLOCK_NONE"})(Eb||(Eb={}));var Tb;(function(i){i.DONT_ALLOW="DONT_ALLOW",i.ALLOW_ADULT="ALLOW_ADULT",i.ALLOW_ALL="ALLOW_ALL"})(Tb||(Tb={}));var Ab;(function(i){i.auto="auto",i.en="en",i.ja="ja",i.ko="ko",i.hi="hi",i.zh="zh",i.pt="pt",i.es="es"})(Ab||(Ab={}));var Sb;(function(i){i.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",i.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",i.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",i.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",i.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Sb||(Sb={}));var wb;(function(i){i.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",i.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",i.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",i.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(wb||(wb={}));var bb;(function(i){i.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",i.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",i.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",i.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(bb||(bb={}));var Cb;(function(i){i.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",i.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",i.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",i.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",i.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",i.EDIT_MODE_STYLE="EDIT_MODE_STYLE",i.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",i.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(Cb||(Cb={}));var Ib;(function(i){i.FOREGROUND="FOREGROUND",i.BACKGROUND="BACKGROUND",i.PROMPT="PROMPT",i.SEMANTIC="SEMANTIC",i.INTERACTIVE="INTERACTIVE"})(Ib||(Ib={}));var Rb;(function(i){i.ASSET="ASSET",i.STYLE="STYLE"})(Rb||(Rb={}));var Mb;(function(i){i.INSERT="INSERT",i.REMOVE="REMOVE",i.REMOVE_STATIC="REMOVE_STATIC",i.OUTPAINT="OUTPAINT"})(Mb||(Mb={}));var Pb;(function(i){i.OPTIMIZED="OPTIMIZED",i.LOSSLESS="LOSSLESS"})(Pb||(Pb={}));var xb;(function(i){i.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",i.PREFERENCE_TUNING="PREFERENCE_TUNING"})(xb||(xb={}));var Db;(function(i){i.STATE_UNSPECIFIED="STATE_UNSPECIFIED",i.STATE_PENDING="STATE_PENDING",i.STATE_ACTIVE="STATE_ACTIVE",i.STATE_FAILED="STATE_FAILED"})(Db||(Db={}));var Nb;(function(i){i.STATE_UNSPECIFIED="STATE_UNSPECIFIED",i.PROCESSING="PROCESSING",i.ACTIVE="ACTIVE",i.FAILED="FAILED"})(Nb||(Nb={}));var kb;(function(i){i.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",i.UPLOADED="UPLOADED",i.GENERATED="GENERATED"})(kb||(kb={}));var Lb;(function(i){i.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",i.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",i.RESPONSE_REJECTED="RESPONSE_REJECTED",i.NEED_MORE_INPUT="NEED_MORE_INPUT"})(Lb||(Lb={}));var Ob;(function(i){i.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",i.TEXT="TEXT",i.IMAGE="IMAGE",i.VIDEO="VIDEO",i.AUDIO="AUDIO",i.DOCUMENT="DOCUMENT"})(Ob||(Ob={}));var Ub;(function(i){i.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",i.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",i.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(Ub||(Ub={}));var Vb;(function(i){i.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",i.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",i.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Vb||(Vb={}));var Bb;(function(i){i.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",i.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",i.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Bb||(Bb={}));var Fb;(function(i){i.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",i.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",i.NO_INTERRUPTION="NO_INTERRUPTION"})(Fb||(Fb={}));var Hb;(function(i){i.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",i.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",i.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(Hb||(Hb={}));var Gb;(function(i){i.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",i.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",i.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",i.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",i.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",i.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",i.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",i.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",i.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",i.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",i.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",i.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",i.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Gb||(Gb={}));var qb;(function(i){i.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",i.QUALITY="QUALITY",i.DIVERSITY="DIVERSITY",i.VOCALIZATION="VOCALIZATION"})(qb||(qb={}));var Kl;(function(i){i.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",i.PLAY="PLAY",i.PAUSE="PAUSE",i.STOP="STOP",i.RESET_CONTEXT="RESET_CONTEXT"})(Kl||(Kl={}));class P_{constructor(t){const e={};for(const n of t.headers.entries())e[n[0]]=n[1];this.headers=e,this.responseInternal=t}json(){return this.responseInternal.json()}}class qu{get text(){var t,e,n,s,r,a,c,u;if(((s=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let h="",f=!1;const m=[];for(const y of(u=(c=(a=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content)===null||c===void 0?void 0:c.parts)!==null&&u!==void 0?u:[]){for(const[T,S]of Object.entries(y))T!=="text"&&T!=="thought"&&T!=="thoughtSignature"&&(S!==null||S!==void 0)&&m.push(T);if(typeof y.text=="string"){if(typeof y.thought=="boolean"&&y.thought)continue;f=!0,h+=y.text}}return m.length>0&&console.warn(`there are non-text parts ${m} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),f?h:void 0}get data(){var t,e,n,s,r,a,c,u;if(((s=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let h="";const f=[];for(const m of(u=(c=(a=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content)===null||c===void 0?void 0:c.parts)!==null&&u!==void 0?u:[]){for(const[y,T]of Object.entries(m))y!=="inlineData"&&(T!==null||T!==void 0)&&f.push(y);m.inlineData&&typeof m.inlineData.data=="string"&&(h+=atob(m.inlineData.data))}return f.length>0&&console.warn(`there are non-data parts ${f} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),h.length>0?btoa(h):void 0}get functionCalls(){var t,e,n,s,r,a,c,u;if(((s=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const h=(u=(c=(a=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content)===null||c===void 0?void 0:c.parts)===null||u===void 0?void 0:u.filter(f=>f.functionCall).map(f=>f.functionCall).filter(f=>f!==void 0);if(h?.length!==0)return h}get executableCode(){var t,e,n,s,r,a,c,u,h;if(((s=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const f=(u=(c=(a=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content)===null||c===void 0?void 0:c.parts)===null||u===void 0?void 0:u.filter(m=>m.executableCode).map(m=>m.executableCode).filter(m=>m!==void 0);if(f?.length!==0)return(h=f?.[0])===null||h===void 0?void 0:h.code}get codeExecutionResult(){var t,e,n,s,r,a,c,u,h;if(((s=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const f=(u=(c=(a=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content)===null||c===void 0?void 0:c.parts)===null||u===void 0?void 0:u.filter(m=>m.codeExecutionResult).map(m=>m.codeExecutionResult).filter(m=>m!==void 0);if(f?.length!==0)return(h=f?.[0])===null||h===void 0?void 0:h.output}}class zb{}class $b{}class jF{}class ZF{}class t4{}class e4{}class Yb{}class Wb{}class Kb{}class n4{}class Cp{_fromAPIResponse({apiResponse:t,_isVertexAI:e}){const n=new Cp;let s;const r=t;return e?s=FF(r):s=BF(r),Object.assign(n,s),n}}class Xb{}class Jb{}class Qb{}class jb{}class i4{}class s4{}class r4{}class sE{_fromAPIResponse({apiResponse:t,_isVertexAI:e}){const n=new sE,r=WF(t);return Object.assign(n,r),n}}class o4{}class a4{}class l4{}class Zb{}class c4{get text(){var t,e,n;let s="",r=!1;const a=[];for(const c of(n=(e=(t=this.serverContent)===null||t===void 0?void 0:t.modelTurn)===null||e===void 0?void 0:e.parts)!==null&&n!==void 0?n:[]){for(const[u,h]of Object.entries(c))u!=="text"&&u!=="thought"&&h!==null&&a.push(u);if(typeof c.text=="string"){if(typeof c.thought=="boolean"&&c.thought)continue;r=!0,s+=c.text}}return a.length>0&&console.warn(`there are non-text parts ${a} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),r?s:void 0}get data(){var t,e,n;let s="";const r=[];for(const a of(n=(e=(t=this.serverContent)===null||t===void 0?void 0:t.modelTurn)===null||e===void 0?void 0:e.parts)!==null&&n!==void 0?n:[]){for(const[c,u]of Object.entries(a))c!=="inlineData"&&u!==null&&r.push(c);a.inlineData&&typeof a.inlineData.data=="string"&&(s+=atob(a.inlineData.data))}return r.length>0&&console.warn(`there are non-data parts ${r} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),s.length>0?btoa(s):void 0}}class u4{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class rE{_fromAPIResponse({apiResponse:t,_isVertexAI:e}){const n=new rE,r=K1(t);return Object.assign(n,r),n}}function oe(i,t){if(!t||typeof t!="string")throw new Error("model is required and must be a string");if(t.includes("..")||t.includes("?")||t.includes("&"))throw new Error("invalid model parameter");if(i.isVertexAI()){if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;if(t.indexOf("/")>=0){const e=t.split("/",2);return`publishers/${e[0]}/models/${e[1]}`}else return`publishers/google/models/${t}`}else return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function X1(i,t){const e=oe(i,t);return e?e.startsWith("publishers/")&&i.isVertexAI()?`projects/${i.getProject()}/locations/${i.getLocation()}/${e}`:e.startsWith("models/")&&i.isVertexAI()?`projects/${i.getProject()}/locations/${i.getLocation()}/publishers/google/${e}`:e:""}function J1(i){return Array.isArray(i)?i.map(t=>Ip(t)):[Ip(i)]}function Ip(i){if(typeof i=="object"&&i!==null)return i;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof i}`)}function Q1(i){const t=Ip(i);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function j1(i){const t=Ip(i);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function tC(i){if(i==null)throw new Error("PartUnion is required");if(typeof i=="object")return i;if(typeof i=="string")return{text:i};throw new Error(`Unsupported part type: ${typeof i}`)}function Z1(i){if(i==null||Array.isArray(i)&&i.length===0)throw new Error("PartListUnion is required");return Array.isArray(i)?i.map(t=>tC(t)):[tC(i)]}function x_(i){return i!=null&&typeof i=="object"&&"parts"in i&&Array.isArray(i.parts)}function eC(i){return i!=null&&typeof i=="object"&&"functionCall"in i}function nC(i){return i!=null&&typeof i=="object"&&"functionResponse"in i}function Bn(i){if(i==null)throw new Error("ContentUnion is required");return x_(i)?i:{role:"user",parts:Z1(i)}}function oE(i,t){if(!t)return[];if(i.isVertexAI()&&Array.isArray(t))return t.flatMap(e=>{const n=Bn(e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]});if(i.isVertexAI()){const e=Bn(t);return e.parts&&e.parts.length>0&&e.parts[0].text!==void 0?[e.parts[0].text]:[]}return Array.isArray(t)?t.map(e=>Bn(e)):[Bn(t)]}function Ui(i){if(i==null||Array.isArray(i)&&i.length===0)throw new Error("contents are required");if(!Array.isArray(i)){if(eC(i)||nC(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Bn(i)]}const t=[],e=[],n=x_(i[0]);for(const s of i){const r=x_(s);if(r!=n)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(r)t.push(s);else{if(eC(s)||nC(s))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");e.push(s)}}return n||t.push({role:"user",parts:Z1(e)}),t}function h4(i,t){i.includes("null")&&(t.nullable=!0);const e=i.filter(n=>n!=="null");if(e.length===1)t.type=Object.values(Eo).includes(e[0].toUpperCase())?e[0].toUpperCase():Eo.TYPE_UNSPECIFIED;else{t.anyOf=[];for(const n of e)t.anyOf.push({type:Object.values(Eo).includes(n.toUpperCase())?n.toUpperCase():Eo.TYPE_UNSPECIFIED})}}function rc(i){const t={},e=["items"],n=["anyOf"],s=["properties"];if(i.type&&i.anyOf)throw new Error("type and anyOf cannot be both populated.");const r=i.anyOf;r!=null&&r.length==2&&(r[0].type==="null"?(t.nullable=!0,i=r[1]):r[1].type==="null"&&(t.nullable=!0,i=r[0])),i.type instanceof Array&&h4(i.type,t);for(const[a,c]of Object.entries(i))if(c!=null)if(a=="type"){if(c==="null")throw new Error("type: null can not be the only possible type for the field.");if(c instanceof Array)continue;t.type=Object.values(Eo).includes(c.toUpperCase())?c.toUpperCase():Eo.TYPE_UNSPECIFIED}else if(e.includes(a))t[a]=rc(c);else if(n.includes(a)){const u=[];for(const h of c){if(h.type=="null"){t.nullable=!0;continue}u.push(rc(h))}t[a]=u}else if(s.includes(a)){const u={};for(const[h,f]of Object.entries(c))u[h]=rc(f);t[a]=u}else{if(a==="additionalProperties")continue;t[a]=c}return t}function aE(i){return rc(i)}function lE(i){if(typeof i=="object")return i;if(typeof i=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:i}}};throw new Error(`Unsupported speechConfig type: ${typeof i}`)}function cE(i){if("multiSpeakerVoiceConfig"in i)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return i}function xc(i){if(i.functionDeclarations)for(const t of i.functionDeclarations)t.parameters&&(Object.keys(t.parameters).includes("$schema")?t.parametersJsonSchema||(t.parametersJsonSchema=t.parameters,delete t.parameters):t.parameters=rc(t.parameters)),t.response&&(Object.keys(t.response).includes("$schema")?t.responseJsonSchema||(t.responseJsonSchema=t.response,delete t.response):t.response=rc(t.response));return i}function Dc(i){if(i==null)throw new Error("tools is required");if(!Array.isArray(i))throw new Error("tools is required and must be an array of Tools");const t=[];for(const e of i)t.push(e);return t}function d4(i,t,e,n=1){const s=!t.startsWith(`${e}/`)&&t.split("/").length===n;return i.isVertexAI()?t.startsWith("projects/")?t:t.startsWith("locations/")?`projects/${i.getProject()}/${t}`:t.startsWith(`${e}/`)?`projects/${i.getProject()}/locations/${i.getLocation()}/${t}`:s?`projects/${i.getProject()}/locations/${i.getLocation()}/${e}/${t}`:t:s?`${e}/${t}`:t}function Ir(i,t){if(typeof t!="string")throw new Error("name must be a string");return d4(i,t,"cachedContents")}function tM(i){switch(i){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return i}}function Bo(i){return iE(i)}function f4(i){return i!=null&&typeof i=="object"&&"name"in i}function p4(i){return i!=null&&typeof i=="object"&&"video"in i}function m4(i){return i!=null&&typeof i=="object"&&"uri"in i}function eM(i){var t;let e;if(f4(i)&&(e=i.name),!(m4(i)&&(e=i.uri,e===void 0))&&!(p4(i)&&(e=(t=i.video)===null||t===void 0?void 0:t.uri,e===void 0))){if(typeof i=="string"&&(e=i),e===void 0)throw new Error("Could not extract file name from the provided input.");if(e.startsWith("https://")){const s=e.split("files/")[1].match(/[a-z0-9]+/);if(s===null)throw new Error(`Could not extract file name from URI ${e}`);e=s[0]}else e.startsWith("files/")&&(e=e.split("files/")[1]);return e}}function nM(i,t){let e;return i.isVertexAI()?e=t?"publishers/google/models":"models":e=t?"models":"tunedModels",e}function iM(i){for(const t of["models","tunedModels","publisherModels"])if(g4(i,t))return i[t];return[]}function g4(i,t){return i!==null&&typeof i=="object"&&t in i}function y4(i,t={}){const e=i,n={name:e.name,description:e.description,parametersJsonSchema:e.inputSchema};return e.outputSchema&&(n.responseJsonSchema=e.outputSchema),t.behavior&&(n.behavior=t.behavior),{functionDeclarations:[n]}}function _4(i,t={}){const e=[],n=new Set;for(const s of i){const r=s.name;if(n.has(r))throw new Error(`Duplicate function name ${r} found in MCP tools. Please ensure function names are unique.`);n.add(r);const a=y4(s,t);a.functionDeclarations&&e.push(...a.functionDeclarations)}return{functionDeclarations:e}}function sM(i,t){let e;if(typeof t=="string")if(i.isVertexAI())if(t.startsWith("gs://"))e={format:"jsonl",gcsUri:[t]};else if(t.startsWith("bq://"))e={format:"bigquery",bigqueryUri:t};else throw new Error(`Unsupported string source for Vertex AI: ${t}`);else if(t.startsWith("files/"))e={fileName:t};else throw new Error(`Unsupported string source for Gemini API: ${t}`);else if(Array.isArray(t)){if(i.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");e={inlinedRequests:t}}else e=t;const n=[e.gcsUri,e.bigqueryUri].filter(Boolean).length,s=[e.inlinedRequests,e.fileName].filter(Boolean).length;if(i.isVertexAI()){if(s>0||n!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(n>0||s!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return e}function v4(i){if(typeof i!="string")return i;const t=i;if(t.startsWith("gs://"))return{format:"jsonl",gcsUri:t};if(t.startsWith("bq://"))return{format:"bigquery",bigqueryUri:t};throw new Error(`Unsupported destination: ${t}`)}function rM(i){if(typeof i!="object"||i===null)return{};const t=i,e=t.inlinedResponses;if(typeof e!="object"||e===null)return i;const s=e.inlinedResponses;if(!Array.isArray(s)||s.length===0)return i;let r=!1;for(const a of s){if(typeof a!="object"||a===null)continue;const u=a.response;if(typeof u!="object"||u===null)continue;if(u.embedding!==void 0){r=!0;break}}return r&&(t.inlinedEmbedContentResponses=t.inlinedResponses,delete t.inlinedResponses),i}function Nc(i,t){const e=t;if(!i.isVertexAI()){if(/batches\/[^/]+$/.test(e))return e.split("/").pop();throw new Error(`Invalid batch job name: ${e}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(e))return e.split("/").pop();if(/^\d+$/.test(e))return e;throw new Error(`Invalid batch job name: ${e}.`)}function oM(i){const t=i;return t==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":t==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":t==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":t==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":t==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":t==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":t==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":t}function E4(i){const t={},e=g(i,["responsesFile"]);e!=null&&_(t,["fileName"],e);const n=g(i,["inlinedResponses","inlinedResponses"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>t3(a))),_(t,["inlinedResponses"],r)}const s=g(i,["inlinedEmbedContentResponses","inlinedResponses"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>a)),_(t,["inlinedEmbedContentResponses"],r)}return t}function T4(i){const t={},e=g(i,["predictionsFormat"]);e!=null&&_(t,["format"],e);const n=g(i,["gcsDestination","outputUriPrefix"]);n!=null&&_(t,["gcsUri"],n);const s=g(i,["bigqueryDestination","outputUri"]);return s!=null&&_(t,["bigqueryUri"],s),t}function A4(i){const t={},e=g(i,["format"]);e!=null&&_(t,["predictionsFormat"],e);const n=g(i,["gcsUri"]);n!=null&&_(t,["gcsDestination","outputUriPrefix"],n);const s=g(i,["bigqueryUri"]);if(s!=null&&_(t,["bigqueryDestination","outputUri"],s),g(i,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(g(i,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(g(i,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return t}function Xf(i){const t={},e=g(i,["name"]);e!=null&&_(t,["name"],e);const n=g(i,["metadata","displayName"]);n!=null&&_(t,["displayName"],n);const s=g(i,["metadata","state"]);s!=null&&_(t,["state"],oM(s));const r=g(i,["metadata","createTime"]);r!=null&&_(t,["createTime"],r);const a=g(i,["metadata","endTime"]);a!=null&&_(t,["endTime"],a);const c=g(i,["metadata","updateTime"]);c!=null&&_(t,["updateTime"],c);const u=g(i,["metadata","model"]);u!=null&&_(t,["model"],u);const h=g(i,["metadata","output"]);return h!=null&&_(t,["dest"],E4(rM(h))),t}function D_(i){const t={},e=g(i,["name"]);e!=null&&_(t,["name"],e);const n=g(i,["displayName"]);n!=null&&_(t,["displayName"],n);const s=g(i,["state"]);s!=null&&_(t,["state"],oM(s));const r=g(i,["error"]);r!=null&&_(t,["error"],r);const a=g(i,["createTime"]);a!=null&&_(t,["createTime"],a);const c=g(i,["startTime"]);c!=null&&_(t,["startTime"],c);const u=g(i,["endTime"]);u!=null&&_(t,["endTime"],u);const h=g(i,["updateTime"]);h!=null&&_(t,["updateTime"],h);const f=g(i,["model"]);f!=null&&_(t,["model"],f);const m=g(i,["inputConfig"]);m!=null&&_(t,["src"],S4(m));const y=g(i,["outputConfig"]);y!=null&&_(t,["dest"],T4(rM(y)));const T=g(i,["completionStats"]);return T!=null&&_(t,["completionStats"],T),t}function S4(i){const t={},e=g(i,["instancesFormat"]);e!=null&&_(t,["format"],e);const n=g(i,["gcsSource","uris"]);n!=null&&_(t,["gcsUri"],n);const s=g(i,["bigquerySource","inputUri"]);return s!=null&&_(t,["bigqueryUri"],s),t}function w4(i,t){const e={};if(g(t,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(g(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(g(t,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const n=g(t,["fileName"]);n!=null&&_(e,["fileName"],n);const s=g(t,["inlinedRequests"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>Z4(i,a))),_(e,["requests","requests"],r)}return e}function b4(i){const t={},e=g(i,["format"]);e!=null&&_(t,["instancesFormat"],e);const n=g(i,["gcsUri"]);n!=null&&_(t,["gcsSource","uris"],n);const s=g(i,["bigqueryUri"]);if(s!=null&&_(t,["bigquerySource","inputUri"],s),g(i,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(g(i,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return t}function C4(i){const t={},e=g(i,["data"]);if(e!=null&&_(t,["data"],e),g(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=g(i,["mimeType"]);return n!=null&&_(t,["mimeType"],n),t}function I4(i,t){const e={},n=g(t,["name"]);return n!=null&&_(e,["_url","name"],Nc(i,n)),e}function R4(i,t){const e={},n=g(t,["name"]);return n!=null&&_(e,["_url","name"],Nc(i,n)),e}function M4(i){const t={},e=g(i,["content"]);e!=null&&_(t,["content"],e);const n=g(i,["citationMetadata"]);n!=null&&_(t,["citationMetadata"],P4(n));const s=g(i,["tokenCount"]);s!=null&&_(t,["tokenCount"],s);const r=g(i,["finishReason"]);r!=null&&_(t,["finishReason"],r);const a=g(i,["avgLogprobs"]);a!=null&&_(t,["avgLogprobs"],a);const c=g(i,["groundingMetadata"]);c!=null&&_(t,["groundingMetadata"],c);const u=g(i,["index"]);u!=null&&_(t,["index"],u);const h=g(i,["logprobsResult"]);h!=null&&_(t,["logprobsResult"],h);const f=g(i,["safetyRatings"]);if(f!=null){let y=f;Array.isArray(y)&&(y=y.map(T=>T)),_(t,["safetyRatings"],y)}const m=g(i,["urlContextMetadata"]);return m!=null&&_(t,["urlContextMetadata"],m),t}function P4(i){const t={},e=g(i,["citationSources"]);if(e!=null){let n=e;Array.isArray(n)&&(n=n.map(s=>s)),_(t,["citations"],n)}return t}function aM(i){const t={},e=g(i,["parts"]);if(e!=null){let s=e;Array.isArray(s)&&(s=s.map(r=>a3(r))),_(t,["parts"],s)}const n=g(i,["role"]);return n!=null&&_(t,["role"],n),t}function x4(i,t){const e={},n=g(i,["displayName"]);if(t!==void 0&&n!=null&&_(t,["batch","displayName"],n),g(i,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return e}function D4(i,t){const e={},n=g(i,["displayName"]);t!==void 0&&n!=null&&_(t,["displayName"],n);const s=g(i,["dest"]);return t!==void 0&&s!=null&&_(t,["outputConfig"],A4(v4(s))),e}function iC(i,t){const e={},n=g(t,["model"]);n!=null&&_(e,["_url","model"],oe(i,n));const s=g(t,["src"]);s!=null&&_(e,["batch","inputConfig"],w4(i,sM(i,s)));const r=g(t,["config"]);return r!=null&&x4(r,e),e}function N4(i,t){const e={},n=g(t,["model"]);n!=null&&_(e,["model"],oe(i,n));const s=g(t,["src"]);s!=null&&_(e,["inputConfig"],b4(sM(i,s)));const r=g(t,["config"]);return r!=null&&D4(r,e),e}function k4(i,t){const e={},n=g(i,["displayName"]);return t!==void 0&&n!=null&&_(t,["batch","displayName"],n),e}function L4(i,t){const e={},n=g(t,["model"]);n!=null&&_(e,["_url","model"],oe(i,n));const s=g(t,["src"]);s!=null&&_(e,["batch","inputConfig"],G4(i,s));const r=g(t,["config"]);return r!=null&&k4(r,e),e}function O4(i,t){const e={},n=g(t,["name"]);return n!=null&&_(e,["_url","name"],Nc(i,n)),e}function U4(i,t){const e={},n=g(t,["name"]);return n!=null&&_(e,["_url","name"],Nc(i,n)),e}function V4(i){const t={},e=g(i,["sdkHttpResponse"]);e!=null&&_(t,["sdkHttpResponse"],e);const n=g(i,["name"]);n!=null&&_(t,["name"],n);const s=g(i,["done"]);s!=null&&_(t,["done"],s);const r=g(i,["error"]);return r!=null&&_(t,["error"],r),t}function B4(i){const t={},e=g(i,["sdkHttpResponse"]);e!=null&&_(t,["sdkHttpResponse"],e);const n=g(i,["name"]);n!=null&&_(t,["name"],n);const s=g(i,["done"]);s!=null&&_(t,["done"],s);const r=g(i,["error"]);return r!=null&&_(t,["error"],r),t}function F4(i,t){const e={},n=g(t,["contents"]);if(n!=null){let r=oE(i,n);Array.isArray(r)&&(r=r.map(a=>a)),_(e,["requests[]","request","content"],r)}const s=g(t,["config"]);return s!=null&&(_(e,["_self"],H4(s,e)),UF(e,{"requests[].*":"requests[].request.*"})),e}function H4(i,t){const e={},n=g(i,["taskType"]);t!==void 0&&n!=null&&_(t,["requests[]","taskType"],n);const s=g(i,["title"]);t!==void 0&&s!=null&&_(t,["requests[]","title"],s);const r=g(i,["outputDimensionality"]);if(t!==void 0&&r!=null&&_(t,["requests[]","outputDimensionality"],r),g(i,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(g(i,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return e}function G4(i,t){const e={},n=g(t,["fileName"]);n!=null&&_(e,["file_name"],n);const s=g(t,["inlinedRequests"]);return s!=null&&_(e,["requests"],F4(i,s)),e}function q4(i){const t={};if(g(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const e=g(i,["fileUri"]);e!=null&&_(t,["fileUri"],e);const n=g(i,["mimeType"]);return n!=null&&_(t,["mimeType"],n),t}function z4(i){const t={},e=g(i,["id"]);e!=null&&_(t,["id"],e);const n=g(i,["args"]);n!=null&&_(t,["args"],n);const s=g(i,["name"]);if(s!=null&&_(t,["name"],s),g(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(g(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function $4(i){const t={},e=g(i,["mode"]);e!=null&&_(t,["mode"],e);const n=g(i,["allowedFunctionNames"]);if(n!=null&&_(t,["allowedFunctionNames"],n),g(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function Y4(i,t,e){const n={},s=g(t,["systemInstruction"]);e!==void 0&&s!=null&&_(e,["systemInstruction"],aM(Bn(s)));const r=g(t,["temperature"]);r!=null&&_(n,["temperature"],r);const a=g(t,["topP"]);a!=null&&_(n,["topP"],a);const c=g(t,["topK"]);c!=null&&_(n,["topK"],c);const u=g(t,["candidateCount"]);u!=null&&_(n,["candidateCount"],u);const h=g(t,["maxOutputTokens"]);h!=null&&_(n,["maxOutputTokens"],h);const f=g(t,["stopSequences"]);f!=null&&_(n,["stopSequences"],f);const m=g(t,["responseLogprobs"]);m!=null&&_(n,["responseLogprobs"],m);const y=g(t,["logprobs"]);y!=null&&_(n,["logprobs"],y);const T=g(t,["presencePenalty"]);T!=null&&_(n,["presencePenalty"],T);const S=g(t,["frequencyPenalty"]);S!=null&&_(n,["frequencyPenalty"],S);const b=g(t,["seed"]);b!=null&&_(n,["seed"],b);const C=g(t,["responseMimeType"]);C!=null&&_(n,["responseMimeType"],C);const I=g(t,["responseSchema"]);I!=null&&_(n,["responseSchema"],aE(I));const D=g(t,["responseJsonSchema"]);if(D!=null&&_(n,["responseJsonSchema"],D),g(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(g(t,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const P=g(t,["safetySettings"]);if(e!==void 0&&P!=null){let B=P;Array.isArray(B)&&(B=B.map(vt=>l3(vt))),_(e,["safetySettings"],B)}const H=g(t,["tools"]);if(e!==void 0&&H!=null){let B=Dc(H);Array.isArray(B)&&(B=B.map(vt=>u3(xc(vt)))),_(e,["tools"],B)}const F=g(t,["toolConfig"]);if(e!==void 0&&F!=null&&_(e,["toolConfig"],c3(F)),g(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const G=g(t,["cachedContent"]);e!==void 0&&G!=null&&_(e,["cachedContent"],Ir(i,G));const N=g(t,["responseModalities"]);N!=null&&_(n,["responseModalities"],N);const x=g(t,["mediaResolution"]);x!=null&&_(n,["mediaResolution"],x);const k=g(t,["speechConfig"]);if(k!=null&&_(n,["speechConfig"],lE(k)),g(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const V=g(t,["thinkingConfig"]);V!=null&&_(n,["thinkingConfig"],V);const U=g(t,["imageConfig"]);U!=null&&_(n,["imageConfig"],j4(U));const $=g(t,["enableEnhancedCivicAnswers"]);return $!=null&&_(n,["enableEnhancedCivicAnswers"],$),n}function W4(i){const t={},e=g(i,["sdkHttpResponse"]);e!=null&&_(t,["sdkHttpResponse"],e);const n=g(i,["candidates"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(h=>M4(h))),_(t,["candidates"],u)}const s=g(i,["modelVersion"]);s!=null&&_(t,["modelVersion"],s);const r=g(i,["promptFeedback"]);r!=null&&_(t,["promptFeedback"],r);const a=g(i,["responseId"]);a!=null&&_(t,["responseId"],a);const c=g(i,["usageMetadata"]);return c!=null&&_(t,["usageMetadata"],c),t}function K4(i,t){const e={},n=g(t,["name"]);return n!=null&&_(e,["_url","name"],Nc(i,n)),e}function X4(i,t){const e={},n=g(t,["name"]);return n!=null&&_(e,["_url","name"],Nc(i,n)),e}function J4(i){const t={};if(g(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const e=g(i,["enableWidget"]);return e!=null&&_(t,["enableWidget"],e),t}function Q4(i){const t={};if(g(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(g(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const e=g(i,["timeRangeFilter"]);return e!=null&&_(t,["timeRangeFilter"],e),t}function j4(i){const t={},e=g(i,["aspectRatio"]);e!=null&&_(t,["aspectRatio"],e);const n=g(i,["imageSize"]);if(n!=null&&_(t,["imageSize"],n),g(i,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(g(i,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}function Z4(i,t){const e={},n=g(t,["model"]);n!=null&&_(e,["request","model"],oe(i,n));const s=g(t,["contents"]);if(s!=null){let c=Ui(s);Array.isArray(c)&&(c=c.map(u=>aM(u))),_(e,["request","contents"],c)}const r=g(t,["metadata"]);r!=null&&_(e,["metadata"],r);const a=g(t,["config"]);return a!=null&&_(e,["request","generationConfig"],Y4(i,a,g(e,["request"],{}))),e}function t3(i){const t={},e=g(i,["response"]);e!=null&&_(t,["response"],W4(e));const n=g(i,["error"]);return n!=null&&_(t,["error"],n),t}function e3(i,t){const e={},n=g(i,["pageSize"]);t!==void 0&&n!=null&&_(t,["_query","pageSize"],n);const s=g(i,["pageToken"]);if(t!==void 0&&s!=null&&_(t,["_query","pageToken"],s),g(i,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return e}function n3(i,t){const e={},n=g(i,["pageSize"]);t!==void 0&&n!=null&&_(t,["_query","pageSize"],n);const s=g(i,["pageToken"]);t!==void 0&&s!=null&&_(t,["_query","pageToken"],s);const r=g(i,["filter"]);return t!==void 0&&r!=null&&_(t,["_query","filter"],r),e}function i3(i){const t={},e=g(i,["config"]);return e!=null&&e3(e,t),t}function s3(i){const t={},e=g(i,["config"]);return e!=null&&n3(e,t),t}function r3(i){const t={},e=g(i,["sdkHttpResponse"]);e!=null&&_(t,["sdkHttpResponse"],e);const n=g(i,["nextPageToken"]);n!=null&&_(t,["nextPageToken"],n);const s=g(i,["operations"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>Xf(a))),_(t,["batchJobs"],r)}return t}function o3(i){const t={},e=g(i,["sdkHttpResponse"]);e!=null&&_(t,["sdkHttpResponse"],e);const n=g(i,["nextPageToken"]);n!=null&&_(t,["nextPageToken"],n);const s=g(i,["batchPredictionJobs"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>D_(a))),_(t,["batchJobs"],r)}return t}function a3(i){const t={},e=g(i,["mediaResolution"]);e!=null&&_(t,["mediaResolution"],e);const n=g(i,["codeExecutionResult"]);n!=null&&_(t,["codeExecutionResult"],n);const s=g(i,["executableCode"]);s!=null&&_(t,["executableCode"],s);const r=g(i,["fileData"]);r!=null&&_(t,["fileData"],q4(r));const a=g(i,["functionCall"]);a!=null&&_(t,["functionCall"],z4(a));const c=g(i,["functionResponse"]);c!=null&&_(t,["functionResponse"],c);const u=g(i,["inlineData"]);u!=null&&_(t,["inlineData"],C4(u));const h=g(i,["text"]);h!=null&&_(t,["text"],h);const f=g(i,["thought"]);f!=null&&_(t,["thought"],f);const m=g(i,["thoughtSignature"]);m!=null&&_(t,["thoughtSignature"],m);const y=g(i,["videoMetadata"]);return y!=null&&_(t,["videoMetadata"],y),t}function l3(i){const t={},e=g(i,["category"]);if(e!=null&&_(t,["category"],e),g(i,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=g(i,["threshold"]);return n!=null&&_(t,["threshold"],n),t}function c3(i){const t={},e=g(i,["functionCallingConfig"]);e!=null&&_(t,["functionCallingConfig"],$4(e));const n=g(i,["retrievalConfig"]);return n!=null&&_(t,["retrievalConfig"],n),t}function u3(i){const t={},e=g(i,["functionDeclarations"]);if(e!=null){let f=e;Array.isArray(f)&&(f=f.map(m=>m)),_(t,["functionDeclarations"],f)}if(g(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=g(i,["googleSearchRetrieval"]);n!=null&&_(t,["googleSearchRetrieval"],n);const s=g(i,["computerUse"]);s!=null&&_(t,["computerUse"],s);const r=g(i,["fileSearch"]);r!=null&&_(t,["fileSearch"],r);const a=g(i,["codeExecution"]);if(a!=null&&_(t,["codeExecution"],a),g(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const c=g(i,["googleMaps"]);c!=null&&_(t,["googleMaps"],J4(c));const u=g(i,["googleSearch"]);u!=null&&_(t,["googleSearch"],Q4(u));const h=g(i,["urlContext"]);return h!=null&&_(t,["urlContext"],h),t}var br;(function(i){i.PAGED_ITEM_BATCH_JOBS="batchJobs",i.PAGED_ITEM_MODELS="models",i.PAGED_ITEM_TUNING_JOBS="tuningJobs",i.PAGED_ITEM_FILES="files",i.PAGED_ITEM_CACHED_CONTENTS="cachedContents",i.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",i.PAGED_ITEM_DOCUMENTS="documents"})(br||(br={}));class $a{constructor(t,e,n,s){this.pageInternal=[],this.paramsInternal={},this.requestInternal=e,this.init(t,n,s)}init(t,e,n){var s,r;this.nameInternal=t,this.pageInternal=e[this.nameInternal]||[],this.sdkHttpResponseInternal=e?.sdkHttpResponse,this.idxInternal=0;let a={config:{}};!n||Object.keys(n).length===0?a={config:{}}:typeof n=="object"?a=Object.assign({},n):a=n,a.config&&(a.config.pageToken=e.nextPageToken),this.paramsInternal=a,this.pageInternalSize=(r=(s=a.config)===null||s===void 0?void 0:s.pageSize)!==null&&r!==void 0?r:this.pageInternal.length}initNextPage(t){this.init(this.nameInternal,t,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(t){return this.pageInternal[t]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const t=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:t,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const t=await this.requestInternal(this.params);return this.initNextPage(t),this.page}hasNextPage(){var t;return((t=this.params.config)===null||t===void 0?void 0:t.pageToken)!==void 0}}class h3 extends Cr{constructor(t){super(),this.apiClient=t,this.list=async(e={})=>new $a(br.PAGED_ITEM_BATCH_JOBS,n=>this.listInternal(n),await this.listInternal(e),e),this.create=async e=>(this.apiClient.isVertexAI()&&(e.config=this.formatDestination(e.src,e.config)),this.createInternal(e)),this.createEmbeddings=async e=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(e)}}createInlinedGenerateContentRequest(t){const e=iC(this.apiClient,t),n=e._url,s=gt("{model}:batchGenerateContent",n),c=e.batch.inputConfig.requests,u=c.requests,h=[];for(const f of u){const m=Object.assign({},f);if(m.systemInstruction){const y=m.systemInstruction;delete m.systemInstruction;const T=m.request;T.systemInstruction=y,m.request=T}h.push(m)}return c.requests=h,delete e.config,delete e._url,delete e._query,{path:s,body:e}}getGcsUri(t){if(typeof t=="string")return t.startsWith("gs://")?t:void 0;if(!Array.isArray(t)&&t.gcsUri&&t.gcsUri.length>0)return t.gcsUri[0]}getBigqueryUri(t){if(typeof t=="string")return t.startsWith("bq://")?t:void 0;if(!Array.isArray(t))return t.bigqueryUri}formatDestination(t,e){const n=e?Object.assign({},e):{},s=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${s}`),n.dest===void 0){const r=this.getGcsUri(t),a=this.getBigqueryUri(t);if(r)r.endsWith(".jsonl")?n.dest=`${r.slice(0,-6)}/dest`:n.dest=`${r}_dest_${s}`;else if(a)n.dest=`${a}_dest_${s}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return n}async createInternal(t){var e,n,s,r;let a,c="",u={};if(this.apiClient.isVertexAI()){const h=N4(this.apiClient,t);return c=gt("batchPredictionJobs",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>D_(f))}else{const h=iC(this.apiClient,t);return c=gt("{model}:batchGenerateContent",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a.then(f=>Xf(f))}}async createEmbeddingsInternal(t){var e,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=L4(this.apiClient,t);return r=gt("{model}:asyncBatchEmbedContent",c._url),a=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),s.then(u=>Xf(u))}}async get(t){var e,n,s,r;let a,c="",u={};if(this.apiClient.isVertexAI()){const h=X4(this.apiClient,t);return c=gt("batchPredictionJobs/{name}",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>D_(f))}else{const h=K4(this.apiClient,t);return c=gt("batches/{name}",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a.then(f=>Xf(f))}}async cancel(t){var e,n,s,r;let a="",c={};if(this.apiClient.isVertexAI()){const u=R4(this.apiClient,t);a=gt("batchPredictionJobs/{name}:cancel",u._url),c=u._query,delete u._url,delete u._query,await this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal})}else{const u=I4(this.apiClient,t);a=gt("batches/{name}:cancel",u._url),c=u._query,delete u._url,delete u._query,await this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(t){var e,n,s,r;let a,c="",u={};if(this.apiClient.isVertexAI()){const h=s3(t);return c=gt("batchPredictionJobs",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:f.headers},y})),a.then(f=>{const m=o3(f),y=new Zb;return Object.assign(y,m),y})}else{const h=i3(t);return c=gt("batches",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:f.headers},y})),a.then(f=>{const m=r3(f),y=new Zb;return Object.assign(y,m),y})}}async delete(t){var e,n,s,r;let a,c="",u={};if(this.apiClient.isVertexAI()){const h=U4(this.apiClient,t);return c=gt("batchPredictionJobs/{name}",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:f.headers},y})),a.then(f=>B4(f))}else{const h=O4(this.apiClient,t);return c=gt("batches/{name}",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:f.headers},y})),a.then(f=>V4(f))}}}function d3(i){const t={},e=g(i,["data"]);if(e!=null&&_(t,["data"],e),g(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=g(i,["mimeType"]);return n!=null&&_(t,["mimeType"],n),t}function sC(i){const t={},e=g(i,["parts"]);if(e!=null){let s=e;Array.isArray(s)&&(s=s.map(r=>L3(r))),_(t,["parts"],s)}const n=g(i,["role"]);return n!=null&&_(t,["role"],n),t}function f3(i,t){const e={},n=g(i,["ttl"]);t!==void 0&&n!=null&&_(t,["ttl"],n);const s=g(i,["expireTime"]);t!==void 0&&s!=null&&_(t,["expireTime"],s);const r=g(i,["displayName"]);t!==void 0&&r!=null&&_(t,["displayName"],r);const a=g(i,["contents"]);if(t!==void 0&&a!=null){let f=Ui(a);Array.isArray(f)&&(f=f.map(m=>sC(m))),_(t,["contents"],f)}const c=g(i,["systemInstruction"]);t!==void 0&&c!=null&&_(t,["systemInstruction"],sC(Bn(c)));const u=g(i,["tools"]);if(t!==void 0&&u!=null){let f=u;Array.isArray(f)&&(f=f.map(m=>U3(m))),_(t,["tools"],f)}const h=g(i,["toolConfig"]);if(t!==void 0&&h!=null&&_(t,["toolConfig"],O3(h)),g(i,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return e}function p3(i,t){const e={},n=g(i,["ttl"]);t!==void 0&&n!=null&&_(t,["ttl"],n);const s=g(i,["expireTime"]);t!==void 0&&s!=null&&_(t,["expireTime"],s);const r=g(i,["displayName"]);t!==void 0&&r!=null&&_(t,["displayName"],r);const a=g(i,["contents"]);if(t!==void 0&&a!=null){let m=Ui(a);Array.isArray(m)&&(m=m.map(y=>y)),_(t,["contents"],m)}const c=g(i,["systemInstruction"]);t!==void 0&&c!=null&&_(t,["systemInstruction"],Bn(c));const u=g(i,["tools"]);if(t!==void 0&&u!=null){let m=u;Array.isArray(m)&&(m=m.map(y=>V3(y))),_(t,["tools"],m)}const h=g(i,["toolConfig"]);t!==void 0&&h!=null&&_(t,["toolConfig"],h);const f=g(i,["kmsKeyName"]);return t!==void 0&&f!=null&&_(t,["encryption_spec","kmsKeyName"],f),e}function m3(i,t){const e={},n=g(t,["model"]);n!=null&&_(e,["model"],X1(i,n));const s=g(t,["config"]);return s!=null&&f3(s,e),e}function g3(i,t){const e={},n=g(t,["model"]);n!=null&&_(e,["model"],X1(i,n));const s=g(t,["config"]);return s!=null&&p3(s,e),e}function y3(i,t){const e={},n=g(t,["name"]);return n!=null&&_(e,["_url","name"],Ir(i,n)),e}function _3(i,t){const e={},n=g(t,["name"]);return n!=null&&_(e,["_url","name"],Ir(i,n)),e}function v3(i){const t={},e=g(i,["sdkHttpResponse"]);return e!=null&&_(t,["sdkHttpResponse"],e),t}function E3(i){const t={},e=g(i,["sdkHttpResponse"]);return e!=null&&_(t,["sdkHttpResponse"],e),t}function T3(i){const t={};if(g(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const e=g(i,["fileUri"]);e!=null&&_(t,["fileUri"],e);const n=g(i,["mimeType"]);return n!=null&&_(t,["mimeType"],n),t}function A3(i){const t={},e=g(i,["id"]);e!=null&&_(t,["id"],e);const n=g(i,["args"]);n!=null&&_(t,["args"],n);const s=g(i,["name"]);if(s!=null&&_(t,["name"],s),g(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(g(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function S3(i){const t={},e=g(i,["mode"]);e!=null&&_(t,["mode"],e);const n=g(i,["allowedFunctionNames"]);if(n!=null&&_(t,["allowedFunctionNames"],n),g(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function w3(i){const t={};if(g(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const e=g(i,["description"]);e!=null&&_(t,["description"],e);const n=g(i,["name"]);n!=null&&_(t,["name"],n);const s=g(i,["parameters"]);s!=null&&_(t,["parameters"],s);const r=g(i,["parametersJsonSchema"]);r!=null&&_(t,["parametersJsonSchema"],r);const a=g(i,["response"]);a!=null&&_(t,["response"],a);const c=g(i,["responseJsonSchema"]);return c!=null&&_(t,["responseJsonSchema"],c),t}function b3(i,t){const e={},n=g(t,["name"]);return n!=null&&_(e,["_url","name"],Ir(i,n)),e}function C3(i,t){const e={},n=g(t,["name"]);return n!=null&&_(e,["_url","name"],Ir(i,n)),e}function I3(i){const t={};if(g(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const e=g(i,["enableWidget"]);return e!=null&&_(t,["enableWidget"],e),t}function R3(i){const t={};if(g(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(g(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const e=g(i,["timeRangeFilter"]);return e!=null&&_(t,["timeRangeFilter"],e),t}function M3(i,t){const e={},n=g(i,["pageSize"]);t!==void 0&&n!=null&&_(t,["_query","pageSize"],n);const s=g(i,["pageToken"]);return t!==void 0&&s!=null&&_(t,["_query","pageToken"],s),e}function P3(i,t){const e={},n=g(i,["pageSize"]);t!==void 0&&n!=null&&_(t,["_query","pageSize"],n);const s=g(i,["pageToken"]);return t!==void 0&&s!=null&&_(t,["_query","pageToken"],s),e}function x3(i){const t={},e=g(i,["config"]);return e!=null&&M3(e,t),t}function D3(i){const t={},e=g(i,["config"]);return e!=null&&P3(e,t),t}function N3(i){const t={},e=g(i,["sdkHttpResponse"]);e!=null&&_(t,["sdkHttpResponse"],e);const n=g(i,["nextPageToken"]);n!=null&&_(t,["nextPageToken"],n);const s=g(i,["cachedContents"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>a)),_(t,["cachedContents"],r)}return t}function k3(i){const t={},e=g(i,["sdkHttpResponse"]);e!=null&&_(t,["sdkHttpResponse"],e);const n=g(i,["nextPageToken"]);n!=null&&_(t,["nextPageToken"],n);const s=g(i,["cachedContents"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>a)),_(t,["cachedContents"],r)}return t}function L3(i){const t={},e=g(i,["mediaResolution"]);e!=null&&_(t,["mediaResolution"],e);const n=g(i,["codeExecutionResult"]);n!=null&&_(t,["codeExecutionResult"],n);const s=g(i,["executableCode"]);s!=null&&_(t,["executableCode"],s);const r=g(i,["fileData"]);r!=null&&_(t,["fileData"],T3(r));const a=g(i,["functionCall"]);a!=null&&_(t,["functionCall"],A3(a));const c=g(i,["functionResponse"]);c!=null&&_(t,["functionResponse"],c);const u=g(i,["inlineData"]);u!=null&&_(t,["inlineData"],d3(u));const h=g(i,["text"]);h!=null&&_(t,["text"],h);const f=g(i,["thought"]);f!=null&&_(t,["thought"],f);const m=g(i,["thoughtSignature"]);m!=null&&_(t,["thoughtSignature"],m);const y=g(i,["videoMetadata"]);return y!=null&&_(t,["videoMetadata"],y),t}function O3(i){const t={},e=g(i,["functionCallingConfig"]);e!=null&&_(t,["functionCallingConfig"],S3(e));const n=g(i,["retrievalConfig"]);return n!=null&&_(t,["retrievalConfig"],n),t}function U3(i){const t={},e=g(i,["functionDeclarations"]);if(e!=null){let f=e;Array.isArray(f)&&(f=f.map(m=>m)),_(t,["functionDeclarations"],f)}if(g(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=g(i,["googleSearchRetrieval"]);n!=null&&_(t,["googleSearchRetrieval"],n);const s=g(i,["computerUse"]);s!=null&&_(t,["computerUse"],s);const r=g(i,["fileSearch"]);r!=null&&_(t,["fileSearch"],r);const a=g(i,["codeExecution"]);if(a!=null&&_(t,["codeExecution"],a),g(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const c=g(i,["googleMaps"]);c!=null&&_(t,["googleMaps"],I3(c));const u=g(i,["googleSearch"]);u!=null&&_(t,["googleSearch"],R3(u));const h=g(i,["urlContext"]);return h!=null&&_(t,["urlContext"],h),t}function V3(i){const t={},e=g(i,["functionDeclarations"]);if(e!=null){let m=e;Array.isArray(m)&&(m=m.map(y=>w3(y))),_(t,["functionDeclarations"],m)}const n=g(i,["retrieval"]);n!=null&&_(t,["retrieval"],n);const s=g(i,["googleSearchRetrieval"]);s!=null&&_(t,["googleSearchRetrieval"],s);const r=g(i,["computerUse"]);if(r!=null&&_(t,["computerUse"],r),g(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const a=g(i,["codeExecution"]);a!=null&&_(t,["codeExecution"],a);const c=g(i,["enterpriseWebSearch"]);c!=null&&_(t,["enterpriseWebSearch"],c);const u=g(i,["googleMaps"]);u!=null&&_(t,["googleMaps"],u);const h=g(i,["googleSearch"]);h!=null&&_(t,["googleSearch"],h);const f=g(i,["urlContext"]);return f!=null&&_(t,["urlContext"],f),t}function B3(i,t){const e={},n=g(i,["ttl"]);t!==void 0&&n!=null&&_(t,["ttl"],n);const s=g(i,["expireTime"]);return t!==void 0&&s!=null&&_(t,["expireTime"],s),e}function F3(i,t){const e={},n=g(i,["ttl"]);t!==void 0&&n!=null&&_(t,["ttl"],n);const s=g(i,["expireTime"]);return t!==void 0&&s!=null&&_(t,["expireTime"],s),e}function H3(i,t){const e={},n=g(t,["name"]);n!=null&&_(e,["_url","name"],Ir(i,n));const s=g(t,["config"]);return s!=null&&B3(s,e),e}function G3(i,t){const e={},n=g(t,["name"]);n!=null&&_(e,["_url","name"],Ir(i,n));const s=g(t,["config"]);return s!=null&&F3(s,e),e}class q3 extends Cr{constructor(t){super(),this.apiClient=t,this.list=async(e={})=>new $a(br.PAGED_ITEM_CACHED_CONTENTS,n=>this.listInternal(n),await this.listInternal(e),e)}async create(t){var e,n,s,r;let a,c="",u={};if(this.apiClient.isVertexAI()){const h=g3(this.apiClient,t);return c=gt("cachedContents",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>f)}else{const h=m3(this.apiClient,t);return c=gt("cachedContents",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a.then(f=>f)}}async get(t){var e,n,s,r;let a,c="",u={};if(this.apiClient.isVertexAI()){const h=C3(this.apiClient,t);return c=gt("{name}",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>f)}else{const h=b3(this.apiClient,t);return c=gt("{name}",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a.then(f=>f)}}async delete(t){var e,n,s,r;let a,c="",u={};if(this.apiClient.isVertexAI()){const h=_3(this.apiClient,t);return c=gt("{name}",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:f.headers},y})),a.then(f=>{const m=E3(f),y=new Qb;return Object.assign(y,m),y})}else{const h=y3(this.apiClient,t);return c=gt("{name}",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:f.headers},y})),a.then(f=>{const m=v3(f),y=new Qb;return Object.assign(y,m),y})}}async update(t){var e,n,s,r;let a,c="",u={};if(this.apiClient.isVertexAI()){const h=G3(this.apiClient,t);return c=gt("{name}",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>f)}else{const h=H3(this.apiClient,t);return c=gt("{name}",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a.then(f=>f)}}async listInternal(t){var e,n,s,r;let a,c="",u={};if(this.apiClient.isVertexAI()){const h=D3(t);return c=gt("cachedContents",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:f.headers},y})),a.then(f=>{const m=k3(f),y=new jb;return Object.assign(y,m),y})}else{const h=x3(t);return c=gt("cachedContents",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:f.headers},y})),a.then(f=>{const m=N3(f),y=new jb;return Object.assign(y,m),y})}}}function Rp(i,t){var e={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(e[n[s]]=i[n[s]]);return e}function rC(i){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&i[t],n=0;if(e)return e.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&n>=i.length&&(i=void 0),{value:i&&i[n++],done:!i}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ut(i){return this instanceof Ut?(this.v=i,this):new Ut(i)}function ns(i,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=e.apply(i,t||[]),s,r=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),c("next"),c("throw"),c("return",a),s[Symbol.asyncIterator]=function(){return this},s;function a(T){return function(S){return Promise.resolve(S).then(T,m)}}function c(T,S){n[T]&&(s[T]=function(b){return new Promise(function(C,I){r.push([T,b,C,I])>1||u(T,b)})},S&&(s[T]=S(s[T])))}function u(T,S){try{h(n[T](S))}catch(b){y(r[0][3],b)}}function h(T){T.value instanceof Ut?Promise.resolve(T.value.v).then(f,m):y(r[0][2],T)}function f(T){u("next",T)}function m(T){u("throw",T)}function y(T,S){T(S),r.shift(),r.length&&u(r[0][0],r[0][1])}}function is(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=i[Symbol.asyncIterator],e;return t?t.call(i):(i=typeof rC=="function"?rC(i):i[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=i[r]&&function(a){return new Promise(function(c,u){a=i[r](a),s(c,u,a.done,a.value)})}}function s(r,a,c,u){Promise.resolve(u).then(function(h){r({value:h,done:c})},a)}}function z3(i){var t;if(i.candidates==null||i.candidates.length===0)return!1;const e=(t=i.candidates[0])===null||t===void 0?void 0:t.content;return e===void 0?!1:lM(e)}function lM(i){if(i.parts===void 0||i.parts.length===0)return!1;for(const t of i.parts)if(t===void 0||Object.keys(t).length===0)return!1;return!0}function $3(i){if(i.length!==0){for(const t of i)if(t.role!=="user"&&t.role!=="model")throw new Error(`Role must be user or model, but got ${t.role}.`)}}function oC(i){if(i===void 0||i.length===0)return[];const t=[],e=i.length;let n=0;for(;n<e;)if(i[n].role==="user")t.push(i[n]),n++;else{const s=[];let r=!0;for(;n<e&&i[n].role==="model";)s.push(i[n]),r&&!lM(i[n])&&(r=!1),n++;r?t.push(...s):t.pop()}return t}class Y3{constructor(t,e){this.modelsModule=t,this.apiClient=e}create(t){return new W3(this.apiClient,this.modelsModule,t.model,t.config,structuredClone(t.history))}}class W3{constructor(t,e,n,s={},r=[]){this.apiClient=t,this.modelsModule=e,this.model=n,this.config=s,this.history=r,this.sendPromise=Promise.resolve(),$3(r)}async sendMessage(t){var e;await this.sendPromise;const n=Bn(t.message),s=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:(e=t.config)!==null&&e!==void 0?e:this.config});return this.sendPromise=(async()=>{var r,a,c;const u=await s,h=(a=(r=u.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content,f=u.automaticFunctionCallingHistory,m=this.getHistory(!0).length;let y=[];f!=null&&(y=(c=f.slice(m))!==null&&c!==void 0?c:[]);const T=h?[h]:[];this.recordHistory(n,T,y)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),s}async sendMessageStream(t){var e;await this.sendPromise;const n=Bn(t.message),s=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:(e=t.config)!==null&&e!==void 0?e:this.config});this.sendPromise=s.then(()=>{}).catch(()=>{});const r=await s;return this.processStreamResponse(r,n)}getHistory(t=!1){const e=t?oC(this.history):this.history;return structuredClone(e)}processStreamResponse(t,e){return ns(this,arguments,function*(){var s,r,a,c,u,h;const f=[];try{for(var m=!0,y=is(t),T;T=yield Ut(y.next()),s=T.done,!s;m=!0){c=T.value,m=!1;const S=c;if(z3(S)){const b=(h=(u=S.candidates)===null||u===void 0?void 0:u[0])===null||h===void 0?void 0:h.content;b!==void 0&&f.push(b)}yield yield Ut(S)}}catch(S){r={error:S}}finally{try{!m&&!s&&(a=y.return)&&(yield Ut(a.call(y)))}finally{if(r)throw r.error}}this.recordHistory(e,f)})}recordHistory(t,e,n){let s=[];e.length>0&&e.every(r=>r.role!==void 0)?s=e:s.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...oC(n)):this.history.push(t),this.history.push(...s)}}class rm extends Error{constructor(t){super(t.message),this.name="ApiError",this.status=t.status,Object.setPrototypeOf(this,rm.prototype)}}function K3(i){const t={},e=g(i,["file"]);return e!=null&&_(t,["file"],e),t}function X3(i){const t={},e=g(i,["sdkHttpResponse"]);return e!=null&&_(t,["sdkHttpResponse"],e),t}function J3(i){const t={},e=g(i,["name"]);return e!=null&&_(t,["_url","file"],eM(e)),t}function Q3(i){const t={},e=g(i,["sdkHttpResponse"]);return e!=null&&_(t,["sdkHttpResponse"],e),t}function j3(i){const t={},e=g(i,["name"]);return e!=null&&_(t,["_url","file"],eM(e)),t}function Z3(i,t){const e={},n=g(i,["pageSize"]);t!==void 0&&n!=null&&_(t,["_query","pageSize"],n);const s=g(i,["pageToken"]);return t!==void 0&&s!=null&&_(t,["_query","pageToken"],s),e}function tH(i){const t={},e=g(i,["config"]);return e!=null&&Z3(e,t),t}function eH(i){const t={},e=g(i,["sdkHttpResponse"]);e!=null&&_(t,["sdkHttpResponse"],e);const n=g(i,["nextPageToken"]);n!=null&&_(t,["nextPageToken"],n);const s=g(i,["files"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>a)),_(t,["files"],r)}return t}class nH extends Cr{constructor(t){super(),this.apiClient=t,this.list=async(e={})=>new $a(br.PAGED_ITEM_FILES,n=>this.listInternal(n),await this.listInternal(e),e)}async upload(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(t.file,t.config).then(e=>e)}async download(t){await this.apiClient.downloadFile(t)}async listInternal(t){var e,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=tH(t);return r=gt("files",c._url),a=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json().then(h=>{const f=h;return f.sdkHttpResponse={headers:u.headers},f})),s.then(u=>{const h=eH(u),f=new o4;return Object.assign(f,h),f})}}async createInternal(t){var e,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=K3(t);return r=gt("upload/v1beta/files",c._url),a=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),s.then(u=>{const h=X3(u),f=new a4;return Object.assign(f,h),f})}}async get(t){var e,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=j3(t);return r=gt("files/{file}",c._url),a=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),s.then(u=>u)}}async delete(t){var e,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=J3(t);return r=gt("files/{file}",c._url),a=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json().then(h=>{const f=h;return f.sdkHttpResponse={headers:u.headers},f})),s.then(u=>{const h=Q3(u),f=new l4;return Object.assign(f,h),f})}}}function Jf(i){const t={},e=g(i,["data"]);if(e!=null&&_(t,["data"],e),g(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=g(i,["mimeType"]);return n!=null&&_(t,["mimeType"],n),t}function iH(i){const t={},e=g(i,["parts"]);if(e!=null){let s=e;Array.isArray(s)&&(s=s.map(r=>vH(r))),_(t,["parts"],s)}const n=g(i,["role"]);return n!=null&&_(t,["role"],n),t}function sH(i){const t={};if(g(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const e=g(i,["fileUri"]);e!=null&&_(t,["fileUri"],e);const n=g(i,["mimeType"]);return n!=null&&_(t,["mimeType"],n),t}function rH(i){const t={},e=g(i,["id"]);e!=null&&_(t,["id"],e);const n=g(i,["args"]);n!=null&&_(t,["args"],n);const s=g(i,["name"]);if(s!=null&&_(t,["name"],s),g(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(g(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function oH(i){const t={};if(g(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const e=g(i,["description"]);e!=null&&_(t,["description"],e);const n=g(i,["name"]);n!=null&&_(t,["name"],n);const s=g(i,["parameters"]);s!=null&&_(t,["parameters"],s);const r=g(i,["parametersJsonSchema"]);r!=null&&_(t,["parametersJsonSchema"],r);const a=g(i,["response"]);a!=null&&_(t,["response"],a);const c=g(i,["responseJsonSchema"]);return c!=null&&_(t,["responseJsonSchema"],c),t}function aH(i){const t={},e=g(i,["modelSelectionConfig"]);e!=null&&_(t,["modelConfig"],e);const n=g(i,["responseJsonSchema"]);n!=null&&_(t,["responseJsonSchema"],n);const s=g(i,["audioTimestamp"]);s!=null&&_(t,["audioTimestamp"],s);const r=g(i,["candidateCount"]);r!=null&&_(t,["candidateCount"],r);const a=g(i,["enableAffectiveDialog"]);a!=null&&_(t,["enableAffectiveDialog"],a);const c=g(i,["frequencyPenalty"]);c!=null&&_(t,["frequencyPenalty"],c);const u=g(i,["logprobs"]);u!=null&&_(t,["logprobs"],u);const h=g(i,["maxOutputTokens"]);h!=null&&_(t,["maxOutputTokens"],h);const f=g(i,["mediaResolution"]);f!=null&&_(t,["mediaResolution"],f);const m=g(i,["presencePenalty"]);m!=null&&_(t,["presencePenalty"],m);const y=g(i,["responseLogprobs"]);y!=null&&_(t,["responseLogprobs"],y);const T=g(i,["responseMimeType"]);T!=null&&_(t,["responseMimeType"],T);const S=g(i,["responseModalities"]);S!=null&&_(t,["responseModalities"],S);const b=g(i,["responseSchema"]);b!=null&&_(t,["responseSchema"],b);const C=g(i,["routingConfig"]);C!=null&&_(t,["routingConfig"],C);const I=g(i,["seed"]);I!=null&&_(t,["seed"],I);const D=g(i,["speechConfig"]);D!=null&&_(t,["speechConfig"],D);const P=g(i,["stopSequences"]);P!=null&&_(t,["stopSequences"],P);const H=g(i,["temperature"]);H!=null&&_(t,["temperature"],H);const F=g(i,["thinkingConfig"]);F!=null&&_(t,["thinkingConfig"],F);const G=g(i,["topK"]);G!=null&&_(t,["topK"],G);const N=g(i,["topP"]);if(N!=null&&_(t,["topP"],N),g(i,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}function lH(i){const t={};if(g(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const e=g(i,["enableWidget"]);return e!=null&&_(t,["enableWidget"],e),t}function cH(i){const t={};if(g(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(g(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const e=g(i,["timeRangeFilter"]);return e!=null&&_(t,["timeRangeFilter"],e),t}function uH(i,t){const e={},n=g(i,["generationConfig"]);t!==void 0&&n!=null&&_(t,["setup","generationConfig"],n);const s=g(i,["responseModalities"]);t!==void 0&&s!=null&&_(t,["setup","generationConfig","responseModalities"],s);const r=g(i,["temperature"]);t!==void 0&&r!=null&&_(t,["setup","generationConfig","temperature"],r);const a=g(i,["topP"]);t!==void 0&&a!=null&&_(t,["setup","generationConfig","topP"],a);const c=g(i,["topK"]);t!==void 0&&c!=null&&_(t,["setup","generationConfig","topK"],c);const u=g(i,["maxOutputTokens"]);t!==void 0&&u!=null&&_(t,["setup","generationConfig","maxOutputTokens"],u);const h=g(i,["mediaResolution"]);t!==void 0&&h!=null&&_(t,["setup","generationConfig","mediaResolution"],h);const f=g(i,["seed"]);t!==void 0&&f!=null&&_(t,["setup","generationConfig","seed"],f);const m=g(i,["speechConfig"]);t!==void 0&&m!=null&&_(t,["setup","generationConfig","speechConfig"],cE(m));const y=g(i,["thinkingConfig"]);t!==void 0&&y!=null&&_(t,["setup","generationConfig","thinkingConfig"],y);const T=g(i,["enableAffectiveDialog"]);t!==void 0&&T!=null&&_(t,["setup","generationConfig","enableAffectiveDialog"],T);const S=g(i,["systemInstruction"]);t!==void 0&&S!=null&&_(t,["setup","systemInstruction"],iH(Bn(S)));const b=g(i,["tools"]);if(t!==void 0&&b!=null){let G=Dc(b);Array.isArray(G)&&(G=G.map(N=>TH(xc(N)))),_(t,["setup","tools"],G)}const C=g(i,["sessionResumption"]);t!==void 0&&C!=null&&_(t,["setup","sessionResumption"],EH(C));const I=g(i,["inputAudioTranscription"]);t!==void 0&&I!=null&&_(t,["setup","inputAudioTranscription"],I);const D=g(i,["outputAudioTranscription"]);t!==void 0&&D!=null&&_(t,["setup","outputAudioTranscription"],D);const P=g(i,["realtimeInputConfig"]);t!==void 0&&P!=null&&_(t,["setup","realtimeInputConfig"],P);const H=g(i,["contextWindowCompression"]);t!==void 0&&H!=null&&_(t,["setup","contextWindowCompression"],H);const F=g(i,["proactivity"]);if(t!==void 0&&F!=null&&_(t,["setup","proactivity"],F),g(i,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return e}function hH(i,t){const e={},n=g(i,["generationConfig"]);t!==void 0&&n!=null&&_(t,["setup","generationConfig"],aH(n));const s=g(i,["responseModalities"]);t!==void 0&&s!=null&&_(t,["setup","generationConfig","responseModalities"],s);const r=g(i,["temperature"]);t!==void 0&&r!=null&&_(t,["setup","generationConfig","temperature"],r);const a=g(i,["topP"]);t!==void 0&&a!=null&&_(t,["setup","generationConfig","topP"],a);const c=g(i,["topK"]);t!==void 0&&c!=null&&_(t,["setup","generationConfig","topK"],c);const u=g(i,["maxOutputTokens"]);t!==void 0&&u!=null&&_(t,["setup","generationConfig","maxOutputTokens"],u);const h=g(i,["mediaResolution"]);t!==void 0&&h!=null&&_(t,["setup","generationConfig","mediaResolution"],h);const f=g(i,["seed"]);t!==void 0&&f!=null&&_(t,["setup","generationConfig","seed"],f);const m=g(i,["speechConfig"]);t!==void 0&&m!=null&&_(t,["setup","generationConfig","speechConfig"],cE(m));const y=g(i,["thinkingConfig"]);t!==void 0&&y!=null&&_(t,["setup","generationConfig","thinkingConfig"],y);const T=g(i,["enableAffectiveDialog"]);t!==void 0&&T!=null&&_(t,["setup","generationConfig","enableAffectiveDialog"],T);const S=g(i,["systemInstruction"]);t!==void 0&&S!=null&&_(t,["setup","systemInstruction"],Bn(S));const b=g(i,["tools"]);if(t!==void 0&&b!=null){let N=Dc(b);Array.isArray(N)&&(N=N.map(x=>AH(xc(x)))),_(t,["setup","tools"],N)}const C=g(i,["sessionResumption"]);t!==void 0&&C!=null&&_(t,["setup","sessionResumption"],C);const I=g(i,["inputAudioTranscription"]);t!==void 0&&I!=null&&_(t,["setup","inputAudioTranscription"],I);const D=g(i,["outputAudioTranscription"]);t!==void 0&&D!=null&&_(t,["setup","outputAudioTranscription"],D);const P=g(i,["realtimeInputConfig"]);t!==void 0&&P!=null&&_(t,["setup","realtimeInputConfig"],P);const H=g(i,["contextWindowCompression"]);t!==void 0&&H!=null&&_(t,["setup","contextWindowCompression"],H);const F=g(i,["proactivity"]);t!==void 0&&F!=null&&_(t,["setup","proactivity"],F);const G=g(i,["explicitVadSignal"]);return t!==void 0&&G!=null&&_(t,["setup","explicitVadSignal"],G),e}function dH(i,t){const e={},n=g(t,["model"]);n!=null&&_(e,["setup","model"],oe(i,n));const s=g(t,["config"]);return s!=null&&_(e,["config"],uH(s,e)),e}function fH(i,t){const e={},n=g(t,["model"]);n!=null&&_(e,["setup","model"],oe(i,n));const s=g(t,["config"]);return s!=null&&_(e,["config"],hH(s,e)),e}function pH(i){const t={},e=g(i,["musicGenerationConfig"]);return e!=null&&_(t,["musicGenerationConfig"],e),t}function mH(i){const t={},e=g(i,["weightedPrompts"]);if(e!=null){let n=e;Array.isArray(n)&&(n=n.map(s=>s)),_(t,["weightedPrompts"],n)}return t}function gH(i){const t={},e=g(i,["media"]);if(e!=null){let h=J1(e);Array.isArray(h)&&(h=h.map(f=>Jf(f))),_(t,["mediaChunks"],h)}const n=g(i,["audio"]);n!=null&&_(t,["audio"],Jf(j1(n)));const s=g(i,["audioStreamEnd"]);s!=null&&_(t,["audioStreamEnd"],s);const r=g(i,["video"]);r!=null&&_(t,["video"],Jf(Q1(r)));const a=g(i,["text"]);a!=null&&_(t,["text"],a);const c=g(i,["activityStart"]);c!=null&&_(t,["activityStart"],c);const u=g(i,["activityEnd"]);return u!=null&&_(t,["activityEnd"],u),t}function yH(i){const t={},e=g(i,["media"]);if(e!=null){let h=J1(e);Array.isArray(h)&&(h=h.map(f=>f)),_(t,["mediaChunks"],h)}const n=g(i,["audio"]);n!=null&&_(t,["audio"],j1(n));const s=g(i,["audioStreamEnd"]);s!=null&&_(t,["audioStreamEnd"],s);const r=g(i,["video"]);r!=null&&_(t,["video"],Q1(r));const a=g(i,["text"]);a!=null&&_(t,["text"],a);const c=g(i,["activityStart"]);c!=null&&_(t,["activityStart"],c);const u=g(i,["activityEnd"]);return u!=null&&_(t,["activityEnd"],u),t}function _H(i){const t={},e=g(i,["setupComplete"]);e!=null&&_(t,["setupComplete"],e);const n=g(i,["serverContent"]);n!=null&&_(t,["serverContent"],n);const s=g(i,["toolCall"]);s!=null&&_(t,["toolCall"],s);const r=g(i,["toolCallCancellation"]);r!=null&&_(t,["toolCallCancellation"],r);const a=g(i,["usageMetadata"]);a!=null&&_(t,["usageMetadata"],SH(a));const c=g(i,["goAway"]);c!=null&&_(t,["goAway"],c);const u=g(i,["sessionResumptionUpdate"]);u!=null&&_(t,["sessionResumptionUpdate"],u);const h=g(i,["voiceActivityDetectionSignal"]);return h!=null&&_(t,["voiceActivityDetectionSignal"],h),t}function vH(i){const t={},e=g(i,["mediaResolution"]);e!=null&&_(t,["mediaResolution"],e);const n=g(i,["codeExecutionResult"]);n!=null&&_(t,["codeExecutionResult"],n);const s=g(i,["executableCode"]);s!=null&&_(t,["executableCode"],s);const r=g(i,["fileData"]);r!=null&&_(t,["fileData"],sH(r));const a=g(i,["functionCall"]);a!=null&&_(t,["functionCall"],rH(a));const c=g(i,["functionResponse"]);c!=null&&_(t,["functionResponse"],c);const u=g(i,["inlineData"]);u!=null&&_(t,["inlineData"],Jf(u));const h=g(i,["text"]);h!=null&&_(t,["text"],h);const f=g(i,["thought"]);f!=null&&_(t,["thought"],f);const m=g(i,["thoughtSignature"]);m!=null&&_(t,["thoughtSignature"],m);const y=g(i,["videoMetadata"]);return y!=null&&_(t,["videoMetadata"],y),t}function EH(i){const t={},e=g(i,["handle"]);if(e!=null&&_(t,["handle"],e),g(i,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return t}function TH(i){const t={},e=g(i,["functionDeclarations"]);if(e!=null){let f=e;Array.isArray(f)&&(f=f.map(m=>m)),_(t,["functionDeclarations"],f)}if(g(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=g(i,["googleSearchRetrieval"]);n!=null&&_(t,["googleSearchRetrieval"],n);const s=g(i,["computerUse"]);s!=null&&_(t,["computerUse"],s);const r=g(i,["fileSearch"]);r!=null&&_(t,["fileSearch"],r);const a=g(i,["codeExecution"]);if(a!=null&&_(t,["codeExecution"],a),g(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const c=g(i,["googleMaps"]);c!=null&&_(t,["googleMaps"],lH(c));const u=g(i,["googleSearch"]);u!=null&&_(t,["googleSearch"],cH(u));const h=g(i,["urlContext"]);return h!=null&&_(t,["urlContext"],h),t}function AH(i){const t={},e=g(i,["functionDeclarations"]);if(e!=null){let m=e;Array.isArray(m)&&(m=m.map(y=>oH(y))),_(t,["functionDeclarations"],m)}const n=g(i,["retrieval"]);n!=null&&_(t,["retrieval"],n);const s=g(i,["googleSearchRetrieval"]);s!=null&&_(t,["googleSearchRetrieval"],s);const r=g(i,["computerUse"]);if(r!=null&&_(t,["computerUse"],r),g(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const a=g(i,["codeExecution"]);a!=null&&_(t,["codeExecution"],a);const c=g(i,["enterpriseWebSearch"]);c!=null&&_(t,["enterpriseWebSearch"],c);const u=g(i,["googleMaps"]);u!=null&&_(t,["googleMaps"],u);const h=g(i,["googleSearch"]);h!=null&&_(t,["googleSearch"],h);const f=g(i,["urlContext"]);return f!=null&&_(t,["urlContext"],f),t}function SH(i){const t={},e=g(i,["promptTokenCount"]);e!=null&&_(t,["promptTokenCount"],e);const n=g(i,["cachedContentTokenCount"]);n!=null&&_(t,["cachedContentTokenCount"],n);const s=g(i,["candidatesTokenCount"]);s!=null&&_(t,["responseTokenCount"],s);const r=g(i,["toolUsePromptTokenCount"]);r!=null&&_(t,["toolUsePromptTokenCount"],r);const a=g(i,["thoughtsTokenCount"]);a!=null&&_(t,["thoughtsTokenCount"],a);const c=g(i,["totalTokenCount"]);c!=null&&_(t,["totalTokenCount"],c);const u=g(i,["promptTokensDetails"]);if(u!=null){let T=u;Array.isArray(T)&&(T=T.map(S=>S)),_(t,["promptTokensDetails"],T)}const h=g(i,["cacheTokensDetails"]);if(h!=null){let T=h;Array.isArray(T)&&(T=T.map(S=>S)),_(t,["cacheTokensDetails"],T)}const f=g(i,["candidatesTokensDetails"]);if(f!=null){let T=f;Array.isArray(T)&&(T=T.map(S=>S)),_(t,["responseTokensDetails"],T)}const m=g(i,["toolUsePromptTokensDetails"]);if(m!=null){let T=m;Array.isArray(T)&&(T=T.map(S=>S)),_(t,["toolUsePromptTokensDetails"],T)}const y=g(i,["trafficType"]);return y!=null&&_(t,["trafficType"],y),t}function wH(i){const t={},e=g(i,["data"]);if(e!=null&&_(t,["data"],e),g(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=g(i,["mimeType"]);return n!=null&&_(t,["mimeType"],n),t}function bH(i){const t={},e=g(i,["content"]);e!=null&&_(t,["content"],e);const n=g(i,["citationMetadata"]);n!=null&&_(t,["citationMetadata"],CH(n));const s=g(i,["tokenCount"]);s!=null&&_(t,["tokenCount"],s);const r=g(i,["finishReason"]);r!=null&&_(t,["finishReason"],r);const a=g(i,["avgLogprobs"]);a!=null&&_(t,["avgLogprobs"],a);const c=g(i,["groundingMetadata"]);c!=null&&_(t,["groundingMetadata"],c);const u=g(i,["index"]);u!=null&&_(t,["index"],u);const h=g(i,["logprobsResult"]);h!=null&&_(t,["logprobsResult"],h);const f=g(i,["safetyRatings"]);if(f!=null){let y=f;Array.isArray(y)&&(y=y.map(T=>T)),_(t,["safetyRatings"],y)}const m=g(i,["urlContextMetadata"]);return m!=null&&_(t,["urlContextMetadata"],m),t}function CH(i){const t={},e=g(i,["citationSources"]);if(e!=null){let n=e;Array.isArray(n)&&(n=n.map(s=>s)),_(t,["citations"],n)}return t}function IH(i,t){const e={},n=g(t,["model"]);n!=null&&_(e,["_url","model"],oe(i,n));const s=g(t,["contents"]);if(s!=null){let r=Ui(s);Array.isArray(r)&&(r=r.map(a=>a)),_(e,["contents"],r)}return e}function RH(i){const t={},e=g(i,["sdkHttpResponse"]);e!=null&&_(t,["sdkHttpResponse"],e);const n=g(i,["tokensInfo"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>r)),_(t,["tokensInfo"],s)}return t}function MH(i){const t={},e=g(i,["values"]);e!=null&&_(t,["values"],e);const n=g(i,["statistics"]);return n!=null&&_(t,["statistics"],PH(n)),t}function PH(i){const t={},e=g(i,["truncated"]);e!=null&&_(t,["truncated"],e);const n=g(i,["token_count"]);return n!=null&&_(t,["tokenCount"],n),t}function om(i){const t={},e=g(i,["parts"]);if(e!=null){let s=e;Array.isArray(s)&&(s=s.map(r=>B6(r))),_(t,["parts"],s)}const n=g(i,["role"]);return n!=null&&_(t,["role"],n),t}function xH(i){const t={},e=g(i,["controlType"]);e!=null&&_(t,["controlType"],e);const n=g(i,["enableControlImageComputation"]);return n!=null&&_(t,["computeControl"],n),t}function DH(i){const t={};if(g(i,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(g(i,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(g(i,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return t}function NH(i,t){const e={},n=g(i,["systemInstruction"]);t!==void 0&&n!=null&&_(t,["systemInstruction"],Bn(n));const s=g(i,["tools"]);if(t!==void 0&&s!=null){let a=s;Array.isArray(a)&&(a=a.map(c=>dM(c))),_(t,["tools"],a)}const r=g(i,["generationConfig"]);return t!==void 0&&r!=null&&_(t,["generationConfig"],w6(r)),e}function kH(i,t){const e={},n=g(t,["model"]);n!=null&&_(e,["_url","model"],oe(i,n));const s=g(t,["contents"]);if(s!=null){let a=Ui(s);Array.isArray(a)&&(a=a.map(c=>om(c))),_(e,["contents"],a)}const r=g(t,["config"]);return r!=null&&DH(r),e}function LH(i,t){const e={},n=g(t,["model"]);n!=null&&_(e,["_url","model"],oe(i,n));const s=g(t,["contents"]);if(s!=null){let a=Ui(s);Array.isArray(a)&&(a=a.map(c=>c)),_(e,["contents"],a)}const r=g(t,["config"]);return r!=null&&NH(r,e),e}function OH(i){const t={},e=g(i,["sdkHttpResponse"]);e!=null&&_(t,["sdkHttpResponse"],e);const n=g(i,["totalTokens"]);n!=null&&_(t,["totalTokens"],n);const s=g(i,["cachedContentTokenCount"]);return s!=null&&_(t,["cachedContentTokenCount"],s),t}function UH(i){const t={},e=g(i,["sdkHttpResponse"]);e!=null&&_(t,["sdkHttpResponse"],e);const n=g(i,["totalTokens"]);return n!=null&&_(t,["totalTokens"],n),t}function VH(i,t){const e={},n=g(t,["model"]);return n!=null&&_(e,["_url","name"],oe(i,n)),e}function BH(i,t){const e={},n=g(t,["model"]);return n!=null&&_(e,["_url","name"],oe(i,n)),e}function FH(i){const t={},e=g(i,["sdkHttpResponse"]);return e!=null&&_(t,["sdkHttpResponse"],e),t}function HH(i){const t={},e=g(i,["sdkHttpResponse"]);return e!=null&&_(t,["sdkHttpResponse"],e),t}function GH(i,t){const e={},n=g(i,["outputGcsUri"]);t!==void 0&&n!=null&&_(t,["parameters","storageUri"],n);const s=g(i,["negativePrompt"]);t!==void 0&&s!=null&&_(t,["parameters","negativePrompt"],s);const r=g(i,["numberOfImages"]);t!==void 0&&r!=null&&_(t,["parameters","sampleCount"],r);const a=g(i,["aspectRatio"]);t!==void 0&&a!=null&&_(t,["parameters","aspectRatio"],a);const c=g(i,["guidanceScale"]);t!==void 0&&c!=null&&_(t,["parameters","guidanceScale"],c);const u=g(i,["seed"]);t!==void 0&&u!=null&&_(t,["parameters","seed"],u);const h=g(i,["safetyFilterLevel"]);t!==void 0&&h!=null&&_(t,["parameters","safetySetting"],h);const f=g(i,["personGeneration"]);t!==void 0&&f!=null&&_(t,["parameters","personGeneration"],f);const m=g(i,["includeSafetyAttributes"]);t!==void 0&&m!=null&&_(t,["parameters","includeSafetyAttributes"],m);const y=g(i,["includeRaiReason"]);t!==void 0&&y!=null&&_(t,["parameters","includeRaiReason"],y);const T=g(i,["language"]);t!==void 0&&T!=null&&_(t,["parameters","language"],T);const S=g(i,["outputMimeType"]);t!==void 0&&S!=null&&_(t,["parameters","outputOptions","mimeType"],S);const b=g(i,["outputCompressionQuality"]);t!==void 0&&b!=null&&_(t,["parameters","outputOptions","compressionQuality"],b);const C=g(i,["addWatermark"]);t!==void 0&&C!=null&&_(t,["parameters","addWatermark"],C);const I=g(i,["labels"]);t!==void 0&&I!=null&&_(t,["labels"],I);const D=g(i,["editMode"]);t!==void 0&&D!=null&&_(t,["parameters","editMode"],D);const P=g(i,["baseSteps"]);return t!==void 0&&P!=null&&_(t,["parameters","editConfig","baseSteps"],P),e}function qH(i,t){const e={},n=g(t,["model"]);n!=null&&_(e,["_url","model"],oe(i,n));const s=g(t,["prompt"]);s!=null&&_(e,["instances[0]","prompt"],s);const r=g(t,["referenceImages"]);if(r!=null){let c=r;Array.isArray(c)&&(c=c.map(u=>$6(u))),_(e,["instances[0]","referenceImages"],c)}const a=g(t,["config"]);return a!=null&&GH(a,e),e}function zH(i){const t={},e=g(i,["sdkHttpResponse"]);e!=null&&_(t,["sdkHttpResponse"],e);const n=g(i,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>am(r))),_(t,["generatedImages"],s)}return t}function $H(i,t){const e={},n=g(i,["taskType"]);t!==void 0&&n!=null&&_(t,["requests[]","taskType"],n);const s=g(i,["title"]);t!==void 0&&s!=null&&_(t,["requests[]","title"],s);const r=g(i,["outputDimensionality"]);if(t!==void 0&&r!=null&&_(t,["requests[]","outputDimensionality"],r),g(i,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(g(i,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return e}function YH(i,t){const e={},n=g(i,["taskType"]);t!==void 0&&n!=null&&_(t,["instances[]","task_type"],n);const s=g(i,["title"]);t!==void 0&&s!=null&&_(t,["instances[]","title"],s);const r=g(i,["outputDimensionality"]);t!==void 0&&r!=null&&_(t,["parameters","outputDimensionality"],r);const a=g(i,["mimeType"]);t!==void 0&&a!=null&&_(t,["instances[]","mimeType"],a);const c=g(i,["autoTruncate"]);return t!==void 0&&c!=null&&_(t,["parameters","autoTruncate"],c),e}function WH(i,t){const e={},n=g(t,["model"]);n!=null&&_(e,["_url","model"],oe(i,n));const s=g(t,["contents"]);if(s!=null){let c=oE(i,s);Array.isArray(c)&&(c=c.map(u=>u)),_(e,["requests[]","content"],c)}const r=g(t,["config"]);r!=null&&$H(r,e);const a=g(t,["model"]);return a!==void 0&&_(e,["requests[]","model"],oe(i,a)),e}function KH(i,t){const e={},n=g(t,["model"]);n!=null&&_(e,["_url","model"],oe(i,n));const s=g(t,["contents"]);if(s!=null){let a=oE(i,s);Array.isArray(a)&&(a=a.map(c=>c)),_(e,["instances[]","content"],a)}const r=g(t,["config"]);return r!=null&&YH(r,e),e}function XH(i){const t={},e=g(i,["sdkHttpResponse"]);e!=null&&_(t,["sdkHttpResponse"],e);const n=g(i,["embeddings"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>a)),_(t,["embeddings"],r)}const s=g(i,["metadata"]);return s!=null&&_(t,["metadata"],s),t}function JH(i){const t={},e=g(i,["sdkHttpResponse"]);e!=null&&_(t,["sdkHttpResponse"],e);const n=g(i,["predictions[]","embeddings"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>MH(a))),_(t,["embeddings"],r)}const s=g(i,["metadata"]);return s!=null&&_(t,["metadata"],s),t}function QH(i){const t={},e=g(i,["endpoint"]);e!=null&&_(t,["name"],e);const n=g(i,["deployedModelId"]);return n!=null&&_(t,["deployedModelId"],n),t}function jH(i){const t={};if(g(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const e=g(i,["fileUri"]);e!=null&&_(t,["fileUri"],e);const n=g(i,["mimeType"]);return n!=null&&_(t,["mimeType"],n),t}function ZH(i){const t={},e=g(i,["id"]);e!=null&&_(t,["id"],e);const n=g(i,["args"]);n!=null&&_(t,["args"],n);const s=g(i,["name"]);if(s!=null&&_(t,["name"],s),g(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(g(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function t6(i){const t={},e=g(i,["mode"]);e!=null&&_(t,["mode"],e);const n=g(i,["allowedFunctionNames"]);if(n!=null&&_(t,["allowedFunctionNames"],n),g(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function e6(i){const t={};if(g(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const e=g(i,["description"]);e!=null&&_(t,["description"],e);const n=g(i,["name"]);n!=null&&_(t,["name"],n);const s=g(i,["parameters"]);s!=null&&_(t,["parameters"],s);const r=g(i,["parametersJsonSchema"]);r!=null&&_(t,["parametersJsonSchema"],r);const a=g(i,["response"]);a!=null&&_(t,["response"],a);const c=g(i,["responseJsonSchema"]);return c!=null&&_(t,["responseJsonSchema"],c),t}function n6(i,t,e){const n={},s=g(t,["systemInstruction"]);e!==void 0&&s!=null&&_(e,["systemInstruction"],om(Bn(s)));const r=g(t,["temperature"]);r!=null&&_(n,["temperature"],r);const a=g(t,["topP"]);a!=null&&_(n,["topP"],a);const c=g(t,["topK"]);c!=null&&_(n,["topK"],c);const u=g(t,["candidateCount"]);u!=null&&_(n,["candidateCount"],u);const h=g(t,["maxOutputTokens"]);h!=null&&_(n,["maxOutputTokens"],h);const f=g(t,["stopSequences"]);f!=null&&_(n,["stopSequences"],f);const m=g(t,["responseLogprobs"]);m!=null&&_(n,["responseLogprobs"],m);const y=g(t,["logprobs"]);y!=null&&_(n,["logprobs"],y);const T=g(t,["presencePenalty"]);T!=null&&_(n,["presencePenalty"],T);const S=g(t,["frequencyPenalty"]);S!=null&&_(n,["frequencyPenalty"],S);const b=g(t,["seed"]);b!=null&&_(n,["seed"],b);const C=g(t,["responseMimeType"]);C!=null&&_(n,["responseMimeType"],C);const I=g(t,["responseSchema"]);I!=null&&_(n,["responseSchema"],aE(I));const D=g(t,["responseJsonSchema"]);if(D!=null&&_(n,["responseJsonSchema"],D),g(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(g(t,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const P=g(t,["safetySettings"]);if(e!==void 0&&P!=null){let B=P;Array.isArray(B)&&(B=B.map(vt=>Y6(vt))),_(e,["safetySettings"],B)}const H=g(t,["tools"]);if(e!==void 0&&H!=null){let B=Dc(H);Array.isArray(B)&&(B=B.map(vt=>Z6(xc(vt)))),_(e,["tools"],B)}const F=g(t,["toolConfig"]);if(e!==void 0&&F!=null&&_(e,["toolConfig"],j6(F)),g(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const G=g(t,["cachedContent"]);e!==void 0&&G!=null&&_(e,["cachedContent"],Ir(i,G));const N=g(t,["responseModalities"]);N!=null&&_(n,["responseModalities"],N);const x=g(t,["mediaResolution"]);x!=null&&_(n,["mediaResolution"],x);const k=g(t,["speechConfig"]);if(k!=null&&_(n,["speechConfig"],lE(k)),g(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const V=g(t,["thinkingConfig"]);V!=null&&_(n,["thinkingConfig"],V);const U=g(t,["imageConfig"]);U!=null&&_(n,["imageConfig"],M6(U));const $=g(t,["enableEnhancedCivicAnswers"]);return $!=null&&_(n,["enableEnhancedCivicAnswers"],$),n}function i6(i,t,e){const n={},s=g(t,["systemInstruction"]);e!==void 0&&s!=null&&_(e,["systemInstruction"],Bn(s));const r=g(t,["temperature"]);r!=null&&_(n,["temperature"],r);const a=g(t,["topP"]);a!=null&&_(n,["topP"],a);const c=g(t,["topK"]);c!=null&&_(n,["topK"],c);const u=g(t,["candidateCount"]);u!=null&&_(n,["candidateCount"],u);const h=g(t,["maxOutputTokens"]);h!=null&&_(n,["maxOutputTokens"],h);const f=g(t,["stopSequences"]);f!=null&&_(n,["stopSequences"],f);const m=g(t,["responseLogprobs"]);m!=null&&_(n,["responseLogprobs"],m);const y=g(t,["logprobs"]);y!=null&&_(n,["logprobs"],y);const T=g(t,["presencePenalty"]);T!=null&&_(n,["presencePenalty"],T);const S=g(t,["frequencyPenalty"]);S!=null&&_(n,["frequencyPenalty"],S);const b=g(t,["seed"]);b!=null&&_(n,["seed"],b);const C=g(t,["responseMimeType"]);C!=null&&_(n,["responseMimeType"],C);const I=g(t,["responseSchema"]);I!=null&&_(n,["responseSchema"],aE(I));const D=g(t,["responseJsonSchema"]);D!=null&&_(n,["responseJsonSchema"],D);const P=g(t,["routingConfig"]);P!=null&&_(n,["routingConfig"],P);const H=g(t,["modelSelectionConfig"]);H!=null&&_(n,["modelConfig"],H);const F=g(t,["safetySettings"]);if(e!==void 0&&F!=null){let W=F;Array.isArray(W)&&(W=W.map(nt=>nt)),_(e,["safetySettings"],W)}const G=g(t,["tools"]);if(e!==void 0&&G!=null){let W=Dc(G);Array.isArray(W)&&(W=W.map(nt=>dM(xc(nt)))),_(e,["tools"],W)}const N=g(t,["toolConfig"]);e!==void 0&&N!=null&&_(e,["toolConfig"],N);const x=g(t,["labels"]);e!==void 0&&x!=null&&_(e,["labels"],x);const k=g(t,["cachedContent"]);e!==void 0&&k!=null&&_(e,["cachedContent"],Ir(i,k));const V=g(t,["responseModalities"]);V!=null&&_(n,["responseModalities"],V);const U=g(t,["mediaResolution"]);U!=null&&_(n,["mediaResolution"],U);const $=g(t,["speechConfig"]);$!=null&&_(n,["speechConfig"],lE($));const B=g(t,["audioTimestamp"]);B!=null&&_(n,["audioTimestamp"],B);const vt=g(t,["thinkingConfig"]);vt!=null&&_(n,["thinkingConfig"],vt);const It=g(t,["imageConfig"]);if(It!=null&&_(n,["imageConfig"],P6(It)),g(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return n}function aC(i,t){const e={},n=g(t,["model"]);n!=null&&_(e,["_url","model"],oe(i,n));const s=g(t,["contents"]);if(s!=null){let a=Ui(s);Array.isArray(a)&&(a=a.map(c=>om(c))),_(e,["contents"],a)}const r=g(t,["config"]);return r!=null&&_(e,["generationConfig"],n6(i,r,e)),e}function lC(i,t){const e={},n=g(t,["model"]);n!=null&&_(e,["_url","model"],oe(i,n));const s=g(t,["contents"]);if(s!=null){let a=Ui(s);Array.isArray(a)&&(a=a.map(c=>c)),_(e,["contents"],a)}const r=g(t,["config"]);return r!=null&&_(e,["generationConfig"],i6(i,r,e)),e}function cC(i){const t={},e=g(i,["sdkHttpResponse"]);e!=null&&_(t,["sdkHttpResponse"],e);const n=g(i,["candidates"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(h=>bH(h))),_(t,["candidates"],u)}const s=g(i,["modelVersion"]);s!=null&&_(t,["modelVersion"],s);const r=g(i,["promptFeedback"]);r!=null&&_(t,["promptFeedback"],r);const a=g(i,["responseId"]);a!=null&&_(t,["responseId"],a);const c=g(i,["usageMetadata"]);return c!=null&&_(t,["usageMetadata"],c),t}function uC(i){const t={},e=g(i,["sdkHttpResponse"]);e!=null&&_(t,["sdkHttpResponse"],e);const n=g(i,["candidates"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(f=>f)),_(t,["candidates"],h)}const s=g(i,["createTime"]);s!=null&&_(t,["createTime"],s);const r=g(i,["modelVersion"]);r!=null&&_(t,["modelVersion"],r);const a=g(i,["promptFeedback"]);a!=null&&_(t,["promptFeedback"],a);const c=g(i,["responseId"]);c!=null&&_(t,["responseId"],c);const u=g(i,["usageMetadata"]);return u!=null&&_(t,["usageMetadata"],u),t}function s6(i,t){const e={};if(g(i,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(g(i,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const n=g(i,["numberOfImages"]);t!==void 0&&n!=null&&_(t,["parameters","sampleCount"],n);const s=g(i,["aspectRatio"]);t!==void 0&&s!=null&&_(t,["parameters","aspectRatio"],s);const r=g(i,["guidanceScale"]);if(t!==void 0&&r!=null&&_(t,["parameters","guidanceScale"],r),g(i,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const a=g(i,["safetyFilterLevel"]);t!==void 0&&a!=null&&_(t,["parameters","safetySetting"],a);const c=g(i,["personGeneration"]);t!==void 0&&c!=null&&_(t,["parameters","personGeneration"],c);const u=g(i,["includeSafetyAttributes"]);t!==void 0&&u!=null&&_(t,["parameters","includeSafetyAttributes"],u);const h=g(i,["includeRaiReason"]);t!==void 0&&h!=null&&_(t,["parameters","includeRaiReason"],h);const f=g(i,["language"]);t!==void 0&&f!=null&&_(t,["parameters","language"],f);const m=g(i,["outputMimeType"]);t!==void 0&&m!=null&&_(t,["parameters","outputOptions","mimeType"],m);const y=g(i,["outputCompressionQuality"]);if(t!==void 0&&y!=null&&_(t,["parameters","outputOptions","compressionQuality"],y),g(i,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(g(i,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const T=g(i,["imageSize"]);if(t!==void 0&&T!=null&&_(t,["parameters","sampleImageSize"],T),g(i,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return e}function r6(i,t){const e={},n=g(i,["outputGcsUri"]);t!==void 0&&n!=null&&_(t,["parameters","storageUri"],n);const s=g(i,["negativePrompt"]);t!==void 0&&s!=null&&_(t,["parameters","negativePrompt"],s);const r=g(i,["numberOfImages"]);t!==void 0&&r!=null&&_(t,["parameters","sampleCount"],r);const a=g(i,["aspectRatio"]);t!==void 0&&a!=null&&_(t,["parameters","aspectRatio"],a);const c=g(i,["guidanceScale"]);t!==void 0&&c!=null&&_(t,["parameters","guidanceScale"],c);const u=g(i,["seed"]);t!==void 0&&u!=null&&_(t,["parameters","seed"],u);const h=g(i,["safetyFilterLevel"]);t!==void 0&&h!=null&&_(t,["parameters","safetySetting"],h);const f=g(i,["personGeneration"]);t!==void 0&&f!=null&&_(t,["parameters","personGeneration"],f);const m=g(i,["includeSafetyAttributes"]);t!==void 0&&m!=null&&_(t,["parameters","includeSafetyAttributes"],m);const y=g(i,["includeRaiReason"]);t!==void 0&&y!=null&&_(t,["parameters","includeRaiReason"],y);const T=g(i,["language"]);t!==void 0&&T!=null&&_(t,["parameters","language"],T);const S=g(i,["outputMimeType"]);t!==void 0&&S!=null&&_(t,["parameters","outputOptions","mimeType"],S);const b=g(i,["outputCompressionQuality"]);t!==void 0&&b!=null&&_(t,["parameters","outputOptions","compressionQuality"],b);const C=g(i,["addWatermark"]);t!==void 0&&C!=null&&_(t,["parameters","addWatermark"],C);const I=g(i,["labels"]);t!==void 0&&I!=null&&_(t,["labels"],I);const D=g(i,["imageSize"]);t!==void 0&&D!=null&&_(t,["parameters","sampleImageSize"],D);const P=g(i,["enhancePrompt"]);return t!==void 0&&P!=null&&_(t,["parameters","enhancePrompt"],P),e}function o6(i,t){const e={},n=g(t,["model"]);n!=null&&_(e,["_url","model"],oe(i,n));const s=g(t,["prompt"]);s!=null&&_(e,["instances[0]","prompt"],s);const r=g(t,["config"]);return r!=null&&s6(r,e),e}function a6(i,t){const e={},n=g(t,["model"]);n!=null&&_(e,["_url","model"],oe(i,n));const s=g(t,["prompt"]);s!=null&&_(e,["instances[0]","prompt"],s);const r=g(t,["config"]);return r!=null&&r6(r,e),e}function l6(i){const t={},e=g(i,["sdkHttpResponse"]);e!=null&&_(t,["sdkHttpResponse"],e);const n=g(i,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>E6(a))),_(t,["generatedImages"],r)}const s=g(i,["positivePromptSafetyAttributes"]);return s!=null&&_(t,["positivePromptSafetyAttributes"],uM(s)),t}function c6(i){const t={},e=g(i,["sdkHttpResponse"]);e!=null&&_(t,["sdkHttpResponse"],e);const n=g(i,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>am(a))),_(t,["generatedImages"],r)}const s=g(i,["positivePromptSafetyAttributes"]);return s!=null&&_(t,["positivePromptSafetyAttributes"],hM(s)),t}function u6(i,t){const e={},n=g(i,["numberOfVideos"]);if(t!==void 0&&n!=null&&_(t,["parameters","sampleCount"],n),g(i,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(g(i,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const s=g(i,["durationSeconds"]);if(t!==void 0&&s!=null&&_(t,["parameters","durationSeconds"],s),g(i,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const r=g(i,["aspectRatio"]);t!==void 0&&r!=null&&_(t,["parameters","aspectRatio"],r);const a=g(i,["resolution"]);t!==void 0&&a!=null&&_(t,["parameters","resolution"],a);const c=g(i,["personGeneration"]);if(t!==void 0&&c!=null&&_(t,["parameters","personGeneration"],c),g(i,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const u=g(i,["negativePrompt"]);t!==void 0&&u!=null&&_(t,["parameters","negativePrompt"],u);const h=g(i,["enhancePrompt"]);if(t!==void 0&&h!=null&&_(t,["parameters","enhancePrompt"],h),g(i,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const f=g(i,["lastFrame"]);t!==void 0&&f!=null&&_(t,["instances[0]","lastFrame"],lm(f));const m=g(i,["referenceImages"]);if(t!==void 0&&m!=null){let y=m;Array.isArray(y)&&(y=y.map(T=>dG(T))),_(t,["instances[0]","referenceImages"],y)}if(g(i,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(g(i,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return e}function h6(i,t){const e={},n=g(i,["numberOfVideos"]);t!==void 0&&n!=null&&_(t,["parameters","sampleCount"],n);const s=g(i,["outputGcsUri"]);t!==void 0&&s!=null&&_(t,["parameters","storageUri"],s);const r=g(i,["fps"]);t!==void 0&&r!=null&&_(t,["parameters","fps"],r);const a=g(i,["durationSeconds"]);t!==void 0&&a!=null&&_(t,["parameters","durationSeconds"],a);const c=g(i,["seed"]);t!==void 0&&c!=null&&_(t,["parameters","seed"],c);const u=g(i,["aspectRatio"]);t!==void 0&&u!=null&&_(t,["parameters","aspectRatio"],u);const h=g(i,["resolution"]);t!==void 0&&h!=null&&_(t,["parameters","resolution"],h);const f=g(i,["personGeneration"]);t!==void 0&&f!=null&&_(t,["parameters","personGeneration"],f);const m=g(i,["pubsubTopic"]);t!==void 0&&m!=null&&_(t,["parameters","pubsubTopic"],m);const y=g(i,["negativePrompt"]);t!==void 0&&y!=null&&_(t,["parameters","negativePrompt"],y);const T=g(i,["enhancePrompt"]);t!==void 0&&T!=null&&_(t,["parameters","enhancePrompt"],T);const S=g(i,["generateAudio"]);t!==void 0&&S!=null&&_(t,["parameters","generateAudio"],S);const b=g(i,["lastFrame"]);t!==void 0&&b!=null&&_(t,["instances[0]","lastFrame"],os(b));const C=g(i,["referenceImages"]);if(t!==void 0&&C!=null){let P=C;Array.isArray(P)&&(P=P.map(H=>fG(H))),_(t,["instances[0]","referenceImages"],P)}const I=g(i,["mask"]);t!==void 0&&I!=null&&_(t,["instances[0]","mask"],hG(I));const D=g(i,["compressionQuality"]);return t!==void 0&&D!=null&&_(t,["parameters","compressionQuality"],D),e}function d6(i){const t={},e=g(i,["name"]);e!=null&&_(t,["name"],e);const n=g(i,["metadata"]);n!=null&&_(t,["metadata"],n);const s=g(i,["done"]);s!=null&&_(t,["done"],s);const r=g(i,["error"]);r!=null&&_(t,["error"],r);const a=g(i,["response","generateVideoResponse"]);return a!=null&&_(t,["response"],g6(a)),t}function f6(i){const t={},e=g(i,["name"]);e!=null&&_(t,["name"],e);const n=g(i,["metadata"]);n!=null&&_(t,["metadata"],n);const s=g(i,["done"]);s!=null&&_(t,["done"],s);const r=g(i,["error"]);r!=null&&_(t,["error"],r);const a=g(i,["response"]);return a!=null&&_(t,["response"],y6(a)),t}function p6(i,t){const e={},n=g(t,["model"]);n!=null&&_(e,["_url","model"],oe(i,n));const s=g(t,["prompt"]);s!=null&&_(e,["instances[0]","prompt"],s);const r=g(t,["image"]);r!=null&&_(e,["instances[0]","image"],lm(r));const a=g(t,["video"]);a!=null&&_(e,["instances[0]","video"],fM(a));const c=g(t,["source"]);c!=null&&_6(c,e);const u=g(t,["config"]);return u!=null&&u6(u,e),e}function m6(i,t){const e={},n=g(t,["model"]);n!=null&&_(e,["_url","model"],oe(i,n));const s=g(t,["prompt"]);s!=null&&_(e,["instances[0]","prompt"],s);const r=g(t,["image"]);r!=null&&_(e,["instances[0]","image"],os(r));const a=g(t,["video"]);a!=null&&_(e,["instances[0]","video"],pM(a));const c=g(t,["source"]);c!=null&&v6(c,e);const u=g(t,["config"]);return u!=null&&h6(u,e),e}function g6(i){const t={},e=g(i,["generatedSamples"]);if(e!=null){let r=e;Array.isArray(r)&&(r=r.map(a=>A6(a))),_(t,["generatedVideos"],r)}const n=g(i,["raiMediaFilteredCount"]);n!=null&&_(t,["raiMediaFilteredCount"],n);const s=g(i,["raiMediaFilteredReasons"]);return s!=null&&_(t,["raiMediaFilteredReasons"],s),t}function y6(i){const t={},e=g(i,["videos"]);if(e!=null){let r=e;Array.isArray(r)&&(r=r.map(a=>S6(a))),_(t,["generatedVideos"],r)}const n=g(i,["raiMediaFilteredCount"]);n!=null&&_(t,["raiMediaFilteredCount"],n);const s=g(i,["raiMediaFilteredReasons"]);return s!=null&&_(t,["raiMediaFilteredReasons"],s),t}function _6(i,t){const e={},n=g(i,["prompt"]);t!==void 0&&n!=null&&_(t,["instances[0]","prompt"],n);const s=g(i,["image"]);t!==void 0&&s!=null&&_(t,["instances[0]","image"],lm(s));const r=g(i,["video"]);return t!==void 0&&r!=null&&_(t,["instances[0]","video"],fM(r)),e}function v6(i,t){const e={},n=g(i,["prompt"]);t!==void 0&&n!=null&&_(t,["instances[0]","prompt"],n);const s=g(i,["image"]);t!==void 0&&s!=null&&_(t,["instances[0]","image"],os(s));const r=g(i,["video"]);return t!==void 0&&r!=null&&_(t,["instances[0]","video"],pM(r)),e}function E6(i){const t={},e=g(i,["_self"]);e!=null&&_(t,["image"],x6(e));const n=g(i,["raiFilteredReason"]);n!=null&&_(t,["raiFilteredReason"],n);const s=g(i,["_self"]);return s!=null&&_(t,["safetyAttributes"],uM(s)),t}function am(i){const t={},e=g(i,["_self"]);e!=null&&_(t,["image"],cM(e));const n=g(i,["raiFilteredReason"]);n!=null&&_(t,["raiFilteredReason"],n);const s=g(i,["_self"]);s!=null&&_(t,["safetyAttributes"],hM(s));const r=g(i,["prompt"]);return r!=null&&_(t,["enhancedPrompt"],r),t}function T6(i){const t={},e=g(i,["_self"]);e!=null&&_(t,["mask"],cM(e));const n=g(i,["labels"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>r)),_(t,["labels"],s)}return t}function A6(i){const t={},e=g(i,["video"]);return e!=null&&_(t,["video"],cG(e)),t}function S6(i){const t={},e=g(i,["_self"]);return e!=null&&_(t,["video"],uG(e)),t}function w6(i){const t={},e=g(i,["modelSelectionConfig"]);e!=null&&_(t,["modelConfig"],e);const n=g(i,["responseJsonSchema"]);n!=null&&_(t,["responseJsonSchema"],n);const s=g(i,["audioTimestamp"]);s!=null&&_(t,["audioTimestamp"],s);const r=g(i,["candidateCount"]);r!=null&&_(t,["candidateCount"],r);const a=g(i,["enableAffectiveDialog"]);a!=null&&_(t,["enableAffectiveDialog"],a);const c=g(i,["frequencyPenalty"]);c!=null&&_(t,["frequencyPenalty"],c);const u=g(i,["logprobs"]);u!=null&&_(t,["logprobs"],u);const h=g(i,["maxOutputTokens"]);h!=null&&_(t,["maxOutputTokens"],h);const f=g(i,["mediaResolution"]);f!=null&&_(t,["mediaResolution"],f);const m=g(i,["presencePenalty"]);m!=null&&_(t,["presencePenalty"],m);const y=g(i,["responseLogprobs"]);y!=null&&_(t,["responseLogprobs"],y);const T=g(i,["responseMimeType"]);T!=null&&_(t,["responseMimeType"],T);const S=g(i,["responseModalities"]);S!=null&&_(t,["responseModalities"],S);const b=g(i,["responseSchema"]);b!=null&&_(t,["responseSchema"],b);const C=g(i,["routingConfig"]);C!=null&&_(t,["routingConfig"],C);const I=g(i,["seed"]);I!=null&&_(t,["seed"],I);const D=g(i,["speechConfig"]);D!=null&&_(t,["speechConfig"],D);const P=g(i,["stopSequences"]);P!=null&&_(t,["stopSequences"],P);const H=g(i,["temperature"]);H!=null&&_(t,["temperature"],H);const F=g(i,["thinkingConfig"]);F!=null&&_(t,["thinkingConfig"],F);const G=g(i,["topK"]);G!=null&&_(t,["topK"],G);const N=g(i,["topP"]);if(N!=null&&_(t,["topP"],N),g(i,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}function b6(i,t){const e={},n=g(t,["model"]);return n!=null&&_(e,["_url","name"],oe(i,n)),e}function C6(i,t){const e={},n=g(t,["model"]);return n!=null&&_(e,["_url","name"],oe(i,n)),e}function I6(i){const t={};if(g(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const e=g(i,["enableWidget"]);return e!=null&&_(t,["enableWidget"],e),t}function R6(i){const t={};if(g(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(g(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const e=g(i,["timeRangeFilter"]);return e!=null&&_(t,["timeRangeFilter"],e),t}function M6(i){const t={},e=g(i,["aspectRatio"]);e!=null&&_(t,["aspectRatio"],e);const n=g(i,["imageSize"]);if(n!=null&&_(t,["imageSize"],n),g(i,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(g(i,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}function P6(i){const t={},e=g(i,["aspectRatio"]);e!=null&&_(t,["aspectRatio"],e);const n=g(i,["imageSize"]);n!=null&&_(t,["imageSize"],n);const s=g(i,["outputMimeType"]);s!=null&&_(t,["imageOutputOptions","mimeType"],s);const r=g(i,["outputCompressionQuality"]);return r!=null&&_(t,["imageOutputOptions","compressionQuality"],r),t}function x6(i){const t={},e=g(i,["bytesBase64Encoded"]);e!=null&&_(t,["imageBytes"],Bo(e));const n=g(i,["mimeType"]);return n!=null&&_(t,["mimeType"],n),t}function cM(i){const t={},e=g(i,["gcsUri"]);e!=null&&_(t,["gcsUri"],e);const n=g(i,["bytesBase64Encoded"]);n!=null&&_(t,["imageBytes"],Bo(n));const s=g(i,["mimeType"]);return s!=null&&_(t,["mimeType"],s),t}function lm(i){const t={};if(g(i,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const e=g(i,["imageBytes"]);e!=null&&_(t,["bytesBase64Encoded"],Bo(e));const n=g(i,["mimeType"]);return n!=null&&_(t,["mimeType"],n),t}function os(i){const t={},e=g(i,["gcsUri"]);e!=null&&_(t,["gcsUri"],e);const n=g(i,["imageBytes"]);n!=null&&_(t,["bytesBase64Encoded"],Bo(n));const s=g(i,["mimeType"]);return s!=null&&_(t,["mimeType"],s),t}function D6(i,t,e){const n={},s=g(t,["pageSize"]);e!==void 0&&s!=null&&_(e,["_query","pageSize"],s);const r=g(t,["pageToken"]);e!==void 0&&r!=null&&_(e,["_query","pageToken"],r);const a=g(t,["filter"]);e!==void 0&&a!=null&&_(e,["_query","filter"],a);const c=g(t,["queryBase"]);return e!==void 0&&c!=null&&_(e,["_url","models_url"],nM(i,c)),n}function N6(i,t,e){const n={},s=g(t,["pageSize"]);e!==void 0&&s!=null&&_(e,["_query","pageSize"],s);const r=g(t,["pageToken"]);e!==void 0&&r!=null&&_(e,["_query","pageToken"],r);const a=g(t,["filter"]);e!==void 0&&a!=null&&_(e,["_query","filter"],a);const c=g(t,["queryBase"]);return e!==void 0&&c!=null&&_(e,["_url","models_url"],nM(i,c)),n}function k6(i,t){const e={},n=g(t,["config"]);return n!=null&&D6(i,n,e),e}function L6(i,t){const e={},n=g(t,["config"]);return n!=null&&N6(i,n,e),e}function O6(i){const t={},e=g(i,["sdkHttpResponse"]);e!=null&&_(t,["sdkHttpResponse"],e);const n=g(i,["nextPageToken"]);n!=null&&_(t,["nextPageToken"],n);const s=g(i,["_self"]);if(s!=null){let r=iM(s);Array.isArray(r)&&(r=r.map(a=>N_(a))),_(t,["models"],r)}return t}function U6(i){const t={},e=g(i,["sdkHttpResponse"]);e!=null&&_(t,["sdkHttpResponse"],e);const n=g(i,["nextPageToken"]);n!=null&&_(t,["nextPageToken"],n);const s=g(i,["_self"]);if(s!=null){let r=iM(s);Array.isArray(r)&&(r=r.map(a=>k_(a))),_(t,["models"],r)}return t}function V6(i){const t={},e=g(i,["maskMode"]);e!=null&&_(t,["maskMode"],e);const n=g(i,["segmentationClasses"]);n!=null&&_(t,["maskClasses"],n);const s=g(i,["maskDilation"]);return s!=null&&_(t,["dilation"],s),t}function N_(i){const t={},e=g(i,["name"]);e!=null&&_(t,["name"],e);const n=g(i,["displayName"]);n!=null&&_(t,["displayName"],n);const s=g(i,["description"]);s!=null&&_(t,["description"],s);const r=g(i,["version"]);r!=null&&_(t,["version"],r);const a=g(i,["_self"]);a!=null&&_(t,["tunedModelInfo"],tG(a));const c=g(i,["inputTokenLimit"]);c!=null&&_(t,["inputTokenLimit"],c);const u=g(i,["outputTokenLimit"]);u!=null&&_(t,["outputTokenLimit"],u);const h=g(i,["supportedGenerationMethods"]);h!=null&&_(t,["supportedActions"],h);const f=g(i,["temperature"]);f!=null&&_(t,["temperature"],f);const m=g(i,["maxTemperature"]);m!=null&&_(t,["maxTemperature"],m);const y=g(i,["topP"]);y!=null&&_(t,["topP"],y);const T=g(i,["topK"]);T!=null&&_(t,["topK"],T);const S=g(i,["thinking"]);return S!=null&&_(t,["thinking"],S),t}function k_(i){const t={},e=g(i,["name"]);e!=null&&_(t,["name"],e);const n=g(i,["displayName"]);n!=null&&_(t,["displayName"],n);const s=g(i,["description"]);s!=null&&_(t,["description"],s);const r=g(i,["versionId"]);r!=null&&_(t,["version"],r);const a=g(i,["deployedModels"]);if(a!=null){let m=a;Array.isArray(m)&&(m=m.map(y=>QH(y))),_(t,["endpoints"],m)}const c=g(i,["labels"]);c!=null&&_(t,["labels"],c);const u=g(i,["_self"]);u!=null&&_(t,["tunedModelInfo"],eG(u));const h=g(i,["defaultCheckpointId"]);h!=null&&_(t,["defaultCheckpointId"],h);const f=g(i,["checkpoints"]);if(f!=null){let m=f;Array.isArray(m)&&(m=m.map(y=>y)),_(t,["checkpoints"],m)}return t}function B6(i){const t={},e=g(i,["mediaResolution"]);e!=null&&_(t,["mediaResolution"],e);const n=g(i,["codeExecutionResult"]);n!=null&&_(t,["codeExecutionResult"],n);const s=g(i,["executableCode"]);s!=null&&_(t,["executableCode"],s);const r=g(i,["fileData"]);r!=null&&_(t,["fileData"],jH(r));const a=g(i,["functionCall"]);a!=null&&_(t,["functionCall"],ZH(a));const c=g(i,["functionResponse"]);c!=null&&_(t,["functionResponse"],c);const u=g(i,["inlineData"]);u!=null&&_(t,["inlineData"],wH(u));const h=g(i,["text"]);h!=null&&_(t,["text"],h);const f=g(i,["thought"]);f!=null&&_(t,["thought"],f);const m=g(i,["thoughtSignature"]);m!=null&&_(t,["thoughtSignature"],m);const y=g(i,["videoMetadata"]);return y!=null&&_(t,["videoMetadata"],y),t}function F6(i){const t={},e=g(i,["productImage"]);return e!=null&&_(t,["image"],os(e)),t}function H6(i,t){const e={},n=g(i,["numberOfImages"]);t!==void 0&&n!=null&&_(t,["parameters","sampleCount"],n);const s=g(i,["baseSteps"]);t!==void 0&&s!=null&&_(t,["parameters","baseSteps"],s);const r=g(i,["outputGcsUri"]);t!==void 0&&r!=null&&_(t,["parameters","storageUri"],r);const a=g(i,["seed"]);t!==void 0&&a!=null&&_(t,["parameters","seed"],a);const c=g(i,["safetyFilterLevel"]);t!==void 0&&c!=null&&_(t,["parameters","safetySetting"],c);const u=g(i,["personGeneration"]);t!==void 0&&u!=null&&_(t,["parameters","personGeneration"],u);const h=g(i,["addWatermark"]);t!==void 0&&h!=null&&_(t,["parameters","addWatermark"],h);const f=g(i,["outputMimeType"]);t!==void 0&&f!=null&&_(t,["parameters","outputOptions","mimeType"],f);const m=g(i,["outputCompressionQuality"]);t!==void 0&&m!=null&&_(t,["parameters","outputOptions","compressionQuality"],m);const y=g(i,["enhancePrompt"]);t!==void 0&&y!=null&&_(t,["parameters","enhancePrompt"],y);const T=g(i,["labels"]);return t!==void 0&&T!=null&&_(t,["labels"],T),e}function G6(i,t){const e={},n=g(t,["model"]);n!=null&&_(e,["_url","model"],oe(i,n));const s=g(t,["source"]);s!=null&&z6(s,e);const r=g(t,["config"]);return r!=null&&H6(r,e),e}function q6(i){const t={},e=g(i,["predictions"]);if(e!=null){let n=e;Array.isArray(n)&&(n=n.map(s=>am(s))),_(t,["generatedImages"],n)}return t}function z6(i,t){const e={},n=g(i,["prompt"]);t!==void 0&&n!=null&&_(t,["instances[0]","prompt"],n);const s=g(i,["personImage"]);t!==void 0&&s!=null&&_(t,["instances[0]","personImage","image"],os(s));const r=g(i,["productImages"]);if(t!==void 0&&r!=null){let a=r;Array.isArray(a)&&(a=a.map(c=>F6(c))),_(t,["instances[0]","productImages"],a)}return e}function $6(i){const t={},e=g(i,["referenceImage"]);e!=null&&_(t,["referenceImage"],os(e));const n=g(i,["referenceId"]);n!=null&&_(t,["referenceId"],n);const s=g(i,["referenceType"]);s!=null&&_(t,["referenceType"],s);const r=g(i,["maskImageConfig"]);r!=null&&_(t,["maskImageConfig"],V6(r));const a=g(i,["controlImageConfig"]);a!=null&&_(t,["controlImageConfig"],xH(a));const c=g(i,["styleImageConfig"]);c!=null&&_(t,["styleImageConfig"],c);const u=g(i,["subjectImageConfig"]);return u!=null&&_(t,["subjectImageConfig"],u),t}function uM(i){const t={},e=g(i,["safetyAttributes","categories"]);e!=null&&_(t,["categories"],e);const n=g(i,["safetyAttributes","scores"]);n!=null&&_(t,["scores"],n);const s=g(i,["contentType"]);return s!=null&&_(t,["contentType"],s),t}function hM(i){const t={},e=g(i,["safetyAttributes","categories"]);e!=null&&_(t,["categories"],e);const n=g(i,["safetyAttributes","scores"]);n!=null&&_(t,["scores"],n);const s=g(i,["contentType"]);return s!=null&&_(t,["contentType"],s),t}function Y6(i){const t={},e=g(i,["category"]);if(e!=null&&_(t,["category"],e),g(i,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=g(i,["threshold"]);return n!=null&&_(t,["threshold"],n),t}function W6(i){const t={},e=g(i,["image"]);return e!=null&&_(t,["image"],os(e)),t}function K6(i,t){const e={},n=g(i,["mode"]);t!==void 0&&n!=null&&_(t,["parameters","mode"],n);const s=g(i,["maxPredictions"]);t!==void 0&&s!=null&&_(t,["parameters","maxPredictions"],s);const r=g(i,["confidenceThreshold"]);t!==void 0&&r!=null&&_(t,["parameters","confidenceThreshold"],r);const a=g(i,["maskDilation"]);t!==void 0&&a!=null&&_(t,["parameters","maskDilation"],a);const c=g(i,["binaryColorThreshold"]);t!==void 0&&c!=null&&_(t,["parameters","binaryColorThreshold"],c);const u=g(i,["labels"]);return t!==void 0&&u!=null&&_(t,["labels"],u),e}function X6(i,t){const e={},n=g(t,["model"]);n!=null&&_(e,["_url","model"],oe(i,n));const s=g(t,["source"]);s!=null&&Q6(s,e);const r=g(t,["config"]);return r!=null&&K6(r,e),e}function J6(i){const t={},e=g(i,["predictions"]);if(e!=null){let n=e;Array.isArray(n)&&(n=n.map(s=>T6(s))),_(t,["generatedMasks"],n)}return t}function Q6(i,t){const e={},n=g(i,["prompt"]);t!==void 0&&n!=null&&_(t,["instances[0]","prompt"],n);const s=g(i,["image"]);t!==void 0&&s!=null&&_(t,["instances[0]","image"],os(s));const r=g(i,["scribbleImage"]);return t!==void 0&&r!=null&&_(t,["instances[0]","scribble"],W6(r)),e}function j6(i){const t={},e=g(i,["functionCallingConfig"]);e!=null&&_(t,["functionCallingConfig"],t6(e));const n=g(i,["retrievalConfig"]);return n!=null&&_(t,["retrievalConfig"],n),t}function Z6(i){const t={},e=g(i,["functionDeclarations"]);if(e!=null){let f=e;Array.isArray(f)&&(f=f.map(m=>m)),_(t,["functionDeclarations"],f)}if(g(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=g(i,["googleSearchRetrieval"]);n!=null&&_(t,["googleSearchRetrieval"],n);const s=g(i,["computerUse"]);s!=null&&_(t,["computerUse"],s);const r=g(i,["fileSearch"]);r!=null&&_(t,["fileSearch"],r);const a=g(i,["codeExecution"]);if(a!=null&&_(t,["codeExecution"],a),g(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const c=g(i,["googleMaps"]);c!=null&&_(t,["googleMaps"],I6(c));const u=g(i,["googleSearch"]);u!=null&&_(t,["googleSearch"],R6(u));const h=g(i,["urlContext"]);return h!=null&&_(t,["urlContext"],h),t}function dM(i){const t={},e=g(i,["functionDeclarations"]);if(e!=null){let m=e;Array.isArray(m)&&(m=m.map(y=>e6(y))),_(t,["functionDeclarations"],m)}const n=g(i,["retrieval"]);n!=null&&_(t,["retrieval"],n);const s=g(i,["googleSearchRetrieval"]);s!=null&&_(t,["googleSearchRetrieval"],s);const r=g(i,["computerUse"]);if(r!=null&&_(t,["computerUse"],r),g(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const a=g(i,["codeExecution"]);a!=null&&_(t,["codeExecution"],a);const c=g(i,["enterpriseWebSearch"]);c!=null&&_(t,["enterpriseWebSearch"],c);const u=g(i,["googleMaps"]);u!=null&&_(t,["googleMaps"],u);const h=g(i,["googleSearch"]);h!=null&&_(t,["googleSearch"],h);const f=g(i,["urlContext"]);return f!=null&&_(t,["urlContext"],f),t}function tG(i){const t={},e=g(i,["baseModel"]);e!=null&&_(t,["baseModel"],e);const n=g(i,["createTime"]);n!=null&&_(t,["createTime"],n);const s=g(i,["updateTime"]);return s!=null&&_(t,["updateTime"],s),t}function eG(i){const t={},e=g(i,["labels","google-vertex-llm-tuning-base-model-id"]);e!=null&&_(t,["baseModel"],e);const n=g(i,["createTime"]);n!=null&&_(t,["createTime"],n);const s=g(i,["updateTime"]);return s!=null&&_(t,["updateTime"],s),t}function nG(i,t){const e={},n=g(i,["displayName"]);t!==void 0&&n!=null&&_(t,["displayName"],n);const s=g(i,["description"]);t!==void 0&&s!=null&&_(t,["description"],s);const r=g(i,["defaultCheckpointId"]);return t!==void 0&&r!=null&&_(t,["defaultCheckpointId"],r),e}function iG(i,t){const e={},n=g(i,["displayName"]);t!==void 0&&n!=null&&_(t,["displayName"],n);const s=g(i,["description"]);t!==void 0&&s!=null&&_(t,["description"],s);const r=g(i,["defaultCheckpointId"]);return t!==void 0&&r!=null&&_(t,["defaultCheckpointId"],r),e}function sG(i,t){const e={},n=g(t,["model"]);n!=null&&_(e,["_url","name"],oe(i,n));const s=g(t,["config"]);return s!=null&&nG(s,e),e}function rG(i,t){const e={},n=g(t,["model"]);n!=null&&_(e,["_url","model"],oe(i,n));const s=g(t,["config"]);return s!=null&&iG(s,e),e}function oG(i,t){const e={},n=g(i,["outputGcsUri"]);t!==void 0&&n!=null&&_(t,["parameters","storageUri"],n);const s=g(i,["safetyFilterLevel"]);t!==void 0&&s!=null&&_(t,["parameters","safetySetting"],s);const r=g(i,["personGeneration"]);t!==void 0&&r!=null&&_(t,["parameters","personGeneration"],r);const a=g(i,["includeRaiReason"]);t!==void 0&&a!=null&&_(t,["parameters","includeRaiReason"],a);const c=g(i,["outputMimeType"]);t!==void 0&&c!=null&&_(t,["parameters","outputOptions","mimeType"],c);const u=g(i,["outputCompressionQuality"]);t!==void 0&&u!=null&&_(t,["parameters","outputOptions","compressionQuality"],u);const h=g(i,["enhanceInputImage"]);t!==void 0&&h!=null&&_(t,["parameters","upscaleConfig","enhanceInputImage"],h);const f=g(i,["imagePreservationFactor"]);t!==void 0&&f!=null&&_(t,["parameters","upscaleConfig","imagePreservationFactor"],f);const m=g(i,["labels"]);t!==void 0&&m!=null&&_(t,["labels"],m);const y=g(i,["numberOfImages"]);t!==void 0&&y!=null&&_(t,["parameters","sampleCount"],y);const T=g(i,["mode"]);return t!==void 0&&T!=null&&_(t,["parameters","mode"],T),e}function aG(i,t){const e={},n=g(t,["model"]);n!=null&&_(e,["_url","model"],oe(i,n));const s=g(t,["image"]);s!=null&&_(e,["instances[0]","image"],os(s));const r=g(t,["upscaleFactor"]);r!=null&&_(e,["parameters","upscaleConfig","upscaleFactor"],r);const a=g(t,["config"]);return a!=null&&oG(a,e),e}function lG(i){const t={},e=g(i,["sdkHttpResponse"]);e!=null&&_(t,["sdkHttpResponse"],e);const n=g(i,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>am(r))),_(t,["generatedImages"],s)}return t}function cG(i){const t={},e=g(i,["uri"]);e!=null&&_(t,["uri"],e);const n=g(i,["encodedVideo"]);n!=null&&_(t,["videoBytes"],Bo(n));const s=g(i,["encoding"]);return s!=null&&_(t,["mimeType"],s),t}function uG(i){const t={},e=g(i,["gcsUri"]);e!=null&&_(t,["uri"],e);const n=g(i,["bytesBase64Encoded"]);n!=null&&_(t,["videoBytes"],Bo(n));const s=g(i,["mimeType"]);return s!=null&&_(t,["mimeType"],s),t}function hG(i){const t={},e=g(i,["image"]);e!=null&&_(t,["_self"],os(e));const n=g(i,["maskMode"]);return n!=null&&_(t,["maskMode"],n),t}function dG(i){const t={},e=g(i,["image"]);e!=null&&_(t,["image"],lm(e));const n=g(i,["referenceType"]);return n!=null&&_(t,["referenceType"],n),t}function fG(i){const t={},e=g(i,["image"]);e!=null&&_(t,["image"],os(e));const n=g(i,["referenceType"]);return n!=null&&_(t,["referenceType"],n),t}function fM(i){const t={},e=g(i,["uri"]);e!=null&&_(t,["uri"],e);const n=g(i,["videoBytes"]);n!=null&&_(t,["encodedVideo"],Bo(n));const s=g(i,["mimeType"]);return s!=null&&_(t,["encoding"],s),t}function pM(i){const t={},e=g(i,["uri"]);e!=null&&_(t,["gcsUri"],e);const n=g(i,["videoBytes"]);n!=null&&_(t,["bytesBase64Encoded"],Bo(n));const s=g(i,["mimeType"]);return s!=null&&_(t,["mimeType"],s),t}function pG(i,t){const e={},n=g(i,["displayName"]);return t!==void 0&&n!=null&&_(t,["displayName"],n),e}function mG(i){const t={},e=g(i,["config"]);return e!=null&&pG(e,t),t}function gG(i,t){const e={},n=g(i,["force"]);return t!==void 0&&n!=null&&_(t,["_query","force"],n),e}function yG(i){const t={},e=g(i,["name"]);e!=null&&_(t,["_url","name"],e);const n=g(i,["config"]);return n!=null&&gG(n,t),t}function _G(i){const t={},e=g(i,["name"]);return e!=null&&_(t,["_url","name"],e),t}function vG(i,t){const e={},n=g(i,["customMetadata"]);if(t!==void 0&&n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>a)),_(t,["customMetadata"],r)}const s=g(i,["chunkingConfig"]);return t!==void 0&&s!=null&&_(t,["chunkingConfig"],s),e}function EG(i){const t={},e=g(i,["name"]);e!=null&&_(t,["name"],e);const n=g(i,["metadata"]);n!=null&&_(t,["metadata"],n);const s=g(i,["done"]);s!=null&&_(t,["done"],s);const r=g(i,["error"]);r!=null&&_(t,["error"],r);const a=g(i,["response"]);return a!=null&&_(t,["response"],AG(a)),t}function TG(i){const t={},e=g(i,["fileSearchStoreName"]);e!=null&&_(t,["_url","file_search_store_name"],e);const n=g(i,["fileName"]);n!=null&&_(t,["fileName"],n);const s=g(i,["config"]);return s!=null&&vG(s,t),t}function AG(i){const t={},e=g(i,["sdkHttpResponse"]);e!=null&&_(t,["sdkHttpResponse"],e);const n=g(i,["parent"]);n!=null&&_(t,["parent"],n);const s=g(i,["documentName"]);return s!=null&&_(t,["documentName"],s),t}function SG(i,t){const e={},n=g(i,["pageSize"]);t!==void 0&&n!=null&&_(t,["_query","pageSize"],n);const s=g(i,["pageToken"]);return t!==void 0&&s!=null&&_(t,["_query","pageToken"],s),e}function wG(i){const t={},e=g(i,["config"]);return e!=null&&SG(e,t),t}function bG(i){const t={},e=g(i,["sdkHttpResponse"]);e!=null&&_(t,["sdkHttpResponse"],e);const n=g(i,["nextPageToken"]);n!=null&&_(t,["nextPageToken"],n);const s=g(i,["fileSearchStores"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>a)),_(t,["fileSearchStores"],r)}return t}function mM(i,t){const e={},n=g(i,["mimeType"]);t!==void 0&&n!=null&&_(t,["mimeType"],n);const s=g(i,["displayName"]);t!==void 0&&s!=null&&_(t,["displayName"],s);const r=g(i,["customMetadata"]);if(t!==void 0&&r!=null){let c=r;Array.isArray(c)&&(c=c.map(u=>u)),_(t,["customMetadata"],c)}const a=g(i,["chunkingConfig"]);return t!==void 0&&a!=null&&_(t,["chunkingConfig"],a),e}function CG(i){const t={},e=g(i,["fileSearchStoreName"]);e!=null&&_(t,["_url","file_search_store_name"],e);const n=g(i,["config"]);return n!=null&&mM(n,t),t}function IG(i){const t={},e=g(i,["sdkHttpResponse"]);return e!=null&&_(t,["sdkHttpResponse"],e),t}const RG="Content-Type",MG="X-Server-Timeout",PG="User-Agent",L_="x-goog-api-client",xG="1.34.0",DG=`google-genai-sdk/${xG}`,NG="v1beta1",kG="v1beta";class LG{constructor(t){var e,n;this.clientOptions=Object.assign(Object.assign({},t),{project:t.project,location:t.location,apiKey:t.apiKey,vertexai:t.vertexai});const s={};this.clientOptions.vertexai?(s.apiVersion=(e=this.clientOptions.apiVersion)!==null&&e!==void 0?e:NG,s.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(s.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:kG,s.baseUrl="https://generativelanguage.googleapis.com/"),s.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=s,t.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(s,t.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var t;return(t=this.clientOptions.vertexai)!==null&&t!==void 0?t:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){const t=new Headers;return await this.clientOptions.auth.addAuthHeaders(t),t}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(t){if(!t||t.baseUrl===void 0||t.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const n=[t.baseUrl.endsWith("/")?t.baseUrl.slice(0,-1):t.baseUrl];return t.apiVersion&&t.apiVersion!==""&&n.push(t.apiVersion),n.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const t=this.getBaseUrl(),e=new URL(t);return e.protocol=e.protocol=="http:"?"ws":"wss",e.toString()}setBaseUrl(t){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=t;else throw new Error("HTTP options are not correctly set.")}constructUrl(t,e,n){const s=[this.getRequestUrlInternal(e)];return n&&s.push(this.getBaseResourcePath()),t!==""&&s.push(t),new URL(`${s.join("/")}`)}shouldPrependVertexProjectPath(t){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||t.path.startsWith("projects/")||t.httpMethod==="GET"&&t.path.startsWith("publishers/google/models"))}async request(t){let e=this.clientOptions.httpOptions;t.httpOptions&&(e=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const n=this.shouldPrependVertexProjectPath(t),s=this.constructUrl(t.path,e,n);if(t.queryParams)for(const[a,c]of Object.entries(t.queryParams))s.searchParams.append(a,String(c));let r={};if(t.httpMethod==="GET"){if(t.body&&t.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else r.body=t.body;return r=await this.includeExtraHttpOptionsToRequestInit(r,e,s.toString(),t.abortSignal),this.unaryApiCall(s,r,t.httpMethod)}patchHttpOptions(t,e){const n=JSON.parse(JSON.stringify(t));for(const[s,r]of Object.entries(e))typeof r=="object"?n[s]=Object.assign(Object.assign({},n[s]),r):r!==void 0&&(n[s]=r);return n}async requestStream(t){let e=this.clientOptions.httpOptions;t.httpOptions&&(e=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const n=this.shouldPrependVertexProjectPath(t),s=this.constructUrl(t.path,e,n);(!s.searchParams.has("alt")||s.searchParams.get("alt")!=="sse")&&s.searchParams.set("alt","sse");let r={};return r.body=t.body,r=await this.includeExtraHttpOptionsToRequestInit(r,e,s.toString(),t.abortSignal),this.streamApiCall(s,r,t.httpMethod)}async includeExtraHttpOptionsToRequestInit(t,e,n,s){if(e&&e.timeout||s){const r=new AbortController,a=r.signal;if(e.timeout&&e?.timeout>0){const c=setTimeout(()=>r.abort(),e.timeout);c&&typeof c.unref=="function"&&c.unref()}s&&s.addEventListener("abort",()=>{r.abort()}),t.signal=a}return e&&e.extraBody!==null&&OG(t,e.extraBody),t.headers=await this.getHeadersInternal(e,n),t}async unaryApiCall(t,e,n){return this.apiCall(t.toString(),Object.assign(Object.assign({},e),{method:n})).then(async s=>(await hC(s),new P_(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}async streamApiCall(t,e,n){return this.apiCall(t.toString(),Object.assign(Object.assign({},e),{method:n})).then(async s=>(await hC(s),this.processStreamResponse(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}processStreamResponse(t){return ns(this,arguments,function*(){var n;const s=(n=t?.body)===null||n===void 0?void 0:n.getReader(),r=new TextDecoder("utf-8");if(!s)throw new Error("Response body is empty");try{let a="";const c="data:",u=[`

`,"\r\r",`\r
\r
`];for(;;){const{done:h,value:f}=yield Ut(s.read());if(h){if(a.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const m=r.decode(f,{stream:!0});try{const S=JSON.parse(m);if("error"in S){const b=JSON.parse(JSON.stringify(S.error)),C=b.status,I=b.code,D=`got status: ${C}. ${JSON.stringify(S)}`;if(I>=400&&I<600)throw new rm({message:D,status:I})}}catch(S){if(S.name==="ApiError")throw S}a+=m;let y=-1,T=0;for(;;){y=-1,T=0;for(const C of u){const I=a.indexOf(C);I!==-1&&(y===-1||I<y)&&(y=I,T=C.length)}if(y===-1)break;const S=a.substring(0,y);a=a.substring(y+T);const b=S.trim();if(b.startsWith(c)){const C=b.substring(c.length).trim();try{const I=new Response(C,{headers:t?.headers,status:t?.status,statusText:t?.statusText});yield yield Ut(new P_(I))}catch(I){throw new Error(`exception parsing stream chunk ${C}. ${I}`)}}}}}finally{s.releaseLock()}})}async apiCall(t,e){return fetch(t,e).catch(n=>{throw new Error(`exception ${n} sending request`)})}getDefaultHeaders(){const t={},e=DG+" "+this.clientOptions.userAgentExtra;return t[PG]=e,t[L_]=e,t[RG]="application/json",t}async getHeadersInternal(t,e){const n=new Headers;if(t&&t.headers){for(const[s,r]of Object.entries(t.headers))n.append(s,r);t.timeout&&t.timeout>0&&n.append(MG,String(Math.ceil(t.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,e),n}getFileName(t){var e;let n="";return typeof t=="string"&&(n=t.replace(/[/\\]+$/,""),n=(e=n.split(/[/\\]/).pop())!==null&&e!==void 0?e:""),n}async uploadFile(t,e){var n;const s={};e!=null&&(s.mimeType=e.mimeType,s.name=e.name,s.displayName=e.displayName),s.name&&!s.name.startsWith("files/")&&(s.name=`files/${s.name}`);const r=this.clientOptions.uploader,a=await r.stat(t);s.sizeBytes=String(a.size);const c=(n=e?.mimeType)!==null&&n!==void 0?n:a.type;if(c===void 0||c==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");s.mimeType=c;const u={file:s},h=this.getFileName(t),f=gt("upload/v1beta/files",u._url),m=await this.fetchUploadUrl(f,s.sizeBytes,s.mimeType,h,u,e?.httpOptions);return r.upload(t,m,this)}async uploadFileToFileSearchStore(t,e,n){var s;const r=this.clientOptions.uploader,a=await r.stat(e),c=String(a.size),u=(s=n?.mimeType)!==null&&s!==void 0?s:a.type;if(u===void 0||u==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const h=`upload/v1beta/${t}:uploadToFileSearchStore`,f=this.getFileName(e),m={};n!=null&&mM(n,m);const y=await this.fetchUploadUrl(h,c,u,f,m,n?.httpOptions);return r.uploadToFileSearchStore(e,y,this)}async downloadFile(t){await this.clientOptions.downloader.download(t,this)}async fetchUploadUrl(t,e,n,s,r,a){var c;let u={};a?u=a:u={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e}`,"X-Goog-Upload-Header-Content-Type":`${n}`},s?{"X-Goog-Upload-File-Name":s}:{})};const h=await this.request({path:t,body:JSON.stringify(r),httpMethod:"POST",httpOptions:u});if(!h||!h?.headers)throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const f=(c=h?.headers)===null||c===void 0?void 0:c["x-goog-upload-url"];if(f===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return f}}async function hC(i){var t;if(i===void 0)throw new Error("response is undefined");if(!i.ok){const e=i.status;let n;!((t=i.headers.get("content-type"))===null||t===void 0)&&t.includes("application/json")?n=await i.json():n={error:{message:await i.text(),code:i.status,status:i.statusText}};const s=JSON.stringify(n);throw e>=400&&e<600?new rm({message:s,status:e}):new Error(s)}}function OG(i,t){if(!t||Object.keys(t).length===0)return;if(i.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let e={};if(typeof i.body=="string"&&i.body.length>0)try{const r=JSON.parse(i.body);if(typeof r=="object"&&r!==null&&!Array.isArray(r))e=r;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function n(r,a){const c=Object.assign({},r);for(const u in a)if(Object.prototype.hasOwnProperty.call(a,u)){const h=a[u],f=c[u];h&&typeof h=="object"&&!Array.isArray(h)&&f&&typeof f=="object"&&!Array.isArray(f)?c[u]=n(f,h):(f&&h&&typeof f!=typeof h&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${u}". Original type: ${typeof f}, New type: ${typeof h}. Overwriting.`),c[u]=h)}return c}const s=n(e,t);i.body=JSON.stringify(s)}const UG="mcp_used/unknown";let VG=!1;function gM(i){for(const t of i)if(BG(t)||typeof t=="object"&&"inputSchema"in t)return!0;return VG}function yM(i){var t;const e=(t=i[L_])!==null&&t!==void 0?t:"";i[L_]=(e+` ${UG}`).trimStart()}function BG(i){return i!==null&&typeof i=="object"&&i instanceof uE}function FG(i){return ns(this,arguments,function*(e,n=100){let s,r=0;for(;r<n;){const a=yield Ut(e.listTools({cursor:s}));for(const c of a.tools)yield yield Ut(c),r++;if(!a.nextCursor)break;s=a.nextCursor}})}class uE{constructor(t=[],e){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=t,this.config=e}static create(t,e){return new uE(t,e)}async initialize(){var t,e,n,s;if(this.mcpTools.length>0)return;const r={},a=[];for(const f of this.mcpClients)try{for(var c=!0,u=(e=void 0,is(FG(f))),h;h=await u.next(),t=h.done,!t;c=!0){s=h.value,c=!1;const m=s;a.push(m);const y=m.name;if(r[y])throw new Error(`Duplicate function name ${y} found in MCP tools. Please ensure function names are unique.`);r[y]=f}}catch(m){e={error:m}}finally{try{!c&&!t&&(n=u.return)&&await n.call(u)}finally{if(e)throw e.error}}this.mcpTools=a,this.functionNameToMcpClient=r}async tool(){return await this.initialize(),_4(this.mcpTools,this.config)}async callTool(t){await this.initialize();const e=[];for(const n of t)if(n.name in this.functionNameToMcpClient){const s=this.functionNameToMcpClient[n.name];let r;this.config.timeout&&(r={timeout:this.config.timeout});const a=await s.callTool({name:n.name,arguments:n.args},void 0,r);e.push({functionResponse:{name:n.name,response:a.isError?{error:a}:a}})}return e}}async function HG(i,t,e){const n=new u4;let s;e.data instanceof Blob?s=JSON.parse(await e.data.text()):s=JSON.parse(e.data),Object.assign(n,s),t(n)}class GG{constructor(t,e,n){this.apiClient=t,this.auth=e,this.webSocketFactory=n}async connect(t){var e,n;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const s=this.apiClient.getWebsocketBaseUrl(),r=this.apiClient.getApiVersion(),a=$G(this.apiClient.getDefaultHeaders()),c=this.apiClient.getApiKey(),u=`${s}/ws/google.ai.generativelanguage.${r}.GenerativeService.BidiGenerateMusic?key=${c}`;let h=()=>{};const f=new Promise(P=>{h=P}),m=t.callbacks,y=function(){h({})},T=this.apiClient,S={onopen:y,onmessage:P=>{HG(T,m.onmessage,P)},onerror:(e=m?.onerror)!==null&&e!==void 0?e:function(P){},onclose:(n=m?.onclose)!==null&&n!==void 0?n:function(P){}},b=this.webSocketFactory.create(u,zG(a),S);b.connect(),await f;const D={setup:{model:oe(this.apiClient,t.model)}};return b.send(JSON.stringify(D)),new qG(b,this.apiClient)}}class qG{constructor(t,e){this.conn=t,this.apiClient=e}async setWeightedPrompts(t){if(!t.weightedPrompts||Object.keys(t.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const e=mH(t);this.conn.send(JSON.stringify({clientContent:e}))}async setMusicGenerationConfig(t){t.musicGenerationConfig||(t.musicGenerationConfig={});const e=pH(t);this.conn.send(JSON.stringify(e))}sendPlaybackControl(t){const e={playbackControl:t};this.conn.send(JSON.stringify(e))}play(){this.sendPlaybackControl(Kl.PLAY)}pause(){this.sendPlaybackControl(Kl.PAUSE)}stop(){this.sendPlaybackControl(Kl.STOP)}resetContext(){this.sendPlaybackControl(Kl.RESET_CONTEXT)}close(){this.conn.close()}}function zG(i){const t={};return i.forEach((e,n)=>{t[n]=e}),t}function $G(i){const t=new Headers;for(const[e,n]of Object.entries(i))t.append(e,n);return t}const YG="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function WG(i,t,e){const n=new c4;let s;e.data instanceof Blob?s=await e.data.text():e.data instanceof ArrayBuffer?s=new TextDecoder().decode(e.data):s=e.data;const r=JSON.parse(s);if(i.isVertexAI()){const a=_H(r);Object.assign(n,a)}else Object.assign(n,r);t(n)}class KG{constructor(t,e,n){this.apiClient=t,this.auth=e,this.webSocketFactory=n,this.music=new GG(this.apiClient,this.auth,this.webSocketFactory)}async connect(t){var e,n,s,r,a,c;if(t.config&&t.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const u=this.apiClient.getWebsocketBaseUrl(),h=this.apiClient.getApiVersion();let f;const m=this.apiClient.getHeaders();t.config&&t.config.tools&&gM(t.config.tools)&&yM(m);const y=jG(m);if(this.apiClient.isVertexAI())f=`${u}/ws/google.cloud.aiplatform.${h}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(y,f);else{const k=this.apiClient.getApiKey();let V="BidiGenerateContent",U="key";k?.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),h!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),V="BidiGenerateContentConstrained",U="access_token"),f=`${u}/ws/google.ai.generativelanguage.${h}.GenerativeService.${V}?${U}=${k}`}let T=()=>{};const S=new Promise(k=>{T=k}),b=t.callbacks,C=function(){var k;(k=b?.onopen)===null||k===void 0||k.call(b),T({})},I=this.apiClient,D={onopen:C,onmessage:k=>{WG(I,b.onmessage,k)},onerror:(e=b?.onerror)!==null&&e!==void 0?e:function(k){},onclose:(n=b?.onclose)!==null&&n!==void 0?n:function(k){}},P=this.webSocketFactory.create(f,QG(y),D);P.connect(),await S;let H=oe(this.apiClient,t.model);if(this.apiClient.isVertexAI()&&H.startsWith("publishers/")){const k=this.apiClient.getProject(),V=this.apiClient.getLocation();H=`projects/${k}/locations/${V}/`+H}let F={};this.apiClient.isVertexAI()&&((s=t.config)===null||s===void 0?void 0:s.responseModalities)===void 0&&(t.config===void 0?t.config={responseModalities:[bp.AUDIO]}:t.config.responseModalities=[bp.AUDIO]),!((r=t.config)===null||r===void 0)&&r.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const G=(c=(a=t.config)===null||a===void 0?void 0:a.tools)!==null&&c!==void 0?c:[],N=[];for(const k of G)if(this.isCallableTool(k)){const V=k;N.push(await V.tool())}else N.push(k);N.length>0&&(t.config.tools=N);const x={model:H,config:t.config,callbacks:t.callbacks};return this.apiClient.isVertexAI()?F=fH(this.apiClient,x):F=dH(this.apiClient,x),delete F.config,P.send(JSON.stringify(F)),new JG(P,this.apiClient)}isCallableTool(t){return"callTool"in t&&typeof t.callTool=="function"}}const XG={turnComplete:!0};class JG{constructor(t,e){this.conn=t,this.apiClient=e}tLiveClientContent(t,e){if(e.turns!==null&&e.turns!==void 0){let n=[];try{n=Ui(e.turns),t.isVertexAI()||(n=n.map(s=>om(s)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof e.turns}'`)}return{clientContent:{turns:n,turnComplete:e.turnComplete}}}return{clientContent:{turnComplete:e.turnComplete}}}tLiveClienttToolResponse(t,e){let n=[];if(e.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(e.functionResponses)?n=e.functionResponses:n=[e.functionResponses],n.length===0)throw new Error("functionResponses is required.");for(const r of n){if(typeof r!="object"||r===null||!("name"in r)||!("response"in r))throw new Error(`Could not parse function response, type '${typeof r}'.`);if(!t.isVertexAI()&&!("id"in r))throw new Error(YG)}return{toolResponse:{functionResponses:n}}}sendClientContent(t){t=Object.assign(Object.assign({},XG),t);const e=this.tLiveClientContent(this.apiClient,t);this.conn.send(JSON.stringify(e))}sendRealtimeInput(t){let e={};this.apiClient.isVertexAI()?e={realtimeInput:yH(t)}:e={realtimeInput:gH(t)},this.conn.send(JSON.stringify(e))}sendToolResponse(t){if(t.functionResponses==null)throw new Error("Tool response parameters are required.");const e=this.tLiveClienttToolResponse(this.apiClient,t);this.conn.send(JSON.stringify(e))}close(){this.conn.close()}}function QG(i){const t={};return i.forEach((e,n)=>{t[n]=e}),t}function jG(i){const t=new Headers;for(const[e,n]of Object.entries(i))t.append(e,n);return t}const dC=10;function fC(i){var t,e,n;if(!((t=i?.automaticFunctionCalling)===null||t===void 0)&&t.disable)return!0;let s=!1;for(const a of(e=i?.tools)!==null&&e!==void 0?e:[])if(oc(a)){s=!0;break}if(!s)return!0;const r=(n=i?.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls;return r&&(r<0||!Number.isInteger(r))||r==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",r),!0):!1}function oc(i){return"callTool"in i&&typeof i.callTool=="function"}function ZG(i){var t,e,n;return(n=(e=(t=i.config)===null||t===void 0?void 0:t.tools)===null||e===void 0?void 0:e.some(s=>oc(s)))!==null&&n!==void 0?n:!1}function pC(i){var t;const e=[];return!((t=i?.config)===null||t===void 0)&&t.tools&&i.config.tools.forEach((n,s)=>{if(oc(n))return;const r=n;r.functionDeclarations&&r.functionDeclarations.length>0&&e.push(s)}),e}function mC(i){var t;return!(!((t=i?.automaticFunctionCalling)===null||t===void 0)&&t.ignoreCallHistory)}class tq extends Cr{constructor(t){super(),this.apiClient=t,this.generateContent=async e=>{var n,s,r,a,c;const u=await this.processParamsMaybeAddMcpUsage(e);if(this.maybeMoveToResponseJsonSchem(e),!ZG(e)||fC(e.config))return await this.generateContentInternal(u);const h=pC(e);if(h.length>0){const b=h.map(C=>`tools[${C}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${b}.`)}let f,m;const y=Ui(u.contents),T=(r=(s=(n=u.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&r!==void 0?r:dC;let S=0;for(;S<T&&(f=await this.generateContentInternal(u),!(!f.functionCalls||f.functionCalls.length===0));){const b=f.candidates[0].content,C=[];for(const I of(c=(a=e.config)===null||a===void 0?void 0:a.tools)!==null&&c!==void 0?c:[])if(oc(I)){const P=await I.callTool(f.functionCalls);C.push(...P)}S++,m={role:"user",parts:C},u.contents=Ui(u.contents),u.contents.push(b),u.contents.push(m),mC(u.config)&&(y.push(b),y.push(m))}return mC(u.config)&&(f.automaticFunctionCallingHistory=y),f},this.generateContentStream=async e=>{var n,s,r,a,c;if(this.maybeMoveToResponseJsonSchem(e),fC(e.config)){const m=await this.processParamsMaybeAddMcpUsage(e);return await this.generateContentStreamInternal(m)}const u=pC(e);if(u.length>0){const m=u.map(y=>`tools[${y}]`).join(", ");throw new Error(`Incompatible tools found at ${m}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const h=(r=(s=(n=e?.config)===null||n===void 0?void 0:n.toolConfig)===null||s===void 0?void 0:s.functionCallingConfig)===null||r===void 0?void 0:r.streamFunctionCallArguments,f=(c=(a=e?.config)===null||a===void 0?void 0:a.automaticFunctionCalling)===null||c===void 0?void 0:c.disable;if(h&&!f)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(e)},this.generateImages=async e=>await this.generateImagesInternal(e).then(n=>{var s;let r;const a=[];if(n?.generatedImages)for(const u of n.generatedImages)u&&u?.safetyAttributes&&((s=u?.safetyAttributes)===null||s===void 0?void 0:s.contentType)==="Positive Prompt"?r=u?.safetyAttributes:a.push(u);let c;return r?c={generatedImages:a,positivePromptSafetyAttributes:r,sdkHttpResponse:n.sdkHttpResponse}:c={generatedImages:a,sdkHttpResponse:n.sdkHttpResponse},c}),this.list=async e=>{var n;const a={config:Object.assign(Object.assign({},{queryBase:!0}),e?.config)};if(this.apiClient.isVertexAI()&&!a.config.queryBase){if(!((n=a.config)===null||n===void 0)&&n.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");a.config.filter="labels.tune-type:*"}return new $a(br.PAGED_ITEM_MODELS,c=>this.listInternal(c),await this.listInternal(a),a)},this.editImage=async e=>{const n={model:e.model,prompt:e.prompt,referenceImages:[],config:e.config};return e.referenceImages&&e.referenceImages&&(n.referenceImages=e.referenceImages.map(s=>s.toReferenceImageAPI())),await this.editImageInternal(n)},this.upscaleImage=async e=>{let n={numberOfImages:1,mode:"upscale"};e.config&&(n=Object.assign(Object.assign({},n),e.config));const s={model:e.model,image:e.image,upscaleFactor:e.upscaleFactor,config:n};return await this.upscaleImageInternal(s)},this.generateVideos=async e=>{var n,s,r,a,c,u;if((e.prompt||e.image||e.video)&&e.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((n=e.video)===null||n===void 0)&&n.uri&&(!((s=e.video)===null||s===void 0)&&s.videoBytes)?e.video={uri:e.video.uri,mimeType:e.video.mimeType}:!((a=(r=e.source)===null||r===void 0?void 0:r.video)===null||a===void 0)&&a.uri&&(!((u=(c=e.source)===null||c===void 0?void 0:c.video)===null||u===void 0)&&u.videoBytes)&&(e.source.video={uri:e.source.video.uri,mimeType:e.source.video.mimeType})),await this.generateVideosInternal(e)}}maybeMoveToResponseJsonSchem(t){t.config&&t.config.responseSchema&&(t.config.responseJsonSchema||Object.keys(t.config.responseSchema).includes("$schema")&&(t.config.responseJsonSchema=t.config.responseSchema,delete t.config.responseSchema))}async processParamsMaybeAddMcpUsage(t){var e,n,s;const r=(e=t.config)===null||e===void 0?void 0:e.tools;if(!r)return t;const a=await Promise.all(r.map(async u=>oc(u)?await u.tool():u)),c={model:t.model,contents:t.contents,config:Object.assign(Object.assign({},t.config),{tools:a})};if(c.config.tools=a,t.config&&t.config.tools&&gM(t.config.tools)){const u=(s=(n=t.config.httpOptions)===null||n===void 0?void 0:n.headers)!==null&&s!==void 0?s:{};let h=Object.assign({},u);Object.keys(h).length===0&&(h=this.apiClient.getDefaultHeaders()),yM(h),c.config.httpOptions=Object.assign(Object.assign({},t.config.httpOptions),{headers:h})}return c}async initAfcToolsMap(t){var e,n,s;const r=new Map;for(const a of(n=(e=t.config)===null||e===void 0?void 0:e.tools)!==null&&n!==void 0?n:[])if(oc(a)){const c=a,u=await c.tool();for(const h of(s=u.functionDeclarations)!==null&&s!==void 0?s:[]){if(!h.name)throw new Error("Function declaration name is required.");if(r.has(h.name))throw new Error(`Duplicate tool declaration name: ${h.name}`);r.set(h.name,c)}}return r}async processAfcStream(t){var e,n,s;const r=(s=(n=(e=t.config)===null||e===void 0?void 0:e.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls)!==null&&s!==void 0?s:dC;let a=!1,c=0;const u=await this.initAfcToolsMap(t);return(function(h,f,m){return ns(this,arguments,function*(){for(var y,T,S,b,C,I;c<r;){a&&(c++,a=!1);const F=yield Ut(h.processParamsMaybeAddMcpUsage(m)),G=yield Ut(h.generateContentStreamInternal(F)),N=[],x=[];try{for(var D=!0,P=(T=void 0,is(G)),H;H=yield Ut(P.next()),y=H.done,!y;D=!0){b=H.value,D=!1;const k=b;if(yield yield Ut(k),k.candidates&&(!((C=k.candidates[0])===null||C===void 0)&&C.content)){x.push(k.candidates[0].content);for(const V of(I=k.candidates[0].content.parts)!==null&&I!==void 0?I:[])if(c<r&&V.functionCall){if(!V.functionCall.name)throw new Error("Function call name was not returned by the model.");if(f.has(V.functionCall.name)){const U=yield Ut(f.get(V.functionCall.name).callTool([V.functionCall]));N.push(...U)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${f.keys()}, mising tool: ${V.functionCall.name}`)}}}}catch(k){T={error:k}}finally{try{!D&&!y&&(S=P.return)&&(yield Ut(S.call(P)))}finally{if(T)throw T.error}}if(N.length>0){a=!0;const k=new qu;k.candidates=[{content:{role:"user",parts:N}}],yield yield Ut(k);const V=[];V.push(...x),V.push({role:"user",parts:N});const U=Ui(m.contents).concat(V);m.contents=U}else break}})})(this,u,t)}async generateContentInternal(t){var e,n,s,r;let a,c="",u={};if(this.apiClient.isVertexAI()){const h=lC(this.apiClient,t);return c=gt("{model}:generateContent",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:f.headers},y})),a.then(f=>{const m=uC(f),y=new qu;return Object.assign(y,m),y})}else{const h=aC(this.apiClient,t);return c=gt("{model}:generateContent",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:f.headers},y})),a.then(f=>{const m=cC(f),y=new qu;return Object.assign(y,m),y})}}async generateContentStreamInternal(t){var e,n,s,r;let a,c="",u={};if(this.apiClient.isVertexAI()){const h=lC(this.apiClient,t);return c=gt("{model}:streamGenerateContent?alt=sse",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.requestStream({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}),a.then(function(m){return ns(this,arguments,function*(){var y,T,S,b;try{for(var C=!0,I=is(m),D;D=yield Ut(I.next()),y=D.done,!y;C=!0){b=D.value,C=!1;const P=b,H=uC(yield Ut(P.json()));H.sdkHttpResponse={headers:P.headers};const F=new qu;Object.assign(F,H),yield yield Ut(F)}}catch(P){T={error:P}}finally{try{!C&&!y&&(S=I.return)&&(yield Ut(S.call(I)))}finally{if(T)throw T.error}}})})}else{const h=aC(this.apiClient,t);return c=gt("{model}:streamGenerateContent?alt=sse",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.requestStream({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}),a.then(function(m){return ns(this,arguments,function*(){var y,T,S,b;try{for(var C=!0,I=is(m),D;D=yield Ut(I.next()),y=D.done,!y;C=!0){b=D.value,C=!1;const P=b,H=cC(yield Ut(P.json()));H.sdkHttpResponse={headers:P.headers};const F=new qu;Object.assign(F,H),yield yield Ut(F)}}catch(P){T={error:P}}finally{try{!C&&!y&&(S=I.return)&&(yield Ut(S.call(I)))}finally{if(T)throw T.error}}})})}}async embedContent(t){var e,n,s,r;let a,c="",u={};if(this.apiClient.isVertexAI()){const h=KH(this.apiClient,t);return c=gt("{model}:predict",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:f.headers},y})),a.then(f=>{const m=JH(f),y=new zb;return Object.assign(y,m),y})}else{const h=WH(this.apiClient,t);return c=gt("{model}:batchEmbedContents",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:f.headers},y})),a.then(f=>{const m=XH(f),y=new zb;return Object.assign(y,m),y})}}async generateImagesInternal(t){var e,n,s,r;let a,c="",u={};if(this.apiClient.isVertexAI()){const h=a6(this.apiClient,t);return c=gt("{model}:predict",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:f.headers},y})),a.then(f=>{const m=c6(f),y=new $b;return Object.assign(y,m),y})}else{const h=o6(this.apiClient,t);return c=gt("{model}:predict",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:f.headers},y})),a.then(f=>{const m=l6(f),y=new $b;return Object.assign(y,m),y})}}async editImageInternal(t){var e,n;let s,r="",a={};if(this.apiClient.isVertexAI()){const c=qH(this.apiClient,t);return r=gt("{model}:predict",c._url),a=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json().then(h=>{const f=h;return f.sdkHttpResponse={headers:u.headers},f})),s.then(u=>{const h=zH(u),f=new jF;return Object.assign(f,h),f})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(t){var e,n;let s,r="",a={};if(this.apiClient.isVertexAI()){const c=aG(this.apiClient,t);return r=gt("{model}:predict",c._url),a=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json().then(h=>{const f=h;return f.sdkHttpResponse={headers:u.headers},f})),s.then(u=>{const h=lG(u),f=new ZF;return Object.assign(f,h),f})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(t){var e,n;let s,r="",a={};if(this.apiClient.isVertexAI()){const c=G6(this.apiClient,t);return r=gt("{model}:predict",c._url),a=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),s.then(u=>{const h=q6(u),f=new t4;return Object.assign(f,h),f})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(t){var e,n;let s,r="",a={};if(this.apiClient.isVertexAI()){const c=X6(this.apiClient,t);return r=gt("{model}:predict",c._url),a=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),s.then(u=>{const h=J6(u),f=new e4;return Object.assign(f,h),f})}else throw new Error("This method is only supported by the Vertex AI.")}async get(t){var e,n,s,r;let a,c="",u={};if(this.apiClient.isVertexAI()){const h=C6(this.apiClient,t);return c=gt("{name}",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>k_(f))}else{const h=b6(this.apiClient,t);return c=gt("{name}",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a.then(f=>N_(f))}}async listInternal(t){var e,n,s,r;let a,c="",u={};if(this.apiClient.isVertexAI()){const h=L6(this.apiClient,t);return c=gt("{models_url}",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:f.headers},y})),a.then(f=>{const m=U6(f),y=new Yb;return Object.assign(y,m),y})}else{const h=k6(this.apiClient,t);return c=gt("{models_url}",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:f.headers},y})),a.then(f=>{const m=O6(f),y=new Yb;return Object.assign(y,m),y})}}async update(t){var e,n,s,r;let a,c="",u={};if(this.apiClient.isVertexAI()){const h=rG(this.apiClient,t);return c=gt("{model}",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>k_(f))}else{const h=sG(this.apiClient,t);return c=gt("{name}",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a.then(f=>N_(f))}}async delete(t){var e,n,s,r;let a,c="",u={};if(this.apiClient.isVertexAI()){const h=BH(this.apiClient,t);return c=gt("{name}",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:f.headers},y})),a.then(f=>{const m=HH(f),y=new Wb;return Object.assign(y,m),y})}else{const h=VH(this.apiClient,t);return c=gt("{name}",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:f.headers},y})),a.then(f=>{const m=FH(f),y=new Wb;return Object.assign(y,m),y})}}async countTokens(t){var e,n,s,r;let a,c="",u={};if(this.apiClient.isVertexAI()){const h=LH(this.apiClient,t);return c=gt("{model}:countTokens",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:f.headers},y})),a.then(f=>{const m=UH(f),y=new Kb;return Object.assign(y,m),y})}else{const h=kH(this.apiClient,t);return c=gt("{model}:countTokens",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:f.headers},y})),a.then(f=>{const m=OH(f),y=new Kb;return Object.assign(y,m),y})}}async computeTokens(t){var e,n;let s,r="",a={};if(this.apiClient.isVertexAI()){const c=IH(this.apiClient,t);return r=gt("{model}:computeTokens",c._url),a=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json().then(h=>{const f=h;return f.sdkHttpResponse={headers:u.headers},f})),s.then(u=>{const h=RH(u),f=new n4;return Object.assign(f,h),f})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(t){var e,n,s,r;let a,c="",u={};if(this.apiClient.isVertexAI()){const h=m6(this.apiClient,t);return c=gt("{model}:predictLongRunning",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>{const m=f6(f),y=new Cp;return Object.assign(y,m),y})}else{const h=p6(this.apiClient,t);return c=gt("{model}:predictLongRunning",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a.then(f=>{const m=d6(f),y=new Cp;return Object.assign(y,m),y})}}}class eq extends Cr{constructor(t){super(),this.apiClient=t}async getVideosOperation(t){const e=t.operation,n=t.config;if(e.name===void 0||e.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const s=e.name.split("/operations/")[0];let r;n&&"httpOptions"in n&&(r=n.httpOptions);const a=await this.fetchPredictVideosOperationInternal({operationName:e.name,resourceName:s,config:{httpOptions:r}});return e._fromAPIResponse({apiResponse:a,_isVertexAI:!0})}else{const s=await this.getVideosOperationInternal({operationName:e.name,config:n});return e._fromAPIResponse({apiResponse:s,_isVertexAI:!1})}}async get(t){const e=t.operation,n=t.config;if(e.name===void 0||e.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const s=e.name.split("/operations/")[0];let r;n&&"httpOptions"in n&&(r=n.httpOptions);const a=await this.fetchPredictVideosOperationInternal({operationName:e.name,resourceName:s,config:{httpOptions:r}});return e._fromAPIResponse({apiResponse:a,_isVertexAI:!0})}else{const s=await this.getVideosOperationInternal({operationName:e.name,config:n});return e._fromAPIResponse({apiResponse:s,_isVertexAI:!1})}}async getVideosOperationInternal(t){var e,n,s,r;let a,c="",u={};if(this.apiClient.isVertexAI()){const h=YF(t);return c=gt("{operationName}",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a}else{const h=$F(t);return c=gt("{operationName}",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a}}async fetchPredictVideosOperationInternal(t){var e,n;let s,r="",a={};if(this.apiClient.isVertexAI()){const c=VF(t);return r=gt("{resourceName}:fetchPredictOperation",c._url),a=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),s}else throw new Error("This method is only supported by the Vertex AI.")}}function nq(i){const t={},e=g(i,["data"]);if(e!=null&&_(t,["data"],e),g(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=g(i,["mimeType"]);return n!=null&&_(t,["mimeType"],n),t}function iq(i){const t={},e=g(i,["parts"]);if(e!=null){let s=e;Array.isArray(s)&&(s=s.map(r=>dq(r))),_(t,["parts"],s)}const n=g(i,["role"]);return n!=null&&_(t,["role"],n),t}function sq(i,t,e){const n={},s=g(t,["expireTime"]);e!==void 0&&s!=null&&_(e,["expireTime"],s);const r=g(t,["newSessionExpireTime"]);e!==void 0&&r!=null&&_(e,["newSessionExpireTime"],r);const a=g(t,["uses"]);e!==void 0&&a!=null&&_(e,["uses"],a);const c=g(t,["liveConnectConstraints"]);e!==void 0&&c!=null&&_(e,["bidiGenerateContentSetup"],hq(i,c));const u=g(t,["lockAdditionalFields"]);return e!==void 0&&u!=null&&_(e,["fieldMask"],u),n}function rq(i,t){const e={},n=g(t,["config"]);return n!=null&&_(e,["config"],sq(i,n,e)),e}function oq(i){const t={};if(g(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const e=g(i,["fileUri"]);e!=null&&_(t,["fileUri"],e);const n=g(i,["mimeType"]);return n!=null&&_(t,["mimeType"],n),t}function aq(i){const t={},e=g(i,["id"]);e!=null&&_(t,["id"],e);const n=g(i,["args"]);n!=null&&_(t,["args"],n);const s=g(i,["name"]);if(s!=null&&_(t,["name"],s),g(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(g(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function lq(i){const t={};if(g(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const e=g(i,["enableWidget"]);return e!=null&&_(t,["enableWidget"],e),t}function cq(i){const t={};if(g(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(g(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const e=g(i,["timeRangeFilter"]);return e!=null&&_(t,["timeRangeFilter"],e),t}function uq(i,t){const e={},n=g(i,["generationConfig"]);t!==void 0&&n!=null&&_(t,["setup","generationConfig"],n);const s=g(i,["responseModalities"]);t!==void 0&&s!=null&&_(t,["setup","generationConfig","responseModalities"],s);const r=g(i,["temperature"]);t!==void 0&&r!=null&&_(t,["setup","generationConfig","temperature"],r);const a=g(i,["topP"]);t!==void 0&&a!=null&&_(t,["setup","generationConfig","topP"],a);const c=g(i,["topK"]);t!==void 0&&c!=null&&_(t,["setup","generationConfig","topK"],c);const u=g(i,["maxOutputTokens"]);t!==void 0&&u!=null&&_(t,["setup","generationConfig","maxOutputTokens"],u);const h=g(i,["mediaResolution"]);t!==void 0&&h!=null&&_(t,["setup","generationConfig","mediaResolution"],h);const f=g(i,["seed"]);t!==void 0&&f!=null&&_(t,["setup","generationConfig","seed"],f);const m=g(i,["speechConfig"]);t!==void 0&&m!=null&&_(t,["setup","generationConfig","speechConfig"],cE(m));const y=g(i,["thinkingConfig"]);t!==void 0&&y!=null&&_(t,["setup","generationConfig","thinkingConfig"],y);const T=g(i,["enableAffectiveDialog"]);t!==void 0&&T!=null&&_(t,["setup","generationConfig","enableAffectiveDialog"],T);const S=g(i,["systemInstruction"]);t!==void 0&&S!=null&&_(t,["setup","systemInstruction"],iq(Bn(S)));const b=g(i,["tools"]);if(t!==void 0&&b!=null){let G=Dc(b);Array.isArray(G)&&(G=G.map(N=>pq(xc(N)))),_(t,["setup","tools"],G)}const C=g(i,["sessionResumption"]);t!==void 0&&C!=null&&_(t,["setup","sessionResumption"],fq(C));const I=g(i,["inputAudioTranscription"]);t!==void 0&&I!=null&&_(t,["setup","inputAudioTranscription"],I);const D=g(i,["outputAudioTranscription"]);t!==void 0&&D!=null&&_(t,["setup","outputAudioTranscription"],D);const P=g(i,["realtimeInputConfig"]);t!==void 0&&P!=null&&_(t,["setup","realtimeInputConfig"],P);const H=g(i,["contextWindowCompression"]);t!==void 0&&H!=null&&_(t,["setup","contextWindowCompression"],H);const F=g(i,["proactivity"]);if(t!==void 0&&F!=null&&_(t,["setup","proactivity"],F),g(i,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return e}function hq(i,t){const e={},n=g(t,["model"]);n!=null&&_(e,["setup","model"],oe(i,n));const s=g(t,["config"]);return s!=null&&_(e,["config"],uq(s,e)),e}function dq(i){const t={},e=g(i,["mediaResolution"]);e!=null&&_(t,["mediaResolution"],e);const n=g(i,["codeExecutionResult"]);n!=null&&_(t,["codeExecutionResult"],n);const s=g(i,["executableCode"]);s!=null&&_(t,["executableCode"],s);const r=g(i,["fileData"]);r!=null&&_(t,["fileData"],oq(r));const a=g(i,["functionCall"]);a!=null&&_(t,["functionCall"],aq(a));const c=g(i,["functionResponse"]);c!=null&&_(t,["functionResponse"],c);const u=g(i,["inlineData"]);u!=null&&_(t,["inlineData"],nq(u));const h=g(i,["text"]);h!=null&&_(t,["text"],h);const f=g(i,["thought"]);f!=null&&_(t,["thought"],f);const m=g(i,["thoughtSignature"]);m!=null&&_(t,["thoughtSignature"],m);const y=g(i,["videoMetadata"]);return y!=null&&_(t,["videoMetadata"],y),t}function fq(i){const t={},e=g(i,["handle"]);if(e!=null&&_(t,["handle"],e),g(i,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return t}function pq(i){const t={},e=g(i,["functionDeclarations"]);if(e!=null){let f=e;Array.isArray(f)&&(f=f.map(m=>m)),_(t,["functionDeclarations"],f)}if(g(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=g(i,["googleSearchRetrieval"]);n!=null&&_(t,["googleSearchRetrieval"],n);const s=g(i,["computerUse"]);s!=null&&_(t,["computerUse"],s);const r=g(i,["fileSearch"]);r!=null&&_(t,["fileSearch"],r);const a=g(i,["codeExecution"]);if(a!=null&&_(t,["codeExecution"],a),g(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const c=g(i,["googleMaps"]);c!=null&&_(t,["googleMaps"],lq(c));const u=g(i,["googleSearch"]);u!=null&&_(t,["googleSearch"],cq(u));const h=g(i,["urlContext"]);return h!=null&&_(t,["urlContext"],h),t}function mq(i){const t=[];for(const e in i)if(Object.prototype.hasOwnProperty.call(i,e)){const n=i[e];if(typeof n=="object"&&n!=null&&Object.keys(n).length>0){const s=Object.keys(n).map(r=>`${e}.${r}`);t.push(...s)}else t.push(e)}return t.join(",")}function gq(i,t){let e=null;const n=i.bidiGenerateContentSetup;if(typeof n=="object"&&n!==null&&"setup"in n){const r=n.setup;typeof r=="object"&&r!==null?(i.bidiGenerateContentSetup=r,e=r):delete i.bidiGenerateContentSetup}else n!==void 0&&delete i.bidiGenerateContentSetup;const s=i.fieldMask;if(e){const r=mq(e);if(Array.isArray(t?.lockAdditionalFields)&&t?.lockAdditionalFields.length===0)r?i.fieldMask=r:delete i.fieldMask;else if(t?.lockAdditionalFields&&t.lockAdditionalFields.length>0&&s!==null&&Array.isArray(s)&&s.length>0){const a=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let c=[];s.length>0&&(c=s.map(h=>a.includes(h)?`generationConfig.${h}`:h));const u=[];r&&u.push(r),c.length>0&&u.push(...c),u.length>0?i.fieldMask=u.join(","):delete i.fieldMask}else delete i.fieldMask}else s!==null&&Array.isArray(s)&&s.length>0?i.fieldMask=s.join(","):delete i.fieldMask;return i}class yq extends Cr{constructor(t){super(),this.apiClient=t}async create(t){var e,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const c=rq(this.apiClient,t);r=gt("auth_tokens",c._url),a=c._query,delete c.config,delete c._url,delete c._query;const u=gq(c,t.config);return s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),s.then(h=>h)}}}function _q(i,t){const e={},n=g(i,["force"]);return t!==void 0&&n!=null&&_(t,["_query","force"],n),e}function vq(i){const t={},e=g(i,["name"]);e!=null&&_(t,["_url","name"],e);const n=g(i,["config"]);return n!=null&&_q(n,t),t}function Eq(i){const t={},e=g(i,["name"]);return e!=null&&_(t,["_url","name"],e),t}function Tq(i,t){const e={},n=g(i,["pageSize"]);t!==void 0&&n!=null&&_(t,["_query","pageSize"],n);const s=g(i,["pageToken"]);return t!==void 0&&s!=null&&_(t,["_query","pageToken"],s),e}function Aq(i){const t={},e=g(i,["parent"]);e!=null&&_(t,["_url","parent"],e);const n=g(i,["config"]);return n!=null&&Tq(n,t),t}function Sq(i){const t={},e=g(i,["sdkHttpResponse"]);e!=null&&_(t,["sdkHttpResponse"],e);const n=g(i,["nextPageToken"]);n!=null&&_(t,["nextPageToken"],n);const s=g(i,["documents"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>a)),_(t,["documents"],r)}return t}class wq extends Cr{constructor(t){super(),this.apiClient=t,this.list=async e=>new $a(br.PAGED_ITEM_DOCUMENTS,n=>this.listInternal({parent:e.parent,config:n.config}),await this.listInternal(e),e)}async get(t){var e,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=Eq(t);return r=gt("{name}",c._url),a=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),s.then(u=>u)}}async delete(t){var e,n;let s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=vq(t);s=gt("{name}",a._url),r=a._query,delete a._url,delete a._query,await this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(t){var e,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=Aq(t);return r=gt("{parent}/documents",c._url),a=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),s.then(u=>{const h=Sq(u),f=new i4;return Object.assign(f,h),f})}}}class bq extends Cr{constructor(t,e=new wq(t)){super(),this.apiClient=t,this.documents=e,this.list=async(n={})=>new $a(br.PAGED_ITEM_FILE_SEARCH_STORES,s=>this.listInternal(s),await this.listInternal(n),n)}async uploadToFileSearchStore(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(t.fileSearchStoreName,t.file,t.config)}async create(t){var e,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=mG(t);return r=gt("fileSearchStores",c._url),a=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),s.then(u=>u)}}async get(t){var e,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=_G(t);return r=gt("{name}",c._url),a=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),s.then(u=>u)}}async delete(t){var e,n;let s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=yG(t);s=gt("{name}",a._url),r=a._query,delete a._url,delete a._query,await this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(t){var e,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=wG(t);return r=gt("fileSearchStores",c._url),a=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),s.then(u=>{const h=bG(u),f=new s4;return Object.assign(f,h),f})}}async uploadToFileSearchStoreInternal(t){var e,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=CG(t);return r=gt("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",c._url),a=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),s.then(u=>{const h=IG(u),f=new r4;return Object.assign(f,h),f})}}async importFile(t){var e,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=TG(t);return r=gt("{file_search_store_name}:importFile",c._url),a=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),s.then(u=>{const h=EG(u),f=new sE;return Object.assign(f,h),f})}}}let _M=function(){const{crypto:i}=globalThis;if(i?.randomUUID)return _M=i.randomUUID.bind(i),i.randomUUID();const t=new Uint8Array(1),e=i?()=>i.getRandomValues(t)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^e()&15>>+n/4).toString(16))};const Cq=()=>_M();function O_(i){return typeof i=="object"&&i!==null&&("name"in i&&i.name==="AbortError"||"message"in i&&String(i.message).includes("FetchRequestCanceledException"))}const U_=i=>{if(i instanceof Error)return i;if(typeof i=="object"&&i!==null){try{if(Object.prototype.toString.call(i)==="[object Error]"){const t=new Error(i.message,i.cause?{cause:i.cause}:{});return i.stack&&(t.stack=i.stack),i.cause&&!t.cause&&(t.cause=i.cause),i.name&&(t.name=i.name),t}}catch{}try{return new Error(JSON.stringify(i))}catch{}}return new Error(i)};class Bi extends Error{}class Qn extends Bi{constructor(t,e,n,s){super(`${Qn.makeMessage(t,e,n)}`),this.status=t,this.headers=s,this.error=e}static makeMessage(t,e,n){const s=e?.message?typeof e.message=="string"?e.message:JSON.stringify(e.message):e?JSON.stringify(e):n;return t&&s?`${t} ${s}`:t?`${t} status code (no body)`:s||"(no status code or body)"}static generate(t,e,n,s){if(!t||!s)return new cm({message:n,cause:U_(e)});const r=e;return t===400?new EM(t,r,n,s):t===401?new TM(t,r,n,s):t===403?new AM(t,r,n,s):t===404?new SM(t,r,n,s):t===409?new wM(t,r,n,s):t===422?new bM(t,r,n,s):t===429?new CM(t,r,n,s):t>=500?new IM(t,r,n,s):new Qn(t,r,n,s)}}class V_ extends Qn{constructor({message:t}={}){super(void 0,void 0,t||"Request was aborted.",void 0)}}class cm extends Qn{constructor({message:t,cause:e}){super(void 0,void 0,t||"Connection error.",void 0),e&&(this.cause=e)}}class vM extends cm{constructor({message:t}={}){super({message:t??"Request timed out."})}}class EM extends Qn{}class TM extends Qn{}class AM extends Qn{}class SM extends Qn{}class wM extends Qn{}class bM extends Qn{}class CM extends Qn{}class IM extends Qn{}const Iq=/^[a-z][a-z0-9+.-]*:/i,Rq=i=>Iq.test(i);let B_=i=>(B_=Array.isArray,B_(i));const Mq=B_;let Pq=Mq;const gC=Pq;function xq(i){if(!i)return!0;for(const t in i)return!1;return!0}function Dq(i,t){return Object.prototype.hasOwnProperty.call(i,t)}const Nq=(i,t)=>{if(typeof t!="number"||!Number.isInteger(t))throw new Bi(`${i} must be an integer`);if(t<0)throw new Bi(`${i} must be a positive integer`);return t},kq=i=>{try{return JSON.parse(i)}catch{return}};const Lq=i=>new Promise(t=>setTimeout(t,i));const ql="0.0.1";function Oq(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const Uq=()=>{var i,t,e,n,s;const r=Oq();if(r==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ql,"X-Stainless-OS":_C(Deno.build.os),"X-Stainless-Arch":yC(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(t=(i=Deno.version)===null||i===void 0?void 0:i.deno)!==null&&t!==void 0?t:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ql,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(r==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ql,"X-Stainless-OS":_C((e=globalThis.process.platform)!==null&&e!==void 0?e:"unknown"),"X-Stainless-Arch":yC((n=globalThis.process.arch)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(s=globalThis.process.version)!==null&&s!==void 0?s:"unknown"};const a=Vq();return a?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ql,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${a.browser}`,"X-Stainless-Runtime-Version":a.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ql,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Vq(){if(typeof navigator>"u"||!navigator)return null;const i=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:e}of i){const n=e.exec(navigator.userAgent);if(n){const s=n[1]||0,r=n[2]||0,a=n[3]||0;return{browser:t,version:`${s}.${r}.${a}`}}}return null}const yC=i=>i==="x32"?"x32":i==="x86_64"||i==="x64"?"x64":i==="arm"?"arm":i==="aarch64"||i==="arm64"?"arm64":i?`other:${i}`:"unknown",_C=i=>(i=i.toLowerCase(),i.includes("ios")?"iOS":i==="android"?"Android":i==="darwin"?"MacOS":i==="win32"?"Windows":i==="freebsd"?"FreeBSD":i==="openbsd"?"OpenBSD":i==="linux"?"Linux":i?`Other:${i}`:"Unknown");let Af;const Bq=()=>Af??(Af=Uq());function Fq(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function RM(...i){const t=globalThis.ReadableStream;if(typeof t>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...i)}function Hq(i){let t=Symbol.asyncIterator in i?i[Symbol.asyncIterator]():i[Symbol.iterator]();return RM({start(){},async pull(e){const{done:n,value:s}=await t.next();n?e.close():e.enqueue(s)},async cancel(){var e;await((e=t.return)===null||e===void 0?void 0:e.call(t))}})}function MM(i){if(i[Symbol.asyncIterator])return i;const t=i.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function Gq(i){var t,e;if(i===null||typeof i!="object")return;if(i[Symbol.asyncIterator]){await((e=(t=i[Symbol.asyncIterator]()).return)===null||e===void 0?void 0:e.call(t));return}const n=i.getReader(),s=n.cancel();n.releaseLock(),await s}const qq=({headers:i,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)});const PM=()=>{var i;if(typeof File>"u"){const{process:t}=globalThis,e=typeof((i=t?.versions)===null||i===void 0?void 0:i.node)=="string"&&parseInt(t.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(e?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Gy(i,t,e){return PM(),new File(i,t??"unknown_file",e)}function zq(i){return(typeof i=="object"&&i!==null&&("name"in i&&i.name&&String(i.name)||"url"in i&&i.url&&String(i.url)||"filename"in i&&i.filename&&String(i.filename)||"path"in i&&i.path&&String(i.path))||"").split(/[\\/]/).pop()||void 0}const $q=i=>i!=null&&typeof i=="object"&&typeof i[Symbol.asyncIterator]=="function";const xM=i=>i!=null&&typeof i=="object"&&typeof i.size=="number"&&typeof i.type=="string"&&typeof i.text=="function"&&typeof i.slice=="function"&&typeof i.arrayBuffer=="function",Yq=i=>i!=null&&typeof i=="object"&&typeof i.name=="string"&&typeof i.lastModified=="number"&&xM(i),Wq=i=>i!=null&&typeof i=="object"&&typeof i.url=="string"&&typeof i.blob=="function";async function Kq(i,t,e){if(PM(),i=await i,Yq(i))return i instanceof File?i:Gy([await i.arrayBuffer()],i.name);if(Wq(i)){const s=await i.blob();return t||(t=new URL(i.url).pathname.split(/[\\/]/).pop()),Gy(await F_(s),t,e)}const n=await F_(i);if(t||(t=zq(i)),!e?.type){const s=n.find(r=>typeof r=="object"&&"type"in r&&r.type);typeof s=="string"&&(e=Object.assign(Object.assign({},e),{type:s}))}return Gy(n,t,e)}async function F_(i){var t,e,n,s,r;let a=[];if(typeof i=="string"||ArrayBuffer.isView(i)||i instanceof ArrayBuffer)a.push(i);else if(xM(i))a.push(i instanceof Blob?i:await i.arrayBuffer());else if($q(i))try{for(var c=!0,u=is(i),h;h=await u.next(),t=h.done,!t;c=!0){s=h.value,c=!1;const f=s;a.push(...await F_(f))}}catch(f){e={error:f}}finally{try{!c&&!t&&(n=u.return)&&await n.call(u)}finally{if(e)throw e.error}}else{const f=(r=i?.constructor)===null||r===void 0?void 0:r.name;throw new Error(`Unexpected data type: ${typeof i}${f?`; constructor: ${f}`:""}${Xq(i)}`)}return a}function Xq(i){return typeof i!="object"||i===null?"":`; props: [${Object.getOwnPropertyNames(i).map(e=>`"${e}"`).join(", ")}]`}class DM{constructor(t){this._client=t}}DM._key=[];function NM(i){return i.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const vC=Object.freeze(Object.create(null)),Jq=(i=NM)=>(function(e,...n){if(e.length===1)return e[0];let s=!1;const r=[],a=e.reduce((f,m,y)=>{var T,S,b;/[?#]/.test(m)&&(s=!0);const C=n[y];let I=(s?encodeURIComponent:i)(""+C);return y!==n.length&&(C==null||typeof C=="object"&&C.toString===((b=Object.getPrototypeOf((S=Object.getPrototypeOf((T=C.hasOwnProperty)!==null&&T!==void 0?T:vC))!==null&&S!==void 0?S:vC))===null||b===void 0?void 0:b.toString))&&(I=C+"",r.push({start:f.length+m.length,length:I.length,error:`Value of type ${Object.prototype.toString.call(C).slice(8,-1)} is not a valid path parameter`})),f+m+(y===n.length?"":I)},""),c=a.split(/[?#]/,1)[0],u=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let h;for(;(h=u.exec(c))!==null;)r.push({start:h.index,length:h[0].length,error:`Value "${h[0]}" can't be safely passed as a path parameter`});if(r.sort((f,m)=>f.start-m.start),r.length>0){let f=0;const m=r.reduce((y,T)=>{const S=" ".repeat(T.start-f),b="^".repeat(T.length);return f=T.start+T.length,y+S+b},"");throw new Bi(`Path parameters result in path with invalid segments:
${r.map(y=>y.error).join(`
`)}
${a}
${m}`)}return a}),Sf=Jq(NM);class kM extends DM{create(t,e){var n;const{api_version:s=this._client.apiVersion}=t,r=Rp(t,["api_version"]);if("model"in r&&"agent_config"in r)throw new Bi("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in r&&"generation_config"in r)throw new Bi("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(Sf`/${s}/interactions`,Object.assign(Object.assign({body:r},e),{stream:(n=t.stream)!==null&&n!==void 0?n:!1}))}delete(t,e={},n){const{api_version:s=this._client.apiVersion}=e??{};return this._client.delete(Sf`/${s}/interactions/${t}`,n)}cancel(t,e={},n){const{api_version:s=this._client.apiVersion}=e??{};return this._client.post(Sf`/${s}/interactions/${t}/cancel`,n)}get(t,e={},n){var s;const r=e??{},{api_version:a=this._client.apiVersion}=r,c=Rp(r,["api_version"]);return this._client.get(Sf`/${a}/interactions/${t}`,Object.assign(Object.assign({query:c},n),{stream:(s=e?.stream)!==null&&s!==void 0?s:!1}))}}kM._key=Object.freeze(["interactions"]);class LM extends kM{}function Qq(i){let t=0;for(const s of i)t+=s.length;const e=new Uint8Array(t);let n=0;for(const s of i)e.set(s,n),n+=s.length;return e}let wf;function hE(i){let t;return(wf??(t=new globalThis.TextEncoder,wf=t.encode.bind(t)))(i)}let bf;function EC(i){let t;return(bf??(t=new globalThis.TextDecoder,bf=t.decode.bind(t)))(i)}class um{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(t){if(t==null)return[];const e=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?hE(t):t;this.buffer=Qq([this.buffer,e]);const n=[];let s;for(;(s=jq(this.buffer,this.carriageReturnIndex))!=null;){if(s.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=s.index;continue}if(this.carriageReturnIndex!=null&&(s.index!==this.carriageReturnIndex+1||s.carriage)){n.push(EC(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}const r=this.carriageReturnIndex!==null?s.preceding-1:s.preceding,a=EC(this.buffer.subarray(0,r));n.push(a),this.buffer=this.buffer.subarray(s.index),this.carriageReturnIndex=null}return n}flush(){return this.buffer.length?this.decode(`
`):[]}}um.NEWLINE_CHARS=new Set([`
`,"\r"]);um.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function jq(i,t){for(let s=t??0;s<i.length;s++){if(i[s]===10)return{preceding:s,index:s+1,carriage:!1};if(i[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function Zq(i){for(let n=0;n<i.length-1;n++){if(i[n]===10&&i[n+1]===10||i[n]===13&&i[n+1]===13)return n+2;if(i[n]===13&&i[n+1]===10&&n+3<i.length&&i[n+2]===13&&i[n+3]===10)return n+4}return-1}const Mp={off:0,error:200,warn:300,info:400,debug:500},TC=(i,t,e)=>{if(i){if(Dq(Mp,i))return i;Yn(e).warn(`${t} was set to ${JSON.stringify(i)}, expected one of ${JSON.stringify(Object.keys(Mp))}`)}};function nh(){}function Cf(i,t,e){return!t||Mp[i]>Mp[e]?nh:t[i].bind(t)}const tz={error:nh,warn:nh,info:nh,debug:nh};let AC=new WeakMap;function Yn(i){var t;const e=i.logger,n=(t=i.logLevel)!==null&&t!==void 0?t:"off";if(!e)return tz;const s=AC.get(e);if(s&&s[0]===n)return s[1];const r={error:Cf("error",e,n),warn:Cf("warn",e,n),info:Cf("info",e,n),debug:Cf("debug",e,n)};return AC.set(e,[n,r]),r}const Sa=i=>(i.options&&(i.options=Object.assign({},i.options),delete i.options.headers),i.headers&&(i.headers=Object.fromEntries((i.headers instanceof Headers?[...i.headers]:Object.entries(i.headers)).map(([t,e])=>[t,t.toLowerCase()==="x-goog-api-key"||t.toLowerCase()==="authorization"||t.toLowerCase()==="cookie"||t.toLowerCase()==="set-cookie"?"***":e]))),"retryOfRequestLogID"in i&&(i.retryOfRequestLogID&&(i.retryOf=i.retryOfRequestLogID),delete i.retryOfRequestLogID),i);class Xl{constructor(t,e,n){this.iterator=t,this.controller=e,this.client=n}static fromSSEResponse(t,e,n){let s=!1;const r=n?Yn(n):console;function a(){return ns(this,arguments,function*(){var u,h,f,m;if(s)throw new Bi("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let y=!1;try{try{for(var T=!0,S=is(ez(t,e)),b;b=yield Ut(S.next()),u=b.done,!u;T=!0){m=b.value,T=!1;const C=m;if(!y)if(C.data.startsWith("[DONE]")){y=!0;continue}else try{yield yield Ut(JSON.parse(C.data))}catch(I){throw r.error("Could not parse message into JSON:",C.data),r.error("From chunk:",C.raw),I}}}catch(C){h={error:C}}finally{try{!T&&!u&&(f=S.return)&&(yield Ut(f.call(S)))}finally{if(h)throw h.error}}y=!0}catch(C){if(O_(C))return yield Ut(void 0);throw C}finally{y||e.abort()}})}return new Xl(a,e,n)}static fromReadableStream(t,e,n){let s=!1;function r(){return ns(this,arguments,function*(){var u,h,f,m;const y=new um,T=MM(t);try{for(var S=!0,b=is(T),C;C=yield Ut(b.next()),u=C.done,!u;S=!0){m=C.value,S=!1;const I=m;for(const D of y.decode(I))yield yield Ut(D)}}catch(I){h={error:I}}finally{try{!S&&!u&&(f=b.return)&&(yield Ut(f.call(b)))}finally{if(h)throw h.error}}for(const I of y.flush())yield yield Ut(I)})}function a(){return ns(this,arguments,function*(){var u,h,f,m;if(s)throw new Bi("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let y=!1;try{try{for(var T=!0,S=is(r()),b;b=yield Ut(S.next()),u=b.done,!u;T=!0){m=b.value,T=!1;const C=m;y||C&&(yield yield Ut(JSON.parse(C)))}}catch(C){h={error:C}}finally{try{!T&&!u&&(f=S.return)&&(yield Ut(f.call(S)))}finally{if(h)throw h.error}}y=!0}catch(C){if(O_(C))return yield Ut(void 0);throw C}finally{y||e.abort()}})}return new Xl(a,e,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){const t=[],e=[],n=this.iterator(),s=r=>({next:()=>{if(r.length===0){const a=n.next();t.push(a),e.push(a)}return r.shift()}});return[new Xl(()=>s(t),this.controller,this.client),new Xl(()=>s(e),this.controller,this.client)]}toReadableStream(){const t=this;let e;return RM({async start(){e=t[Symbol.asyncIterator]()},async pull(n){try{const{value:s,done:r}=await e.next();if(r)return n.close();const a=hE(JSON.stringify(s)+`
`);n.enqueue(a)}catch(s){n.error(s)}},async cancel(){var n;await((n=e.return)===null||n===void 0?void 0:n.call(e))}})}}function ez(i,t){return ns(this,arguments,function*(){var n,s,r,a;if(!i.body)throw t.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new Bi("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new Bi("Attempted to iterate over a response with no body");const c=new iz,u=new um,h=MM(i.body);try{for(var f=!0,m=is(nz(h)),y;y=yield Ut(m.next()),n=y.done,!n;f=!0){a=y.value,f=!1;const T=a;for(const S of u.decode(T)){const b=c.decode(S);b&&(yield yield Ut(b))}}}catch(T){s={error:T}}finally{try{!f&&!n&&(r=m.return)&&(yield Ut(r.call(m)))}finally{if(s)throw s.error}}for(const T of u.flush()){const S=c.decode(T);S&&(yield yield Ut(S))}})}function nz(i){return ns(this,arguments,function*(){var e,n,s,r;let a=new Uint8Array;try{for(var c=!0,u=is(i),h;h=yield Ut(u.next()),e=h.done,!e;c=!0){r=h.value,c=!1;const f=r;if(f==null)continue;const m=f instanceof ArrayBuffer?new Uint8Array(f):typeof f=="string"?hE(f):f;let y=new Uint8Array(a.length+m.length);y.set(a),y.set(m,a.length),a=y;let T;for(;(T=Zq(a))!==-1;)yield yield Ut(a.slice(0,T)),a=a.slice(T)}}catch(f){n={error:f}}finally{try{!c&&!e&&(s=u.return)&&(yield Ut(s.call(u)))}finally{if(n)throw n.error}}a.length>0&&(yield yield Ut(a))})}class iz{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(t){if(t.endsWith("\r")&&(t=t.substring(0,t.length-1)),!t){if(!this.event&&!this.data.length)return null;const r={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],r}if(this.chunks.push(t),t.startsWith(":"))return null;let[e,n,s]=sz(t,":");return s.startsWith(" ")&&(s=s.substring(1)),e==="event"?this.event=s:e==="data"&&this.data.push(s),null}}function sz(i,t){const e=i.indexOf(t);return e!==-1?[i.substring(0,e),t,i.substring(e+t.length)]:[i,"",""]}async function rz(i,t){const{response:e,requestLogID:n,retryOfRequestLogID:s,startTime:r}=t,a=await(async()=>{var c;if(t.options.stream)return Yn(i).debug("response",e.status,e.url,e.headers,e.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(e,t.controller,i):Xl.fromSSEResponse(e,t.controller,i);if(e.status===204)return null;if(t.options.__binaryResponse)return e;const u=e.headers.get("content-type"),h=(c=u?.split(";")[0])===null||c===void 0?void 0:c.trim();return h?.includes("application/json")||h?.endsWith("+json")?await e.json():await e.text()})();return Yn(i).debug(`[${n}] response parsed`,Sa({retryOfRequestLogID:s,url:e.url,status:e.status,body:a,durationMs:Date.now()-r})),a}class dE extends Promise{constructor(t,e,n=rz){super(s=>{s(null)}),this.responsePromise=e,this.parseResponse=n,this.client=t}_thenUnwrap(t){return new dE(this.client,this.responsePromise,async(e,n)=>t(await this.parseResponse(e,n),n))}asResponse(){return this.responsePromise.then(t=>t.response)}async withResponse(){const[t,e]=await Promise.all([this.parse(),this.asResponse()]);return{data:t,response:e}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(t=>this.parseResponse(this.client,t))),this.parsedPromise}then(t,e){return this.parse().then(t,e)}catch(t){return this.parse().catch(t)}finally(t){return this.parse().finally(t)}}const OM=Symbol("brand.privateNullableHeaders");function*oz(i){if(!i)return;if(OM in i){const{values:n,nulls:s}=i;yield*n.entries();for(const r of s)yield[r,null];return}let t=!1,e;i instanceof Headers?e=i.entries():gC(i)?e=i:(t=!0,e=Object.entries(i??{}));for(let n of e){const s=n[0];if(typeof s!="string")throw new TypeError("expected header name to be a string");const r=gC(n[1])?n[1]:[n[1]];let a=!1;for(const c of r)c!==void 0&&(t&&!a&&(a=!0,yield[s,null]),yield[s,c])}}const zu=i=>{const t=new Headers,e=new Set;for(const n of i){const s=new Set;for(const[r,a]of oz(n)){const c=r.toLowerCase();s.has(c)||(t.delete(r),s.add(c)),a===null?(t.delete(r),e.add(c)):(t.append(r,a),e.delete(c))}}return{[OM]:!0,values:t,nulls:e}};const qy=i=>{var t,e,n,s,r,a;if(typeof globalThis.process<"u")return(n=(e=(t=DF)===null||t===void 0?void 0:t[i])===null||e===void 0?void 0:e.trim())!==null&&n!==void 0?n:void 0;if(typeof globalThis.Deno<"u")return(a=(r=(s=globalThis.Deno.env)===null||s===void 0?void 0:s.get)===null||r===void 0?void 0:r.call(s,i))===null||a===void 0?void 0:a.trim()};var UM;class hm{constructor(t){var e,n,s,r,a,c,u,{baseURL:h=qy("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:f=(e=qy("GEMINI_API_KEY"))!==null&&e!==void 0?e:null,apiVersion:m="v1beta"}=t,y=Rp(t,["baseURL","apiKey","apiVersion"]);const T=Object.assign(Object.assign({apiKey:f,apiVersion:m},y),{baseURL:h||"https://generativelanguage.googleapis.com"});this.baseURL=T.baseURL,this.timeout=(n=T.timeout)!==null&&n!==void 0?n:hm.DEFAULT_TIMEOUT,this.logger=(s=T.logger)!==null&&s!==void 0?s:console;const S="warn";this.logLevel=S,this.logLevel=(a=(r=TC(T.logLevel,"ClientOptions.logLevel",this))!==null&&r!==void 0?r:TC(qy("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&a!==void 0?a:S,this.fetchOptions=T.fetchOptions,this.maxRetries=(c=T.maxRetries)!==null&&c!==void 0?c:2,this.fetch=(u=T.fetch)!==null&&u!==void 0?u:Fq(),this.encoder=qq,this._options=T,this.apiKey=f,this.apiVersion=m,this.clientAdapter=T.clientAdapter}withOptions(t){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),t))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:t,nulls:e}){if(!(t.has("authorization")||t.has("x-goog-api-key"))&&!(this.apiKey&&t.get("x-goog-api-key"))&&!e.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(t){const e=zu([t.headers]);if(!(e.values.has("authorization")||e.values.has("x-goog-api-key"))){if(this.apiKey)return zu([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return zu([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(t){return Object.entries(t).filter(([e,n])=>typeof n<"u").map(([e,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(e)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(e)}=`;throw new Bi(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${ql}`}defaultIdempotencyKey(){return`stainless-node-retry-${Cq()}`}makeStatusError(t,e,n,s){return Qn.generate(t,e,n,s)}buildURL(t,e,n){const s=!this.baseURLOverridden()&&n||this.baseURL,r=Rq(t)?new URL(t):new URL(s+(s.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),a=this.defaultQuery();return xq(a)||(e=Object.assign(Object.assign({},a),e)),typeof e=="object"&&e&&!Array.isArray(e)&&(r.search=this.stringifyQuery(e)),r.toString()}async prepareOptions(t){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!t.path.startsWith(`/${this.apiVersion}/projects/`)){const e=t.path.slice(this.apiVersion.length+1);t.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${e}`}}async prepareRequest(t,{url:e,options:n}){}get(t,e){return this.methodRequest("get",t,e)}post(t,e){return this.methodRequest("post",t,e)}patch(t,e){return this.methodRequest("patch",t,e)}put(t,e){return this.methodRequest("put",t,e)}delete(t,e){return this.methodRequest("delete",t,e)}methodRequest(t,e,n){return this.request(Promise.resolve(n).then(s=>Object.assign({method:t,path:e},s)))}request(t,e=null){return new dE(this,this.makeRequest(t,e,void 0))}async makeRequest(t,e,n){var s,r,a;const c=await t,u=(s=c.maxRetries)!==null&&s!==void 0?s:this.maxRetries;e==null&&(e=u),await this.prepareOptions(c);const{req:h,url:f,timeout:m}=await this.buildRequest(c,{retryCount:u-e});await this.prepareRequest(h,{url:f,options:c});const y="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),T=n===void 0?"":`, retryOf: ${n}`,S=Date.now();if(Yn(this).debug(`[${y}] sending request`,Sa({retryOfRequestLogID:n,method:c.method,url:f,options:c,headers:h.headers})),!((r=c.signal)===null||r===void 0)&&r.aborted)throw new V_;const b=new AbortController,C=await this.fetchWithTimeout(f,h,m,b).catch(U_),I=Date.now();if(C instanceof globalThis.Error){const P=`retrying, ${e} attempts remaining`;if(!((a=c.signal)===null||a===void 0)&&a.aborted)throw new V_;const H=O_(C)||/timed? ?out/i.test(String(C)+("cause"in C?String(C.cause):""));if(e)return Yn(this).info(`[${y}] connection ${H?"timed out":"failed"} - ${P}`),Yn(this).debug(`[${y}] connection ${H?"timed out":"failed"} (${P})`,Sa({retryOfRequestLogID:n,url:f,durationMs:I-S,message:C.message})),this.retryRequest(c,e,n??y);throw Yn(this).info(`[${y}] connection ${H?"timed out":"failed"} - error; no more retries left`),Yn(this).debug(`[${y}] connection ${H?"timed out":"failed"} (error; no more retries left)`,Sa({retryOfRequestLogID:n,url:f,durationMs:I-S,message:C.message})),H?new vM:new cm({cause:C})}const D=`[${y}${T}] ${h.method} ${f} ${C.ok?"succeeded":"failed"} with status ${C.status} in ${I-S}ms`;if(!C.ok){const P=await this.shouldRetry(C);if(e&&P){const k=`retrying, ${e} attempts remaining`;return await Gq(C.body),Yn(this).info(`${D} - ${k}`),Yn(this).debug(`[${y}] response error (${k})`,Sa({retryOfRequestLogID:n,url:C.url,status:C.status,headers:C.headers,durationMs:I-S})),this.retryRequest(c,e,n??y,C.headers)}const H=P?"error; no more retries left":"error; not retryable";Yn(this).info(`${D} - ${H}`);const F=await C.text().catch(k=>U_(k).message),G=kq(F),N=G?void 0:F;throw Yn(this).debug(`[${y}] response error (${H})`,Sa({retryOfRequestLogID:n,url:C.url,status:C.status,headers:C.headers,message:N,durationMs:Date.now()-S})),this.makeStatusError(C.status,G,N,C.headers)}return Yn(this).info(D),Yn(this).debug(`[${y}] response start`,Sa({retryOfRequestLogID:n,url:C.url,status:C.status,headers:C.headers,durationMs:I-S})),{response:C,options:c,controller:b,requestLogID:y,retryOfRequestLogID:n,startTime:S}}async fetchWithTimeout(t,e,n,s){const r=e||{},{signal:a,method:c}=r,u=Rp(r,["signal","method"]);a&&a.addEventListener("abort",()=>s.abort());const h=setTimeout(()=>s.abort(),n),f=globalThis.ReadableStream&&u.body instanceof globalThis.ReadableStream||typeof u.body=="object"&&u.body!==null&&Symbol.asyncIterator in u.body,m=Object.assign(Object.assign(Object.assign({signal:s.signal},f?{duplex:"half"}:{}),{method:"GET"}),u);c&&(m.method=c.toUpperCase());try{return await this.fetch.call(void 0,t,m)}finally{clearTimeout(h)}}async shouldRetry(t){const e=t.headers.get("x-should-retry");return e==="true"?!0:e==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,e,n,s){var r;let a;const c=s?.get("retry-after-ms");if(c){const h=parseFloat(c);Number.isNaN(h)||(a=h)}const u=s?.get("retry-after");if(u&&!a){const h=parseFloat(u);Number.isNaN(h)?a=Date.parse(u)-Date.now():a=h*1e3}if(!(a&&0<=a&&a<60*1e3)){const h=(r=t.maxRetries)!==null&&r!==void 0?r:this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(e,h)}return await Lq(a),this.makeRequest(t,e-1,n)}calculateDefaultRetryTimeoutMillis(t,e){const r=e-t,a=Math.min(.5*Math.pow(2,r),8),c=1-Math.random()*.25;return a*c*1e3}async buildRequest(t,{retryCount:e=0}={}){var n,s,r;const a=Object.assign({},t),{method:c,path:u,query:h,defaultBaseURL:f}=a,m=this.buildURL(u,h,f);"timeout"in a&&Nq("timeout",a.timeout),a.timeout=(n=a.timeout)!==null&&n!==void 0?n:this.timeout;const{bodyHeaders:y,body:T}=this.buildBody({options:a}),S=await this.buildHeaders({options:t,method:c,bodyHeaders:y,retryCount:e});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:c,headers:S},a.signal&&{signal:a.signal}),globalThis.ReadableStream&&T instanceof globalThis.ReadableStream&&{duplex:"half"}),T&&{body:T}),(s=this.fetchOptions)!==null&&s!==void 0?s:{}),(r=a.fetchOptions)!==null&&r!==void 0?r:{}),url:m,timeout:a.timeout}}async buildHeaders({options:t,method:e,bodyHeaders:n,retryCount:s}){let r={};this.idempotencyHeader&&e!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=t.idempotencyKey);const a=await this.authHeaders(t);let c=zu([r,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(s)},t.timeout?{"X-Stainless-Timeout":String(Math.trunc(t.timeout/1e3))}:{}),Bq()),this._options.defaultHeaders,n,t.headers,a]);return this.validateHeaders(c),c.values}buildBody({options:{body:t,headers:e}}){if(!t)return{bodyHeaders:void 0,body:void 0};const n=zu([e]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||typeof t=="string"&&n.values.has("content-type")||globalThis.Blob&&t instanceof globalThis.Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:typeof t=="object"&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&typeof t.next=="function")?{bodyHeaders:void 0,body:Hq(t)}:this.encoder({body:t,headers:n})}}hm.DEFAULT_TIMEOUT=6e4;class En extends hm{constructor(){super(...arguments),this.interactions=new LM(this)}}UM=En;En.GeminiNextGenAPIClient=UM;En.GeminiNextGenAPIClientError=Bi;En.APIError=Qn;En.APIConnectionError=cm;En.APIConnectionTimeoutError=vM;En.APIUserAbortError=V_;En.NotFoundError=SM;En.ConflictError=wM;En.RateLimitError=CM;En.BadRequestError=EM;En.AuthenticationError=TM;En.InternalServerError=IM;En.PermissionDeniedError=AM;En.UnprocessableEntityError=bM;En.toFile=Kq;En.Interactions=LM;function az(i,t){const e={},n=g(i,["name"]);return n!=null&&_(e,["_url","name"],n),e}function lz(i,t){const e={},n=g(i,["name"]);return n!=null&&_(e,["_url","name"],n),e}function cz(i,t){const e={},n=g(i,["sdkHttpResponse"]);return n!=null&&_(e,["sdkHttpResponse"],n),e}function uz(i,t){const e={},n=g(i,["sdkHttpResponse"]);return n!=null&&_(e,["sdkHttpResponse"],n),e}function hz(i,t,e){const n={};if(g(i,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const s=g(i,["tunedModelDisplayName"]);if(t!==void 0&&s!=null&&_(t,["displayName"],s),g(i,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const r=g(i,["epochCount"]);t!==void 0&&r!=null&&_(t,["tuningTask","hyperparameters","epochCount"],r);const a=g(i,["learningRateMultiplier"]);if(a!=null&&_(n,["tuningTask","hyperparameters","learningRateMultiplier"],a),g(i,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(g(i,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(g(i,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const c=g(i,["batchSize"]);t!==void 0&&c!=null&&_(t,["tuningTask","hyperparameters","batchSize"],c);const u=g(i,["learningRate"]);if(t!==void 0&&u!=null&&_(t,["tuningTask","hyperparameters","learningRate"],u),g(i,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(g(i,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return n}function dz(i,t,e){const n={};let s=g(e,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){const T=g(i,["validationDataset"]);t!==void 0&&T!=null&&_(t,["supervisedTuningSpec"],SC(T))}else if(s==="PREFERENCE_TUNING"){const T=g(i,["validationDataset"]);t!==void 0&&T!=null&&_(t,["preferenceOptimizationSpec"],SC(T))}const r=g(i,["tunedModelDisplayName"]);t!==void 0&&r!=null&&_(t,["tunedModelDisplayName"],r);const a=g(i,["description"]);t!==void 0&&a!=null&&_(t,["description"],a);let c=g(e,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){const T=g(i,["epochCount"]);t!==void 0&&T!=null&&_(t,["supervisedTuningSpec","hyperParameters","epochCount"],T)}else if(c==="PREFERENCE_TUNING"){const T=g(i,["epochCount"]);t!==void 0&&T!=null&&_(t,["preferenceOptimizationSpec","hyperParameters","epochCount"],T)}let u=g(e,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){const T=g(i,["learningRateMultiplier"]);t!==void 0&&T!=null&&_(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],T)}else if(u==="PREFERENCE_TUNING"){const T=g(i,["learningRateMultiplier"]);t!==void 0&&T!=null&&_(t,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],T)}let h=g(e,["config","method"]);if(h===void 0&&(h="SUPERVISED_FINE_TUNING"),h==="SUPERVISED_FINE_TUNING"){const T=g(i,["exportLastCheckpointOnly"]);t!==void 0&&T!=null&&_(t,["supervisedTuningSpec","exportLastCheckpointOnly"],T)}else if(h==="PREFERENCE_TUNING"){const T=g(i,["exportLastCheckpointOnly"]);t!==void 0&&T!=null&&_(t,["preferenceOptimizationSpec","exportLastCheckpointOnly"],T)}let f=g(e,["config","method"]);if(f===void 0&&(f="SUPERVISED_FINE_TUNING"),f==="SUPERVISED_FINE_TUNING"){const T=g(i,["adapterSize"]);t!==void 0&&T!=null&&_(t,["supervisedTuningSpec","hyperParameters","adapterSize"],T)}else if(f==="PREFERENCE_TUNING"){const T=g(i,["adapterSize"]);t!==void 0&&T!=null&&_(t,["preferenceOptimizationSpec","hyperParameters","adapterSize"],T)}if(g(i,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(g(i,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const m=g(i,["labels"]);t!==void 0&&m!=null&&_(t,["labels"],m);const y=g(i,["beta"]);return t!==void 0&&y!=null&&_(t,["preferenceOptimizationSpec","hyperParameters","beta"],y),n}function fz(i,t){const e={},n=g(i,["baseModel"]);n!=null&&_(e,["baseModel"],n);const s=g(i,["preTunedModel"]);s!=null&&_(e,["preTunedModel"],s);const r=g(i,["trainingDataset"]);r!=null&&wz(r);const a=g(i,["config"]);return a!=null&&hz(a,e),e}function pz(i,t){const e={},n=g(i,["baseModel"]);n!=null&&_(e,["baseModel"],n);const s=g(i,["preTunedModel"]);s!=null&&_(e,["preTunedModel"],s);const r=g(i,["trainingDataset"]);r!=null&&bz(r,e,t);const a=g(i,["config"]);return a!=null&&dz(a,e,t),e}function mz(i,t){const e={},n=g(i,["name"]);return n!=null&&_(e,["_url","name"],n),e}function gz(i,t){const e={},n=g(i,["name"]);return n!=null&&_(e,["_url","name"],n),e}function yz(i,t,e){const n={},s=g(i,["pageSize"]);t!==void 0&&s!=null&&_(t,["_query","pageSize"],s);const r=g(i,["pageToken"]);t!==void 0&&r!=null&&_(t,["_query","pageToken"],r);const a=g(i,["filter"]);return t!==void 0&&a!=null&&_(t,["_query","filter"],a),n}function _z(i,t,e){const n={},s=g(i,["pageSize"]);t!==void 0&&s!=null&&_(t,["_query","pageSize"],s);const r=g(i,["pageToken"]);t!==void 0&&r!=null&&_(t,["_query","pageToken"],r);const a=g(i,["filter"]);return t!==void 0&&a!=null&&_(t,["_query","filter"],a),n}function vz(i,t){const e={},n=g(i,["config"]);return n!=null&&yz(n,e),e}function Ez(i,t){const e={},n=g(i,["config"]);return n!=null&&_z(n,e),e}function Tz(i,t){const e={},n=g(i,["sdkHttpResponse"]);n!=null&&_(e,["sdkHttpResponse"],n);const s=g(i,["nextPageToken"]);s!=null&&_(e,["nextPageToken"],s);const r=g(i,["tunedModels"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(c=>VM(c))),_(e,["tuningJobs"],a)}return e}function Az(i,t){const e={},n=g(i,["sdkHttpResponse"]);n!=null&&_(e,["sdkHttpResponse"],n);const s=g(i,["nextPageToken"]);s!=null&&_(e,["nextPageToken"],s);const r=g(i,["tuningJobs"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(c=>H_(c))),_(e,["tuningJobs"],a)}return e}function Sz(i,t){const e={},n=g(i,["name"]);n!=null&&_(e,["model"],n);const s=g(i,["name"]);return s!=null&&_(e,["endpoint"],s),e}function wz(i,t){const e={};if(g(i,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(g(i,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const n=g(i,["examples"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>r)),_(e,["examples","examples"],s)}return e}function bz(i,t,e){const n={};let s=g(e,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){const a=g(i,["gcsUri"]);t!==void 0&&a!=null&&_(t,["supervisedTuningSpec","trainingDatasetUri"],a)}else if(s==="PREFERENCE_TUNING"){const a=g(i,["gcsUri"]);t!==void 0&&a!=null&&_(t,["preferenceOptimizationSpec","trainingDatasetUri"],a)}let r=g(e,["config","method"]);if(r===void 0&&(r="SUPERVISED_FINE_TUNING"),r==="SUPERVISED_FINE_TUNING"){const a=g(i,["vertexDatasetResource"]);t!==void 0&&a!=null&&_(t,["supervisedTuningSpec","trainingDatasetUri"],a)}else if(r==="PREFERENCE_TUNING"){const a=g(i,["vertexDatasetResource"]);t!==void 0&&a!=null&&_(t,["preferenceOptimizationSpec","trainingDatasetUri"],a)}if(g(i,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function VM(i,t){const e={},n=g(i,["sdkHttpResponse"]);n!=null&&_(e,["sdkHttpResponse"],n);const s=g(i,["name"]);s!=null&&_(e,["name"],s);const r=g(i,["state"]);r!=null&&_(e,["state"],tM(r));const a=g(i,["createTime"]);a!=null&&_(e,["createTime"],a);const c=g(i,["tuningTask","startTime"]);c!=null&&_(e,["startTime"],c);const u=g(i,["tuningTask","completeTime"]);u!=null&&_(e,["endTime"],u);const h=g(i,["updateTime"]);h!=null&&_(e,["updateTime"],h);const f=g(i,["description"]);f!=null&&_(e,["description"],f);const m=g(i,["baseModel"]);m!=null&&_(e,["baseModel"],m);const y=g(i,["_self"]);return y!=null&&_(e,["tunedModel"],Sz(y)),e}function H_(i,t){const e={},n=g(i,["sdkHttpResponse"]);n!=null&&_(e,["sdkHttpResponse"],n);const s=g(i,["name"]);s!=null&&_(e,["name"],s);const r=g(i,["state"]);r!=null&&_(e,["state"],tM(r));const a=g(i,["createTime"]);a!=null&&_(e,["createTime"],a);const c=g(i,["startTime"]);c!=null&&_(e,["startTime"],c);const u=g(i,["endTime"]);u!=null&&_(e,["endTime"],u);const h=g(i,["updateTime"]);h!=null&&_(e,["updateTime"],h);const f=g(i,["error"]);f!=null&&_(e,["error"],f);const m=g(i,["description"]);m!=null&&_(e,["description"],m);const y=g(i,["baseModel"]);y!=null&&_(e,["baseModel"],y);const T=g(i,["tunedModel"]);T!=null&&_(e,["tunedModel"],T);const S=g(i,["preTunedModel"]);S!=null&&_(e,["preTunedModel"],S);const b=g(i,["supervisedTuningSpec"]);b!=null&&_(e,["supervisedTuningSpec"],b);const C=g(i,["preferenceOptimizationSpec"]);C!=null&&_(e,["preferenceOptimizationSpec"],C);const I=g(i,["tuningDataStats"]);I!=null&&_(e,["tuningDataStats"],I);const D=g(i,["encryptionSpec"]);D!=null&&_(e,["encryptionSpec"],D);const P=g(i,["partnerModelTuningSpec"]);P!=null&&_(e,["partnerModelTuningSpec"],P);const H=g(i,["customBaseModel"]);H!=null&&_(e,["customBaseModel"],H);const F=g(i,["experiment"]);F!=null&&_(e,["experiment"],F);const G=g(i,["labels"]);G!=null&&_(e,["labels"],G);const N=g(i,["outputUri"]);N!=null&&_(e,["outputUri"],N);const x=g(i,["pipelineJob"]);x!=null&&_(e,["pipelineJob"],x);const k=g(i,["serviceAccount"]);k!=null&&_(e,["serviceAccount"],k);const V=g(i,["tunedModelDisplayName"]);V!=null&&_(e,["tunedModelDisplayName"],V);const U=g(i,["veoTuningSpec"]);return U!=null&&_(e,["veoTuningSpec"],U),e}function Cz(i,t){const e={},n=g(i,["sdkHttpResponse"]);n!=null&&_(e,["sdkHttpResponse"],n);const s=g(i,["name"]);s!=null&&_(e,["name"],s);const r=g(i,["metadata"]);r!=null&&_(e,["metadata"],r);const a=g(i,["done"]);a!=null&&_(e,["done"],a);const c=g(i,["error"]);return c!=null&&_(e,["error"],c),e}function SC(i,t){const e={},n=g(i,["gcsUri"]);n!=null&&_(e,["validationDatasetUri"],n);const s=g(i,["vertexDatasetResource"]);return s!=null&&_(e,["validationDatasetUri"],s),e}class Iz extends Cr{constructor(t){super(),this.apiClient=t,this.list=async(e={})=>new $a(br.PAGED_ITEM_TUNING_JOBS,n=>this.listInternal(n),await this.listInternal(e),e),this.get=async e=>await this.getInternal(e),this.tune=async e=>{var n;if(this.apiClient.isVertexAI())if(e.baseModel.startsWith("projects/")){const s={tunedModelName:e.baseModel};!((n=e.config)===null||n===void 0)&&n.preTunedModelCheckpointId&&(s.checkpointId=e.config.preTunedModelCheckpointId);const r=Object.assign(Object.assign({},e),{preTunedModel:s});return r.baseModel=void 0,await this.tuneInternal(r)}else{const s=Object.assign({},e);return await this.tuneInternal(s)}else{const s=Object.assign({},e),r=await this.tuneMldevInternal(s);let a="";return r.metadata!==void 0&&r.metadata.tunedModel!==void 0?a=r.metadata.tunedModel:r.name!==void 0&&r.name.includes("/operations/")&&(a=r.name.split("/operations/")[0]),{name:a,state:M_.JOB_STATE_QUEUED}}}}async getInternal(t){var e,n,s,r;let a,c="",u={};if(this.apiClient.isVertexAI()){const h=gz(t);return c=gt("{name}",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:f.headers},y})),a.then(f=>H_(f))}else{const h=mz(t);return c=gt("{name}",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:f.headers},y})),a.then(f=>VM(f))}}async listInternal(t){var e,n,s,r;let a,c="",u={};if(this.apiClient.isVertexAI()){const h=Ez(t);return c=gt("tuningJobs",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:f.headers},y})),a.then(f=>{const m=Az(f),y=new Xb;return Object.assign(y,m),y})}else{const h=vz(t);return c=gt("tunedModels",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:f.headers},y})),a.then(f=>{const m=Tz(f),y=new Xb;return Object.assign(y,m),y})}}async cancel(t){var e,n,s,r;let a,c="",u={};if(this.apiClient.isVertexAI()){const h=lz(t);return c=gt("{name}:cancel",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:f.headers},y})),a.then(f=>{const m=uz(f),y=new Jb;return Object.assign(y,m),y})}else{const h=az(t);return c=gt("{name}:cancel",h._url),u=h._query,delete h._url,delete h._query,a=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:f.headers},y})),a.then(f=>{const m=cz(f),y=new Jb;return Object.assign(y,m),y})}}async tuneInternal(t){var e,n;let s,r="",a={};if(this.apiClient.isVertexAI()){const c=pz(t,t);return r=gt("tuningJobs",c._url),a=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json().then(h=>{const f=h;return f.sdkHttpResponse={headers:u.headers},f})),s.then(u=>H_(u))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(t){var e,n;let s,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=fz(t);return r=gt("tunedModels",c._url),a=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json().then(h=>{const f=h;return f.sdkHttpResponse={headers:u.headers},f})),s.then(u=>Cz(u))}}}class Rz{async download(t,e){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const Mz=1024*1024*8,Pz=3,xz=1e3,Dz=2,Pp="x-goog-upload-status";async function Nz(i,t,e){var n;const s=await BM(i,t,e),r=await s?.json();if(((n=s?.headers)===null||n===void 0?void 0:n[Pp])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return r.file}async function kz(i,t,e){var n;const s=await BM(i,t,e),r=await s?.json();if(((n=s?.headers)===null||n===void 0?void 0:n[Pp])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const a=K1(r),c=new rE;return Object.assign(c,a),c}async function BM(i,t,e){var n,s;let r=0,a=0,c=new P_(new Response),u="upload";for(r=i.size;a<r;){const h=Math.min(Mz,r-a),f=i.slice(a,a+h);a+h>=r&&(u+=", finalize");let m=0,y=xz;for(;m<Pz&&(c=await e.request({path:"",body:f,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":u,"X-Goog-Upload-Offset":String(a),"Content-Length":String(h)}}}),!(!((n=c?.headers)===null||n===void 0)&&n[Pp]));)m++,await Oz(y),y=y*Dz;if(a+=h,((s=c?.headers)===null||s===void 0?void 0:s[Pp])!=="active")break;if(r<=a)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return c}async function Lz(i){return{size:i.size,type:i.type}}function Oz(i){return new Promise(t=>setTimeout(t,i))}class Uz{async upload(t,e,n){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await Nz(t,e,n)}async uploadToFileSearchStore(t,e,n){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await kz(t,e,n)}async stat(t){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await Lz(t)}}class Vz{create(t,e,n){return new Bz(t,e,n)}}class Bz{constructor(t,e,n){this.url=t,this.headers=e,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(t){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(t)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}const wC="x-goog-api-key";class Fz{constructor(t){this.apiKey=t}async addAuthHeaders(t,e){if(t.get(wC)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");t.append(wC,this.apiKey)}}}const Hz="gl-node/";class Gz{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");const t=this.httpOptions;t?.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");const e=new En({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:t?.timeout});return this._interactions=e.interactions,this._interactions}constructor(t){var e;if(t.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(t.project||t.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(e=t.vertexai)!==null&&e!==void 0?e:!1,this.apiKey=t.apiKey;const n=OF(t.httpOptions,t.vertexai,void 0,void 0);n&&(t.httpOptions?t.httpOptions.baseUrl=n:t.httpOptions={baseUrl:n}),this.apiVersion=t.apiVersion,this.httpOptions=t.httpOptions;const s=new Fz(this.apiKey);this.apiClient=new LG({auth:s,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:Hz+"web",uploader:new Uz,downloader:new Rz}),this.models=new tq(this.apiClient),this.live=new KG(this.apiClient,s,new Vz),this.batches=new h3(this.apiClient),this.chats=new Y3(this.models,this.apiClient),this.caches=new q3(this.apiClient),this.files=new nH(this.apiClient),this.operations=new eq(this.apiClient),this.authTokens=new yq(this.apiClient),this.tunings=new Iz(this.apiClient),this.fileSearchStores=new bq(this.apiClient)}}const Kn=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),G_=[.001,0,0,.001,0,0],zy=1.35,mi={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},yo={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Ah="pdfjs_internal_editor_",qt={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},te={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},qz={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},q_={TRIANGLES:1,LATTICE:2},bn={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Qf={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Ze={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},zl={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},dm={ERRORS:0,WARNINGS:1,INFOS:5},Sh={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},$u={moveTo:0,lineTo:1,curveTo:2,quadraticCurveTo:3,closePath:4},zz={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let fm=dm.WARNINGS;function $z(i){Number.isInteger(i)&&(fm=i)}function Yz(){return fm}function pm(i){fm>=dm.INFOS&&console.info(`Info: ${i}`)}function Ft(i){fm>=dm.WARNINGS&&console.warn(`Warning: ${i}`)}function Ee(i){throw new Error(i)}function ee(i,t){i||Ee(t)}function Wz(i){switch(i?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function FM(i,t=null,e=null){if(!i)return null;if(e&&typeof i=="string"&&(e.addDefaultProtocol&&i.startsWith("www.")&&i.match(/\./g)?.length>=2&&(i=`http://${i}`),e.tryConvertEncoding))try{i=jz(i)}catch{}const n=t?URL.parse(i,t):URL.parse(i);return Wz(n)?n:null}function HM(i,t,e=!1){const n=URL.parse(i);return n?(n.hash=t,n.href):e&&FM(i,"http://example.com")?i.split("#",1)[0]+`${t?`#${t}`:""}`:""}function Ht(i,t,e,n=!1){return Object.defineProperty(i,t,{value:e,enumerable:!n,configurable:!0,writable:!1}),e}const Ya=(function(){function t(e,n){this.message=e,this.name=n}return t.prototype=new Error,t.constructor=t,t})();class bC extends Ya{constructor(t,e){super(t,"PasswordException"),this.code=e}}class $y extends Ya{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class z_ extends Ya{constructor(t){super(t,"InvalidPDFException")}}class xp extends Ya{constructor(t,e,n){super(t,"ResponseException"),this.status=e,this.missing=n}}class Kz extends Ya{constructor(t){super(t,"FormatError")}}class Do extends Ya{constructor(t){super(t,"AbortException")}}function GM(i){(typeof i!="object"||i?.length===void 0)&&Ee("Invalid argument for bytesToString");const t=i.length,e=8192;if(t<e)return String.fromCharCode.apply(null,i);const n=[];for(let s=0;s<t;s+=e){const r=Math.min(s+e,t),a=i.subarray(s,r);n.push(String.fromCharCode.apply(null,a))}return n.join("")}function Gh(i){typeof i!="string"&&Ee("Invalid argument for stringToBytes");const t=i.length,e=new Uint8Array(t);for(let n=0;n<t;++n)e[n]=i.charCodeAt(n)&255;return e}function Xz(i){return String.fromCharCode(i>>24&255,i>>16&255,i>>8&255,i&255)}function Jz(){const i=new Uint8Array(4);return i[0]=1,new Uint32Array(i.buffer,0,1)[0]===1}function Qz(){try{return new Function(""),!0}catch{return!1}}class Pn{static get isLittleEndian(){return Ht(this,"isLittleEndian",Jz())}static get isEvalSupported(){return Ht(this,"isEvalSupported",Qz())}static get isOffscreenCanvasSupported(){return Ht(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return Ht(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get isFloat16ArraySupported(){return Ht(this,"isFloat16ArraySupported",typeof Float16Array<"u")}static get isSanitizerSupported(){return Ht(this,"isSanitizerSupported",typeof Sanitizer<"u")}static get platform(){const{platform:t,userAgent:e}=navigator;return Ht(this,"platform",{isAndroid:e.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:e.includes("Firefox")})}static get isCSSRoundSupported(){return Ht(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const Yy=Array.from(Array(256).keys(),i=>i.toString(16).padStart(2,"0"));class Tt{static makeHexColor(t,e,n){return`#${Yy[t]}${Yy[e]}${Yy[n]}`}static domMatrixToTransform(t){return[t.a,t.b,t.c,t.d,t.e,t.f]}static scaleMinMax(t,e){let n;t[0]?(t[0]<0&&(n=e[0],e[0]=e[2],e[2]=n),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(n=e[1],e[1]=e[3],e[3]=n),e[1]*=t[3],e[3]*=t[3]):(n=e[0],e[0]=e[1],e[1]=n,n=e[2],e[2]=e[3],e[3]=n,t[1]<0&&(n=e[1],e[1]=e[3],e[3]=n),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(n=e[0],e[0]=e[2],e[2]=n),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static multiplyByDOMMatrix(t,e){return[t[0]*e.a+t[2]*e.b,t[1]*e.a+t[3]*e.b,t[0]*e.c+t[2]*e.d,t[1]*e.c+t[3]*e.d,t[0]*e.e+t[2]*e.f+t[4],t[1]*e.e+t[3]*e.f+t[5]]}static applyTransform(t,e,n=0){const s=t[n],r=t[n+1];t[n]=s*e[0]+r*e[2]+e[4],t[n+1]=s*e[1]+r*e[3]+e[5]}static applyTransformToBezier(t,e,n=0){const s=e[0],r=e[1],a=e[2],c=e[3],u=e[4],h=e[5];for(let f=0;f<6;f+=2){const m=t[n+f],y=t[n+f+1];t[n+f]=m*s+y*a+u,t[n+f+1]=m*r+y*c+h}}static applyInverseTransform(t,e){const n=t[0],s=t[1],r=e[0]*e[3]-e[1]*e[2];t[0]=(n*e[3]-s*e[2]+e[2]*e[5]-e[4]*e[3])/r,t[1]=(-n*e[1]+s*e[0]+e[4]*e[1]-e[5]*e[0])/r}static axialAlignedBoundingBox(t,e,n){const s=e[0],r=e[1],a=e[2],c=e[3],u=e[4],h=e[5],f=t[0],m=t[1],y=t[2],T=t[3];let S=s*f+u,b=S,C=s*y+u,I=C,D=c*m+h,P=D,H=c*T+h,F=H;if(r!==0||a!==0){const G=r*f,N=r*y,x=a*m,k=a*T;S+=x,I+=x,C+=k,b+=k,D+=G,F+=G,H+=N,P+=N}n[0]=Math.min(n[0],S,C,b,I),n[1]=Math.min(n[1],D,H,P,F),n[2]=Math.max(n[2],S,C,b,I),n[3]=Math.max(n[3],D,H,P,F)}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t,e){const n=t[0],s=t[1],r=t[2],a=t[3],c=n**2+s**2,u=n*r+s*a,h=r**2+a**2,f=(c+h)/2,m=Math.sqrt(f**2-(c*h-u**2));e[0]=Math.sqrt(f+m||1),e[1]=Math.sqrt(f-m||1)}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const n=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),s=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(n>s)return null;const r=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),a=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return r>a?null:[n,r,s,a]}static pointBoundingBox(t,e,n){n[0]=Math.min(n[0],t),n[1]=Math.min(n[1],e),n[2]=Math.max(n[2],t),n[3]=Math.max(n[3],e)}static rectBoundingBox(t,e,n,s,r){r[0]=Math.min(r[0],t,n),r[1]=Math.min(r[1],e,s),r[2]=Math.max(r[2],t,n),r[3]=Math.max(r[3],e,s)}static#t(t,e,n,s,r,a,c,u,h,f){if(h<=0||h>=1)return;const m=1-h,y=h*h,T=y*h,S=m*(m*(m*t+3*h*e)+3*y*n)+T*s,b=m*(m*(m*r+3*h*a)+3*y*c)+T*u;f[0]=Math.min(f[0],S),f[1]=Math.min(f[1],b),f[2]=Math.max(f[2],S),f[3]=Math.max(f[3],b)}static#e(t,e,n,s,r,a,c,u,h,f,m,y){if(Math.abs(h)<1e-12){Math.abs(f)>=1e-12&&this.#t(t,e,n,s,r,a,c,u,-m/f,y);return}const T=f**2-4*m*h;if(T<0)return;const S=Math.sqrt(T),b=2*h;this.#t(t,e,n,s,r,a,c,u,(-f+S)/b,y),this.#t(t,e,n,s,r,a,c,u,(-f-S)/b,y)}static bezierBoundingBox(t,e,n,s,r,a,c,u,h){h[0]=Math.min(h[0],t,c),h[1]=Math.min(h[1],e,u),h[2]=Math.max(h[2],t,c),h[3]=Math.max(h[3],e,u),this.#e(t,n,r,c,e,s,a,u,3*(-t+3*(n-r)+c),6*(t-2*n+r),3*(n-t),h),this.#e(t,n,r,c,e,s,a,u,3*(-e+3*(s-a)+u),6*(e-2*s+a),3*(s-e),h)}}function jz(i){return decodeURIComponent(escape(i))}let Wy=null,CC=null;function Zz(i){return Wy||(Wy=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,CC=new Map([["","t"]])),i.replaceAll(Wy,(t,e,n)=>e?e.normalize("NFKC"):CC.get(n))}function qM(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const i=new Uint8Array(32);return crypto.getRandomValues(i),GM(i)}const Jl="pdfjs_internal_id_";function t5(i,t,e){if(!Array.isArray(e)||e.length<2)return!1;const[n,s,...r]=e;if(!i(n)&&!Number.isInteger(n)||!t(s))return!1;const a=r.length;let c=!0;switch(s.name){case"XYZ":if(a<2||a>3)return!1;break;case"Fit":case"FitB":return a===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(a>1)return!1;break;case"FitR":if(a!==4)return!1;c=!1;break;default:return!1}for(const u of r)if(!(typeof u=="number"||c&&u===null))return!1;return!0}function Xn(i,t,e){return Math.min(Math.max(i,t),e)}function zM(i){return Uint8Array.prototype.toBase64?i.toBase64():btoa(GM(i))}function e5(i){return Uint8Array.fromBase64?Uint8Array.fromBase64(i):Gh(atob(i))}typeof Promise.try!="function"&&(Promise.try=function(i,...t){return new Promise(e=>{e(i(...t))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(i){return i.reduce((t,e)=>t+e,0)});class wh{static textContent(t){const e=[],n={items:e,styles:Object.create(null)};function s(r){if(!r)return;let a=null;const c=r.name;if(c==="#text")a=r.value;else if(wh.shouldBuildText(c))r?.attributes?.textContent?a=r.attributes.textContent:r.value&&(a=r.value);else return;if(a!==null&&e.push({str:a}),!!r.children)for(const u of r.children)s(u)}return s(t),n}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}class $M{static setupStorage(t,e,n,s,r){const a=s.getValue(e,{value:null});switch(n.name){case"textarea":if(a.value!==null&&(t.textContent=a.value),r==="print")break;t.addEventListener("input",c=>{s.setValue(e,{value:c.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(a.value===n.attributes.xfaOn?t.setAttribute("checked",!0):a.value===n.attributes.xfaOff&&t.removeAttribute("checked"),r==="print")break;t.addEventListener("change",c=>{s.setValue(e,{value:c.target.checked?c.target.getAttribute("xfaOn"):c.target.getAttribute("xfaOff")})})}else{if(a.value!==null&&t.setAttribute("value",a.value),r==="print")break;t.addEventListener("input",c=>{s.setValue(e,{value:c.target.value})})}break;case"select":if(a.value!==null){t.setAttribute("value",a.value);for(const c of n.children)c.attributes.value===a.value?c.attributes.selected=!0:c.attributes.hasOwnProperty("selected")&&delete c.attributes.selected}t.addEventListener("input",c=>{const u=c.target.options,h=u.selectedIndex===-1?"":u[u.selectedIndex].value;s.setValue(e,{value:h})});break}}static setAttributes({html:t,element:e,storage:n=null,intent:s,linkService:r}){const{attributes:a}=e,c=t instanceof HTMLAnchorElement;a.type==="radio"&&(a.name=`${a.name}-${s}`);for(const[u,h]of Object.entries(a))if(h!=null)switch(u){case"class":h.length&&t.setAttribute(u,h.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",h);break;case"style":Object.assign(t.style,h);break;case"textContent":t.textContent=h;break;default:(!c||u!=="href"&&u!=="newWindow")&&t.setAttribute(u,h)}c&&r.addLinkAttributes(t,a.href,a.newWindow),n&&a.dataId&&this.setupStorage(t,a.dataId,e,n)}static render(t){const e=t.annotationStorage,n=t.linkService,s=t.xfaHtml,r=t.intent||"display",a=document.createElement(s.name);s.attributes&&this.setAttributes({html:a,element:s,intent:r,linkService:n});const c=r!=="richText",u=t.div;if(u.append(a),t.viewport){const m=`matrix(${t.viewport.transform.join(",")})`;u.style.transform=m}c&&u.setAttribute("class","xfaLayer xfaFont");const h=[];if(s.children.length===0){if(s.value){const m=document.createTextNode(s.value);a.append(m),c&&wh.shouldBuildText(s.name)&&h.push(m)}return{textDivs:h}}const f=[[s,-1,a]];for(;f.length>0;){const[m,y,T]=f.at(-1);if(y+1===m.children.length){f.pop();continue}const S=m.children[++f.at(-1)[1]];if(S===null)continue;const{name:b}=S;if(b==="#text"){const I=document.createTextNode(S.value);h.push(I),T.append(I);continue}const C=S?.attributes?.xmlns?document.createElementNS(S.attributes.xmlns,b):document.createElement(b);if(T.append(C),S.attributes&&this.setAttributes({html:C,element:S,storage:e,intent:r,linkService:n}),S.children?.length>0)f.push([S,-1,C]);else if(S.value){const I=document.createTextNode(S.value);c&&wh.shouldBuildText(b)&&h.push(I),C.append(I)}}for(const m of u.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))m.setAttribute("readOnly",!0);return{textDivs:h}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const hr="http://www.w3.org/2000/svg";class Ac{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function qh(i,t="text"){if(ih(i,document.baseURI)){const e=await fetch(i);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,n)=>{const s=new XMLHttpRequest;s.open("GET",i,!0),s.responseType=t,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(s.status===200||s.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(s.response);return}e(s.responseText);return}n(new Error(s.statusText))}},s.send(null)})}class zh{constructor({viewBox:t,userUnit:e,scale:n,rotation:s,offsetX:r=0,offsetY:a=0,dontFlip:c=!1}){this.viewBox=t,this.userUnit=e,this.scale=n,this.rotation=s,this.offsetX=r,this.offsetY=a,n*=e;const u=(t[2]+t[0])/2,h=(t[3]+t[1])/2;let f,m,y,T;switch(s%=360,s<0&&(s+=360),s){case 180:f=-1,m=0,y=0,T=1;break;case 90:f=0,m=1,y=1,T=0;break;case 270:f=0,m=-1,y=-1,T=0;break;case 0:f=1,m=0,y=0,T=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}c&&(y=-y,T=-T);let S,b,C,I;f===0?(S=Math.abs(h-t[1])*n+r,b=Math.abs(u-t[0])*n+a,C=(t[3]-t[1])*n,I=(t[2]-t[0])*n):(S=Math.abs(u-t[0])*n+r,b=Math.abs(h-t[1])*n+a,C=(t[2]-t[0])*n,I=(t[3]-t[1])*n),this.transform=[f*n,m*n,y*n,T*n,S-f*n*u-y*n*h,b-m*n*u-T*n*h],this.width=C,this.height=I}get rawDims(){const t=this.viewBox;return Ht(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:n=this.offsetX,offsetY:s=this.offsetY,dontFlip:r=!1}={}){return new zh({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:n,offsetY:s,dontFlip:r})}convertToViewportPoint(t,e){const n=[t,e];return Tt.applyTransform(n,this.transform),n}convertToViewportRectangle(t){const e=[t[0],t[1]];Tt.applyTransform(e,this.transform);const n=[t[2],t[3]];return Tt.applyTransform(n,this.transform),[e[0],e[1],n[0],n[1]]}convertToPdfPoint(t,e){const n=[t,e];return Tt.applyInverseTransform(n,this.transform),n}}class fE extends Ya{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function mm(i){const t=i.length;let e=0;for(;e<t&&i[e].trim()==="";)e++;return i.substring(e,e+5).toLowerCase()==="data:"}function pE(i){return typeof i=="string"&&/\.pdf$/i.test(i)}function n5(i){return[i]=i.split(/[#?]/,1),i.substring(i.lastIndexOf("/")+1)}function i5(i,t="document.pdf"){if(typeof i!="string")return t;if(mm(i))return Ft('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const n=(c=>{try{return new URL(c)}catch{try{return new URL(decodeURIComponent(c))}catch{try{return new URL(c,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(c),"https://foo.bar")}catch{return null}}}}})(i);if(!n)return t;const s=c=>{try{let u=decodeURIComponent(c);return u.includes("/")?(u=u.split("/").at(-1),u.test(/^\.pdf$/i)?u:c):u}catch{return c}},r=/\.pdf$/i,a=n.pathname.split("/").at(-1);if(r.test(a))return s(a);if(n.searchParams.size>0){const c=Array.from(n.searchParams.values()).reverse();for(const h of c)if(r.test(h))return s(h);const u=Array.from(n.searchParams.keys()).reverse();for(const h of u)if(r.test(h))return s(h)}if(n.hash){const u=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(n.hash);if(u)return s(u[0])}return t}class IC{started=Object.create(null);times=[];time(t){t in this.started&&Ft(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||Ft(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:n}of this.times)e=Math.max(n.length,e);for(const{name:n,start:s,end:r}of this.times)t.push(`${n.padEnd(e)} ${r-s}ms
`);return t.join("")}}function ih(i,t){const e=t?URL.parse(i,t):URL.parse(i);return e?.protocol==="http:"||e?.protocol==="https:"}function Fi(i){i.preventDefault()}function Ue(i){i.preventDefault(),i.stopPropagation()}function s5(i){console.log("Deprecated API usage: "+i)}class $_{static#t;static toDateObject(t){if(t instanceof Date)return t;if(!t||typeof t!="string")return null;this.#t||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const e=this.#t.exec(t);if(!e)return null;const n=parseInt(e[1],10);let s=parseInt(e[2],10);s=s>=1&&s<=12?s-1:0;let r=parseInt(e[3],10);r=r>=1&&r<=31?r:1;let a=parseInt(e[4],10);a=a>=0&&a<=23?a:0;let c=parseInt(e[5],10);c=c>=0&&c<=59?c:0;let u=parseInt(e[6],10);u=u>=0&&u<=59?u:0;const h=e[7]||"Z";let f=parseInt(e[8],10);f=f>=0&&f<=23?f:0;let m=parseInt(e[9],10)||0;return m=m>=0&&m<=59?m:0,h==="-"?(a+=f,c+=m):h==="+"&&(a-=f,c-=m),new Date(Date.UTC(n,s,r,a,c,u))}}function r5(i,{scale:t=1,rotation:e=0}){const{width:n,height:s}=i.attributes.style,r=[0,0,parseInt(n),parseInt(s)];return new zh({viewBox:r,userUnit:1,scale:t,rotation:e})}function $h(i){if(i.startsWith("#")){const t=parseInt(i.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return i.startsWith("rgb(")?i.slice(4,-1).split(",").map(t=>parseInt(t)):i.startsWith("rgba(")?i.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(Ft(`Not a valid color format: "${i}"`),[0,0,0])}function o5(i){const t=document.createElement("span");t.style.visibility="hidden",t.style.colorScheme="only light",document.body.append(t);for(const e of i.keys()){t.style.color=e;const n=window.getComputedStyle(t).color;i.set(e,$h(n))}t.remove()}function xe(i){const{a:t,b:e,c:n,d:s,e:r,f:a}=i.getTransform();return[t,e,n,s,r,a]}function Ss(i){const{a:t,b:e,c:n,d:s,e:r,f:a}=i.getTransform().invertSelf();return[t,e,n,s,r,a]}function Ua(i,t,e=!1,n=!0){if(t instanceof zh){const{pageWidth:s,pageHeight:r}=t.rawDims,{style:a}=i,c=Pn.isCSSRoundSupported,u=`var(--total-scale-factor) * ${s}px`,h=`var(--total-scale-factor) * ${r}px`,f=c?`round(down, ${u}, var(--scale-round-x))`:`calc(${u})`,m=c?`round(down, ${h}, var(--scale-round-y))`:`calc(${h})`;!e||t.rotation%180===0?(a.width=f,a.height=m):(a.width=m,a.height=f)}n&&i.setAttribute("data-main-rotation",t.rotation)}class Vs{constructor(){const{pixelRatio:t}=Vs;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(t,e,n,s,r=-1){let a=1/0,c=1/0,u=1/0;n=Vs.capPixels(n,r),n>0&&(a=Math.sqrt(n/(t*e))),s!==-1&&(c=s/t,u=s/e);const h=Math.min(a,c,u);return this.sx>h||this.sy>h?(this.sx=h,this.sy=h,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(t,e){if(e>=0){const n=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+e/100));return t>0?Math.min(t,n):n}return t}}const Y_=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class a5{static get isDarkMode(){return Ht(this,"isDarkMode",!!window?.matchMedia?.("(prefers-color-scheme: dark)").matches)}}class l5{static get commentForegroundColor(){const t=document.createElement("span");t.classList.add("comment","sidebar");const{style:e}=t;e.width=e.height="0",e.display="none",e.color="var(--comment-fg-color)",document.body.append(t);const{color:n}=window.getComputedStyle(t);return t.remove(),Ht(this,"commentForegroundColor",$h(n))}}function c5(i,t,e,n){n=Math.min(Math.max(n??1,0),1);const s=255*(1-n);return i=Math.round(i*n+s),t=Math.round(t*n+s),e=Math.round(e*n+s),[i,t,e]}function RC(i,t){const e=i[0]/255,n=i[1]/255,s=i[2]/255,r=Math.max(e,n,s),a=Math.min(e,n,s),c=(r+a)/2;if(r===a)t[0]=t[1]=0;else{const u=r-a;switch(t[1]=c<.5?u/(r+a):u/(2-r-a),r){case e:t[0]=((n-s)/u+(n<s?6:0))*60;break;case n:t[0]=((s-e)/u+2)*60;break;case s:t[0]=((e-n)/u+4)*60;break}}t[2]=c}function W_(i,t){const e=i[0],n=i[1],s=i[2],r=(1-Math.abs(2*s-1))*n,a=r*(1-Math.abs(e/60%2-1)),c=s-r/2;switch(Math.floor(e/60)){case 0:t[0]=r+c,t[1]=a+c,t[2]=c;break;case 1:t[0]=a+c,t[1]=r+c,t[2]=c;break;case 2:t[0]=c,t[1]=r+c,t[2]=a+c;break;case 3:t[0]=c,t[1]=a+c,t[2]=r+c;break;case 4:t[0]=a+c,t[1]=c,t[2]=r+c;break;case 5:case 6:t[0]=r+c,t[1]=c,t[2]=a+c;break}}function MC(i){return i<=.03928?i/12.92:((i+.055)/1.055)**2.4}function PC(i,t,e){W_(i,e),e.map(MC);const n=.2126*e[0]+.7152*e[1]+.0722*e[2];W_(t,e),e.map(MC);const s=.2126*e[0]+.7152*e[1]+.0722*e[2];return n>s?(n+.05)/(s+.05):(s+.05)/(n+.05)}const xC=new Map;function u5(i,t){const e=i[0]+i[1]*256+i[2]*65536+t[0]*16777216+t[1]*4294967296+t[2]*1099511627776;let n=xC.get(e);if(n)return n;const s=new Float32Array(9),r=s.subarray(0,3),a=s.subarray(3,6);RC(i,a);const c=s.subarray(6,9);RC(t,c);const u=c[2]<.5,h=u?12:4.5;if(a[2]=u?Math.sqrt(a[2]):1-Math.sqrt(1-a[2]),PC(a,c,r)<h){let f,m;u?(f=a[2],m=1):(f=0,m=a[2]);const y=.005;for(;m-f>y;){const T=a[2]=(f+m)/2;u===PC(a,c,r)<h?f=T:m=T}a[2]=u?m:f}return W_(a,r),n=Tt.makeHexColor(Math.round(r[0]*255),Math.round(r[1]*255),Math.round(r[2]*255)),xC.set(e,n),n}function YM({html:i,dir:t,className:e},n){const s=document.createDocumentFragment();if(typeof i=="string"){const r=document.createElement("p");r.dir=t||"auto";const a=i.split(/(?:\r\n?|\n)/);for(let c=0,u=a.length;c<u;++c){const h=a[c];r.append(document.createTextNode(h)),c<u-1&&r.append(document.createElement("br"))}s.append(r)}else $M.render({xfaHtml:i,div:s,intent:"richText"});s.firstElementChild.classList.add("richText",e),n.append(s)}function WM(i){const t=new Path2D;if(!i)return t;for(let e=0,n=i.length;e<n;)switch(i[e++]){case $u.moveTo:t.moveTo(i[e++],i[e++]);break;case $u.lineTo:t.lineTo(i[e++],i[e++]);break;case $u.curveTo:t.bezierCurveTo(i[e++],i[e++],i[e++],i[e++],i[e++],i[e++]);break;case $u.quadraticCurveTo:t.quadraticCurveTo(i[e++],i[e++],i[e++],i[e++]);break;case $u.closePath:t.closePath();break;default:Ft(`Unrecognized drawing path operator: ${i[e-1]}`);break}return t}class dh{#t=null;#e=null;#i;#n=null;#o=null;#r=null;#s=null;#a=null;static#c=null;constructor(t){this.#i=t,dh.#c||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const t=this.#t=document.createElement("div");t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=this.#i._uiManager._signal;e instanceof AbortSignal&&!e.aborted&&(t.addEventListener("contextmenu",Fi,{signal:e}),t.addEventListener("pointerdown",dh.#l,{signal:e}));const n=this.#n=document.createElement("div");n.className="buttons",t.append(n);const s=this.#i.toolbarPosition;if(s){const{style:r}=t,a=this.#i._uiManager.direction==="ltr"?1-s[0]:s[0];r.insetInlineEnd=`${100*a}%`,r.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return t}get div(){return this.#t}static#l(t){t.stopPropagation()}#d(t){this.#i._focusEventsAllowed=!1,Ue(t)}#h(t){this.#i._focusEventsAllowed=!0,Ue(t)}#f(t){const e=this.#i._uiManager._signal;return!(e instanceof AbortSignal)||e.aborted?!1:(t.addEventListener("focusin",this.#d.bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",this.#h.bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",Fi,{signal:e}),!0)}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden"),this.#o?.shown(),this.#r?.shown()}addDeleteButton(){const{editorType:t,_uiManager:e}=this.#i,n=document.createElement("button");n.classList.add("basic","deleteButton"),n.tabIndex=0,n.setAttribute("data-l10n-id",dh.#c[t]),this.#f(n)&&n.addEventListener("click",s=>{e.delete()},{signal:e._signal}),this.#n.append(n)}get#g(){const t=document.createElement("div");return t.className="divider",t}async addAltText(t){const e=await t.render();this.#f(e),this.#n.append(e,this.#g),this.#o=t}addComment(t,e=null){if(this.#r)return;const n=t.renderForToolbar();if(!n)return;this.#f(n);const s=this.#s=this.#g;e?(this.#n.insertBefore(n,e),this.#n.insertBefore(s,e)):this.#n.append(n,s),this.#r=t,t.toolbar=this}addColorPicker(t){if(this.#e)return;this.#e=t;const e=t.renderButton();this.#f(e),this.#n.append(e,this.#g)}async addEditSignatureButton(t){const e=this.#a=await t.renderEditButton(this.#i);this.#f(e),this.#n.append(e,this.#g)}removeButton(t){switch(t){case"comment":this.#r?.removeToolbarCommentButton(),this.#r=null,this.#s?.remove(),this.#s=null;break}}async addButton(t,e){switch(t){case"colorPicker":e&&this.addColorPicker(e);break;case"altText":e&&await this.addAltText(e);break;case"editSignature":e&&await this.addEditSignatureButton(e);break;case"delete":this.addDeleteButton();break;case"comment":e&&this.addComment(e);break}}async addButtonBefore(t,e,n){if(!e&&t==="comment")return;const s=this.#n.querySelector(n);s&&t==="comment"&&this.addComment(e,s)}updateEditSignatureButton(t){this.#a&&(this.#a.title=t)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}}class h5{#t=null;#e=null;#i;constructor(t){this.#i=t}#n(){const t=this.#e=document.createElement("div");t.className="editToolbar",t.setAttribute("role","toolbar");const e=this.#i._signal;e instanceof AbortSignal&&!e.aborted&&t.addEventListener("contextmenu",Fi,{signal:e});const n=this.#t=document.createElement("div");return n.className="buttons",t.append(n),this.#i.hasCommentManager()&&this.#r("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#i.commentSelection("floating_button")}),this.#r("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#i.highlightSelection("floating_button")}),t}#o(t,e){let n=0,s=0;for(const r of t){const a=r.y+r.height;if(a<n)continue;const c=r.x+(e?r.width:0);if(a>n){s=c,n=a;continue}e?c>s&&(s=c):c<s&&(s=c)}return[e?1-s:s,n]}show(t,e,n){const[s,r]=this.#o(e,n),{style:a}=this.#e||=this.#n();t.append(this.#e),a.insetInlineEnd=`${100*s}%`,a.top=`calc(${100*r}% + var(--editor-toolbar-vert-offset))`}hide(){this.#e.remove()}#r(t,e,n,s){const r=document.createElement("button");r.classList.add("basic",t),r.tabIndex=0,r.setAttribute("data-l10n-id",e);const a=document.createElement("span");r.append(a),a.className="visuallyHidden",a.setAttribute("data-l10n-id",n);const c=this.#i._signal;c instanceof AbortSignal&&!c.aborted&&(r.addEventListener("contextmenu",Fi,{signal:c}),r.addEventListener("click",s,{signal:c})),this.#t.append(r)}}function KM(i,t,e){for(const n of e)t.addEventListener(n,i[n].bind(i))}class ce{static#t=NaN;static#e=null;static#i=NaN;static#n=null;static initializeAndAddPointerId(t){(ce.#e||=new Set).add(t)}static setPointer(t,e){ce.#t||=e,ce.#n??=t}static setTimeStamp(t){ce.#i=t}static isSamePointerId(t){return ce.#t===t}static isSamePointerIdOrRemove(t){return ce.#t===t?!0:(ce.#e?.delete(t),!1)}static isSamePointerType(t){return ce.#n===t}static isInitializedAndDifferentPointerType(t){return ce.#n!==null&&!ce.isSamePointerType(t)}static isSameTimeStamp(t){return ce.#i===t}static isUsingMultiplePointers(){return ce.#e?.size>=1}static clearPointerType(){ce.#n=null}static clearPointerIds(){ce.#t=NaN,ce.#e=null}static clearTimeStamp(){ce.#i=NaN}}class d5{#t=0;get id(){return`${Ah}${this.#t++}`}}class mE{#t=qM();#e=0;#i=null;static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),s=new Image;s.src=t;const r=s.decode().then(()=>(n.drawImage(s,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return Ht(this,"_isSVGFittingCanvas",r)}async#n(t,e){this.#i||=new Map;let n=this.#i.get(t);if(n===null)return null;if(n?.bitmap)return n.refCounter+=1,n;try{n||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let s;if(typeof e=="string"?(n.url=e,s=await qh(e,"blob")):e instanceof File?s=n.file=e:e instanceof Blob&&(s=e),s.type==="image/svg+xml"){const r=mE._isSVGFittingCanvas,a=new FileReader,c=new Image,u=new Promise((h,f)=>{c.onload=()=>{n.bitmap=c,n.isSvg=!0,h()},a.onload=async()=>{const m=n.svgUrl=a.result;c.src=await r?`${m}#svgView(preserveAspectRatio(none))`:m},c.onerror=a.onerror=f});a.readAsDataURL(s),await u}else n.bitmap=await createImageBitmap(s);n.refCounter=1}catch(s){Ft(s),n=null}return this.#i.set(t,n),n&&this.#i.set(n.id,n),n}async getFromFile(t){const{lastModified:e,name:n,size:s,type:r}=t;return this.#n(`${e}_${n}_${s}_${r}`,t)}async getFromUrl(t){return this.#n(t,t)}async getFromBlob(t,e){const n=await e;return this.#n(t,n)}async getFromId(t){this.#i||=new Map;const e=this.#i.get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:n}=e;return delete e.blobPromise,this.getFromBlob(e.id,n)}return this.getFromUrl(e.url)}getFromCanvas(t,e){this.#i||=new Map;let n=this.#i.get(t);if(n?.bitmap)return n.refCounter+=1,n;const s=new OffscreenCanvas(e.width,e.height);return s.getContext("2d").drawImage(e,0,0),n={bitmap:s.transferToImageBitmap(),id:`image_${this.#t}_${this.#e++}`,refCounter:1,isSvg:!1},this.#i.set(t,n),this.#i.set(n.id,n),n}getSvgUrl(t){const e=this.#i.get(t);return e?.isSvg?e.svgUrl:null}deleteId(t){this.#i||=new Map;const e=this.#i.get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;const{bitmap:n}=e;if(!e.url&&!e.file){const s=new OffscreenCanvas(n.width,n.height);s.getContext("bitmaprenderer").transferFromImageBitmap(n),e.blobPromise=s.convertToBlob()}n.close?.(),e.bitmap=null}isValidId(t){return t.startsWith(`image_${this.#t}_`)}}class f5{#t=[];#e=!1;#i;#n=-1;constructor(t=128){this.#i=t}add({cmd:t,undo:e,post:n,mustExec:s,type:r=NaN,overwriteIfSameType:a=!1,keepUndo:c=!1}){if(s&&t(),this.#e)return;const u={cmd:t,undo:e,post:n,type:r};if(this.#n===-1){this.#t.length>0&&(this.#t.length=0),this.#n=0,this.#t.push(u);return}if(a&&this.#t[this.#n].type===r){c&&(u.undo=this.#t[this.#n].undo),this.#t[this.#n]=u;return}const h=this.#n+1;h===this.#i?this.#t.splice(0,1):(this.#n=h,h<this.#t.length&&this.#t.splice(h)),this.#t.push(u)}undo(){if(this.#n===-1)return;this.#e=!0;const{undo:t,post:e}=this.#t[this.#n];t(),e?.(),this.#e=!1,this.#n-=1}redo(){if(this.#n<this.#t.length-1){this.#n+=1,this.#e=!0;const{cmd:t,post:e}=this.#t[this.#n];t(),e?.(),this.#e=!1}}hasSomethingToUndo(){return this.#n!==-1}hasSomethingToRedo(){return this.#n<this.#t.length-1}cleanType(t){if(this.#n!==-1){for(let e=this.#n;e>=0;e--)if(this.#t[e].type!==t){this.#t.splice(e+1,this.#n-e),this.#n=e;return}this.#t.length=0,this.#n=-1}}destroy(){this.#t=null}}class Yh{constructor(t){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=Pn.platform;for(const[n,s,r={}]of t)for(const a of n){const c=a.startsWith("mac+");e&&c?(this.callbacks.set(a.slice(4),{callback:s,options:r}),this.allKeys.add(a.split("+").at(-1))):!e&&!c&&(this.callbacks.set(a,{callback:s,options:r}),this.allKeys.add(a.split("+").at(-1)))}}#t(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e}exec(t,e){if(!this.allKeys.has(e.key))return;const n=this.callbacks.get(this.#t(e));if(!n)return;const{callback:s,options:{bubbles:r=!1,args:a=[],checker:c=null}}=n;c&&!c(t,e)||(s.bind(t,...a,e)(),r||Ue(e))}}class gE{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return o5(t),Ht(this,"_colors",t)}convert(t){const e=$h(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[n,s]of this._colors)if(s.every((r,a)=>r===e[a]))return gE._colorsMapping.get(n);return e}getHexCode(t){const e=this._colors.get(t);return e?Tt.makeHexColor(...e):t}}class No{#t=new AbortController;#e=null;#i=null;#n=new Map;#o=new Map;#r=null;#s=null;#a=null;#c=new f5;#l=null;#d=null;#h=null;#f=0;#g=new Set;#m=null;#u=null;#p=new Set;_editorUndoBar=null;#y=!1;#v=!1;#_=!1;#b=null;#S=null;#T=null;#I=null;#E=!1;#w=null;#P=new d5;#R=!1;#M=!1;#U=!1;#D=null;#k=null;#V=null;#L=null;#z=null;#C=qt.NONE;#A=new Set;#N=null;#B=null;#H=null;#W=null;#Y=null;#K={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#G=[0,0];#O=null;#$=null;#j=null;#Z=null;#F=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const t=No.prototype,e=a=>a.#$.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&a.hasSomethingToControl(),n=(a,{target:c})=>{if(c instanceof HTMLInputElement){const{type:u}=c;return u!=="text"&&u!=="number"}return!0},s=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return Ht(this,"_keyboardManager",new Yh([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],t.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:n}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(a,{target:c})=>!(c instanceof HTMLButtonElement)&&a.#$.contains(c)&&!a.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(a,{target:c})=>!(c instanceof HTMLButtonElement)&&a.#$.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-s,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-r,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[s,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[r,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-s],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-r],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,s],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,r],checker:e}]]))}constructor(t,e,n,s,r,a,c,u,h,f,m,y,T,S,b,C){const I=this._signal=this.#t.signal;this.#$=t,this.#j=e,this.#Z=n,this.#r=s,this.#l=r,this.#B=a,this.#Y=u,this._eventBus=c,c._on("editingaction",this.onEditingAction.bind(this),{signal:I}),c._on("pagechanging",this.onPageChanging.bind(this),{signal:I}),c._on("scalechanging",this.onScaleChanging.bind(this),{signal:I}),c._on("rotationchanging",this.onRotationChanging.bind(this),{signal:I}),c._on("setpreference",this.onSetPreference.bind(this),{signal:I}),c._on("switchannotationeditorparams",D=>this.updateParams(D.type,D.value),{signal:I}),window.addEventListener("pointerdown",()=>{this.#M=!0},{capture:!0,signal:I}),window.addEventListener("pointerup",()=>{this.#M=!1},{capture:!0,signal:I}),this.#ot(),this.#dt(),this.#et(),this.#s=u.annotationStorage,this.#b=u.filterFactory,this.#H=h,this.#I=f||null,this.#y=m,this.#v=y,this.#_=T,this.#z=S||null,this.viewParameters={realScale:Ac.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=b||null,this._supportsPinchToZoom=C!==!1,r?.setSidebarUiManager(this)}destroy(){this.#F?.resolve(),this.#F=null,this.#t?.abort(),this.#t=null,this._signal=null;for(const t of this.#o.values())t.destroy();this.#o.clear(),this.#n.clear(),this.#p.clear(),this.#L?.clear(),this.#e=null,this.#A.clear(),this.#c.destroy(),this.#r?.destroy(),this.#l?.destroy(),this.#B?.destroy(),this.#w?.hide(),this.#w=null,this.#V?.destroy(),this.#V=null,this.#i=null,this.#S&&(clearTimeout(this.#S),this.#S=null),this.#O&&(clearTimeout(this.#O),this.#O=null),this._editorUndoBar?.destroy(),this.#Y=null}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#z}get useNewAltTextFlow(){return this.#v}get useNewAltTextWhenAddingImage(){return this.#_}get hcmFilter(){return Ht(this,"hcmFilter",this.#H?this.#b.addHCMFilter(this.#H.foreground,this.#H.background):"none")}get direction(){return Ht(this,"direction",getComputedStyle(this.#$).direction)}get _highlightColors(){return Ht(this,"_highlightColors",this.#I?new Map(this.#I.split(",").map(t=>(t=t.split("=").map(e=>e.trim()),t[1]=t[1].toUpperCase(),t))):null)}get highlightColors(){const{_highlightColors:t}=this;if(!t)return Ht(this,"highlightColors",null);const e=new Map,n=!!this.#H;for(const[s,r]of t){const a=s.endsWith("_HCM");if(n&&a){e.set(s.replace("_HCM",""),r);continue}!n&&!a&&e.set(s,r)}return Ht(this,"highlightColors",e)}get highlightColorNames(){return Ht(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}getNonHCMColor(t){if(!this._highlightColors)return t;const e=this.highlightColorNames.get(t);return this._highlightColors.get(e)||t}getNonHCMColorName(t){return this.highlightColorNames.get(t)||t}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#h=t}setMainHighlightColorPicker(t){this.#V=t}editAltText(t,e=!1){this.#r?.editAltText(this,t,e)}hasCommentManager(){return!!this.#l}editComment(t,e,n,s){this.#l?.showDialog(this,t,e,n,s)}selectComment(t,e){this.#o.get(t)?.getEditorByUID(e)?.toggleComment(!0,!0)}updateComment(t){this.#l?.updateComment(t.getData())}updatePopupColor(t){this.#l?.updatePopupColor(t)}removeComment(t){this.#l?.removeComments([t.uid])}toggleComment(t,e,n=void 0){this.#l?.toggleCommentPopup(t,e,n)}makeCommentColor(t,e){return t&&this.#l?.makeCommentColor(t,e)||null}getCommentDialogElement(){return this.#l?.dialogElement||null}async waitForEditorsRendered(t){if(this.#o.has(t-1))return;const{resolve:e,promise:n}=Promise.withResolvers(),s=r=>{r.pageNumber===t&&(this._eventBus._off("editorsrendered",s),e())};this._eventBus.on("editorsrendered",s),await n}getSignature(t){this.#B?.getSignature({uiManager:this,editor:t})}get signatureManager(){return this.#B}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){switch(t){case"enableNewAltTextWhenAddingImage":this.#_=e;break}}onPageChanging({pageNumber:t}){this.#f=t-1}focusMainContainer(){this.#$.focus()}findParent(t,e){for(const n of this.#o.values()){const{x:s,y:r,width:a,height:c}=n.div.getBoundingClientRect();if(t>=s&&t<=s+a&&e>=r&&e<=r+c)return n}return null}disableUserSelect(t=!1){this.#j.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#p.add(t)}removeShouldRescale(t){this.#p.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*Ac.PDF_TO_CSS_UNITS;for(const e of this.#p)e.onScaleChanging();this.#h?.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}#Q({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#tt(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const n of this.#o.values())if(n.hasTextLayer(t))return n;return null}highlightSelection(t="",e=!1){const n=document.getSelection();if(!n||n.isCollapsed)return;const{anchorNode:s,anchorOffset:r,focusNode:a,focusOffset:c}=n,u=n.toString(),f=this.#Q(n).closest(".textLayer"),m=this.getSelectionBoxes(f);if(!m)return;n.empty();const y=this.#tt(f),T=this.#C===qt.NONE,S=()=>{const b=y?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:m,anchorNode:s,anchorOffset:r,focusNode:a,focusOffset:c,text:u});T&&this.showAllEditors("highlight",!0,!0),e&&b?.editComment()};if(T){this.switchToMode(qt.HIGHLIGHT,S);return}S()}commentSelection(t=""){this.highlightSelection(t,!0)}#st(){const t=document.getSelection();if(!t||t.isCollapsed)return;const n=this.#Q(t).closest(".textLayer"),s=this.getSelectionBoxes(n);s&&(this.#w||=new h5(this),this.#w.show(n,s,this.direction==="ltr"))}getAndRemoveDataFromAnnotationStorage(t){if(!this.#s)return null;const e=`${Ah}${t}`,n=this.#s.getRawValue(e);return n&&this.#s.remove(e),n}addToAnnotationStorage(t){!t.isEmpty()&&this.#s&&!this.#s.has(t.id)&&this.#s.setValue(t.id,t)}a11yAlert(t,e=null){const n=this.#Z;n&&(n.setAttribute("data-l10n-id",t),e?n.setAttribute("data-l10n-args",JSON.stringify(e)):n.removeAttribute("data-l10n-args"))}#rt(){const t=document.getSelection();if(!t||t.isCollapsed){this.#N&&(this.#w?.hide(),this.#N=null,this.#x({hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===this.#N)return;const s=this.#Q(t).closest(".textLayer");if(!s){this.#N&&(this.#w?.hide(),this.#N=null,this.#x({hasSelectedText:!1}));return}if(this.#w?.hide(),this.#N=e,this.#x({hasSelectedText:!0}),!(this.#C!==qt.HIGHLIGHT&&this.#C!==qt.NONE)&&(this.#C===qt.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#E=this.isShiftKeyDown,!this.isShiftKeyDown)){const r=this.#C===qt.HIGHLIGHT?this.#tt(s):null;if(r?.toggleDrawing(),this.#M){const a=new AbortController,c=this.combinedSignal(a),u=h=>{h.type==="pointerup"&&h.button!==0||(a.abort(),r?.toggleDrawing(!0),h.type==="pointerup"&&this.#X("main_toolbar"))};window.addEventListener("pointerup",u,{signal:c}),window.addEventListener("blur",u,{signal:c})}else r?.toggleDrawing(!0),this.#X("main_toolbar")}}#X(t=""){this.#C===qt.HIGHLIGHT?this.highlightSelection(t):this.#y&&this.#st()}#ot(){document.addEventListener("selectionchange",this.#rt.bind(this),{signal:this._signal})}#at(){if(this.#T)return;this.#T=new AbortController;const t=this.combinedSignal(this.#T);window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})}#lt(){this.#T?.abort(),this.#T=null}blur(){if(this.isShiftKeyDown=!1,this.#E&&(this.#E=!1,this.#X("main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of this.#A)if(e.div.contains(t)){this.#k=[e,t],e._focusEventsAllowed=!1;break}}focus(){if(!this.#k)return;const[t,e]=this.#k;this.#k=null,e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}#et(){if(this.#D)return;this.#D=new AbortController;const t=this.combinedSignal(this.#D);window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#ct(){this.#D?.abort(),this.#D=null}#ut(){if(this.#d)return;this.#d=new AbortController;const t=this.combinedSignal(this.#d);document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})}#ht(){this.#d?.abort(),this.#d=null}#dt(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#et(),this.setEditingState(!0)}removeEditListeners(){this.#ct(),this.setEditingState(!1)}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const n of this.#u)if(n.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const n of this.#u)if(n.isHandlingMimeForPasting(e.type)){n.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){if(t.preventDefault(),this.#e?.commitOrRemove(),!this.hasSelection)return;const e=[];for(const n of this.#A){const s=n.serialize(!0);s&&e.push(s)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const r of e.items)for(const a of this.#u)if(a.isHandlingMimeForPasting(r.type)){a.paste(r,this.currentLayer);return}let n=e.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(r){Ft(`paste: "${r.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();const s=this.currentLayer;try{const r=[];for(const u of n){const h=await s.deserialize(u);if(!h)return;r.push(h)}const a=()=>{for(const u of r)this.#nt(u);this.#it(r)},c=()=>{for(const u of r)u.remove()};this.addCommands({cmd:a,undo:c,mustExec:!0})}catch(r){Ft(`paste: "${r.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),this.#C!==qt.NONE&&!this.isEditorHandlingKeyboard&&No._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,this.#E&&(this.#E=!1,this.#X("main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}#x(t){Object.entries(t).some(([n,s])=>this.#K[n]!==s)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#K,t)}),this.#C===qt.HIGHLIGHT&&t.hasSelectedEditor===!1&&this.#q([[te.HIGHLIGHT_FREE,!0]]))}#q(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#at(),this.#ut(),this.#x({isEditing:this.#C!==qt.NONE,isEmpty:this.#J(),hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:this.#c.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#lt(),this.#ht(),this.#x({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#u){this.#u=t;for(const e of this.#u)this.#q(e.defaultPropertiesToUpdate)}}getId(){return this.#P.id}get currentLayer(){return this.#o.get(this.#f)}getLayer(t){return this.#o.get(t)}get currentPageIndex(){return this.#f}addLayer(t){this.#o.set(t.pageIndex,t),this.#R?t.enable():t.disable()}removeLayer(t){this.#o.delete(t.pageIndex)}async updateMode(t,e=null,n=!1,s=!1,r=!1){if(this.#C!==t&&!(this.#F&&(await this.#F.promise,!this.#F))){if(this.#F=Promise.withResolvers(),this.#h?.commitOrRemove(),this.#C===qt.POPUP&&this.#l?.hideSidebar(),this.#l?.destroyPopup(),this.#C=t,t===qt.NONE){this.setEditingState(!1),this.#pt();for(const a of this.#n.values())a.hideStandaloneCommentButton();this._editorUndoBar?.hide(),this.toggleComment(null),this.#F.resolve();return}for(const a of this.#n.values())a.addStandaloneCommentButton();t===qt.SIGNATURE&&await this.#B?.loadSignatures(),this.setEditingState(!0),await this.#ft(),this.unselectAll();for(const a of this.#o.values())a.updateMode(t);if(t===qt.POPUP){this.#i||=await this.#Y.getAnnotationsByType(new Set(this.#u.map(u=>u._editorType)));const a=new Set,c=[];for(const u of this.#n.values()){const{annotationElementId:h,hasComment:f,deleted:m}=u;h&&a.add(h),f&&!m&&c.push(u.getData())}for(const u of this.#i){const{id:h,popupRef:f,contentsObj:m}=u;f&&m?.str&&!a.has(h)&&!this.#g.has(h)&&c.push(u)}this.#l?.showSidebar(c)}if(!e){n&&this.addNewEditorFromKeyboard(),this.#F.resolve();return}for(const a of this.#n.values())a.uid===e?(this.setSelected(a),r?a.editComment():s?a.enterInEditMode():a.focus()):a.unselect();this.#F.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t.mode!==this.#C&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...t})}updateParams(t,e){if(this.#u){switch(t){case te.CREATE:this.currentLayer.addNewEditor(e);return;case te.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#W||=new Map).set(t,e),this.showAllEditors("highlight",e);break}if(this.hasSelection)for(const n of this.#A)n.updateParams(t,e);else for(const n of this.#u)n.updateDefaultParams(t,e)}}showAllEditors(t,e,n=!1){for(const r of this.#n.values())r.editorType===t&&r.show(e);(this.#W?.get(te.HIGHLIGHT_SHOW_ALL)??!0)!==e&&this.#q([[te.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(this.#U!==t){this.#U=t;for(const e of this.#o.values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}async#ft(){if(!this.#R){this.#R=!0;const t=[];for(const e of this.#o.values())t.push(e.enable());await Promise.all(t);for(const e of this.#n.values())e.enable()}}#pt(){if(this.unselectAll(),this.#R){this.#R=!1;for(const t of this.#o.values())t.disable();for(const t of this.#n.values())t.disable()}}*getEditors(t){for(const e of this.#n.values())e.pageIndex===t&&(yield e)}getEditor(t){return this.#n.get(t)}addEditor(t){this.#n.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#S&&clearTimeout(this.#S),this.#S=setTimeout(()=>{this.focusMainContainer(),this.#S=null},0)),this.#n.delete(t.id),t.annotationElementId&&this.#L?.delete(t.annotationElementId),this.unselect(t),(!t.annotationElementId||!this.#g.has(t.annotationElementId))&&this.#s?.remove(t.id)}addDeletedAnnotationElement(t){this.#g.add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return this.#g.has(t)}removeDeletedAnnotationElement(t){this.#g.delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}#nt(t){const e=this.#o.get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}setActiveEditor(t){this.#e!==t&&(this.#e=t,t&&this.#q(t.propertiesToUpdate))}get#mt(){let t=null;for(t of this.#A);return t}updateUI(t){this.#mt===t&&this.#q(t.propertiesToUpdate)}updateUIForDefaultProperties(t){this.#q(t.defaultPropertiesToUpdate)}toggleSelected(t){if(this.#A.has(t)){this.#A.delete(t),t.unselect(),this.#x({hasSelectedEditor:this.hasSelection});return}this.#A.add(t),t.select(),this.#q(t.propertiesToUpdate),this.#x({hasSelectedEditor:!0})}setSelected(t){this.updateToolbar({mode:t.mode,editId:t.uid}),this.#h?.commitOrRemove();for(const e of this.#A)e!==t&&e.unselect();this.#A.clear(),this.#A.add(t),t.select(),this.#q(t.propertiesToUpdate),this.#x({hasSelectedEditor:!0})}isSelected(t){return this.#A.has(t)}get firstSelectedEditor(){return this.#A.values().next().value}unselect(t){t.unselect(),this.#A.delete(t),this.#x({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#A.size!==0}get isEnterHandled(){return this.#A.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#c.undo(),this.#x({hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#J()}),this._editorUndoBar?.hide()}redo(){this.#c.redo(),this.#x({hasSomethingToUndo:!0,hasSomethingToRedo:this.#c.hasSomethingToRedo(),isEmpty:this.#J()})}addCommands(t){this.#c.add(t),this.#x({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#J()})}cleanUndoStack(t){this.#c.cleanType(t)}#J(){if(this.#n.size===0)return!0;if(this.#n.size===1)for(const t of this.#n.values())return t.isEmpty();return!1}delete(){this.commitOrRemove();const t=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...this.#A],n=()=>{this._editorUndoBar?.show(s,e.length===1?e[0].editorType:e.length);for(const r of e)r.remove()},s=()=>{for(const r of e)this.#nt(r)};this.addCommands({cmd:n,undo:s,mustExec:!0})}commitOrRemove(){this.#e?.commitOrRemove()}hasSomethingToControl(){return this.#e||this.hasSelection}#it(t){for(const e of this.#A)e.unselect();this.#A.clear();for(const e of t)e.isEmpty()||(this.#A.add(e),e.select());this.#x({hasSelectedEditor:this.hasSelection})}selectAll(){for(const t of this.#A)t.commit();this.#it(this.#n.values())}unselectAll(){if(!(this.#e&&(this.#e.commitOrRemove(),this.#C!==qt.NONE))&&!this.#h?.commitOrRemove()&&this.hasSelection){for(const t of this.#A)t.unselect();this.#A.clear(),this.#x({hasSelectedEditor:!1})}}translateSelectedEditors(t,e,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;this.#G[0]+=t,this.#G[1]+=e;const[s,r]=this.#G,a=[...this.#A],c=1e3;this.#O&&clearTimeout(this.#O),this.#O=setTimeout(()=>{this.#O=null,this.#G[0]=this.#G[1]=0,this.addCommands({cmd:()=>{for(const u of a)this.#n.has(u.id)&&(u.translateInPage(s,r),u.translationDone())},undo:()=>{for(const u of a)this.#n.has(u.id)&&(u.translateInPage(-s,-r),u.translationDone())},mustExec:!1})},c);for(const u of a)u.translateInPage(t,e),u.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#m=new Map;for(const t of this.#A)this.#m.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#m)return!1;this.disableUserSelect(!1);const t=this.#m;this.#m=null;let e=!1;for(const[{x:s,y:r,pageIndex:a},c]of t)c.newX=s,c.newY=r,c.newPageIndex=a,e||=s!==c.savedX||r!==c.savedY||a!==c.savedPageIndex;if(!e)return!1;const n=(s,r,a,c)=>{if(this.#n.has(s.id)){const u=this.#o.get(c);u?s._setParentAndPosition(u,r,a):(s.pageIndex=c,s.x=r,s.y=a)}};return this.addCommands({cmd:()=>{for(const[s,{newX:r,newY:a,newPageIndex:c}]of t)n(s,r,a,c)},undo:()=>{for(const[s,{savedX:r,savedY:a,savedPageIndex:c}]of t)n(s,r,a,c)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(this.#m)for(const n of this.#m.keys())n.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#A.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#e===t}getActive(){return this.#e}getMode(){return this.#C}isEditingMode(){return this.#C!==qt.NONE}get imageManager(){return Ht(this,"imageManager",new mE)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let h=0,f=e.rangeCount;h<f;h++)if(!t.contains(e.getRangeAt(h).commonAncestorContainer))return null;const{x:n,y:s,width:r,height:a}=t.getBoundingClientRect();let c;switch(t.getAttribute("data-main-rotation")){case"90":c=(h,f,m,y)=>({x:(f-s)/a,y:1-(h+m-n)/r,width:y/a,height:m/r});break;case"180":c=(h,f,m,y)=>({x:1-(h+m-n)/r,y:1-(f+y-s)/a,width:m/r,height:y/a});break;case"270":c=(h,f,m,y)=>({x:1-(f+y-s)/a,y:(h-n)/r,width:y/a,height:m/r});break;default:c=(h,f,m,y)=>({x:(h-n)/r,y:(f-s)/a,width:m/r,height:y/a});break}const u=[];for(let h=0,f=e.rangeCount;h<f;h++){const m=e.getRangeAt(h);if(!m.collapsed)for(const{x:y,y:T,width:S,height:b}of m.getClientRects())S===0||b===0||u.push(c(y,T,S,b))}return u.length===0?null:u}addChangedExistingAnnotation({annotationElementId:t,id:e}){(this.#a||=new Map).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){this.#a?.delete(t)}renderAnnotationElement(t){const e=this.#a?.get(t.data.id);if(!e)return;const n=this.#s.getRawValue(e);n&&(this.#C===qt.NONE&&!n.hasBeenModified||n.renderAnnotationElement(t))}setMissingCanvas(t,e,n){const s=this.#L?.get(t);s&&(s.setCanvas(e,n),this.#L.delete(t))}addMissingCanvas(t,e){(this.#L||=new Map).set(t,e)}}class Is{#t=null;#e=!1;#i=null;#n=null;#o=null;#r=null;#s=!1;#a=null;#c=null;#l=null;#d=null;#h=!1;static#f=null;static _l10n=null;constructor(t){this.#c=t,this.#h=t._uiManager.useNewAltTextFlow,Is.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){Is._l10n??=t}async render(){const t=this.#i=document.createElement("button");t.className="altText",t.tabIndex="0";const e=this.#n=document.createElement("span");t.append(e),this.#h?(t.classList.add("new"),t.setAttribute("data-l10n-id",Is.#f.missing),e.setAttribute("data-l10n-id",Is.#f["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const n=this.#c._uiManager._signal;t.addEventListener("contextmenu",Fi,{signal:n}),t.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:n});const s=r=>{r.preventDefault(),this.#c._uiManager.editAltText(this.#c),this.#h&&this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#g}})};return t.addEventListener("click",s,{capture:!0,signal:n}),t.addEventListener("keydown",r=>{r.target===t&&r.key==="Enter"&&(this.#s=!0,s(r))},{signal:n}),await this.#m(),t}get#g(){return this.#t&&"added"||this.#t===null&&this.guessedText&&"review"||"missing"}finish(){this.#i&&(this.#i.focus({focusVisible:this.#s}),this.#s=!1)}isEmpty(){return this.#h?this.#t===null:!this.#t&&!this.#e}hasData(){return this.#h?this.#t!==null||!!this.#l:this.isEmpty()}get guessedText(){return this.#l}async setGuessedText(t){this.#t===null&&(this.#l=t,this.#d=await Is._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t}),this.#m())}toggleAltTextBadge(t=!1){if(!this.#h||this.#t){this.#a?.remove(),this.#a=null;return}if(!this.#a){const e=this.#a=document.createElement("div");e.className="noAltTextBadge",this.#c.div.append(e)}this.#a.classList.toggle("hidden",!t)}serialize(t){let e=this.#t;return!t&&this.#l===e&&(e=this.#d),{altText:e,decorative:this.#e,guessedText:this.#l,textWithDisclaimer:this.#d}}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:t,decorative:e,guessedText:n,textWithDisclaimer:s,cancel:r=!1}){n&&(this.#l=n,this.#d=s),!(this.#t===t&&this.#e===e)&&(r||(this.#t=t,this.#e=e),this.#m())}toggle(t=!1){this.#i&&(!t&&this.#r&&(clearTimeout(this.#r),this.#r=null),this.#i.disabled=!t)}shown(){this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#g}})}destroy(){this.#i?.remove(),this.#i=null,this.#n=null,this.#o=null,this.#a?.remove(),this.#a=null}async#m(){const t=this.#i;if(!t)return;if(this.#h){if(t.classList.toggle("done",!!this.#t),t.setAttribute("data-l10n-id",Is.#f[this.#g]),this.#n?.setAttribute("data-l10n-id",Is.#f[`${this.#g}-label`]),!this.#t){this.#o?.remove();return}}else{if(!this.#t&&!this.#e){t.classList.remove("done"),this.#o?.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=this.#o;if(!e){this.#o=e=document.createElement("span"),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${this.#c.id}`;const s=100,r=this.#c._uiManager._signal;r.addEventListener("abort",()=>{clearTimeout(this.#r),this.#r=null},{once:!0}),t.addEventListener("mouseenter",()=>{this.#r=setTimeout(()=>{this.#r=null,this.#o.classList.add("show"),this.#c._reportTelemetry({action:"alt_text_tooltip"})},s)},{signal:r}),t.addEventListener("mouseleave",()=>{this.#r&&(clearTimeout(this.#r),this.#r=null),this.#o?.classList.remove("show")},{signal:r})}this.#e?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=this.#t),e.parentNode||t.append(e),this.#c.getElementForAltText()?.setAttribute("aria-describedby",e.id)}}class If{#t=null;#e=null;#i=!1;#n=null;#o=null;#r=null;#s=null;#a=null;#c=!1;#l=null;constructor(t){this.#n=t}renderForToolbar(){const t=this.#e=document.createElement("button");return t.className="comment",this.#d(t,!1)}renderForStandalone(){const t=this.#t=document.createElement("button");t.className="annotationCommentButton";const e=this.#n.commentButtonPosition;if(e){const{style:n}=t;n.insetInlineEnd=`calc(${100*(this.#n._uiManager.direction==="ltr"?1-e[0]:e[0])}% - var(--comment-button-dim))`,n.top=`calc(${100*e[1]}% - var(--comment-button-dim))`;const s=this.#n.commentButtonColor;s&&(n.backgroundColor=s)}return this.#d(t,!0)}focusButton(){setTimeout(()=>{(this.#t??this.#e)?.focus()},0)}onUpdatedColor(){if(!this.#t)return;const t=this.#n.commentButtonColor;t&&(this.#t.style.backgroundColor=t),this.#n._uiManager.updatePopupColor(this.#n)}get commentButtonWidth(){return(this.#t?.getBoundingClientRect().width??0)/this.#n.parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(this.#l)return this.#l;if(!this.#t)return null;const{x:t,y:e,height:n}=this.#t.getBoundingClientRect(),{x:s,y:r,width:a,height:c}=this.#n.parent.boundingClientRect;return[(t-s)/a,(e+n-r)/c]}set commentPopupPositionInLayer(t){this.#l=t}hasDefaultPopupPosition(){return this.#l===null}removeStandaloneCommentButton(){this.#t?.remove(),this.#t=null}removeToolbarCommentButton(){this.#e?.remove(),this.#e=null}setCommentButtonStates({selected:t,hasPopup:e}){this.#t&&(this.#t.classList.toggle("selected",t),this.#t.ariaExpanded=e)}#d(t,e){if(!this.#n._uiManager.hasCommentManager())return null;t.tabIndex="0",t.ariaHasPopup="dialog",e?(t.ariaControls="commentPopup",t.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(t.ariaControlsElements=[this.#n._uiManager.getCommentDialogElement()],t.setAttribute("data-l10n-id","pdfjs-editor-add-comment-button"));const n=this.#n._uiManager._signal;if(!(n instanceof AbortSignal)||n.aborted)return t;t.addEventListener("contextmenu",Fi,{signal:n}),e&&(t.addEventListener("focusin",r=>{this.#n._focusEventsAllowed=!1,Ue(r)},{capture:!0,signal:n}),t.addEventListener("focusout",r=>{this.#n._focusEventsAllowed=!0,Ue(r)},{capture:!0,signal:n})),t.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:n});const s=r=>{r.preventDefault(),t===this.#e?this.edit():this.#n.toggleComment(!0)};return t.addEventListener("click",s,{capture:!0,signal:n}),t.addEventListener("keydown",r=>{r.target===t&&r.key==="Enter"&&(this.#i=!0,s(r))},{signal:n}),t.addEventListener("pointerenter",()=>{this.#n.toggleComment(!1,!0)},{signal:n}),t.addEventListener("pointerleave",()=>{this.#n.toggleComment(!1,!1)},{signal:n}),t}edit(t){const e=this.commentPopupPositionInLayer;let n,s;if(e)[n,s]=e;else{[n,s]=this.#n.commentButtonPosition;const{width:f,height:m,x:y,y:T}=this.#n;n=y+n*f,s=T+s*m}const r=this.#n.parent.boundingClientRect,{x:a,y:c,width:u,height:h}=r;this.#n._uiManager.editComment(this.#n,a+n*u,c+s*h,{...t,parentDimensions:r})}finish(){this.#e&&(this.#e.focus({focusVisible:this.#i}),this.#i=!1)}isDeleted(){return this.#c||this.#s===""}isEmpty(){return this.#s===null}hasBeenEdited(){return this.isDeleted()||this.#s!==this.#o}serialize(){return this.data}get data(){return{text:this.#s,richText:this.#r,date:this.#a,deleted:this.isDeleted()}}set data(t){if(t!==this.#s&&(this.#r=null),t===null){this.#s="",this.#c=!0;return}this.#s=t,this.#a=new Date,this.#c=!1}setInitialText(t,e=null){this.#o=t,this.data=t,this.#a=null,this.#r=e}shown(){}destroy(){this.#e?.remove(),this.#e=null,this.#t?.remove(),this.#t=null,this.#s="",this.#r=null,this.#a=null,this.#n=null,this.#i=!1,this.#c=!1}}class gm{#t;#e=!1;#i=null;#n;#o;#r;#s;#a=null;#c;#l=null;#d;#h=null;constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:n=null,onPinchStart:s=null,onPinching:r=null,onPinchEnd:a=null,signal:c}){this.#t=t,this.#i=n,this.#n=e,this.#o=s,this.#r=r,this.#s=a,this.#d=new AbortController,this.#c=AbortSignal.any([c,this.#d.signal]),t.addEventListener("touchstart",this.#f.bind(this),{passive:!1,signal:this.#c})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/Vs.pixelRatio}#f(t){if(this.#n?.())return;if(t.touches.length===1){if(this.#a)return;const s=this.#a=new AbortController,r=AbortSignal.any([this.#c,s.signal]),a=this.#t,c={capture:!0,signal:r,passive:!1},u=h=>{h.pointerType==="touch"&&(this.#a?.abort(),this.#a=null)};a.addEventListener("pointerdown",h=>{h.pointerType==="touch"&&(Ue(h),u(h))},c),a.addEventListener("pointerup",u,c),a.addEventListener("pointercancel",u,c);return}if(!this.#h){this.#h=new AbortController;const s=AbortSignal.any([this.#c,this.#h.signal]),r=this.#t,a={signal:s,capture:!1,passive:!1};r.addEventListener("touchmove",this.#g.bind(this),a);const c=this.#m.bind(this);r.addEventListener("touchend",c,a),r.addEventListener("touchcancel",c,a),a.capture=!0,r.addEventListener("pointerdown",Ue,a),r.addEventListener("pointermove",Ue,a),r.addEventListener("pointercancel",Ue,a),r.addEventListener("pointerup",Ue,a),this.#o?.()}if(Ue(t),t.touches.length!==2||this.#i?.()){this.#l=null;return}let[e,n]=t.touches;e.identifier>n.identifier&&([e,n]=[n,e]),this.#l={touch0X:e.screenX,touch0Y:e.screenY,touch1X:n.screenX,touch1Y:n.screenY}}#g(t){if(!this.#l||t.touches.length!==2)return;Ue(t);let[e,n]=t.touches;e.identifier>n.identifier&&([e,n]=[n,e]);const{screenX:s,screenY:r}=e,{screenX:a,screenY:c}=n,u=this.#l,{touch0X:h,touch0Y:f,touch1X:m,touch1Y:y}=u,T=m-h,S=y-f,b=a-s,C=c-r,I=Math.hypot(b,C)||1,D=Math.hypot(T,S)||1;if(!this.#e&&Math.abs(D-I)<=gm.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(u.touch0X=s,u.touch0Y=r,u.touch1X=a,u.touch1Y=c,!this.#e){this.#e=!0;return}const P=[(s+a)/2,(r+c)/2];this.#r?.(P,D,I)}#m(t){t.touches.length>=2||(this.#h&&(this.#h.abort(),this.#h=null,this.#s?.()),this.#l&&(Ue(t),this.#l=null,this.#e=!1))}destroy(){this.#d?.abort(),this.#d=null,this.#a?.abort(),this.#a=null}}class Rt{#t=null;#e=null;#i=null;#n=null;#o=null;#r=!1;#s=null;#a="";#c=null;#l=null;#d=null;#h=null;#f=null;#g="";#m=!1;#u=null;#p=!1;#y=!1;#v=!1;#_=null;#b=0;#S=0;#T=null;#I=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#E=!1;#w=Rt._zIndex++;static _borderLineWidth=-1;static _colorManager=new gE;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const t=Rt.prototype._resizeWithKeyboard,e=No.TRANSLATE_SMALL,n=No.TRANSLATE_BIG;return Ht(this,"_resizerKeyboardManager",new Yh([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,n]}],[["Escape","mac+Escape"],Rt.prototype._stopResizingWithKeyboard]]))}constructor(t){this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null,this.annotationElementId=t.annotationElementId||null,this.creationDate=t.creationDate||new Date,this.modificationDate=t.modificationDate||null,this.canAddComment=!0;const{rotation:e,rawDims:{pageWidth:n,pageHeight:s,pageX:r,pageY:a}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,s],this.pageTranslation=[r,a];const[c,u]=this.parentDimensions;this.x=t.x/c,this.y=t.y/u,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return Ht(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new p5({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(Rt._l10n??=t,Rt._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),Rt._borderLineWidth!==-1)return;const n=getComputedStyle(document.documentElement);Rt._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){Ee("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#E}set _isDraggable(t){this.#E=t,this.div?.classList.toggle("draggable",t)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#w}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):(this.#O(),this.#h?.remove(),this.#h=null),this.parent=t}focusin(t){this._focusEventsAllowed&&(this.#m?this.#m=!1:this.parent.setSelected(this))}focusout(t){!this._focusEventsAllowed||!this.isAttachedToDOM||t.relatedTarget?.closest(`#${this.id}`)||(t.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,n,s){const[r,a]=this.parentDimensions;[n,s]=this.screenToPageTranslation(n,s),this.x=(t+n)/r,this.y=(e+s)/a,this.fixAndSetPosition()}_moveAfterPaste(t,e){const[n,s]=this.parentDimensions;this.setAt(t*n,e*s,this.width*n,this.height*s),this._onTranslated()}#P([t,e],n,s){[n,s]=this.screenToPageTranslation(n,s),this.x+=n/t,this.y+=s/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(t,e){this.#P(this.parentDimensions,t,e)}translateInPage(t,e){this.#u||=[this.x,this.y,this.width,this.height],this.#P(this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(t,e){this.#u||=[this.x,this.y,this.width,this.height];const{div:n,parentDimensions:[s,r]}=this;if(this.x+=t/s,this.y+=e/r,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:m,y}=this.div.getBoundingClientRect();this.parent.findNewParent(this,m,y)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:a,y:c}=this;const[u,h]=this.getBaseTranslation();a+=u,c+=h;const{style:f}=n;f.left=`${(100*a).toFixed(2)}%`,f.top=`${(100*c).toFixed(2)}%`,this._onTranslating(a,c),n.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!this.#u&&(this.#u[0]!==this.x||this.#u[1]!==this.y)}get _hasBeenResized(){return!!this.#u&&(this.#u[2]!==this.width||this.#u[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:n}=Rt,s=n/t,r=n/e;switch(this.rotation){case 90:return[-s,r];case 180:return[s,r];case 270:return[s,-r];default:return[-s,-r]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[n,s]}=this;let{x:r,y:a,width:c,height:u}=this;if(c*=n,u*=s,r*=n,a*=s,this._mustFixPosition)switch(t){case 0:r=Xn(r,0,n-c),a=Xn(a,0,s-u);break;case 90:r=Xn(r,0,n-u),a=Xn(a,c,s);break;case 180:r=Xn(r,c,n),a=Xn(a,u,s);break;case 270:r=Xn(r,u,n),a=Xn(a,0,s-c);break}this.x=r/=n,this.y=a/=s;const[h,f]=this.getBaseTranslation();r+=h,a+=f,e.left=`${(100*r).toFixed(2)}%`,e.top=`${(100*a).toFixed(2)}%`,this.moveInDOM()}static#R(t,e,n){switch(n){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}screenToPageTranslation(t,e){return Rt.#R(t,e,this.parentRotation)}pageTranslationToScreen(t,e){return Rt.#R(t,e,360-this.parentRotation)}#M(t){switch(t){case 90:{const[e,n]=this.pageDimensions;return[0,-e/n,n/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,n]=this.pageDimensions;return[0,e/n,-n/e,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,n]}=this;return[e*t,n*t]}setDims(){const{div:{style:t},width:e,height:n}=this;t.width=`${(100*e).toFixed(2)}%`,t.height=`${(100*n).toFixed(2)}%`}getInitialTranslation(){return[0,0]}#U(){if(this.#c)return;this.#c=document.createElement("div"),this.#c.classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const n of t){const s=document.createElement("div");this.#c.append(s),s.classList.add("resizer",n),s.setAttribute("data-resizer-name",n),s.addEventListener("pointerdown",this.#D.bind(this,n),{signal:e}),s.addEventListener("contextmenu",Fi,{signal:e}),s.tabIndex=-1}this.div.prepend(this.#c)}#D(t,e){e.preventDefault();const{isMac:n}=Pn.platform;if(e.button!==0||e.ctrlKey&&n)return;this.#i?.toggle(!1);const s=this._isDraggable;this._isDraggable=!1,this.#l=[e.screenX,e.screenY];const r=new AbortController,a=this._uiManager.combinedSignal(r);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#L.bind(this,t),{passive:!0,capture:!0,signal:a}),window.addEventListener("touchmove",Ue,{passive:!1,signal:a}),window.addEventListener("contextmenu",Fi,{signal:a}),this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const c=this.parent.div.style.cursor,u=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const h=()=>{r.abort(),this.parent.togglePointerEvents(!0),this.#i?.toggle(!0),this._isDraggable=s,this.parent.div.style.cursor=c,this.div.style.cursor=u,this.#V()};window.addEventListener("pointerup",h,{signal:a}),window.addEventListener("blur",h,{signal:a})}#k(t,e,n,s){this.width=n,this.height=s,this.x=t,this.y=e,this.setDims(),this.fixAndSetPosition(),this._onResized()}_onResized(){}#V(){if(!this.#d)return;const{savedX:t,savedY:e,savedWidth:n,savedHeight:s}=this.#d;this.#d=null;const r=this.x,a=this.y,c=this.width,u=this.height;r===t&&a===e&&c===n&&u===s||this.addCommands({cmd:this.#k.bind(this,r,a,c,u),undo:this.#k.bind(this,t,e,n,s),mustExec:!0})}static _round(t){return Math.round(t*1e4)/1e4}#L(t,e){const[n,s]=this.parentDimensions,r=this.x,a=this.y,c=this.width,u=this.height,h=Rt.MIN_SIZE/n,f=Rt.MIN_SIZE/s,m=this.#M(this.rotation),y=(W,nt)=>[m[0]*W+m[2]*nt,m[1]*W+m[3]*nt],T=this.#M(360-this.rotation),S=(W,nt)=>[T[0]*W+T[2]*nt,T[1]*W+T[3]*nt];let b,C,I=!1,D=!1;switch(t){case"topLeft":I=!0,b=(W,nt)=>[0,0],C=(W,nt)=>[W,nt];break;case"topMiddle":b=(W,nt)=>[W/2,0],C=(W,nt)=>[W/2,nt];break;case"topRight":I=!0,b=(W,nt)=>[W,0],C=(W,nt)=>[0,nt];break;case"middleRight":D=!0,b=(W,nt)=>[W,nt/2],C=(W,nt)=>[0,nt/2];break;case"bottomRight":I=!0,b=(W,nt)=>[W,nt],C=(W,nt)=>[0,0];break;case"bottomMiddle":b=(W,nt)=>[W/2,nt],C=(W,nt)=>[W/2,0];break;case"bottomLeft":I=!0,b=(W,nt)=>[0,nt],C=(W,nt)=>[W,0];break;case"middleLeft":D=!0,b=(W,nt)=>[0,nt/2],C=(W,nt)=>[W,nt/2];break}const P=b(c,u),H=C(c,u);let F=y(...H);const G=Rt._round(r+F[0]),N=Rt._round(a+F[1]);let x=1,k=1,V,U;if(e.fromKeyboard)({deltaX:V,deltaY:U}=e);else{const{screenX:W,screenY:nt}=e,[ft,xt]=this.#l;[V,U]=this.screenToPageTranslation(W-ft,nt-xt),this.#l[0]=W,this.#l[1]=nt}if([V,U]=S(V/n,U/s),I){const W=Math.hypot(c,u);x=k=Math.max(Math.min(Math.hypot(H[0]-P[0]-V,H[1]-P[1]-U)/W,1/c,1/u),h/c,f/u)}else D?x=Xn(Math.abs(H[0]-P[0]-V),h,1)/c:k=Xn(Math.abs(H[1]-P[1]-U),f,1)/u;const $=Rt._round(c*x),B=Rt._round(u*k);F=y(...C($,B));const vt=G-F[0],It=N-F[1];this.#u||=[this.x,this.y,this.width,this.height],this.width=$,this.height=B,this.x=vt,this.y=It,this.setDims(),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#i?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#y)return this._editToolbar;this._editToolbar=new dh(this),this.div.append(this._editToolbar.render());const{toolbarButtons:t}=this;if(t)for(const[e,n]of t)await this._editToolbar.addButton(e,n);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){this._editToolbar?.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){this._editToolbar?.removeButton("comment")}removeEditToolbar(){this._editToolbar?.remove(),this._editToolbar=null,this.#i?.destroy()}addContainer(t){const e=this._editToolbar?.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#i||(Is.initialize(Rt._l10n),this.#i=new Is(this),this.#t&&(this.#i.data=this.#t,this.#t=null)),this.#i}get altTextData(){return this.#i?.data}set altTextData(t){this.#i&&(this.#i.data=t)}get guessedAltText(){return this.#i?.guessedText}async setGuessedAltText(t){await this.#i?.setGuessedText(t)}serializeAltText(t){return this.#i?.serialize(t)}hasAltText(){return!!this.#i&&!this.#i.isEmpty()}hasAltTextData(){return this.#i?.hasData()??!1}focusCommentButton(){this.#n?.focusButton()}addCommentButton(){return this.canAddComment?this.#n||=new If(this):null}addStandaloneCommentButton(){if(this._uiManager.hasCommentManager()){if(this.#o){this._uiManager.isEditingMode()&&this.#o.classList.remove("hidden");return}this.hasComment&&(this.#o=this.#n.renderForStandalone(),this.div.append(this.#o))}}removeStandaloneCommentButton(){this.#n.removeStandaloneCommentButton(),this.#o=null}hideStandaloneCommentButton(){this.#o?.classList.add("hidden")}get comment(){const{data:{richText:t,text:e,date:n,deleted:s}}=this.#n;return{text:e,richText:t,date:n,deleted:s,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(t){this.#n||=new If(this),this.#n.data=t,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:t,popupRef:e,richText:n}){if(!e||(this.#n||=new If(this),this.#n.setInitialText(t,n),!this.annotationElementId))return;const s=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);s&&this.updateFromAnnotationLayer(s)}get hasEditedComment(){return this.#n?.hasBeenEdited()}get hasDeletedComment(){return this.#n?.isDeleted()}get hasComment(){return!!this.#n&&!this.#n.isEmpty()&&!this.#n.isDeleted()}async editComment(t){this.#n||=new If(this),this.#n.edit(t)}toggleComment(t,e=void 0){this.hasComment&&this._uiManager.toggleComment(this,t,e)}setSelectedCommentButton(t){this.#n.setSelectedButton(t)}addComment(t){if(this.hasEditedComment){const[,,,s]=t.rect,[r]=this.pageDimensions,[a]=this.pageTranslation,c=a+r+1,u=s-100,h=c+180;t.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[c,u,h,s]}}}updateFromAnnotationLayer({popup:{contents:t,deleted:e}}){this.#n.data=e?null:t}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){const t=this.div=document.createElement("div");t.setAttribute("data-editor-rotation",(360-this.rotation)%360),t.className=this.name,t.setAttribute("id",this.id),t.tabIndex=this.#r?-1:0,t.setAttribute("role","application"),this.defaultL10nId&&t.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||t.classList.add("hidden"),this.setInForeground(),this.#H();const[e,n]=this.parentDimensions;this.parentRotation%180!==0&&(t.style.maxWidth=`${(100*n/e).toFixed(2)}%`,t.style.maxHeight=`${(100*e/n).toFixed(2)}%`);const[s,r]=this.getInitialTranslation();return this.translate(s,r),KM(this,t,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#I||=new gm({container:t,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#z.bind(this),onPinching:this.#C.bind(this),onPinchEnd:this.#A.bind(this),signal:this._uiManager._signal})),this.addStandaloneCommentButton(),this._uiManager._editorUndoBar?.hide(),t}#z(){this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#i?.toggle(!1),this.parent.togglePointerEvents(!1)}#C(t,e,n){let r=.7*(n/e)+1-.7;if(r===1)return;const a=this.#M(this.rotation),c=(G,N)=>[a[0]*G+a[2]*N,a[1]*G+a[3]*N],[u,h]=this.parentDimensions,f=this.x,m=this.y,y=this.width,T=this.height,S=Rt.MIN_SIZE/u,b=Rt.MIN_SIZE/h;r=Math.max(Math.min(r,1/y,1/T),S/y,b/T);const C=Rt._round(y*r),I=Rt._round(T*r);if(C===y&&I===T)return;this.#u||=[f,m,y,T];const D=c(y/2,T/2),P=Rt._round(f+D[0]),H=Rt._round(m+D[1]),F=c(C/2,I/2);this.x=P-F[0],this.y=H-F[1],this.width=C,this.height=I,this.setDims(),this.fixAndSetPosition(),this._onResizing()}#A(){this.#i?.toggle(!0),this.parent.togglePointerEvents(!0),this.#V()}pointerdown(t){const{isMac:e}=Pn.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(this.#m=!0,this._isDraggable){this.#B(t);return}this.#N(t)}#N(t){const{isMac:e}=Pn.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}#B(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let n=!1;const s=new AbortController,r=this._uiManager.combinedSignal(s),a={capture:!0,passive:!1,signal:r},c=h=>{s.abort(),this.#s=null,this.#m=!1,this._uiManager.endDragSession()||this.#N(h),n&&this._onStopDragging()};e&&(this.#b=t.clientX,this.#S=t.clientY,this.#s=t.pointerId,this.#a=t.pointerType,window.addEventListener("pointermove",h=>{n||(n=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:f,clientY:m,pointerId:y}=h;if(y!==this.#s){Ue(h);return}const[T,S]=this.screenToPageTranslation(f-this.#b,m-this.#S);this.#b=f,this.#S=m,this._uiManager.dragSelectedEditors(T,S)},a),window.addEventListener("touchmove",Ue,a),window.addEventListener("pointerdown",h=>{h.pointerType===this.#a&&(this.#I||h.isPrimary)&&c(h),Ue(h)},a));const u=h=>{if(!this.#s||this.#s===h.pointerId){c(h);return}Ue(h)};window.addEventListener("pointerup",u,{signal:r}),window.addEventListener("blur",u,{signal:r})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#_&&clearTimeout(this.#_),this.#_=setTimeout(()=>{this.#_=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(t,e,n){t.changeParent(this),this.x=e,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,n=this.rotation){const s=this.parentScale,[r,a]=this.pageDimensions,[c,u]=this.pageTranslation,h=t/s,f=e/s,m=this.x*r,y=this.y*a,T=this.width*r,S=this.height*a;switch(n){case 0:return[m+h+c,a-y-f-S+u,m+h+T+c,a-y-f+u];case 90:return[m+f+c,a-y+h+u,m+f+S+c,a-y+h+T+u];case 180:return[m-h-T+c,a-y+f+u,m-h+c,a-y+f+S+u];case 270:return[m-f-S+c,a-y-h-T+u,m-f+c,a-y-h+u];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[n,s,r,a]=t,c=r-n,u=a-s;switch(this.rotation){case 0:return[n,e-a,c,u];case 90:return[n,e-s,u,c];case 180:return[r,e-s,c,u];case 270:return[r,e-a,u,c];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&Rt._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){this.#n?.onUpdatedColor()}getData(){const{comment:{text:t,color:e,date:n,opacity:s,deleted:r,richText:a},uid:c,pageIndex:u,creationDate:h,modificationDate:f}=this;return{id:c,pageIndex:u,rect:this.getPDFRect(),richText:a,contentsObj:{str:t},creationDate:h,modificationDate:n||f,popupRef:!r,color:e,opacity:s}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#y=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#y=!1,!0):!1}isInEditMode(){return this.#y}shouldGetKeyboardEvents(){return this.#v}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:n,right:s}=this.getClientDimensions(),{innerHeight:r,innerWidth:a}=window;return e<a&&s>0&&t<r&&n>0}#H(){if(this.#f||!this.div)return;this.#f=new AbortController;const t=this._uiManager.combinedSignal(this.#f);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})}rebuild(){this.#H()}rotate(t){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(t=!1,e=null){return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:this._initialData?.popupRef||""}}static async deserialize(t,e,n){const s=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:n,annotationElementId:t.annotationElementId,creationDate:t.creationDate,modificationDate:t.modificationDate});s.rotation=t.rotation,s.#t=t.accessibilityData,s._isCopy=t.isCopy||!1;const[r,a]=s.pageDimensions,[c,u,h,f]=s.getRectInCurrentCoords(t.rect,a);return s.x=c/r,s.y=u/a,s.width=h/r,s.height=f/a,s}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#f?.abort(),this.#f=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.hideCommentPopup(),this.#_&&(clearTimeout(this.#_),this.#_=null),this.#O(),this.removeEditToolbar(),this.#T){for(const t of this.#T.values())clearTimeout(t);this.#T=null}this.parent=null,this.#I?.destroy(),this.#I=null,this.#h?.remove(),this.#h=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#U(),this.#c.classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[t,e]}=this,[n,s,r,a]=this.getPDFRect();return[Rt._round(n+(r-n)*t),Rt._round(s+(a-s)*(1-e))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return this.#n.commentPopupPositionInLayer}set commentPopupPosition(t){this.#n.commentPopupPositionInLayer=t}hasDefaultPopupPosition(){return this.#n.hasDefaultPopupPosition()}get commentButtonWidth(){return this.#n.commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(t){this.#n?.setCommentButtonStates(t)}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const e=this.#c.children;if(!this.#e){this.#e=Array.from(e);const a=this.#W.bind(this),c=this.#Y.bind(this),u=this._uiManager._signal;for(const h of this.#e){const f=h.getAttribute("data-resizer-name");h.setAttribute("role","spinbutton"),h.addEventListener("keydown",a,{signal:u}),h.addEventListener("blur",c,{signal:u}),h.addEventListener("focus",this.#K.bind(this,f),{signal:u}),h.setAttribute("data-l10n-id",Rt._l10nResizer[f])}}const n=this.#e[0];let s=0;for(const a of e){if(a===n)break;s++}const r=(360-this.rotation+this.parentRotation)%360/90*(this.#e.length/4);if(r!==s){if(r<s)for(let c=0;c<s-r;c++)this.#c.append(this.#c.firstElementChild);else if(r>s)for(let c=0;c<r-s;c++)this.#c.firstElementChild.before(this.#c.lastElementChild);let a=0;for(const c of e){const h=this.#e[a++].getAttribute("data-resizer-name");c.setAttribute("data-l10n-id",Rt._l10nResizer[h])}}this.#G(0),this.#v=!0,this.#c.firstElementChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}#W(t){Rt._resizerKeyboardManager.exec(this,t)}#Y(t){this.#v&&t.relatedTarget?.parentNode!==this.#c&&this.#O()}#K(t){this.#g=this.#v?t:""}#G(t){if(this.#e)for(const e of this.#e)e.tabIndex=t}_resizeWithKeyboard(t,e){this.#v&&this.#L(this.#g,{deltaX:t,deltaY:e,fromKeyboard:!0})}#O(){this.#v=!1,this.#G(-1),this.#V()}_stopResizingWithKeyboard(){this.#O(),this.div.focus()}select(){if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#i?.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>this.div?.focus({preventScroll:!0}),0)}unselect(){this.isSelected&&(this.isSelected=!1,this.#c?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#i?.toggleAltTextBadge(!0),this.hideCommentPopup())}hideCommentPopup(){this.hasComment&&this._uiManager.toggleComment(null)}updateParams(t,e){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(t){t.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.uid}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#p}set isEditing(t){this.#p=t,this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){this.#T||=new Map;const{action:n}=t;let s=this.#T.get(n);s&&clearTimeout(s),s=setTimeout(()=>{this._reportTelemetry(t),this.#T.delete(n),this.#T.size===0&&(this.#T=null)},Rt._telemetryTimeout),this.#T.set(n,s);return}t.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),this.#r=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#r=!0}updateFakeAnnotationElement(t){if(!this.#h&&!this.deleted){this.#h=t.addFakeAnnotation(this);return}if(this.deleted){this.#h.remove(),this.#h=null;return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&this.#h.updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const n=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),n.before(e)}return e}resetAnnotationElement(t){const{firstElementChild:e}=t.container;e?.nodeName==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}}class p5 extends Rt{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const DC=3285377520,Ni=4294901760,ws=65535;class XM{constructor(t){this.h1=t?t&4294967295:DC,this.h2=t?t&4294967295:DC}update(t){let e,n;if(typeof t=="string"){e=new Uint8Array(t.length*2),n=0;for(let b=0,C=t.length;b<C;b++){const I=t.charCodeAt(b);I<=255?e[n++]=I:(e[n++]=I>>>8,e[n++]=I&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),n=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const s=n>>2,r=n-s*4,a=new Uint32Array(e.buffer,0,s);let c=0,u=0,h=this.h1,f=this.h2;const m=3432918353,y=461845907,T=m&ws,S=y&ws;for(let b=0;b<s;b++)b&1?(c=a[b],c=c*m&Ni|c*T&ws,c=c<<15|c>>>17,c=c*y&Ni|c*S&ws,h^=c,h=h<<13|h>>>19,h=h*5+3864292196):(u=a[b],u=u*m&Ni|u*T&ws,u=u<<15|u>>>17,u=u*y&Ni|u*S&ws,f^=u,f=f<<13|f>>>19,f=f*5+3864292196);switch(c=0,r){case 3:c^=e[s*4+2]<<16;case 2:c^=e[s*4+1]<<8;case 1:c^=e[s*4],c=c*m&Ni|c*T&ws,c=c<<15|c>>>17,c=c*y&Ni|c*S&ws,s&1?h^=c:f^=c}this.h1=h,this.h2=f}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&Ni|t*36045&ws,e=e*4283543511&Ni|((e<<16|t>>>16)*2950163797&Ni)>>>16,t^=e>>>1,t=t*444984403&Ni|t*60499&ws,e=e*3301882366&Ni|((e<<16|t>>>16)*3120437893&Ni)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const K_=Object.freeze({map:null,hash:"",transfer:void 0});class yE{#t=!1;#e=null;#i=null;#n=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const n=this.#n.get(t);return n===void 0?e:Object.assign(e,n)}getRawValue(t){return this.#n.get(t)}remove(t){const e=this.#n.get(t);if(e!==void 0&&(e instanceof Rt&&this.#i.delete(e.annotationElementId),this.#n.delete(t),this.#n.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const n of this.#n.values())if(n instanceof Rt)return;this.onAnnotationEditor(null)}}setValue(t,e){const n=this.#n.get(t);let s=!1;if(n!==void 0)for(const[r,a]of Object.entries(e))n[r]!==a&&(s=!0,n[r]=a);else s=!0,this.#n.set(t,e);s&&this.#o(),e instanceof Rt&&((this.#i||=new Map).set(e.annotationElementId,e),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type))}has(t){return this.#n.has(t)}get size(){return this.#n.size}#o(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new JM(this)}get serializable(){if(this.#n.size===0)return K_;const t=new Map,e=new XM,n=[],s=Object.create(null);let r=!1;for(const[a,c]of this.#n){const u=c instanceof Rt?c.serialize(!1,s):c;u&&(t.set(a,u),e.update(`${a}:${JSON.stringify(u)}`),r||=!!u.bitmap)}if(r)for(const a of t.values())a.bitmap&&n.push(a.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:n}:K_}get editorStats(){let t=null;const e=new Map;let n=0,s=0;for(const r of this.#n.values()){if(!(r instanceof Rt)){r.popup&&(r.popup.deleted?s+=1:n+=1);continue}r.isCommentDeleted?s+=1:r.hasEditedComment&&(n+=1);const a=r.telemetryFinalData;if(!a)continue;const{type:c}=a;e.has(c)||e.set(c,Object.getPrototypeOf(r).constructor),t||=Object.create(null);const u=t[c]||=new Map;for(const[h,f]of Object.entries(a)){if(h==="type")continue;let m=u.get(h);m||(m=new Map,u.set(h,m));const y=m.get(f)??0;m.set(f,y+1)}}if((s>0||n>0)&&(t||=Object.create(null),t.comments={deleted:s,edited:n}),!t)return null;for(const[r,a]of e)t[r]=a.computeTelemetryFinalData(t[r]);return t}resetModifiedIds(){this.#e=null}updateEditor(t,e){const n=this.#i?.get(t);return n?(n.updateFromAnnotationLayer(e),!0):!1}getEditor(t){return this.#i?.get(t)||null}get modifiedIds(){if(this.#e)return this.#e;const t=[];if(this.#i)for(const e of this.#i.values())e.serialize()&&t.push(e.annotationElementId);return this.#e={ids:new Set(t),hash:t.join(",")}}[Symbol.iterator](){return this.#n.entries()}}class JM extends yE{#t;constructor(t){super();const{map:e,hash:n,transfer:s}=t.serializable,r=structuredClone(e,s?{transfer:s}:null);this.#t={map:r,hash:n,transfer:s}}get print(){Ee("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}get modifiedIds(){return Ht(this,"modifiedIds",{ids:new Set,hash:""})}}class m5{#t=new Set;constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,disableFontFace:e,_inspectFont:n}){if(!(!t||this.#t.has(t.loadedName))){if(ee(!e,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:s,src:r,style:a}=t,c=new FontFace(s,r,a);this.addNativeFontFace(c);try{await c.load(),this.#t.add(s),n?.(t)}catch{Ft(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(c)}return}Ee("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const n=t.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(s){throw Ft(`Failed to load font '${n.family}': '${s}'.`),t.disableFontFace=!0,s}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(n=>{const s=this._queueLoadingCallback(n);this._prepareFontLoadEvent(t,s)})}}get isFontLoadingAPISupported(){const t=!!this._document?.fonts;return Ht(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){return Ht(this,"isSyncFontLoadingSupported",Kn||Pn.platform.isFirefox)}_queueLoadingCallback(t){function e(){for(ee(!s.done,"completeRequest() cannot be called twice."),s.done=!0;n.length>0&&n[0].done;){const r=n.shift();setTimeout(r.callback,0)}}const{loadingRequests:n}=this,s={done:!1,complete:e,callback:t};return n.push(s),s}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return Ht(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function n(H,F){return H.charCodeAt(F)<<24|H.charCodeAt(F+1)<<16|H.charCodeAt(F+2)<<8|H.charCodeAt(F+3)&255}function s(H,F,G,N){const x=H.substring(0,F),k=H.substring(F+G);return x+N+k}let r,a;const c=this._document.createElement("canvas");c.width=1,c.height=1;const u=c.getContext("2d");let h=0;function f(H,F){if(++h>30){Ft("Load test font never loaded."),F();return}if(u.font="30px "+H,u.fillText(".",0,20),u.getImageData(0,0,1,1).data[3]>0){F();return}setTimeout(f.bind(null,H,F))}const m=`lt${Date.now()}${this.loadTestFontId++}`;let y=this._loadTestFont;y=s(y,976,m.length,m);const S=16,b=1482184792;let C=n(y,S);for(r=0,a=m.length-3;r<a;r+=4)C=C-b+n(m,r)|0;r<m.length&&(C=C-b+n(m+"XXX",r)|0),y=s(y,S,4,Xz(C));const I=`url(data:font/opentype;base64,${btoa(y)});`,D=`@font-face {font-family:"${m}";src:${I}}`;this.insertRule(D);const P=this._document.createElement("div");P.style.visibility="hidden",P.style.width=P.style.height="10px",P.style.position="absolute",P.style.top=P.style.left="0px";for(const H of[t.loadedName,m]){const F=this._document.createElement("span");F.textContent="Hi",F.style.fontFamily=H,P.append(F)}this._document.body.append(P),f(m,()=>{P.remove(),e.complete()})}}class g5{#t;constructor(t,e=null,n,s){this.compiledGlyphs=Object.create(null),this.#t=t,this._inspectFont=e,n&&Object.assign(this,n),s&&(this.charProcOperatorList=s)}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}return this._inspectFont?.(this),t}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${zM(this.data)});`;let e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let n=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(n+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${n}src:${t}}`}return this._inspectFont?.(this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];const n=this.loadedName+"_path_"+e;let s;try{s=t.get(n)}catch(a){Ft(`getPathGenerator - ignoring character: "${a}".`)}const r=WM(s);return this.fontExtraProperties||t.delete(n),this.compiledGlyphs[e]=r}get black(){return this.#t.black}get bold(){return this.#t.bold}get disableFontFace(){return this.#t.disableFontFace??!1}set disableFontFace(t){Ht(this,"disableFontFace",!!t)}get fontExtraProperties(){return this.#t.fontExtraProperties??!1}get isInvalidPDFjsFont(){return this.#t.isInvalidPDFjsFont}get isType3Font(){return this.#t.isType3Font}get italic(){return this.#t.italic}get missingFile(){return this.#t.missingFile}get remeasure(){return this.#t.remeasure}get vertical(){return this.#t.vertical}get ascent(){return this.#t.ascent}get defaultWidth(){return this.#t.defaultWidth}get descent(){return this.#t.descent}get bbox(){return this.#t.bbox}set bbox(t){Ht(this,"bbox",t)}get fontMatrix(){return this.#t.fontMatrix}get fallbackName(){return this.#t.fallbackName}get loadedName(){return this.#t.loadedName}get mimetype(){return this.#t.mimetype}get name(){return this.#t.name}get data(){return this.#t.data}clearData(){this.#t.clearData()}get cssFontInfo(){return this.#t.cssFontInfo}get systemFontInfo(){return this.#t.systemFontInfo}get defaultVMetrics(){return this.#t.defaultVMetrics}}class ac{#t;#e;#i;static strings=["fontFamily","fontWeight","italicAngle"];static write(t){const e=new TextEncoder,n={};let s=0;for(const h of ac.strings){const f=e.encode(t[h]);n[h]=f,s+=4+f.length}const r=new ArrayBuffer(s),a=new Uint8Array(r),c=new DataView(r);let u=0;for(const h of ac.strings){const f=n[h],m=f.length;c.setUint32(u,m),a.set(f,u+4),u+=4+m}return ee(u===r.byteLength,"CssFontInfo.write: Buffer overflow"),r}constructor(t){this.#t=t,this.#e=new DataView(this.#t),this.#i=new TextDecoder}#n(t){ee(t<ac.strings.length,"Invalid string index");let e=0;for(let s=0;s<t;s++)e+=this.#e.getUint32(e)+4;const n=this.#e.getUint32(e);return this.#i.decode(new Uint8Array(this.#t,e+4,n))}get fontFamily(){return this.#n(0)}get fontWeight(){return this.#n(1)}get italicAngle(){return this.#n(2)}}class lc{#t;#e;#i;static strings=["css","loadedName","baseFontName","src"];static write(t){const e=new TextEncoder,n={};let s=0;for(const y of lc.strings){const T=e.encode(t[y]);n[y]=T,s+=4+T.length}s+=4;let r,a,c=1+s;t.style&&(r=e.encode(t.style.style),a=e.encode(t.style.weight),c+=4+r.length+4+a.length);const u=new ArrayBuffer(c),h=new Uint8Array(u),f=new DataView(u);let m=0;f.setUint8(m++,t.guessFallback?1:0),f.setUint32(m,0),m+=4,s=0;for(const y of lc.strings){const T=n[y],S=T.length;s+=4+S,f.setUint32(m,S),h.set(T,m+4),m+=4+S}return f.setUint32(m-s-4,s),t.style&&(f.setUint32(m,r.length),h.set(r,m+4),m+=4+r.length,f.setUint32(m,a.length),h.set(a,m+4),m+=4+a.length),ee(m<=u.byteLength,"SubstitionInfo.write: Buffer overflow"),u.transferToFixedLength(m)}constructor(t){this.#t=t,this.#e=new DataView(this.#t),this.#i=new TextDecoder}get guessFallback(){return this.#e.getUint8(0)!==0}#n(t){ee(t<lc.strings.length,"Invalid string index");let e=5;for(let s=0;s<t;s++)e+=this.#e.getUint32(e)+4;const n=this.#e.getUint32(e);return this.#i.decode(new Uint8Array(this.#t,e+4,n))}get css(){return this.#n(0)}get loadedName(){return this.#n(1)}get baseFontName(){return this.#n(2)}get src(){return this.#n(3)}get style(){let t=1;t+=4+this.#e.getUint32(t);const e=this.#e.getUint32(t),n=this.#i.decode(new Uint8Array(this.#t,t+4,e));t+=4+e;const s=this.#e.getUint32(t),r=this.#i.decode(new Uint8Array(this.#t,t+4,s));return{style:n,weight:r}}}class _e{static bools=["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"];static numbers=["ascent","defaultWidth","descent"];static strings=["fallbackName","loadedName","mimetype","name"];static#t=Math.ceil(this.bools.length*2/8);static#e=this.#t+this.numbers.length*8;static#i=this.#e+1+8;static#n=this.#i+1+48;static#o=this.#n+1+6;#r;#s;#a;constructor({data:t,extra:e}){this.#r=t,this.#s=new TextDecoder,this.#a=new DataView(this.#r),e&&Object.assign(this,e)}#c(t){ee(t<_e.bools.length,"Invalid boolean index");const e=Math.floor(t/4),n=t*2%8,s=this.#a.getUint8(e)>>n&3;return s===0?void 0:s===2}get black(){return this.#c(0)}get bold(){return this.#c(1)}get disableFontFace(){return this.#c(2)}get fontExtraProperties(){return this.#c(3)}get isInvalidPDFjsFont(){return this.#c(4)}get isType3Font(){return this.#c(5)}get italic(){return this.#c(6)}get missingFile(){return this.#c(7)}get remeasure(){return this.#c(8)}get vertical(){return this.#c(9)}#l(t){return ee(t<_e.numbers.length,"Invalid number index"),this.#a.getFloat64(_e.#t+t*8)}get ascent(){return this.#l(0)}get defaultWidth(){return this.#l(1)}get descent(){return this.#l(2)}get bbox(){let t=_e.#e;if(this.#a.getUint8(t)===0)return;t+=1;const n=[];for(let s=0;s<4;s++)n.push(this.#a.getInt16(t,!0)),t+=2;return n}get fontMatrix(){let t=_e.#i;if(this.#a.getUint8(t)===0)return;t+=1;const n=[];for(let s=0;s<6;s++)n.push(this.#a.getFloat64(t,!0)),t+=8;return n}get defaultVMetrics(){let t=_e.#n;if(this.#a.getUint8(t)===0)return;t+=1;const n=[];for(let s=0;s<3;s++)n.push(this.#a.getInt16(t,!0)),t+=2;return n}#d(t){ee(t<_e.strings.length,"Invalid string index");let e=_e.#o+4;for(let r=0;r<t;r++)e+=this.#a.getUint32(e)+4;const n=this.#a.getUint32(e),s=new Uint8Array(n);return s.set(new Uint8Array(this.#r,e+4,n)),this.#s.decode(s)}get fallbackName(){return this.#d(0)}get loadedName(){return this.#d(1)}get mimetype(){return this.#d(2)}get name(){return this.#d(3)}get data(){let t=_e.#o;const e=this.#a.getUint32(t);t+=4+e;const n=this.#a.getUint32(t);t+=4+n;const s=this.#a.getUint32(t);t+=4+s;const r=this.#a.getUint32(t);if(r!==0)return new Uint8Array(this.#r,t+4,r)}clearData(){let t=_e.#o;const e=this.#a.getUint32(t);t+=4+e;const n=this.#a.getUint32(t);t+=4+n;const s=this.#a.getUint32(t);t+=4+s;const r=this.#a.getUint32(t);new Uint8Array(this.#r,t+4,r).fill(0),this.#a.setUint32(t,0)}get cssFontInfo(){let t=_e.#o;const e=this.#a.getUint32(t);t+=4+e;const n=this.#a.getUint32(t);t+=4+n;const s=this.#a.getUint32(t);if(s===0)return null;const r=new Uint8Array(s);return r.set(new Uint8Array(this.#r,t+4,s)),new ac(r.buffer)}get systemFontInfo(){let t=_e.#o;const e=this.#a.getUint32(t);t+=4+e;const n=this.#a.getUint32(t);if(n===0)return null;const s=new Uint8Array(n);return s.set(new Uint8Array(this.#r,t+4,n)),new lc(s.buffer)}static write(t){const e=t.systemFontInfo?lc.write(t.systemFontInfo):null,n=t.cssFontInfo?ac.write(t.cssFontInfo):null,s=new TextEncoder,r={};let a=0;for(const b of _e.strings)r[b]=s.encode(t[b]),a+=4+r[b].length;const c=_e.#o+4+a+4+(e?e.byteLength:0)+4+(n?n.byteLength:0)+4+(t.data?t.data.length:0),u=new ArrayBuffer(c),h=new Uint8Array(u),f=new DataView(u);let m=0;const y=_e.bools.length;let T=0,S=0;for(let b=0;b<y;b++){const C=t[_e.bools[b]];T|=(C===void 0?0:C?2:1)<<S,S+=2,(S===8||b===y-1)&&(f.setUint8(m++,T),T=0,S=0)}ee(m===_e.#t,"FontInfo.write: Boolean properties offset mismatch");for(const b of _e.numbers)f.setFloat64(m,t[b]),m+=8;if(ee(m===_e.#e,"FontInfo.write: Number properties offset mismatch"),t.bbox){f.setUint8(m++,4);for(const b of t.bbox)f.setInt16(m,b,!0),m+=2}else f.setUint8(m++,0),m+=8;if(ee(m===_e.#i,"FontInfo.write: BBox properties offset mismatch"),t.fontMatrix){f.setUint8(m++,6);for(const b of t.fontMatrix)f.setFloat64(m,b,!0),m+=8}else f.setUint8(m++,0),m+=48;if(ee(m===_e.#n,"FontInfo.write: FontMatrix properties offset mismatch"),t.defaultVMetrics){f.setUint8(m++,1);for(const b of t.defaultVMetrics)f.setInt16(m,b,!0),m+=2}else f.setUint8(m++,0),m+=6;ee(m===_e.#o,"FontInfo.write: DefaultVMetrics properties offset mismatch"),f.setUint32(_e.#o,0),m+=4;for(const b of _e.strings){const C=r[b],I=C.length;f.setUint32(m,I),h.set(C,m+4),m+=4+I}if(f.setUint32(_e.#o,m-_e.#o-4),!e)f.setUint32(m,0),m+=4;else{const b=e.byteLength;f.setUint32(m,b),ee(m+4+b<=u.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),h.set(new Uint8Array(e),m+4),m+=4+b}if(!n)f.setUint32(m,0),m+=4;else{const b=n.byteLength;f.setUint32(m,b),ee(m+4+b<=u.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),h.set(new Uint8Array(n),m+4),m+=4+b}return t.data===void 0?(f.setUint32(m,0),m+=4):(f.setUint32(m,t.data.length),h.set(t.data,m+4),m+=4+t.data.length),ee(m<=u.byteLength,"FontInfo.write: Buffer overflow"),u.transferToFixedLength(m)}}class gn{static#t=0;static#e=1;static#i=2;static#n=3;static#o=4;static#r=8;static#s=12;static#a=16;constructor(t){this.buffer=t,this.view=new DataView(t),this.data=new Uint8Array(t)}static write(t){let e,n=null,s=[],r=[],a=[],c=[],u=null,h=null;switch(t[0]){case"RadialAxial":e=t[1]==="axial"?1:2,n=t[2],a=t[3],e===1?s.push(...t[4],...t[5]):s.push(t[4][0],t[4][1],t[6],t[5][0],t[5][1],t[7]);break;case"Mesh":e=3,u=t[1],s=t[2],r=t[3],c=t[4]||[],n=t[6],h=t[7];break;default:throw new Error(`Unsupported pattern type: ${t[0]}`)}const f=Math.floor(s.length/2),m=Math.floor(r.length/3),y=a.length,T=c.length;let S=0;for(const F of c)S+=1,S=Math.ceil(S/4)*4,S+=4+F.coords.length*4,S+=4+F.colors.length*4,F.verticesPerRow!==void 0&&(S+=4);const b=20+f*8+m*3+y*8+(n?16:0)+(h?3:0)+S,C=new ArrayBuffer(b),I=new DataView(C),D=new Uint8Array(C);I.setUint8(gn.#t,e),I.setUint8(gn.#e,n?1:0),I.setUint8(gn.#i,h?1:0),I.setUint8(gn.#n,u),I.setUint32(gn.#o,f,!0),I.setUint32(gn.#r,m,!0),I.setUint32(gn.#s,y,!0),I.setUint32(gn.#a,T,!0);let P=20;new Float32Array(C,P,f*2).set(s),P+=f*8,D.set(r,P),P+=m*3;for(const[F,G]of a)I.setFloat32(P,F,!0),P+=4,I.setUint32(P,parseInt(G.slice(1),16),!0),P+=4;if(n)for(const F of n)I.setFloat32(P,F,!0),P+=4;h&&(D.set(h,P),P+=3);for(let F=0;F<c.length;F++){const G=c[F];I.setUint8(P,G.type),P+=1,P=Math.ceil(P/4)*4,I.setUint32(P,G.coords.length,!0),P+=4,new Int32Array(C,P,G.coords.length).set(G.coords),P+=G.coords.length*4,I.setUint32(P,G.colors.length,!0),P+=4,new Int32Array(C,P,G.colors.length).set(G.colors),P+=G.colors.length*4,G.verticesPerRow!==void 0&&(I.setUint32(P,G.verticesPerRow,!0),P+=4)}return C}getIR(){const t=this.view,e=this.data[gn.#t],n=!!this.data[gn.#e],s=!!this.data[gn.#i],r=t.getUint32(gn.#o,!0),a=t.getUint32(gn.#r,!0),c=t.getUint32(gn.#s,!0),u=t.getUint32(gn.#a,!0);let h=20;const f=new Float32Array(this.buffer,h,r*2);h+=r*8;const m=new Uint8Array(this.buffer,h,a*3);h+=a*3;const y=[];for(let C=0;C<c;++C){const I=t.getFloat32(h,!0);h+=4;const D=t.getUint32(h,!0);h+=4,y.push([I,`#${D.toString(16).padStart(6,"0")}`])}let T=null;if(n){T=[];for(let C=0;C<4;++C)T.push(t.getFloat32(h,!0)),h+=4}let S=null;s&&(S=new Uint8Array(this.buffer,h,3),h+=3);const b=[];for(let C=0;C<u;++C){const I=t.getUint8(h);h+=1,h=Math.ceil(h/4)*4;const D=t.getUint32(h,!0);h+=4;const P=new Int32Array(this.buffer,h,D);h+=D*4;const H=t.getUint32(h,!0);h+=4;const F=new Int32Array(this.buffer,h,H);h+=H*4;const G={type:I,coords:P,colors:F};I===q_.LATTICE&&(G.verticesPerRow=t.getUint32(h,!0),h+=4),b.push(G)}if(e===1)return["RadialAxial","axial",T,y,Array.from(f.slice(0,2)),Array.from(f.slice(2,4)),null,null];if(e===2)return["RadialAxial","radial",T,y,[f[0],f[1]],[f[3],f[4]],f[2],f[5]];if(e===3){const C=this.data[gn.#n];let I=null;if(f.length>0){let D=f[0],P=f[0],H=f[1],F=f[1];for(let G=0;G<f.length;G+=2){const N=f[G],x=f[G+1];D=D>N?N:D,H=H>x?x:H,P=P<N?N:P,F=F<x?x:F}I=[D,H,P,F]}return["Mesh",C,f,m,b,I,T,S]}throw new Error(`Unsupported pattern kind: ${e}`)}}function y5(i){if(i instanceof URL)return i.href;if(typeof i=="string"){if(Kn)return i;const t=URL.parse(i,window.location);if(t)return t.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function _5(i){if(Kn&&typeof Buffer<"u"&&i instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(i instanceof Uint8Array&&i.byteLength===i.buffer.byteLength)return i;if(typeof i=="string")return Gh(i);if(i instanceof ArrayBuffer||ArrayBuffer.isView(i)||typeof i=="object"&&!isNaN(i?.length))return new Uint8Array(i);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Rf(i){if(typeof i!="string")return null;if(i.endsWith("/"))return i;throw new Error(`Invalid factory url: "${i}" must include trailing slash.`)}const X_=i=>typeof i=="object"&&Number.isInteger(i?.num)&&i.num>=0&&Number.isInteger(i?.gen)&&i.gen>=0,v5=i=>typeof i=="object"&&typeof i?.name=="string",E5=t5.bind(null,X_,v5);class T5{#t=new Map;#e=Promise.resolve();postMessage(t,e){const n={data:structuredClone(t,e?{transfer:e}:null)};this.#e.then(()=>{for(const[s]of this.#t)s.call(this,n)})}addEventListener(t,e,n=null){let s=null;if(n?.signal instanceof AbortSignal){const{signal:r}=n;if(r.aborted){Ft("LoopbackPort - cannot use an `aborted` signal.");return}const a=()=>this.removeEventListener(t,e);s=()=>r.removeEventListener("abort",a),r.addEventListener("abort",a)}this.#t.set(e,s)}removeEventListener(t,e){this.#t.get(e)?.(),this.#t.delete(e)}terminate(){for(const[,t]of this.#t)t?.();this.#t.clear()}}const Mf={DATA:1,ERROR:2},je={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function NC(){}function ni(i){if(i instanceof Do||i instanceof z_||i instanceof bC||i instanceof xp||i instanceof $y)return i;switch(i instanceof Error||typeof i=="object"&&i!==null||Ee('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),i.name){case"AbortException":return new Do(i.message);case"InvalidPDFException":return new z_(i.message);case"PasswordException":return new bC(i.message,i.code);case"ResponseException":return new xp(i.message,i.status,i.missing);case"UnknownErrorException":return new $y(i.message,i.details)}return new $y(i.message,i.toString())}class sh{#t=new AbortController;constructor(t,e,n){this.sourceName=t,this.targetName=e,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",this.#e.bind(this),{signal:this.#t.signal})}#e({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){this.#n(t);return}if(t.callback){const n=t.callbackId,s=this.callbackCapabilities[n];if(!s)throw new Error(`Cannot resolve callback ${n}`);if(delete this.callbackCapabilities[n],t.callback===Mf.DATA)s.resolve(t.data);else if(t.callback===Mf.ERROR)s.reject(ni(t.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const n=this.sourceName,s=t.sourceName,r=this.comObj;Promise.try(e,t.data).then(function(a){r.postMessage({sourceName:n,targetName:s,callback:Mf.DATA,callbackId:t.callbackId,data:a})},function(a){r.postMessage({sourceName:n,targetName:s,callback:Mf.ERROR,callbackId:t.callbackId,reason:ni(a)})});return}if(t.streamId){this.#i(t);return}e(t.data)}on(t,e){const n=this.actionHandler;if(n[t])throw new Error(`There is already an actionName called "${t}"`);n[t]=e}send(t,e,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},n)}sendWithPromise(t,e,n){const s=this.callbackId++,r=Promise.withResolvers();this.callbackCapabilities[s]=r;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:s,data:e},n)}catch(a){r.reject(a)}return r.promise}sendWithStream(t,e,n,s){const r=this.streamId++,a=this.sourceName,c=this.targetName,u=this.comObj;return new ReadableStream({start:h=>{const f=Promise.withResolvers();return this.streamControllers[r]={controller:h,startCall:f,pullCall:null,cancelCall:null,isClosed:!1},u.postMessage({sourceName:a,targetName:c,action:t,streamId:r,data:e,desiredSize:h.desiredSize},s),f.promise},pull:h=>{const f=Promise.withResolvers();return this.streamControllers[r].pullCall=f,u.postMessage({sourceName:a,targetName:c,stream:je.PULL,streamId:r,desiredSize:h.desiredSize}),f.promise},cancel:h=>{ee(h instanceof Error,"cancel must have a valid reason");const f=Promise.withResolvers();return this.streamControllers[r].cancelCall=f,this.streamControllers[r].isClosed=!0,u.postMessage({sourceName:a,targetName:c,stream:je.CANCEL,streamId:r,reason:ni(h)}),f.promise}},n)}#i(t){const e=t.streamId,n=this.sourceName,s=t.sourceName,r=this.comObj,a=this,c=this.actionHandler[t.action],u={enqueue(h,f=1,m){if(this.isCancelled)return;const y=this.desiredSize;this.desiredSize-=f,y>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),r.postMessage({sourceName:n,targetName:s,stream:je.ENQUEUE,streamId:e,chunk:h},m)},close(){this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:n,targetName:s,stream:je.CLOSE,streamId:e}),delete a.streamSinks[e])},error(h){ee(h instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,r.postMessage({sourceName:n,targetName:s,stream:je.ERROR,streamId:e,reason:ni(h)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};u.sinkCapability.resolve(),u.ready=u.sinkCapability.promise,this.streamSinks[e]=u,Promise.try(c,t.data,u).then(function(){r.postMessage({sourceName:n,targetName:s,stream:je.START_COMPLETE,streamId:e,success:!0})},function(h){r.postMessage({sourceName:n,targetName:s,stream:je.START_COMPLETE,streamId:e,reason:ni(h)})})}#n(t){const e=t.streamId,n=this.sourceName,s=t.sourceName,r=this.comObj,a=this.streamControllers[e],c=this.streamSinks[e];switch(t.stream){case je.START_COMPLETE:t.success?a.startCall.resolve():a.startCall.reject(ni(t.reason));break;case je.PULL_COMPLETE:t.success?a.pullCall.resolve():a.pullCall.reject(ni(t.reason));break;case je.PULL:if(!c){r.postMessage({sourceName:n,targetName:s,stream:je.PULL_COMPLETE,streamId:e,success:!0});break}c.desiredSize<=0&&t.desiredSize>0&&c.sinkCapability.resolve(),c.desiredSize=t.desiredSize,Promise.try(c.onPull||NC).then(function(){r.postMessage({sourceName:n,targetName:s,stream:je.PULL_COMPLETE,streamId:e,success:!0})},function(h){r.postMessage({sourceName:n,targetName:s,stream:je.PULL_COMPLETE,streamId:e,reason:ni(h)})});break;case je.ENQUEUE:if(ee(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(t.chunk);break;case je.CLOSE:if(ee(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),this.#o(a,e);break;case je.ERROR:ee(a,"error should have stream controller"),a.controller.error(ni(t.reason)),this.#o(a,e);break;case je.CANCEL_COMPLETE:t.success?a.cancelCall.resolve():a.cancelCall.reject(ni(t.reason)),this.#o(a,e);break;case je.CANCEL:if(!c)break;const u=ni(t.reason);Promise.try(c.onCancel||NC,u).then(function(){r.postMessage({sourceName:n,targetName:s,stream:je.CANCEL_COMPLETE,streamId:e,success:!0})},function(h){r.postMessage({sourceName:n,targetName:s,stream:je.CANCEL_COMPLETE,streamId:e,reason:ni(h)})}),c.sinkCapability.reject(u),c.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}async#o(t,e){await Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]),delete this.streamControllers[e]}destroy(){this.#t?.abort(),this.#t=null}}class QM{#t=!1;constructor({enableHWA:t=!1}){this.#t=t}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const n=this._createCanvas(t,e);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!this.#t})}}reset(t,e,n){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||n<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=n}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){Ee("Abstract method `_createCanvas` called.")}}class A5 extends QM{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const n=this._document.createElement("canvas");return n.width=t,n.height=e,n}}class jM{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(n=>({cMapData:n,isCompressed:this.isCompressed})).catch(n=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){Ee("Abstract method `_fetch` called.")}}class kC extends jM{async _fetch(t){const e=await qh(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):Gh(e)}}class ZM{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,n,s,r){return"none"}destroy(t=!1){}}class S5 extends ZM{#t;#e;#i;#n;#o;#r;#s=0;constructor({docId:t,ownerDocument:e=globalThis.document}){super(),this.#n=t,this.#o=e}get#a(){return this.#e||=new Map}get#c(){return this.#r||=new Map}get#l(){if(!this.#i){const t=this.#o.createElement("div"),{style:e}=t;e.visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1;const n=this.#o.createElementNS(hr,"svg");n.setAttribute("width",0),n.setAttribute("height",0),this.#i=this.#o.createElementNS(hr,"defs"),t.append(n),n.append(this.#i),this.#o.body.append(t)}return this.#i}#d(t){if(t.length===1){const u=t[0],h=new Array(256);for(let m=0;m<256;m++)h[m]=u[m]/255;const f=h.join(",");return[f,f,f]}const[e,n,s]=t,r=new Array(256),a=new Array(256),c=new Array(256);for(let u=0;u<256;u++)r[u]=e[u]/255,a[u]=n[u]/255,c[u]=s[u]/255;return[r.join(","),a.join(","),c.join(",")]}#h(t){if(this.#t===void 0){this.#t="";const e=this.#o.URL;e!==this.#o.baseURI&&(mm(e)?Ft('#createUrl: ignore "data:"-URL for performance reasons.'):this.#t=HM(e,""))}return`url(${this.#t}#${t})`}addFilter(t){if(!t)return"none";let e=this.#a.get(t);if(e)return e;const[n,s,r]=this.#d(t),a=t.length===1?n:`${n}${s}${r}`;if(e=this.#a.get(a),e)return this.#a.set(t,e),e;const c=`g_${this.#n}_transfer_map_${this.#s++}`,u=this.#h(c);this.#a.set(t,u),this.#a.set(a,u);const h=this.#m(c);return this.#p(n,s,r,h),u}addHCMFilter(t,e){const n=`${t}-${e}`,s="base";let r=this.#c.get(s);if(r?.key===n||(r?(r.filter?.remove(),r.key=n,r.url="none",r.filter=null):(r={key:n,url:"none",filter:null},this.#c.set(s,r)),!t||!e))return r.url;const a=this.#v(t);t=Tt.makeHexColor(...a);const c=this.#v(e);if(e=Tt.makeHexColor(...c),this.#l.style.color="",t==="#000000"&&e==="#ffffff"||t===e)return r.url;const u=new Array(256);for(let T=0;T<=255;T++){const S=T/255;u[T]=S<=.03928?S/12.92:((S+.055)/1.055)**2.4}const h=u.join(","),f=`g_${this.#n}_hcm_filter`,m=r.filter=this.#m(f);this.#p(h,h,h,m),this.#g(m);const y=(T,S)=>{const b=a[T]/255,C=c[T]/255,I=new Array(S+1);for(let D=0;D<=S;D++)I[D]=b+D/S*(C-b);return I.join(",")};return this.#p(y(0,5),y(1,5),y(2,5),m),r.url=this.#h(f),r.url}addAlphaFilter(t){let e=this.#a.get(t);if(e)return e;const[n]=this.#d([t]),s=`alpha_${n}`;if(e=this.#a.get(s),e)return this.#a.set(t,e),e;const r=`g_${this.#n}_alpha_map_${this.#s++}`,a=this.#h(r);this.#a.set(t,a),this.#a.set(s,a);const c=this.#m(r);return this.#y(n,c),a}addLuminosityFilter(t){let e=this.#a.get(t||"luminosity");if(e)return e;let n,s;if(t?([n]=this.#d([t]),s=`luminosity_${n}`):s="luminosity",e=this.#a.get(s),e)return this.#a.set(t,e),e;const r=`g_${this.#n}_luminosity_map_${this.#s++}`,a=this.#h(r);this.#a.set(t,a),this.#a.set(s,a);const c=this.#m(r);return this.#f(c),t&&this.#y(n,c),a}addHighlightHCMFilter(t,e,n,s,r){const a=`${e}-${n}-${s}-${r}`;let c=this.#c.get(t);if(c?.key===a||(c?(c.filter?.remove(),c.key=a,c.url="none",c.filter=null):(c={key:a,url:"none",filter:null},this.#c.set(t,c)),!e||!n))return c.url;const[u,h]=[e,n].map(this.#v.bind(this));let f=Math.round(.2126*u[0]+.7152*u[1]+.0722*u[2]),m=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),[y,T]=[s,r].map(this.#v.bind(this));m<f&&([f,m,y,T]=[m,f,T,y]),this.#l.style.color="";const S=(I,D,P)=>{const H=new Array(256),F=(m-f)/P,G=I/255,N=(D-I)/(255*P);let x=0;for(let k=0;k<=P;k++){const V=Math.round(f+k*F),U=G+k*N;for(let $=x;$<=V;$++)H[$]=U;x=V+1}for(let k=x;k<256;k++)H[k]=H[x-1];return H.join(",")},b=`g_${this.#n}_hcm_${t}_filter`,C=c.filter=this.#m(b);return this.#g(C),this.#p(S(y[0],T[0],5),S(y[1],T[1],5),S(y[2],T[2],5),C),c.url=this.#h(b),c.url}destroy(t=!1){t&&this.#r?.size||(this.#i?.parentNode.parentNode.remove(),this.#i=null,this.#e?.clear(),this.#e=null,this.#r?.clear(),this.#r=null,this.#s=0)}#f(t){const e=this.#o.createElementNS(hr,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(e)}#g(t){const e=this.#o.createElementNS(hr,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}#m(t){const e=this.#o.createElementNS(hr,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),this.#l.append(e),e}#u(t,e,n){const s=this.#o.createElementNS(hr,e);s.setAttribute("type","discrete"),s.setAttribute("tableValues",n),t.append(s)}#p(t,e,n,s){const r=this.#o.createElementNS(hr,"feComponentTransfer");s.append(r),this.#u(r,"feFuncR",t),this.#u(r,"feFuncG",e),this.#u(r,"feFuncB",n)}#y(t,e){const n=this.#o.createElementNS(hr,"feComponentTransfer");e.append(n),this.#u(n,"feFuncA",t)}#v(t){return this.#l.style.color=t,$h(getComputedStyle(this.#l).getPropertyValue("color"))}}class tP{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(n=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){Ee("Abstract method `_fetch` called.")}}class LC extends tP{async _fetch(t){const e=await qh(t,"arraybuffer");return new Uint8Array(e)}}class eP{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!t)throw new Error("Wasm filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(n=>{throw new Error(`Unable to load wasm data at: ${e}`)})}async _fetch(t){Ee("Abstract method `_fetch` called.")}}class OC extends eP{async _fetch(t){const e=await qh(t,"arraybuffer");return new Uint8Array(e)}}Kn&&Ft("Please use the `legacy` build in Node.js environments.");async function _E(i){const e=await process.getBuiltinModule("fs").promises.readFile(i);return new Uint8Array(e)}class w5 extends ZM{}class b5 extends QM{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}}class C5 extends jM{async _fetch(t){return _E(t)}}class I5 extends tP{async _fetch(t){return _E(t)}}class R5 extends eP{async _fetch(t){return _E(t)}}const Ul="__forcedDependency",{floor:UC,ceil:VC}=Math;function Pf(i,t,e,n,s,r){i[t*4+0]=Math.min(i[t*4+0],e),i[t*4+1]=Math.min(i[t*4+1],n),i[t*4+2]=Math.max(i[t*4+2],s),i[t*4+3]=Math.max(i[t*4+3],r)}const J_=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];class M5{#t;#e;constructor(t,e){this.#t=t,this.#e=e}get length(){return this.#t.length}isEmpty(t){return this.#t[t]===J_}minX(t){return this.#e[t*4+0]/256}minY(t){return this.#e[t*4+1]/256}maxX(t){return(this.#e[t*4+2]+1)/256}maxY(t){return(this.#e[t*4+3]+1)/256}}const xf=(i,t)=>{if(!i)return;let e=i.get(t);return e||(e={dependencies:new Set,isRenderingOperation:!1},i.set(t,e)),e};class P5{#t={__proto__:null};#e={__proto__:null,transform:[],moveText:[],sameLineText:[],[Ul]:[]};#i=new Map;#n=[];#o=[];#r=[[1,0,0,1,0,0]];#s=[-1/0,-1/0,1/0,1/0];#a=new Float64Array([1/0,1/0,-1/0,-1/0]);#c=-1;#l=new Set;#d=new Map;#h=new Map;#f;#g;#m;#u;#p;constructor(t,e,n=!1){this.#f=t.width,this.#g=t.height,this.#y(e),n&&(this.#p=new Map)}growOperationsCount(t){t>=this.#u.length&&this.#y(t,this.#u)}#y(t,e){const n=new ArrayBuffer(t*4);this.#m=new Uint8ClampedArray(n),this.#u=new Uint32Array(n),e&&e.length>0?(this.#u.set(e),this.#u.fill(J_,e.length)):this.#u.fill(J_)}save(t){return this.#t={__proto__:this.#t},this.#e={__proto__:this.#e,transform:{__proto__:this.#e.transform},moveText:{__proto__:this.#e.moveText},sameLineText:{__proto__:this.#e.sameLineText},[Ul]:{__proto__:this.#e[Ul]}},this.#s={__proto__:this.#s},this.#n.push(t),this}restore(t){const e=Object.getPrototypeOf(this.#t);if(e===null)return this;this.#t=e,this.#e=Object.getPrototypeOf(this.#e),this.#s=Object.getPrototypeOf(this.#s);const n=this.#n.pop();return n!==void 0&&(xf(this.#p,t)?.dependencies.add(n),this.#u[t]=this.#u[n]),this}recordOpenMarker(t){return this.#n.push(t),this}getOpenMarker(){return this.#n.length===0?null:this.#n.at(-1)}recordCloseMarker(t){const e=this.#n.pop();return e!==void 0&&(xf(this.#p,t)?.dependencies.add(e),this.#u[t]=this.#u[e]),this}beginMarkedContent(t){return this.#o.push(t),this}endMarkedContent(t){const e=this.#o.pop();return e!==void 0&&(xf(this.#p,t)?.dependencies.add(e),this.#u[t]=this.#u[e]),this}pushBaseTransform(t){return this.#r.push(Tt.multiplyByDOMMatrix(this.#r.at(-1),t.getTransform())),this}popBaseTransform(){return this.#r.length>1&&this.#r.pop(),this}recordSimpleData(t,e){return this.#t[t]=e,this}recordIncrementalData(t,e){return this.#e[t].push(e),this}resetIncrementalData(t,e){return this.#e[t].length=0,this}recordNamedData(t,e){return this.#i.set(t,e),this}recordSimpleDataFromNamed(t,e,n){this.#t[t]=this.#i.get(e)??n}recordFutureForcedDependency(t,e){return this.recordIncrementalData(Ul,e),this}inheritSimpleDataAsFutureForcedDependencies(t){for(const e of t)e in this.#t&&this.recordFutureForcedDependency(e,this.#t[e]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const t of this.#l)this.recordFutureForcedDependency(Ul,t);return this}resetBBox(t){return this.#c!==t&&(this.#c=t,this.#a[0]=1/0,this.#a[1]=1/0,this.#a[2]=-1/0,this.#a[3]=-1/0),this}recordClipBox(t,e,n,s,r,a){const c=Tt.multiplyByDOMMatrix(this.#r.at(-1),e.getTransform()),u=[1/0,1/0,-1/0,-1/0];Tt.axialAlignedBoundingBox([n,r,s,a],c,u);const h=Tt.intersect(this.#s,u);return h?(this.#s[0]=h[0],this.#s[1]=h[1],this.#s[2]=h[2],this.#s[3]=h[3]):(this.#s[0]=this.#s[1]=1/0,this.#s[2]=this.#s[3]=-1/0),this}recordBBox(t,e,n,s,r,a){const c=this.#s;if(c[0]===1/0)return this;const u=Tt.multiplyByDOMMatrix(this.#r.at(-1),e.getTransform());if(c[0]===-1/0)return Tt.axialAlignedBoundingBox([n,r,s,a],u,this.#a),this;const h=[1/0,1/0,-1/0,-1/0];return Tt.axialAlignedBoundingBox([n,r,s,a],u,h),this.#a[0]=Math.min(this.#a[0],Math.max(h[0],c[0])),this.#a[1]=Math.min(this.#a[1],Math.max(h[1],c[1])),this.#a[2]=Math.max(this.#a[2],Math.min(h[2],c[2])),this.#a[3]=Math.max(this.#a[3],Math.min(h[3],c[3])),this}recordCharacterBBox(t,e,n,s=1,r=0,a=0,c){const u=n.bbox;let h,f;if(u&&(h=u[2]!==u[0]&&u[3]!==u[1]&&this.#h.get(n),h!==!1&&(f=[0,0,0,0],Tt.axialAlignedBoundingBox(u,n.fontMatrix,f),(s!==1||r!==0||a!==0)&&Tt.scaleMinMax([s,0,0,-s,r,a],f),h)))return this.recordBBox(t,e,f[0],f[2],f[1],f[3]);if(!c)return this.recordFullPageBBox(t);const m=c();return u&&f&&h===void 0&&(h=f[0]<=r-m.actualBoundingBoxLeft&&f[2]>=r+m.actualBoundingBoxRight&&f[1]<=a-m.actualBoundingBoxAscent&&f[3]>=a+m.actualBoundingBoxDescent,this.#h.set(n,h),h)?this.recordBBox(t,e,f[0],f[2],f[1],f[3]):this.recordBBox(t,e,r-m.actualBoundingBoxLeft,r+m.actualBoundingBoxRight,a-m.actualBoundingBoxAscent,a+m.actualBoundingBoxDescent)}recordFullPageBBox(t){return this.#a[0]=Math.max(0,this.#s[0]),this.#a[1]=Math.max(0,this.#s[1]),this.#a[2]=Math.min(this.#f,this.#s[2]),this.#a[3]=Math.min(this.#g,this.#s[3]),this}getSimpleIndex(t){return this.#t[t]}recordDependencies(t,e){const n=this.#l,s=this.#t,r=this.#e;for(const a of e)a in this.#t?n.add(s[a]):a in r&&r[a].forEach(n.add,n);return this}recordNamedDependency(t,e){return this.#i.has(e)&&this.#l.add(this.#i.get(e)),this}recordOperation(t,e=!1){if(this.recordDependencies(t,[Ul]),this.#p){const n=xf(this.#p,t),{dependencies:s}=n;this.#l.forEach(s.add,s),this.#n.forEach(s.add,s),this.#o.forEach(s.add,s),s.delete(t),n.isRenderingOperation=!0}if(this.#c===t){const n=UC(this.#a[0]*256/this.#f),s=UC(this.#a[1]*256/this.#g),r=VC(this.#a[2]*256/this.#f),a=VC(this.#a[3]*256/this.#g);Pf(this.#m,t,n,s,r,a);for(const c of this.#l)c!==t&&Pf(this.#m,c,n,s,r,a);for(const c of this.#n)c!==t&&Pf(this.#m,c,n,s,r,a);for(const c of this.#o)c!==t&&Pf(this.#m,c,n,s,r,a);e||(this.#l.clear(),this.#c=-1)}return this}recordShowTextOperation(t,e=!1){const n=Array.from(this.#l);this.recordOperation(t,e),this.recordIncrementalData("sameLineText",t);for(const s of n)this.recordIncrementalData("sameLineText",s);return this}bboxToClipBoxDropOperation(t,e=!1){return this.#c===t&&(this.#c=-1,this.#s[0]=Math.max(this.#s[0],this.#a[0]),this.#s[1]=Math.max(this.#s[1],this.#a[1]),this.#s[2]=Math.min(this.#s[2],this.#a[2]),this.#s[3]=Math.min(this.#s[3],this.#a[3]),e||this.#l.clear()),this}_takePendingDependencies(){const t=this.#l;return this.#l=new Set,t}_extractOperation(t){const e=this.#d.get(t);return this.#d.delete(t),e}_pushPendingDependencies(t){for(const e of t)this.#l.add(e)}take(){return this.#h.clear(),new M5(this.#u,this.#m)}takeDebugMetadata(){return this.#p}}class Dp{#t;#e;#i;#n=0;#o=0;constructor(t,e,n){if(t instanceof Dp&&t.#i===!!n)return t;this.#t=t,this.#e=e,this.#i=!!n}growOperationsCount(){throw new Error("Unreachable")}save(t){return this.#o++,this.#t.save(this.#e),this}restore(t){return this.#o>0&&(this.#t.restore(this.#e),this.#o--),this}recordOpenMarker(t){return this.#n++,this}getOpenMarker(){return this.#n>0?this.#e:this.#t.getOpenMarker()}recordCloseMarker(t){return this.#n--,this}beginMarkedContent(t){return this}endMarkedContent(t){return this}pushBaseTransform(t){return this.#t.pushBaseTransform(t),this}popBaseTransform(){return this.#t.popBaseTransform(),this}recordSimpleData(t,e){return this.#t.recordSimpleData(t,this.#e),this}recordIncrementalData(t,e){return this.#t.recordIncrementalData(t,this.#e),this}resetIncrementalData(t,e){return this.#t.resetIncrementalData(t,this.#e),this}recordNamedData(t,e){return this}recordSimpleDataFromNamed(t,e,n){return this.#t.recordSimpleDataFromNamed(t,e,this.#e),this}recordFutureForcedDependency(t,e){return this.#t.recordFutureForcedDependency(t,this.#e),this}inheritSimpleDataAsFutureForcedDependencies(t){return this.#t.inheritSimpleDataAsFutureForcedDependencies(t),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#t.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(t){return this.#i||this.#t.resetBBox(this.#e),this}recordClipBox(t,e,n,s,r,a){return this.#i||this.#t.recordClipBox(this.#e,e,n,s,r,a),this}recordBBox(t,e,n,s,r,a){return this.#i||this.#t.recordBBox(this.#e,e,n,s,r,a),this}recordCharacterBBox(t,e,n,s,r,a,c){return this.#i||this.#t.recordCharacterBBox(this.#e,e,n,s,r,a,c),this}recordFullPageBBox(t){return this.#i||this.#t.recordFullPageBBox(this.#e),this}getSimpleIndex(t){return this.#t.getSimpleIndex(t)}recordDependencies(t,e){return this.#t.recordDependencies(this.#e,e),this}recordNamedDependency(t,e){return this.#t.recordNamedDependency(this.#e,e),this}recordOperation(t){return this.#t.recordOperation(this.#e,!0),this}recordShowTextOperation(t){return this.#t.recordShowTextOperation(this.#e,!0),this}bboxToClipBoxDropOperation(t){return this.#i||this.#t.bboxToClipBoxDropOperation(this.#e,!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}}const ki={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},Rn={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Q_(i,t){if(!t)return;const e=t[2]-t[0],n=t[3]-t[1],s=new Path2D;s.rect(t[0],t[1],e,n),i.clip(s)}class vE{isModifyingCurrentTransform(){return!1}getPattern(){Ee("Abstract method `getPattern` called.")}}class x5 extends vE{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;this._type==="axial"?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const n of this._colorStops)e.addColorStop(n[0],n[1]);return e}getPattern(t,e,n,s){let r;if(s===Rn.STROKE||s===Rn.FILL){const a=e.current.getClippedPathBoundingBox(s,xe(t))||[0,0,0,0],c=Math.ceil(a[2]-a[0])||1,u=Math.ceil(a[3]-a[1])||1,h=e.cachedCanvases.getCanvas("pattern",c,u),f=h.context;f.clearRect(0,0,f.canvas.width,f.canvas.height),f.beginPath(),f.rect(0,0,f.canvas.width,f.canvas.height),f.translate(-a[0],-a[1]),n=Tt.transform(n,[1,0,0,1,a[0],a[1]]),f.transform(...e.baseTransform),this.matrix&&f.transform(...this.matrix),Q_(f,this._bbox),f.fillStyle=this._createGradient(f),f.fill(),r=t.createPattern(h.canvas,"no-repeat");const m=new DOMMatrix(n);r.setTransform(m)}else Q_(t,this._bbox),r=this._createGradient(t);return r}}function Ky(i,t,e,n,s,r,a,c){const u=t.coords,h=t.colors,f=i.data,m=i.width*4;let y;u[e+1]>u[n+1]&&(y=e,e=n,n=y,y=r,r=a,a=y),u[n+1]>u[s+1]&&(y=n,n=s,s=y,y=a,a=c,c=y),u[e+1]>u[n+1]&&(y=e,e=n,n=y,y=r,r=a,a=y);const T=(u[e]+t.offsetX)*t.scaleX,S=(u[e+1]+t.offsetY)*t.scaleY,b=(u[n]+t.offsetX)*t.scaleX,C=(u[n+1]+t.offsetY)*t.scaleY,I=(u[s]+t.offsetX)*t.scaleX,D=(u[s+1]+t.offsetY)*t.scaleY;if(S>=D)return;const P=h[r],H=h[r+1],F=h[r+2],G=h[a],N=h[a+1],x=h[a+2],k=h[c],V=h[c+1],U=h[c+2],$=Math.round(S),B=Math.round(D);let vt,It,W,nt,ft,xt,z,ot;for(let dt=$;dt<=B;dt++){if(dt<C){const $t=dt<S?0:(S-dt)/(S-C);vt=T-(T-b)*$t,It=P-(P-G)*$t,W=H-(H-N)*$t,nt=F-(F-x)*$t}else{let $t;dt>D?$t=1:C===D?$t=0:$t=(C-dt)/(C-D),vt=b-(b-I)*$t,It=G-(G-k)*$t,W=N-(N-V)*$t,nt=x-(x-U)*$t}let ht;dt<S?ht=0:dt>D?ht=1:ht=(S-dt)/(S-D),ft=T-(T-I)*ht,xt=P-(P-k)*ht,z=H-(H-V)*ht,ot=F-(F-U)*ht;const _t=Math.round(Math.min(vt,ft)),Ot=Math.round(Math.max(vt,ft));let St=m*dt+_t*4;for(let $t=_t;$t<=Ot;$t++)ht=(vt-$t)/(vt-ft),ht<0?ht=0:ht>1&&(ht=1),f[St++]=It-(It-xt)*ht|0,f[St++]=W-(W-z)*ht|0,f[St++]=nt-(nt-ot)*ht|0,f[St++]=255}}function D5(i,t,e){const n=t.coords,s=t.colors;let r,a;switch(t.type){case q_.LATTICE:const c=t.verticesPerRow,u=Math.floor(n.length/c)-1,h=c-1;for(r=0;r<u;r++){let f=r*c;for(let m=0;m<h;m++,f++)Ky(i,e,n[f],n[f+1],n[f+c],s[f],s[f+1],s[f+c]),Ky(i,e,n[f+c+1],n[f+1],n[f+c],s[f+c+1],s[f+1],s[f+c])}break;case q_.TRIANGLES:for(r=0,a=n.length;r<a;r+=3)Ky(i,e,n[r],n[r+1],n[r+2],s[r],s[r+1],s[r+2]);break;default:throw new Error("illegal figure")}}class N5 extends vE{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[6],this._background=t[7],this.matrix=null}_createMeshCanvas(t,e,n){const c=Math.floor(this._bounds[0]),u=Math.floor(this._bounds[1]),h=Math.ceil(this._bounds[2])-c,f=Math.ceil(this._bounds[3])-u,m=Math.min(Math.ceil(Math.abs(h*t[0]*1.1)),3e3),y=Math.min(Math.ceil(Math.abs(f*t[1]*1.1)),3e3),T=h/m,S=f/y,b={coords:this._coords,colors:this._colors,offsetX:-c,offsetY:-u,scaleX:1/T,scaleY:1/S},C=m+4,I=y+4,D=n.getCanvas("mesh",C,I),P=D.context,H=P.createImageData(m,y);if(e){const G=H.data;for(let N=0,x=G.length;N<x;N+=4)G[N]=e[0],G[N+1]=e[1],G[N+2]=e[2],G[N+3]=255}for(const G of this._figures)D5(H,G,b);return P.putImageData(H,2,2),{canvas:D.canvas,offsetX:c-2*T,offsetY:u-2*S,scaleX:T,scaleY:S}}isModifyingCurrentTransform(){return!0}getPattern(t,e,n,s){Q_(t,this._bbox);const r=new Float32Array(2);if(s===Rn.SHADING)Tt.singularValueDecompose2dScale(xe(t),r);else if(this.matrix){Tt.singularValueDecompose2dScale(this.matrix,r);const[c,u]=r;Tt.singularValueDecompose2dScale(e.baseTransform,r),r[0]*=c,r[1]*=u}else Tt.singularValueDecompose2dScale(e.baseTransform,r);const a=this._createMeshCanvas(r,s===Rn.SHADING?null:this._background,e.cachedCanvases);return s!==Rn.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(a.offsetX,a.offsetY),t.scale(a.scaleX,a.scaleY),t.createPattern(a.canvas,"no-repeat")}}class k5 extends vE{getPattern(){return"hotpink"}}function L5(i){switch(i[0]){case"RadialAxial":return new x5(i);case"Mesh":return new N5(i);case"Dummy":return new k5}throw new Error(`Unknown IR type: ${i[0]}`)}const BC={COLORED:1,UNCOLORED:2};class EE{static MAX_PATTERN_SIZE=3e3;constructor(t,e,n,s){this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=e,this.canvasGraphicsFactory=n,this.baseTransform=s}createPatternCanvas(t,e){const{bbox:n,operatorList:s,paintType:r,tilingType:a,color:c,canvasGraphicsFactory:u}=this;let{xstep:h,ystep:f}=this;h=Math.abs(h),f=Math.abs(f),pm("TilingType: "+a);const m=n[0],y=n[1],T=n[2],S=n[3],b=T-m,C=S-y,I=new Float32Array(2);Tt.singularValueDecompose2dScale(this.matrix,I);const[D,P]=I;Tt.singularValueDecompose2dScale(this.baseTransform,I);const H=D*I[0],F=P*I[1];let G=b,N=C,x=!1,k=!1;const V=Math.ceil(h*H),U=Math.ceil(f*F),$=Math.ceil(b*H),B=Math.ceil(C*F);V>=$?G=h:x=!0,U>=B?N=f:k=!0;const vt=this.getSizeAndScale(G,this.ctx.canvas.width,H),It=this.getSizeAndScale(N,this.ctx.canvas.height,F),W=t.cachedCanvases.getCanvas("pattern",vt.size,It.size),nt=W.context,ft=u.createCanvasGraphics(nt,e);if(ft.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(ft,r,c),nt.translate(-vt.scale*m,-It.scale*y),ft.transform(0,vt.scale,0,0,It.scale,0,0),nt.save(),ft.dependencyTracker?.save(),this.clipBbox(ft,m,y,T,S),ft.baseTransform=xe(ft.ctx),ft.executeOperatorList(s),ft.endDrawing(),ft.dependencyTracker?.restore(),nt.restore(),x||k){const xt=W.canvas;x&&(G=h),k&&(N=f);const z=this.getSizeAndScale(G,this.ctx.canvas.width,H),ot=this.getSizeAndScale(N,this.ctx.canvas.height,F),dt=z.size,ht=ot.size,_t=t.cachedCanvases.getCanvas("pattern-workaround",dt,ht),Ot=_t.context,St=x?Math.floor(b/h):0,$t=k?Math.floor(C/f):0;for(let Wt=0;Wt<=St;Wt++)for(let Xe=0;Xe<=$t;Xe++)Ot.drawImage(xt,dt*Wt,ht*Xe,dt,ht,0,0,dt,ht);return{canvas:_t.canvas,scaleX:z.scale,scaleY:ot.scale,offsetX:m,offsetY:y}}return{canvas:W.canvas,scaleX:vt.scale,scaleY:It.scale,offsetX:m,offsetY:y}}getSizeAndScale(t,e,n){const s=Math.max(EE.MAX_PATTERN_SIZE,e);let r=Math.ceil(t*n);return r>=s?r=s:n=r/t,{scale:n,size:r}}clipBbox(t,e,n,s,r){const a=s-e,c=r-n;t.ctx.rect(e,n,a,c),Tt.axialAlignedBoundingBox([e,n,s,r],xe(t.ctx),t.current.minMax),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,n){const s=t.ctx,r=t.current;switch(e){case BC.COLORED:const{fillStyle:a,strokeStyle:c}=this.ctx;s.fillStyle=r.fillColor=a,s.strokeStyle=r.strokeColor=c;break;case BC.UNCOLORED:s.fillStyle=s.strokeStyle=n,r.fillColor=r.strokeColor=n;break;default:throw new Kz(`Unsupported paint type: ${e}`)}}isModifyingCurrentTransform(){return!1}getPattern(t,e,n,s,r){let a=n;s!==Rn.SHADING&&(a=Tt.transform(a,e.baseTransform),this.matrix&&(a=Tt.transform(a,this.matrix)));const c=this.createPatternCanvas(e,r);let u=new DOMMatrix(a);u=u.translate(c.offsetX,c.offsetY),u=u.scale(1/c.scaleX,1/c.scaleY);const h=t.createPattern(c.canvas,"repeat");return h.setTransform(u),h}}function O5({src:i,srcPos:t=0,dest:e,width:n,height:s,nonBlackColor:r=4294967295,inverseDecode:a=!1}){const c=Pn.isLittleEndian?4278190080:255,[u,h]=a?[r,c]:[c,r],f=n>>3,m=n&7,y=i.length;e=new Uint32Array(e.buffer);let T=0;for(let S=0;S<s;S++){for(const C=t+f;t<C;t++){const I=t<y?i[t]:255;e[T++]=I&128?h:u,e[T++]=I&64?h:u,e[T++]=I&32?h:u,e[T++]=I&16?h:u,e[T++]=I&8?h:u,e[T++]=I&4?h:u,e[T++]=I&2?h:u,e[T++]=I&1?h:u}if(m===0)continue;const b=t<y?i[t++]:255;for(let C=0;C<m;C++)e[T++]=b&1<<7-C?h:u}return{srcPos:t,destPos:T}}const FC=16,HC=100,U5=15,GC=10,ii=16,Xy=new DOMMatrix,gi=new Float32Array(2),Ql=new Float32Array([1/0,1/0,-1/0,-1/0]);function V5(i,t){if(i._removeMirroring)throw new Error("Context is already forwarding operations.");i.__originalSave=i.save,i.__originalRestore=i.restore,i.__originalRotate=i.rotate,i.__originalScale=i.scale,i.__originalTranslate=i.translate,i.__originalTransform=i.transform,i.__originalSetTransform=i.setTransform,i.__originalResetTransform=i.resetTransform,i.__originalClip=i.clip,i.__originalMoveTo=i.moveTo,i.__originalLineTo=i.lineTo,i.__originalBezierCurveTo=i.bezierCurveTo,i.__originalRect=i.rect,i.__originalClosePath=i.closePath,i.__originalBeginPath=i.beginPath,i._removeMirroring=()=>{i.save=i.__originalSave,i.restore=i.__originalRestore,i.rotate=i.__originalRotate,i.scale=i.__originalScale,i.translate=i.__originalTranslate,i.transform=i.__originalTransform,i.setTransform=i.__originalSetTransform,i.resetTransform=i.__originalResetTransform,i.clip=i.__originalClip,i.moveTo=i.__originalMoveTo,i.lineTo=i.__originalLineTo,i.bezierCurveTo=i.__originalBezierCurveTo,i.rect=i.__originalRect,i.closePath=i.__originalClosePath,i.beginPath=i.__originalBeginPath,delete i._removeMirroring},i.save=function(){t.save(),this.__originalSave()},i.restore=function(){t.restore(),this.__originalRestore()},i.translate=function(e,n){t.translate(e,n),this.__originalTranslate(e,n)},i.scale=function(e,n){t.scale(e,n),this.__originalScale(e,n)},i.transform=function(e,n,s,r,a,c){t.transform(e,n,s,r,a,c),this.__originalTransform(e,n,s,r,a,c)},i.setTransform=function(e,n,s,r,a,c){t.setTransform(e,n,s,r,a,c),this.__originalSetTransform(e,n,s,r,a,c)},i.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},i.rotate=function(e){t.rotate(e),this.__originalRotate(e)},i.clip=function(e){t.clip(e),this.__originalClip(e)},i.moveTo=function(e,n){t.moveTo(e,n),this.__originalMoveTo(e,n)},i.lineTo=function(e,n){t.lineTo(e,n),this.__originalLineTo(e,n)},i.bezierCurveTo=function(e,n,s,r,a,c){t.bezierCurveTo(e,n,s,r,a,c),this.__originalBezierCurveTo(e,n,s,r,a,c)},i.rect=function(e,n,s,r){t.rect(e,n,s,r),this.__originalRect(e,n,s,r)},i.closePath=function(){t.closePath(),this.__originalClosePath()},i.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class B5{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,n){let s;return this.cache[t]!==void 0?(s=this.cache[t],this.canvasFactory.reset(s,e,n)):(s=this.canvasFactory.create(e,n),this.cache[t]=s),s}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function Df(i,t,e,n,s,r,a,c,u,h){const[f,m,y,T,S,b]=xe(i);if(m===0&&y===0){const D=a*f+S,P=Math.round(D),H=c*T+b,F=Math.round(H),G=(a+u)*f+S,N=Math.abs(Math.round(G)-P)||1,x=(c+h)*T+b,k=Math.abs(Math.round(x)-F)||1;return i.setTransform(Math.sign(f),0,0,Math.sign(T),P,F),i.drawImage(t,e,n,s,r,0,0,N,k),i.setTransform(f,m,y,T,S,b),[N,k]}if(f===0&&T===0){const D=c*y+S,P=Math.round(D),H=a*m+b,F=Math.round(H),G=(c+h)*y+S,N=Math.abs(Math.round(G)-P)||1,x=(a+u)*m+b,k=Math.abs(Math.round(x)-F)||1;return i.setTransform(0,Math.sign(m),Math.sign(y),0,P,F),i.drawImage(t,e,n,s,r,0,0,k,N),i.setTransform(f,m,y,T,S,b),[k,N]}i.drawImage(t,e,n,s,r,a,c,u,h);const C=Math.hypot(f,m),I=Math.hypot(y,T);return[C*u,I*h]}class qC{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=G_;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=bn.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(t,e,n){n?.(this),this.clipBox=new Float32Array([0,0,t,e]),this.minMax=Ql.slice()}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t.minMax=this.minMax.slice(),t}getPathBoundingBox(t=Rn.FILL,e=null){const n=this.minMax.slice();if(t===Rn.STROKE){e||Ee("Stroke bounding box must include transform."),Tt.singularValueDecompose2dScale(e,gi);const s=gi[0]*this.lineWidth/2,r=gi[1]*this.lineWidth/2;n[0]-=s,n[1]-=r,n[2]+=s,n[3]+=r}return n}updateClipFromPath(){const t=Tt.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(t){this.clipBox.set(t,0),this.minMax.set(Ql,0)}getClippedPathBoundingBox(t=Rn.FILL,e=null){return Tt.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function zC(i,t){if(t instanceof ImageData){i.putImageData(t,0,0);return}const e=t.height,n=t.width,s=e%ii,r=(e-s)/ii,a=s===0?r:r+1,c=i.createImageData(n,ii);let u=0,h;const f=t.data,m=c.data;let y,T,S,b;if(t.kind===Qf.GRAYSCALE_1BPP){const C=f.byteLength,I=new Uint32Array(m.buffer,0,m.byteLength>>2),D=I.length,P=n+7>>3,H=4294967295,F=Pn.isLittleEndian?4278190080:255;for(y=0;y<a;y++){for(S=y<r?ii:s,h=0,T=0;T<S;T++){const G=C-u;let N=0;const x=G>P?n:G*8-7,k=x&-8;let V=0,U=0;for(;N<k;N+=8)U=f[u++],I[h++]=U&128?H:F,I[h++]=U&64?H:F,I[h++]=U&32?H:F,I[h++]=U&16?H:F,I[h++]=U&8?H:F,I[h++]=U&4?H:F,I[h++]=U&2?H:F,I[h++]=U&1?H:F;for(;N<x;N++)V===0&&(U=f[u++],V=128),I[h++]=U&V?H:F,V>>=1}for(;h<D;)I[h++]=0;i.putImageData(c,0,y*ii)}}else if(t.kind===Qf.RGBA_32BPP){for(T=0,b=n*ii*4,y=0;y<r;y++)m.set(f.subarray(u,u+b)),u+=b,i.putImageData(c,0,T),T+=ii;y<a&&(b=n*s*4,m.set(f.subarray(u,u+b)),i.putImageData(c,0,T))}else if(t.kind===Qf.RGB_24BPP)for(S=ii,b=n*S,y=0;y<a;y++){for(y>=r&&(S=s,b=n*S),h=0,T=b;T--;)m[h++]=f[u++],m[h++]=f[u++],m[h++]=f[u++],m[h++]=255;i.putImageData(c,0,y*ii)}else throw new Error(`bad image kind: ${t.kind}`)}function $C(i,t){if(t.bitmap){i.drawImage(t.bitmap,0,0);return}const e=t.height,n=t.width,s=e%ii,r=(e-s)/ii,a=s===0?r:r+1,c=i.createImageData(n,ii);let u=0;const h=t.data,f=c.data;for(let m=0;m<a;m++){const y=m<r?ii:s;({srcPos:u}=O5({src:h,srcPos:u,dest:f,width:n,height:y,nonBlackColor:0})),i.putImageData(c,0,m*ii)}}function Yu(i,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const n of e)i[n]!==void 0&&(t[n]=i[n]);i.setLineDash!==void 0&&(t.setLineDash(i.getLineDash()),t.lineDashOffset=i.lineDashOffset)}function Nf(i){i.strokeStyle=i.fillStyle="#000000",i.fillRule="nonzero",i.globalAlpha=1,i.lineWidth=1,i.lineCap="butt",i.lineJoin="miter",i.miterLimit=10,i.globalCompositeOperation="source-over",i.font="10px sans-serif",i.setLineDash!==void 0&&(i.setLineDash([]),i.lineDashOffset=0);const{filter:t}=i;t!=="none"&&t!==""&&(i.filter="none")}function YC(i,t){if(t)return!0;Tt.singularValueDecompose2dScale(i,gi);const e=Math.fround(Vs.pixelRatio*Ac.PDF_TO_CSS_UNITS);return gi[0]<=e&&gi[1]<=e}const F5=["butt","round","square"],H5=["miter","round","bevel"],G5={},WC={};class cc{constructor(t,e,n,s,r,{optionalContentConfig:a,markedContentStack:c=null},u,h,f){this.ctx=t,this.current=new qC(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=n,this.canvasFactory=s,this.filterFactory=r,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=c||[],this.optionalContentConfig=a,this.cachedCanvases=new B5(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=u,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=h,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=f??null}getObject(t,e,n=null){return typeof e=="string"?(this.dependencyTracker?.recordNamedDependency(t,e),e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e)):n}beginDrawing({transform:t,viewport:e,transparency:n=!1,background:s=null}){const r=this.ctx.canvas.width,a=this.ctx.canvas.height,c=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,r,a),this.ctx.fillStyle=c,n){const u=this.cachedCanvases.getCanvas("transparent",r,a);this.compositeCtx=this.ctx,this.transparentCanvas=u.canvas,this.ctx=u.context,this.ctx.save(),this.ctx.transform(...xe(this.compositeCtx))}this.ctx.save(),Nf(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=xe(this.ctx)}executeOperatorList(t,e,n,s,r){const a=t.argsArray,c=t.fnArray;let u=e||0;const h=a.length;if(h===u)return u;const f=h-u>GC&&typeof n=="function",m=f?Date.now()+U5:0;let y=0;const T=this.commonObjs,S=this.objs;let b,C;for(;;){if(s!==void 0&&u===s.nextBreakPoint)return s.breakIt(u,n),u;if(!r||r(u))if(b=c[u],C=a[u]??null,b!==Sh.dependency)C===null?this[b](u):this[b](u,...C);else for(const I of C){this.dependencyTracker?.recordNamedData(I,u);const D=I.startsWith("g_")?T:S;if(!D.has(I))return D.get(I,n),u}if(u++,u===h)return u;if(f&&++y>GC){if(Date.now()>m)return n(),u;y=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}}_scaleImage(t,e){const n=t.width??t.displayWidth,s=t.height??t.displayHeight;let r=Math.max(Math.hypot(e[0],e[1]),1),a=Math.max(Math.hypot(e[2],e[3]),1),c=n,u=s,h="prescale1",f,m;for(;r>2&&c>1||a>2&&u>1;){let y=c,T=u;r>2&&c>1&&(y=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c/2),r/=c/y),a>2&&u>1&&(T=u>=16384?Math.floor(u/2)-1||1:Math.ceil(u)/2,a/=u/T),f=this.cachedCanvases.getCanvas(h,y,T),m=f.context,m.clearRect(0,0,y,T),m.drawImage(t,0,0,c,u,0,0,y,T),t=f.canvas,c=y,u=T,h=h==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:c,paintHeight:u}}_createMaskCanvas(t,e){const n=this.ctx,{width:s,height:r}=e,a=this.current.fillColor,c=this.current.patternFill,u=xe(n);let h,f,m,y;if((e.bitmap||e.data)&&e.count>1){const V=e.bitmap||e.data.buffer;f=JSON.stringify(c?u:[u.slice(0,4),a]),h=this._cachedBitmapsMap.get(V),h||(h=new Map,this._cachedBitmapsMap.set(V,h));const U=h.get(f);if(U&&!c){const $=Math.round(Math.min(u[0],u[2])+u[4]),B=Math.round(Math.min(u[1],u[3])+u[5]);return this.dependencyTracker?.recordDependencies(t,ki.transformAndFill),{canvas:U,offsetX:$,offsetY:B}}m=U}m||(y=this.cachedCanvases.getCanvas("maskCanvas",s,r),$C(y.context,e));let T=Tt.transform(u,[1/s,0,0,-1/r,0,0]);T=Tt.transform(T,[1,0,0,1,0,-r]);const S=Ql.slice();Tt.axialAlignedBoundingBox([0,0,s,r],T,S);const[b,C,I,D]=S,P=Math.round(I-b)||1,H=Math.round(D-C)||1,F=this.cachedCanvases.getCanvas("fillCanvas",P,H),G=F.context,N=b,x=C;G.translate(-N,-x),G.transform(...T),m||(m=this._scaleImage(y.canvas,Ss(G)),m=m.img,h&&c&&h.set(f,m)),G.imageSmoothingEnabled=YC(xe(G),e.interpolate),Df(G,m,0,0,m.width,m.height,0,0,s,r),G.globalCompositeOperation="source-in";const k=Tt.transform(Ss(G),[1,0,0,1,-N,-x]);return G.fillStyle=c?a.getPattern(n,this,k,Rn.FILL,t):a,G.fillRect(0,0,s,r),h&&!c&&(this.cachedCanvases.delete("fillCanvas"),h.set(f,F.canvas)),this.dependencyTracker?.recordDependencies(t,ki.transformAndFill),{canvas:F.canvas,offsetX:Math.round(N),offsetY:Math.round(x)}}setLineWidth(t,e){this.dependencyTracker?.recordSimpleData("lineWidth",t),e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(t,e){this.dependencyTracker?.recordSimpleData("lineCap",t),this.ctx.lineCap=F5[e]}setLineJoin(t,e){this.dependencyTracker?.recordSimpleData("lineJoin",t),this.ctx.lineJoin=H5[e]}setMiterLimit(t,e){this.dependencyTracker?.recordSimpleData("miterLimit",t),this.ctx.miterLimit=e}setDash(t,e,n){this.dependencyTracker?.recordSimpleData("dash",t);const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(e),s.lineDashOffset=n)}setRenderingIntent(t,e){}setFlatness(t,e){}setGState(t,e){for(const[n,s]of e)switch(n){case"LW":this.setLineWidth(t,s);break;case"LC":this.setLineCap(t,s);break;case"LJ":this.setLineJoin(t,s);break;case"ML":this.setMiterLimit(t,s);break;case"D":this.setDash(t,s[0],s[1]);break;case"RI":this.setRenderingIntent(t,s);break;case"FL":this.setFlatness(t,s);break;case"Font":this.setFont(t,s[0],s[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",t),this.current.strokeAlpha=s;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",t),this.ctx.globalAlpha=this.current.fillAlpha=s;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",t),this.ctx.globalCompositeOperation=s;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",t),this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",t),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(t){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,n=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,r=this.cachedCanvases.getCanvas(s,e,n);this.suspendedCtx=this.ctx;const a=this.ctx=r.context;a.setTransform(this.suspendedCtx.getTransform()),Yu(this.suspendedCtx,a),V5(a,this.suspendedCtx),this.setGState(t,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Yu(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,n,s){const r=s[0],a=s[1],c=s[2]-r,u=s[3]-a;c===0||u===0||(this.genericComposeSMask(e.context,n,c,u,e.subtype,e.backdrop,e.transferMap,r,a,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(n.canvas,0,0),t.restore())}genericComposeSMask(t,e,n,s,r,a,c,u,h,f,m){let y=t.canvas,T=u-f,S=h-m;if(a)if(T<0||S<0||T+n>y.width||S+s>y.height){const C=this.cachedCanvases.getCanvas("maskExtension",n,s),I=C.context;I.drawImage(y,-T,-S),I.globalCompositeOperation="destination-atop",I.fillStyle=a,I.fillRect(0,0,n,s),I.globalCompositeOperation="source-over",y=C.canvas,T=S=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const C=new Path2D;C.rect(T,S,n,s),t.clip(C),t.globalCompositeOperation="destination-atop",t.fillStyle=a,t.fillRect(T,S,n,s),t.restore()}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),r==="Alpha"&&c?e.filter=this.filterFactory.addAlphaFilter(c):r==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(c));const b=new Path2D;b.rect(u,h,n,s),e.clip(b),e.globalCompositeOperation="destination-in",e.drawImage(y,T,S,n,s,u,h,n,s),e.restore()}save(t){this.inSMaskMode&&Yu(this.ctx,this.suspendedCtx),this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone(),this.dependencyTracker?.save(t)}restore(t){if(this.dependencyTracker?.restore(t),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&Yu(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(t,e,n,s,r,a,c){this.dependencyTracker?.recordIncrementalData("transform",t),this.ctx.transform(e,n,s,r,a,c),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,n,s){let[r]=n;if(!s){r||=n[0]=new Path2D,this[e](t,r);return}if(this.dependencyTracker!==null){const a=e===Sh.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(t).recordBBox(t,this.ctx,s[0]-a,s[2]+a,s[1]-a,s[3]+a).recordDependencies(t,["transform"])}r instanceof Path2D||(r=n[0]=WM(r)),Tt.axialAlignedBoundingBox(s,xe(this.ctx),this.current.minMax),this[e](t,r),this._pathStartIdx=t}closePath(t){this.ctx.closePath()}stroke(t,e,n=!0){const s=this.ctx,r=this.current.strokeColor;if(s.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof r=="object"&&r?.getPattern){const a=r.isModifyingCurrentTransform()?s.getTransform():null;if(s.save(),s.strokeStyle=r.getPattern(s,this,Ss(s),Rn.STROKE,t),a){const c=new Path2D;c.addPath(e,s.getTransform().invertSelf().multiplySelf(a)),e=c}this.rescaleAndStroke(e,!1),s.restore()}else this.rescaleAndStroke(e,!0);this.dependencyTracker?.recordDependencies(t,ki.stroke),n&&this.consumePath(t,e,this.current.getClippedPathBoundingBox(Rn.STROKE,xe(this.ctx))),s.globalAlpha=this.current.fillAlpha}closeStroke(t,e){this.stroke(t,e)}fill(t,e,n=!0){const s=this.ctx,r=this.current.fillColor,a=this.current.patternFill;let c=!1;if(a){const h=r.isModifyingCurrentTransform()?s.getTransform():null;if(this.dependencyTracker?.save(t),s.save(),s.fillStyle=r.getPattern(s,this,Ss(s),Rn.FILL,t),h){const f=new Path2D;f.addPath(e,s.getTransform().invertSelf().multiplySelf(h)),e=f}c=!0}const u=this.current.getClippedPathBoundingBox();this.contentVisible&&u!==null&&(this.pendingEOFill?(s.fill(e,"evenodd"),this.pendingEOFill=!1):s.fill(e)),this.dependencyTracker?.recordDependencies(t,ki.fill),c&&(s.restore(),this.dependencyTracker?.restore(t)),n&&this.consumePath(t,e,u)}eoFill(t,e){this.pendingEOFill=!0,this.fill(t,e)}fillStroke(t,e){this.fill(t,e,!1),this.stroke(t,e,!1),this.consumePath(t,e)}eoFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}closeFillStroke(t,e){this.fillStroke(t,e)}closeEOFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}endPath(t,e){this.consumePath(t,e)}rawFillPath(t,e){this.ctx.fill(e),this.dependencyTracker?.recordDependencies(t,ki.rawFillPath).recordOperation(t)}clip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=G5}eoClip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=WC}beginText(t){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(t).resetIncrementalData("sameLineText").resetIncrementalData("moveText",t)}endText(t){const e=this.pendingTextPaths,n=this.ctx;if(this.dependencyTracker){const{dependencyTracker:s}=this;e!==void 0&&s.recordFutureForcedDependency("textClip",s.getOpenMarker()).recordFutureForcedDependency("textClip",t),s.recordCloseMarker(t)}if(e!==void 0){const s=new Path2D,r=n.getTransform().invertSelf();for(const{transform:a,x:c,y:u,fontSize:h,path:f}of e)f&&s.addPath(f,new DOMMatrix(a).preMultiplySelf(r).translate(c,u).scale(h,-h));n.clip(s)}delete this.pendingTextPaths}setCharSpacing(t,e){this.dependencyTracker?.recordSimpleData("charSpacing",t),this.current.charSpacing=e}setWordSpacing(t,e){this.dependencyTracker?.recordSimpleData("wordSpacing",t),this.current.wordSpacing=e}setHScale(t,e){this.dependencyTracker?.recordSimpleData("hScale",t),this.current.textHScale=e/100}setLeading(t,e){this.dependencyTracker?.recordSimpleData("leading",t),this.current.leading=-e}setFont(t,e,n){this.dependencyTracker?.recordSimpleData("font",t).recordSimpleDataFromNamed("fontObj",e,t);const s=this.commonObjs.get(e),r=this.current;if(!s)throw new Error(`Can't find font for ${e}`);if(r.fontMatrix=s.fontMatrix||G_,(r.fontMatrix[0]===0||r.fontMatrix[3]===0)&&Ft("Invalid font matrix for font "+e),n<0?(n=-n,r.fontDirection=-1):r.fontDirection=1,this.current.font=s,this.current.fontSize=n,s.isType3Font)return;const a=s.loadedName||"sans-serif",c=s.systemFontInfo?.css||`"${a}", ${s.fallbackName}`;let u="normal";s.black?u="900":s.bold&&(u="bold");const h=s.italic?"italic":"normal";let f=n;n<FC?f=FC:n>HC&&(f=HC),this.current.fontSizeScale=n/f,this.ctx.font=`${h} ${u} ${f}px ${c}`}setTextRenderingMode(t,e){this.dependencyTracker?.recordSimpleData("textRenderingMode",t),this.current.textRenderingMode=e}setTextRise(t,e){this.dependencyTracker?.recordSimpleData("textRise",t),this.current.textRise=e}moveText(t,e,n){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",t),this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=n}setLeadingMoveText(t,e,n){this.setLeading(t,-n),this.moveText(t,e,n)}setTextMatrix(t,e){this.dependencyTracker?.resetIncrementalData("sameLineText").recordSimpleData("textMatrix",t);const{current:n}=this;n.textMatrix=e,n.textMatrixScale=Math.hypot(e[0],e[1]),n.x=n.lineX=0,n.y=n.lineY=0}nextLine(t){this.moveText(t,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??t)}#i(t,e,n){const s=new Path2D;return s.addPath(t,new DOMMatrix(n).invertSelf().multiplySelf(e)),s}paintChar(t,e,n,s,r,a){const c=this.ctx,u=this.current,h=u.font,f=u.textRenderingMode,m=u.fontSize/u.fontSizeScale,y=f&bn.FILL_STROKE_MASK,T=!!(f&bn.ADD_TO_PATH_FLAG),S=u.patternFill&&!h.missingFile,b=u.patternStroke&&!h.missingFile;let C;if((h.disableFontFace||T||S||b)&&!h.missingFile&&(C=h.getPathGenerator(this.commonObjs,e)),C&&(h.disableFontFace||S||b)){c.save(),c.translate(n,s),c.scale(m,-m),this.dependencyTracker?.recordCharacterBBox(t,c,h);let I;if(y===bn.FILL||y===bn.FILL_STROKE)if(r){I=c.getTransform(),c.setTransform(...r);const D=this.#i(C,I,r);c.fill(D)}else c.fill(C);if(y===bn.STROKE||y===bn.FILL_STROKE)if(a){I||=c.getTransform(),c.setTransform(...a);const{a:D,b:P,c:H,d:F}=I,G=Tt.inverseTransform(a),N=Tt.transform([D,P,H,F,0,0],G);Tt.singularValueDecompose2dScale(N,gi),c.lineWidth*=Math.max(gi[0],gi[1])/m,c.stroke(this.#i(C,I,a))}else c.lineWidth/=m,c.stroke(C);c.restore()}else(y===bn.FILL||y===bn.FILL_STROKE)&&(c.fillText(e,n,s),this.dependencyTracker?.recordCharacterBBox(t,c,h,m,n,s,()=>c.measureText(e))),(y===bn.STROKE||y===bn.FILL_STROKE)&&(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(t,c,h,m,n,s,()=>c.measureText(e)).recordDependencies(t,ki.stroke),c.strokeText(e,n,s));T&&((this.pendingTextPaths||=[]).push({transform:xe(c),x:n,y:s,fontSize:m,path:C}),this.dependencyTracker?.recordCharacterBBox(t,c,h,m,n,s))}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let n=!1;for(let s=3;s<e.length;s+=4)if(e[s]>0&&e[s]<255){n=!0;break}return Ht(this,"isFontSubpixelAAEnabled",n)}showText(t,e){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(t,ki.showText).resetBBox(t),this.current.textRenderingMode&bn.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",t).inheritPendingDependenciesAsFutureForcedDependencies());const n=this.current,s=n.font;if(s.isType3Font){this.showType3Text(t,e),this.dependencyTracker?.recordShowTextOperation(t);return}const r=n.fontSize;if(r===0){this.dependencyTracker?.recordOperation(t);return}const a=this.ctx,c=n.fontSizeScale,u=n.charSpacing,h=n.wordSpacing,f=n.fontDirection,m=n.textHScale*f,y=e.length,T=s.vertical,S=T?1:-1,b=s.defaultVMetrics,C=r*n.fontMatrix[0],I=n.textRenderingMode===bn.FILL&&!s.disableFontFace&&!n.patternFill;a.save(),n.textMatrix&&a.transform(...n.textMatrix),a.translate(n.x,n.y+n.textRise),f>0?a.scale(m,-1):a.scale(m,1);let D,P;if(n.patternFill){a.save();const x=n.fillColor.getPattern(a,this,Ss(a),Rn.FILL,t);D=xe(a),a.restore(),a.fillStyle=x}if(n.patternStroke){a.save();const x=n.strokeColor.getPattern(a,this,Ss(a),Rn.STROKE,t);P=xe(a),a.restore(),a.strokeStyle=x}let H=n.lineWidth;const F=n.textMatrixScale;if(F===0||H===0){const x=n.textRenderingMode&bn.FILL_STROKE_MASK;(x===bn.STROKE||x===bn.FILL_STROKE)&&(H=this.getSinglePixelWidth())}else H/=F;if(c!==1&&(a.scale(c,c),H/=c),a.lineWidth=H,s.isInvalidPDFjsFont){const x=[];let k=0;for(const U of e)x.push(U.unicode),k+=U.width;const V=x.join("");if(a.fillText(V,0,0),this.dependencyTracker!==null){const U=a.measureText(V);this.dependencyTracker.recordBBox(t,this.ctx,-U.actualBoundingBoxLeft,U.actualBoundingBoxRight,-U.actualBoundingBoxAscent,U.actualBoundingBoxDescent).recordShowTextOperation(t)}n.x+=k*C*m,a.restore(),this.compose();return}let G=0,N;for(N=0;N<y;++N){const x=e[N];if(typeof x=="number"){G+=S*x*r/1e3;continue}let k=!1;const V=(x.isSpace?h:0)+u,U=x.fontChar,$=x.accent;let B,vt,It=x.width;if(T){const ft=x.vmetric||b,xt=-(x.vmetric?ft[1]:It*.5)*C,z=ft[2]*C;It=ft?-ft[0]:It,B=xt/c,vt=(G+z)/c}else B=G/c,vt=0;let W;if(s.remeasure&&It>0){W=a.measureText(U);const ft=W.width*1e3/r*c;if(It<ft&&this.isFontSubpixelAAEnabled){const xt=It/ft;k=!0,a.save(),a.scale(xt,1),B/=xt}else It!==ft&&(B+=(It-ft)/2e3*r/c)}if(this.contentVisible&&(x.isInFont||s.missingFile)){if(I&&!$)a.fillText(U,B,vt),this.dependencyTracker?.recordCharacterBBox(t,a,W?{bbox:null}:s,r/c,B,vt,()=>W??a.measureText(U));else if(this.paintChar(t,U,B,vt,D,P),$){const ft=B+r*$.offset.x/c,xt=vt-r*$.offset.y/c;this.paintChar(t,$.fontChar,ft,xt,D,P)}}const nt=T?It*C-V*f:It*C+V*f;G+=nt,k&&a.restore()}T?n.y-=G:n.x+=G*m,a.restore(),this.compose(),this.dependencyTracker?.recordShowTextOperation(t)}showType3Text(t,e){const n=this.ctx,s=this.current,r=s.font,a=s.fontSize,c=s.fontDirection,u=r.vertical?1:-1,h=s.charSpacing,f=s.wordSpacing,m=s.textHScale*c,y=s.fontMatrix||G_,T=e.length,S=s.textRenderingMode===bn.INVISIBLE;let b,C,I,D;if(S||a===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,n.save(),s.textMatrix&&n.transform(...s.textMatrix),n.translate(s.x,s.y+s.textRise),n.scale(m,c);const P=this.dependencyTracker;for(this.dependencyTracker=P?new Dp(P,t):null,b=0;b<T;++b){if(C=e[b],typeof C=="number"){D=u*C*a/1e3,this.ctx.translate(D,0),s.x+=D*m;continue}const H=(C.isSpace?f:0)+h,F=r.charProcOperatorList[C.operatorListId];F?this.contentVisible&&(this.save(),n.scale(a,a),n.transform(...y),this.executeOperatorList(F),this.restore()):Ft(`Type3 character "${C.operatorListId}" is not available.`);const G=[C.width,0];Tt.applyTransform(G,y),I=G[0]*a+H,n.translate(I,0),s.x+=I*m}n.restore(),P&&(this.dependencyTracker=P)}setCharWidth(t,e,n){}setCharWidthAndBounds(t,e,n,s,r,a,c){const u=new Path2D;u.rect(s,r,a-s,c-r),this.ctx.clip(u),this.dependencyTracker?.recordBBox(t,this.ctx,s,a,r,c).recordClipBox(t,this.ctx,s,a,r,c),this.endPath(t)}getColorN_Pattern(t,e){let n;if(e[0]==="TilingPattern"){const s=this.baseTransform||xe(this.ctx),r={createCanvasGraphics:(a,c)=>new cc(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new Dp(this.dependencyTracker,c,!0):null)};n=new EE(e,this.ctx,r,s)}else n=this._getPattern(t,e[1],e[2]);return n}setStrokeColorN(t,...e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.current.strokeColor=this.getColorN_Pattern(t,e),this.current.patternStroke=!0}setFillColorN(t,...e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.current.fillColor=this.getColorN_Pattern(t,e),this.current.patternFill=!0}setStrokeRGBColor(t,e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor=e,this.current.patternStroke=!1}setStrokeTransparent(t){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor=e,this.current.patternFill=!1}setFillTransparent(t){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e,n=null){let s;return this.cachedPatterns.has(e)?s=this.cachedPatterns.get(e):(s=L5(this.getObject(t,e)),this.cachedPatterns.set(e,s)),n&&(s.matrix=n),s}shadingFill(t,e){if(!this.contentVisible)return;const n=this.ctx;this.save(t);const s=this._getPattern(t,e);n.fillStyle=s.getPattern(n,this,Ss(n),Rn.SHADING,t);const r=Ss(n);if(r){const{width:a,height:c}=n.canvas,u=Ql.slice();Tt.axialAlignedBoundingBox([0,0,a,c],r,u);const[h,f,m,y]=u;this.ctx.fillRect(h,f,m-h,y-f)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(t).recordFullPageBBox(t).recordDependencies(t,ki.transform).recordDependencies(t,ki.fill).recordOperation(t),this.compose(this.current.getClippedPathBoundingBox()),this.restore(t)}beginInlineImage(){Ee("Should not call beginInlineImage")}beginImageData(){Ee("Should not call beginImageData")}paintFormXObjectBegin(t,e,n){if(this.contentVisible&&(this.save(t),this.baseTransformStack.push(this.baseTransform),e&&this.transform(t,...e),this.baseTransform=xe(this.ctx),n)){Tt.axialAlignedBoundingBox(n,this.baseTransform,this.current.minMax);const[s,r,a,c]=n,u=new Path2D;u.rect(s,r,a-s,c-r),this.ctx.clip(u),this.dependencyTracker?.recordClipBox(t,this.ctx,s,a,r,c),this.endPath(t)}}paintFormXObjectEnd(t){this.contentVisible&&(this.restore(t),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t,e){if(!this.contentVisible)return;this.save(t),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const n=this.ctx;e.isolated||pm("TODO: Support non-isolated groups."),e.knockout&&Ft("Knockout groups not supported.");const s=xe(n);if(e.matrix&&n.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let r=Ql.slice();Tt.axialAlignedBoundingBox(e.bbox,xe(n),r);const a=[0,0,n.canvas.width,n.canvas.height];r=Tt.intersect(r,a)||[0,0,0,0];const c=Math.floor(r[0]),u=Math.floor(r[1]),h=Math.max(Math.ceil(r[2])-c,1),f=Math.max(Math.ceil(r[3])-u,1);this.current.startNewPathAndClipBox([0,0,h,f]);let m="groupAt"+this.groupLevel;e.smask&&(m+="_smask_"+this.smaskCounter++%2);const y=this.cachedCanvases.getCanvas(m,h,f),T=y.context;T.translate(-c,-u),T.transform(...s);let S=new Path2D;const[b,C,I,D]=e.bbox;if(S.rect(b,C,I-b,D-C),e.matrix){const P=new Path2D;P.addPath(S,new DOMMatrix(e.matrix)),S=P}T.clip(S),e.smask&&this.smaskStack.push({canvas:y.canvas,context:T,offsetX:c,offsetY:u,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}),(!e.smask||this.dependencyTracker)&&(n.setTransform(1,0,0,1,0,0),n.translate(c,u),n.save()),Yu(n,T),this.ctx=T,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(n),this.setGState(t,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(n),this.groupLevel++}endGroup(t,e){if(!this.contentVisible)return;this.groupLevel--;const n=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),e.smask)this.tempSMask=this.smaskStack.pop(),this.restore(t),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const r=xe(this.ctx);this.restore(t),this.ctx.save(),this.ctx.setTransform(...r);const a=Ql.slice();Tt.axialAlignedBoundingBox([0,0,n.canvas.width,n.canvas.height],r,a),this.ctx.drawImage(n.canvas,0,0),this.ctx.restore(),this.compose(a)}}beginAnnotation(t,e,n,s,r,a){if(this.#t(),Nf(this.ctx),this.ctx.save(),this.save(t),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),n){const c=n[2]-n[0],u=n[3]-n[1];if(a&&this.annotationCanvasMap){s=s.slice(),s[4]-=n[0],s[5]-=n[1],n=n.slice(),n[0]=n[1]=0,n[2]=c,n[3]=u,Tt.singularValueDecompose2dScale(xe(this.ctx),gi);const{viewportScale:h}=this,f=Math.ceil(c*this.outputScaleX*h),m=Math.ceil(u*this.outputScaleY*h);this.annotationCanvas=this.canvasFactory.create(f,m);const{canvas:y,context:T}=this.annotationCanvas;this.annotationCanvasMap.set(e,y),this.annotationCanvas.savedCtx=this.ctx,this.ctx=T,this.ctx.save(),this.ctx.setTransform(gi[0],0,0,-gi[1],0,u*gi[1]),Nf(this.ctx)}else{Nf(this.ctx),this.endPath(t);const h=new Path2D;h.rect(n[0],n[1],c,u),this.ctx.clip(h)}}this.current=new qC(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(t,...s),this.transform(t,...r)}endAnnotation(t){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t,e){if(!this.contentVisible)return;const n=e.count;e=this.getObject(t,e.data,e),e.count=n;const s=this.ctx,r=this._createMaskCanvas(t,e),a=r.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(a,r.offsetX,r.offsetY),this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,r.offsetX,r.offsetX+a.width,r.offsetY,r.offsetY+a.height).recordOperation(t),s.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,n,s=0,r=0,a,c){if(!this.contentVisible)return;e=this.getObject(t,e.data,e);const u=this.ctx;u.save();const h=xe(u);u.transform(n,s,r,a,0,0);const f=this._createMaskCanvas(t,e);u.setTransform(1,0,0,1,f.offsetX-h[4],f.offsetY-h[5]),this.dependencyTracker?.resetBBox(t);for(let m=0,y=c.length;m<y;m+=2){const T=Tt.transform(h,[n,s,r,a,c[m],c[m+1]]);u.drawImage(f.canvas,T[4],T[5]),this.dependencyTracker?.recordBBox(t,this.ctx,T[4],T[4]+f.canvas.width,T[5],T[5]+f.canvas.height)}u.restore(),this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageMaskXObjectGroup(t,e){if(!this.contentVisible)return;const n=this.ctx,s=this.current.fillColor,r=this.current.patternFill;this.dependencyTracker?.resetBBox(t).recordDependencies(t,ki.transformAndFill);for(const a of e){const{data:c,width:u,height:h,transform:f}=a,m=this.cachedCanvases.getCanvas("maskCanvas",u,h),y=m.context;y.save();const T=this.getObject(t,c,a);$C(y,T),y.globalCompositeOperation="source-in",y.fillStyle=r?s.getPattern(y,this,Ss(n),Rn.FILL,t):s,y.fillRect(0,0,u,h),y.restore(),n.save(),n.transform(...f),n.scale(1,-1),Df(n,m.canvas,0,0,u,h,0,-1,1,1),this.dependencyTracker?.recordBBox(t,n,0,u,0,h),n.restore()}this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageXObject(t,e){if(!this.contentVisible)return;const n=this.getObject(t,e);if(!n){Ft("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t,n)}paintImageXObjectRepeat(t,e,n,s,r){if(!this.contentVisible)return;const a=this.getObject(t,e);if(!a){Ft("Dependent image isn't ready yet");return}const c=a.width,u=a.height,h=[];for(let f=0,m=r.length;f<m;f+=2)h.push({transform:[n,0,0,s,r[f],r[f+1]],x:0,y:0,w:c,h:u});this.paintInlineImageXObjectGroup(t,a,h)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:n,height:s}=t,r=this.cachedCanvases.getCanvas("inlineImage",n,s),a=r.context;return a.filter=this.current.transferMaps,a.drawImage(e,0,0),a.filter="none",r.canvas}paintInlineImageXObject(t,e){if(!this.contentVisible)return;const n=e.width,s=e.height,r=this.ctx;this.save(t);const{filter:a}=r;a!=="none"&&a!==""&&(r.filter="none"),r.scale(1/n,-1/s);let c;if(e.bitmap)c=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)c=e;else{const f=this.cachedCanvases.getCanvas("inlineImage",n,s).context;zC(f,e),c=this.applyTransferMapsToCanvas(f)}const u=this._scaleImage(c,Ss(r));r.imageSmoothingEnabled=YC(xe(r),e.interpolate),this.dependencyTracker?.resetBBox(t).recordBBox(t,r,0,n,-s,0).recordDependencies(t,ki.imageXObject).recordOperation(t),Df(r,u.img,0,0,u.paintWidth,u.paintHeight,0,-s,n,s),this.compose(),this.restore(t)}paintInlineImageXObjectGroup(t,e,n){if(!this.contentVisible)return;const s=this.ctx;let r;if(e.bitmap)r=e.bitmap;else{const a=e.width,c=e.height,h=this.cachedCanvases.getCanvas("inlineImage",a,c).context;zC(h,e),r=this.applyTransferMapsToCanvas(h)}this.dependencyTracker?.resetBBox(t);for(const a of n)s.save(),s.transform(...a.transform),s.scale(1,-1),Df(s,r,a.x,a.y,a.w,a.h,0,-1,1,1),this.dependencyTracker?.recordBBox(t,s,0,1,-1,0),s.restore();this.dependencyTracker?.recordOperation(t),this.compose()}paintSolidColorImageMask(t){this.contentVisible&&(this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,0,1,0,1).recordDependencies(t,ki.fill).recordOperation(t),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t,e){}markPointProps(t,e,n){}beginMarkedContent(t,e){this.dependencyTracker?.beginMarkedContent(t),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e,n){this.dependencyTracker?.beginMarkedContent(t),e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(n)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(t){this.dependencyTracker?.endMarkedContent(t),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(t){}endCompat(t){}consumePath(t,e,n){const s=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(n);const r=this.ctx;this.pendingClip?(s||(this.pendingClip===WC?r.clip(e,"evenodd"):r.clip(e)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(t).recordFutureForcedDependency("clipPath",t)):this.dependencyTracker?.recordOperation(t),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=xe(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),n=Math.hypot(t[0],t[2]),s=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(n,s)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:n,c:s,d:r}=this.ctx.getTransform();let a,c;if(n===0&&s===0){const u=Math.abs(e),h=Math.abs(r);if(u===h)if(t===0)a=c=1/u;else{const f=u*t;a=c=f<1?1/f:1}else if(t===0)a=1/u,c=1/h;else{const f=u*t,m=h*t;a=f<1?1/f:1,c=m<1?1/m:1}}else{const u=Math.abs(e*r-n*s),h=Math.hypot(e,n),f=Math.hypot(s,r);if(t===0)a=f/u,c=h/u;else{const m=t*u;a=f>m?f/m:1,c=h>m?h/m:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=c}return this._cachedScaleForStroking}rescaleAndStroke(t,e){const{ctx:n,current:{lineWidth:s}}=this,[r,a]=this.getScaleForStroking();if(r===a){n.lineWidth=(s||1)*r,n.stroke(t);return}const c=n.getLineDash();e&&n.save(),n.scale(r,a),Xy.a=1/r,Xy.d=1/a;const u=new Path2D;if(u.addPath(t,Xy),c.length>0){const h=Math.max(r,a);n.setLineDash(c.map(f=>f/h)),n.lineDashOffset/=h}n.lineWidth=s||1,n.stroke(u),e&&n.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}}for(const i in Sh)cc.prototype[i]!==void 0&&(cc.prototype[Sh[i]]=cc.prototype[i]);class uc{static#t=null;static#e="";static get workerPort(){return this.#t}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");this.#t=t}static get workerSrc(){return this.#e}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");this.#e=t}}class q5{#t;#e;constructor({parsedData:t,rawData:e}){this.#t=t,this.#e=e}getRaw(){return this.#e}get(t){return this.#t.get(t)??null}[Symbol.iterator](){return this.#t.entries()}}const $l=Symbol("INTERNAL");class z5{#t=!1;#e=!1;#i=!1;#n=!0;constructor(t,{name:e,intent:n,usage:s,rbGroups:r}){this.#t=!!(t&mi.DISPLAY),this.#e=!!(t&mi.PRINT),this.name=e,this.intent=n,this.usage=s,this.rbGroups=r}get visible(){if(this.#i)return this.#n;if(!this.#n)return!1;const{print:t,view:e}=this.usage;return this.#t?e?.viewState!=="OFF":this.#e?t?.printState!=="OFF":!0}_setVisible(t,e,n=!1){t!==$l&&Ee("Internal method `_setVisible` called."),this.#i=n,this.#n=e}}class $5{#t=null;#e=new Map;#i=null;#n=null;constructor(t,e=mi.DISPLAY){if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,this.#n=t.order;for(const n of t.groups)this.#e.set(n.id,new z5(e,n));if(t.baseState==="OFF")for(const n of this.#e.values())n._setVisible($l,!1);for(const n of t.on)this.#e.get(n)._setVisible($l,!0);for(const n of t.off)this.#e.get(n)._setVisible($l,!1);this.#i=this.getHash()}}#o(t){const e=t.length;if(e<2)return!0;const n=t[0];for(let s=1;s<e;s++){const r=t[s];let a;if(Array.isArray(r))a=this.#o(r);else if(this.#e.has(r))a=this.#e.get(r).visible;else return Ft(`Optional content group not found: ${r}`),!0;switch(n){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return n==="And"}isVisible(t){if(this.#e.size===0)return!0;if(!t)return pm("Optional content group not defined."),!0;if(t.type==="OCG")return this.#e.has(t.id)?this.#e.get(t.id).visible:(Ft(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return this.#o(t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!this.#e.has(e))return Ft(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!this.#e.has(e))return Ft(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!this.#e.has(e))return Ft(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!this.#e.has(e))return Ft(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!1}return!0}return Ft(`Unknown optional content policy ${t.policy}.`),!0}return Ft(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,n=!0){const s=this.#e.get(t);if(!s){Ft(`Optional content group not found: ${t}`);return}if(n&&e&&s.rbGroups.length)for(const r of s.rbGroups)for(const a of r)a!==t&&this.#e.get(a)?._setVisible($l,!1,!0);s._setVisible($l,!!e,!0),this.#t=null}setOCGState({state:t,preserveRB:e}){let n;for(const s of t){switch(s){case"ON":case"OFF":case"Toggle":n=s;continue}const r=this.#e.get(s);if(r)switch(n){case"ON":this.setVisibility(s,!0,e);break;case"OFF":this.setVisibility(s,!1,e);break;case"Toggle":this.setVisibility(s,!r.visible,e);break}}this.#t=null}get hasInitialVisibility(){return this.#i===null||this.getHash()===this.#i}getOrder(){return this.#e.size?this.#n?this.#n.slice():[...this.#e.keys()]:null}getGroup(t){return this.#e.get(t)||null}getHash(){if(this.#t!==null)return this.#t;const t=new XM;for(const[e,n]of this.#e)t.update(`${e}:${n.visible}`);return this.#t=t.hexdigest()}[Symbol.iterator](){return this.#e.entries()}}class Y5{constructor(t,{disableRange:e=!1,disableStream:n=!1}){ee(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:s,initialData:r,progressiveDone:a,contentDispositionFilename:c}=t;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=c,r?.length>0){const u=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(u)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!n,this._isRangeSupported=!e,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((u,h)=>{this._onReceiveData({begin:u,chunk:h})}),t.addProgressListener((u,h)=>{this._onProgress({loaded:u,total:h})}),t.addProgressiveReadListener(u=>{this._onReceiveData({chunk:u})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const n=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{const s=this._rangeReaders.some(function(r){return r._begin!==t?!1:(r._enqueue(n),!0)});ee(s,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(t){t.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:t.loaded}):this._fullRequestReader?.onProgress?.({loaded:t.loaded,total:t.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){ee(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new W5(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new K5(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeReaders.slice(0))e.cancel(t);this._pdfDataRangeTransport.abort()}}class W5{constructor(t,e,n=!1,s=null){this._stream=t,this._done=n||!1,this._filename=pE(s)?s:null,this._queuedChunks=e||[],this._loaded=0;for(const r of this._queuedChunks)this._loaded+=r.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class K5{constructor(t,e,n){this._stream=t,this._begin=e,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function X5(i){let t=!0,e=n("filename\\*","i").exec(i);if(e){e=e[1];let f=c(e);return f=unescape(f),f=u(f),f=h(f),r(f)}if(e=a(i),e){const f=h(e);return r(f)}if(e=n("filename","i").exec(i),e){e=e[1];let f=c(e);return f=h(f),r(f)}function n(f,m){return new RegExp("(?:^|;)\\s*"+f+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',m)}function s(f,m){if(f){if(!/^[\x00-\xFF]+$/.test(m))return m;try{const y=new TextDecoder(f,{fatal:!0}),T=Gh(m);m=y.decode(T),t=!1}catch{}}return m}function r(f){return t&&/[\x80-\xff]/.test(f)&&(f=s("utf-8",f),t&&(f=s("iso-8859-1",f))),f}function a(f){const m=[];let y;const T=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(y=T.exec(f))!==null;){let[,b,C,I]=y;if(b=parseInt(b,10),b in m){if(b===0)break;continue}m[b]=[C,I]}const S=[];for(let b=0;b<m.length&&b in m;++b){let[C,I]=m[b];I=c(I),C&&(I=unescape(I),b===0&&(I=u(I))),S.push(I)}return S.join("")}function c(f){if(f.startsWith('"')){const m=f.slice(1).split('\\"');for(let y=0;y<m.length;++y){const T=m[y].indexOf('"');T!==-1&&(m[y]=m[y].slice(0,T),m.length=y+1),m[y]=m[y].replaceAll(/\\(.)/g,"$1")}f=m.join('"')}return f}function u(f){const m=f.indexOf("'");if(m===-1)return f;const y=f.slice(0,m),S=f.slice(m+1).replace(/^[^']*'/,"");return s(y,S)}function h(f){return!f.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(f)?f:f.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(m,y,T,S){if(T==="q"||T==="Q")return S=S.replaceAll("_"," "),S=S.replaceAll(/=([0-9a-fA-F]{2})/g,function(b,C){return String.fromCharCode(parseInt(C,16))}),s(y,S);try{S=atob(S)}catch{}return s(y,S)})}return""}function nP(i,t){const e=new Headers;if(!i||!t||typeof t!="object")return e;for(const n in t){const s=t[n];s!==void 0&&e.append(n,s)}return e}function ym(i){return URL.parse(i)?.origin??null}function iP({responseHeaders:i,isHttp:t,rangeChunkSize:e,disableRange:n}){const s={allowRangeRequests:!1,suggestedLength:void 0},r=parseInt(i.get("Content-Length"),10);return!Number.isInteger(r)||(s.suggestedLength=r,r<=2*e)||n||!t||i.get("Accept-Ranges")!=="bytes"||(i.get("Content-Encoding")||"identity")!=="identity"||(s.allowRangeRequests=!0),s}function sP(i){const t=i.get("Content-Disposition");if(t){let e=X5(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(pE(e))return e}return null}function Wh(i,t){return new xp(`Unexpected server response (${i}) while retrieving PDF "${t}".`,i,i===404||i===0&&t.startsWith("file:"))}function rP(i){return i===200||i===206}function oP(i,t,e){return{method:"GET",headers:i,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function aP(i){return i instanceof Uint8Array?i.buffer:i instanceof ArrayBuffer?i:(Ft(`getArrayBuffer - unexpected data format: ${i}`),new Uint8Array(i).buffer)}class J5{_responseOrigin=null;constructor(t){this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=nP(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return ee(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Q5(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new j5(this,t,e);return this._rangeRequestReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class Q5{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const n=new Headers(t.headers),s=e.url;fetch(s,oP(n,this._withCredentials,this._abortController)).then(r=>{if(t._responseOrigin=ym(r.url),!rP(r.status))throw Wh(r.status,s);this._reader=r.body.getReader(),this._headersCapability.resolve();const a=r.headers,{allowRangeRequests:c,suggestedLength:u}=iP({responseHeaders:a,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=c,this._contentLength=u||this._contentLength,this._filename=sP(a),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Do("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:aP(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}class j5{constructor(t,e,n){this._stream=t,this._reader=null,this._loaded=0;const s=t.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController;const r=new Headers(t.headers);r.append("Range",`bytes=${e}-${n-1}`);const a=s.url;fetch(a,oP(r,this._withCredentials,this._abortController)).then(c=>{const u=ym(c.url);if(u!==t._responseOrigin)throw new Error(`Expected range response-origin "${u}" to match "${t._responseOrigin}".`);if(!rP(c.status))throw Wh(c.status,a);this._readCapability.resolve(),this._reader=c.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded}),{value:aP(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}const Jy=200,Qy=206;function Z5(i){const t=i.response;return typeof t!="string"?t:Gh(t).buffer}class t9{_responseOrigin=null;constructor({url:t,httpHeaders:e,withCredentials:n}){this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=nP(this.isHttp,e),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest,n=this.currXhrId++,s=this.pendingRequests[n]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[r,a]of this.headers)e.setRequestHeader(r,a);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),s.expectedStatus=Qy):s.expectedStatus=Jy,e.responseType="arraybuffer",ee(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,n),e.onprogress=this.onProgress.bind(this,n),s.onHeadersReceived=t.onHeadersReceived,s.onDone=t.onDone,s.onError=t.onError,s.onProgress=t.onProgress,e.send(null),n}onProgress(t,e){const n=this.pendingRequests[t];n&&n.onProgress?.(e)}onStateChange(t,e){const n=this.pendingRequests[t];if(!n)return;const s=n.xhr;if(s.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),s.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],s.status===0&&this.isHttp){n.onError(s.status);return}const r=s.status||Jy;if(!(r===Jy&&n.expectedStatus===Qy)&&r!==n.expectedStatus){n.onError(s.status);return}const c=Z5(s);if(r===Qy){const u=s.getResponseHeader("Content-Range"),h=/bytes (\d+)-(\d+)\/(\d+)/.exec(u);h?n.onDone({begin:parseInt(h[1],10),chunk:c}):(Ft('Missing or invalid "Content-Range" header.'),n.onError(0))}else c?n.onDone({begin:0,chunk:c}):n.onError(s.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class e9{constructor(t){this._source=t,this._manager=new t9(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return ee(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new n9(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const n=new i9(this._manager,t,e);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class n9{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=ym(e.responseURL);const n=e.getAllResponseHeaders(),s=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(c=>{const[u,...h]=c.split(": ");return[u,h.join(": ")]}):[]),{allowRangeRequests:r,suggestedLength:a}=iP({responseHeaders:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});r&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=sP(s),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=Wh(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class i9{constructor(t,e,n){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const t=ym(this._manager.getRequestXhr(this._requestId)?.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??=Wh(t,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){this.isStreamingSupported||this.onProgress?.({loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const s9=/^[a-z][a-z0-9\-+.]+:/i;function r9(i){if(s9.test(i))return new URL(i);const t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(i))}class o9{constructor(t){this.source=t,this.url=r9(t.url),ee(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return ee(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new a9(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new l9(this,t,e);return this._rangeRequestReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class a9{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(s=>{this._contentLength=s.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},s=>{s.code==="ENOENT"&&(s=Wh(0,this._url.href)),this._storedError=s,this._headersCapability.reject(s)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Do("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class l9{constructor(t,e,n){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const s=t.source;this._isStreamingSupported=!s.disableStream;const r=process.getBuiltinModule("fs");this._setReadableStream(r.createReadStream(this._url,{start:e,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const Wu=Symbol("INITIAL_DATA");class lP{#t=Object.create(null);#e(t){return this.#t[t]||={...Promise.withResolvers(),data:Wu}}get(t,e=null){if(e){const s=this.#e(t);return s.promise.then(()=>e(s.data)),null}const n=this.#t[t];if(!n||n.data===Wu)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return n.data}has(t){const e=this.#t[t];return!!e&&e.data!==Wu}delete(t){const e=this.#t[t];return!e||e.data===Wu?!1:(delete this.#t[t],!0)}resolve(t,e=null){const n=this.#e(t);n.data=e,n.resolve()}clear(){for(const t in this.#t){const{data:e}=this.#t[t];e?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(const t in this.#t){const{data:e}=this.#t[t];e!==Wu&&(yield[t,e])}}}const c9=1e5,KC=30;class Wn{#t=Promise.withResolvers();#e=null;#i=!1;#n=!!globalThis.FontInspector?.enabled;#o=null;#r=null;#s=0;#a=0;#c=null;#l=null;#d=0;#h=0;#f=Object.create(null);#g=[];#m=null;#u=[];#p=new WeakMap;#y=null;static#v=new Map;static#_=new Map;static#b=new WeakMap;static#S=null;static#T=new Set;constructor({textContentSource:t,container:e,viewport:n}){if(t instanceof ReadableStream)this.#m=t;else if(typeof t=="object")this.#m=new ReadableStream({start(u){u.enqueue(t),u.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#e=this.#l=e,this.#h=n.scale*Vs.pixelRatio,this.#d=n.rotation,this.#r={div:null,properties:null,ctx:null};const{pageWidth:s,pageHeight:r,pageX:a,pageY:c}=n.rawDims;this.#y=[1,0,0,-1,-a,c+r],this.#a=s,this.#s=r,Wn.#M(),Ua(e,n),this.#t.promise.finally(()=>{Wn.#T.delete(this),this.#r=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=Pn.platform;return Ht(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{this.#c.read().then(({value:e,done:n})=>{if(n){this.#t.resolve();return}this.#o??=e.lang,Object.assign(this.#f,e.styles),this.#I(e.items),t()},this.#t.reject)};return this.#c=this.#m.getReader(),Wn.#T.add(this),t(),this.#t.promise}update({viewport:t,onBefore:e=null}){const n=t.scale*Vs.pixelRatio,s=t.rotation;if(s!==this.#d&&(e?.(),this.#d=s,Ua(this.#l,{rotation:s})),n!==this.#h){e?.(),this.#h=n;const r={div:null,properties:null,ctx:Wn.#P(this.#o)};for(const a of this.#u)r.properties=this.#p.get(a),r.div=a,this.#w(r)}}cancel(){const t=new Do("TextLayer task cancelled.");this.#c?.cancel(t).catch(()=>{}),this.#c=null,this.#t.reject(t)}get textDivs(){return this.#u}get textContentItemsStr(){return this.#g}#I(t){if(this.#i)return;this.#r.ctx??=Wn.#P(this.#o);const e=this.#u,n=this.#g;for(const s of t){if(e.length>c9){Ft("Ignoring additional textDivs for performance reasons."),this.#i=!0;return}if(s.str===void 0){if(s.type==="beginMarkedContentProps"||s.type==="beginMarkedContent"){const r=this.#e;this.#e=document.createElement("span"),this.#e.classList.add("markedContent"),s.id&&this.#e.setAttribute("id",`${s.id}`),r.append(this.#e)}else s.type==="endMarkedContent"&&(this.#e=this.#e.parentNode);continue}n.push(s.str),this.#E(s)}}#E(t){const e=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};this.#u.push(e);const s=Tt.transform(this.#y,t.transform);let r=Math.atan2(s[1],s[0]);const a=this.#f[t.fontName];a.vertical&&(r+=Math.PI/2);let c=this.#n&&a.fontSubstitution||a.fontFamily;c=Wn.fontFamilyMap.get(c)||c;const u=Math.hypot(s[2],s[3]),h=u*Wn.#U(c,a,this.#o);let f,m;r===0?(f=s[4],m=s[5]-h):(f=s[4]+h*Math.sin(r),m=s[5]-h*Math.cos(r));const y="calc(var(--total-scale-factor) *",T=e.style;this.#e===this.#l?(T.left=`${(100*f/this.#a).toFixed(2)}%`,T.top=`${(100*m/this.#s).toFixed(2)}%`):(T.left=`${y}${f.toFixed(2)}px)`,T.top=`${y}${m.toFixed(2)}px)`),T.fontSize=`${y}${(Wn.#S*u).toFixed(2)}px)`,T.fontFamily=c,n.fontSize=u,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,this.#n&&(e.dataset.fontName=a.fontSubstitutionLoadedName||t.fontName),r!==0&&(n.angle=r*(180/Math.PI));let S=!1;if(t.str.length>1)S=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const b=Math.abs(t.transform[0]),C=Math.abs(t.transform[3]);b!==C&&Math.max(b,C)/Math.min(b,C)>1.5&&(S=!0)}if(S&&(n.canvasWidth=a.vertical?t.height:t.width),this.#p.set(e,n),this.#r.div=e,this.#r.properties=n,this.#w(this.#r),n.hasText&&this.#e.append(e),n.hasEOL){const b=document.createElement("br");b.setAttribute("role","presentation"),this.#e.append(b)}}#w(t){const{div:e,properties:n,ctx:s}=t,{style:r}=e;let a="";if(Wn.#S>1&&(a=`scale(${1/Wn.#S})`),n.canvasWidth!==0&&n.hasText){const{fontFamily:c}=r,{canvasWidth:u,fontSize:h}=n;Wn.#R(s,h*this.#h,c);const{width:f}=s.measureText(e.textContent);f>0&&(a=`scaleX(${u*this.#h/f}) ${a}`)}n.angle!==0&&(a=`rotate(${n.angle}deg) ${a}`),a.length>0&&(r.transform=a)}static cleanup(){if(!(this.#T.size>0)){this.#v.clear();for(const{canvas:t}of this.#_.values())t.remove();this.#_.clear()}}static#P(t=null){let e=this.#_.get(t||="");if(!e){const n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=t,document.body.append(n),e=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#_.set(t,e),this.#b.set(e,{size:0,family:""})}return e}static#R(t,e,n){const s=this.#b.get(t);e===s.size&&n===s.family||(t.font=`${e}px ${n}`,s.size=e,s.family=n)}static#M(){if(this.#S!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),this.#S=t.getBoundingClientRect().height,t.remove()}static#U(t,e,n){const s=this.#v.get(t);if(s)return s;const r=this.#P(n);r.canvas.width=r.canvas.height=KC,this.#R(r,KC,t);const a=r.measureText(""),c=a.fontBoundingBoxAscent,u=Math.abs(a.fontBoundingBoxDescent);r.canvas.width=r.canvas.height=0;let h=.8;return c?h=c/(c+u):(Pn.platform.isFirefox&&Ft("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),e.ascent?h=e.ascent:e.descent&&(h=1+e.descent)),this.#v.set(t,h),h}}const u9=100;function cP(i={}){typeof i=="string"||i instanceof URL?i={url:i}:(i instanceof ArrayBuffer||ArrayBuffer.isView(i))&&(i={data:i});const t=new TE,{docId:e}=t,n=i.url?y5(i.url):null,s=i.data?_5(i.data):null,r=i.httpHeaders||null,a=i.withCredentials===!0,c=i.password??null,u=i.range instanceof uP?i.range:null,h=Number.isInteger(i.rangeChunkSize)&&i.rangeChunkSize>0?i.rangeChunkSize:2**16;let f=i.worker instanceof bh?i.worker:null;const m=i.verbosity,y=typeof i.docBaseUrl=="string"&&!mm(i.docBaseUrl)?i.docBaseUrl:null,T=Rf(i.cMapUrl),S=i.cMapPacked!==!1,b=i.CMapReaderFactory||(Kn?C5:kC),C=Rf(i.iccUrl),I=Rf(i.standardFontDataUrl),D=i.StandardFontDataFactory||(Kn?I5:LC),P=Rf(i.wasmUrl),H=i.WasmFactory||(Kn?R5:OC),F=i.stopAtErrors!==!0,G=Number.isInteger(i.maxImageSize)&&i.maxImageSize>-1?i.maxImageSize:-1,N=i.isEvalSupported!==!1,x=typeof i.isOffscreenCanvasSupported=="boolean"?i.isOffscreenCanvasSupported:!Kn,k=typeof i.isImageDecoderSupported=="boolean"?i.isImageDecoderSupported:!Kn&&(Pn.platform.isFirefox||!globalThis.chrome),V=Number.isInteger(i.canvasMaxAreaInBytes)?i.canvasMaxAreaInBytes:-1,U=typeof i.disableFontFace=="boolean"?i.disableFontFace:Kn,$=i.fontExtraProperties===!0,B=i.enableXfa===!0,vt=i.ownerDocument||globalThis.document,It=i.disableRange===!0,W=i.disableStream===!0,nt=i.disableAutoFetch===!0,ft=i.pdfBug===!0,xt=i.CanvasFactory||(Kn?b5:A5),z=i.FilterFactory||(Kn?w5:S5),ot=i.enableHWA===!0,dt=i.useWasm!==!1,ht=u?u.length:i.length??NaN,_t=typeof i.useSystemFonts=="boolean"?i.useSystemFonts:!Kn&&!U,Ot=typeof i.useWorkerFetch=="boolean"?i.useWorkerFetch:!!(b===kC&&D===LC&&H===OC&&T&&I&&P&&ih(T,document.baseURI)&&ih(I,document.baseURI)&&ih(P,document.baseURI)),St=null;$z(m);const $t={canvasFactory:new xt({ownerDocument:vt,enableHWA:ot}),filterFactory:new z({docId:e,ownerDocument:vt}),cMapReaderFactory:Ot?null:new b({baseUrl:T,isCompressed:S}),standardFontDataFactory:Ot?null:new D({baseUrl:I}),wasmFactory:Ot?null:new H({baseUrl:P})};f||(f=bh.create({verbosity:m,port:uc.workerPort}),t._worker=f);const Wt={docId:e,apiVersion:"5.4.449",data:s,password:c,disableAutoFetch:nt,rangeChunkSize:h,length:ht,docBaseUrl:y,enableXfa:B,evaluatorOptions:{maxImageSize:G,disableFontFace:U,ignoreErrors:F,isEvalSupported:N,isOffscreenCanvasSupported:x,isImageDecoderSupported:k,canvasMaxAreaInBytes:V,fontExtraProperties:$,useSystemFonts:_t,useWasm:dt,useWorkerFetch:Ot,cMapUrl:T,iccUrl:C,standardFontDataUrl:I,wasmUrl:P}},Xe={ownerDocument:vt,pdfBug:ft,styleElement:St,loadingParams:{disableAutoFetch:nt,enableXfa:B}};return f.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(f.destroyed)throw new Error("Worker was destroyed");const qs=f.messageHandler.sendWithPromise("GetDocRequest",Wt,s?[s.buffer]:null);let vi;if(u)vi=new Y5(u,{disableRange:It,disableStream:W});else if(!s){if(!n)throw new Error("getDocument - no `url` parameter provided.");const Ei=ih(n)?J5:Kn?o9:e9;vi=new Ei({url:n,length:ht,httpHeaders:r,withCredentials:a,rangeChunkSize:h,disableRange:It,disableStream:W})}return qs.then(Ei=>{if(t.destroyed)throw new Error("Loading aborted");if(f.destroyed)throw new Error("Worker was destroyed");const ct=new sh(e,Ei,f.port),mt=new f9(ct,t,vi,Xe,$t,ot);t._transport=mt,ct.send("Ready",null)})}).catch(t._capability.reject),t}class TE{static#t=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${TE.#t++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(t){throw this._worker?.port&&delete this._worker._pendingDestroy,t}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class uP{#t=Promise.withResolvers();#e=[];#i=[];#n=[];#o=[];constructor(t,e,n=!1,s=null){this.length=t,this.initialData=e,this.progressiveDone=n,this.contentDispositionFilename=s}addRangeListener(t){this.#o.push(t)}addProgressListener(t){this.#n.push(t)}addProgressiveReadListener(t){this.#i.push(t)}addProgressiveDoneListener(t){this.#e.push(t)}onDataRange(t,e){for(const n of this.#o)n(t,e)}onDataProgress(t,e){this.#t.promise.then(()=>{for(const n of this.#n)n(t,e)})}onDataProgressiveRead(t){this.#t.promise.then(()=>{for(const e of this.#i)e(t)})}onDataProgressiveDone(){this.#t.promise.then(()=>{for(const t of this.#e)t()})}transportReady(){this.#t.resolve()}requestDataRange(t,e){Ee("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class h9{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Ht(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(t,e){return this._transport.getAnnotationsByType(t,e)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}extractPages(t){return this._transport.extractPages(t)}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class d9{#t=!1;constructor(t,e,n,s=!1){this._pageIndex=t,this._pageInfo=e,this._transport=n,this._stats=s?new IC:null,this._pdfBug=s,this.commonObjs=n.commonObjs,this.objs=new lP,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:n=0,offsetY:s=0,dontFlip:r=!1}={}){return new zh({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:n,offsetY:s,dontFlip:r})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Ht(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:t,canvas:e=t.canvas,viewport:n,intent:s="display",annotationMode:r=yo.ENABLE,transform:a=null,background:c=null,optionalContentConfigPromise:u=null,annotationCanvasMap:h=null,pageColors:f=null,printAnnotationStorage:m=null,isEditing:y=!1,recordOperations:T=!1,operationsFilter:S=null}){this._stats?.time("Overall");const b=this._transport.getRenderingIntent(s,r,m,y),{renderingIntent:C,cacheKey:I}=b;this.#t=!1,u||=this._transport.getOptionalContentConfig(C);let D=this._intentStates.get(I);D||(D=Object.create(null),this._intentStates.set(I,D)),D.streamReaderCancelTimeout&&(clearTimeout(D.streamReaderCancelTimeout),D.streamReaderCancelTimeout=null);const P=!!(C&mi.PRINT);D.displayReadyCapability||(D.displayReadyCapability=Promise.withResolvers(),D.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(b));const H=!!(this._pdfBug&&globalThis.StepperManager?.enabled),F=!this.recordedBBoxes&&(T||H),G=k=>{if(D.renderTasks.delete(N),F){const V=N.gfx?.dependencyTracker.take();V&&(N.stepper&&N.stepper.setOperatorBBoxes(V,N.gfx.dependencyTracker.takeDebugMetadata()),T&&(this.recordedBBoxes=V))}P&&(this.#t=!0),this.#e(),k?(N.capability.reject(k),this._abortOperatorList({intentState:D,reason:k instanceof Error?k:new Error(k)})):N.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},N=new jl({callback:G,params:{canvas:e,canvasContext:t,dependencyTracker:F?new P5(e,D.operatorList.length,H):null,viewport:n,transform:a,background:c},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:h,operatorList:D.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!P,pdfBug:this._pdfBug,pageColors:f,enableHWA:this._transport.enableHWA,operationsFilter:S});(D.renderTasks||=new Set).add(N);const x=N.task;return Promise.all([D.displayReadyCapability.promise,u]).then(([k,V])=>{if(this.destroyed){G();return}if(this._stats?.time("Rendering"),!(V.renderingIntent&C))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");N.initializeGraphics({transparency:k,optionalContentConfig:V}),N.operatorListChanged()}).catch(G),x}getOperatorList({intent:t="display",annotationMode:e=yo.ENABLE,printAnnotationStorage:n=null,isEditing:s=!1}={}){function r(){c.operatorList.lastChunk&&(c.opListReadCapability.resolve(c.operatorList),c.renderTasks.delete(u))}const a=this._transport.getRenderingIntent(t,e,n,s,!0);let c=this._intentStates.get(a.cacheKey);c||(c=Object.create(null),this._intentStates.set(a.cacheKey,c));let u;return c.opListReadCapability||(u=Object.create(null),u.operatorListChanged=r,c.opListReadCapability=Promise.withResolvers(),(c.renderTasks||=new Set).add(u),c.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(a)),c.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(s){return s.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>wh.textContent(n));const e=this.streamTextContent(t);return new Promise(function(n,s){function r(){a.read().then(function({value:u,done:h}){if(h){n(c);return}c.lang??=u.lang,Object.assign(c.styles,u.styles),c.items.push(...u.items),r()},s)}const a=e.getReader(),c={items:[],styles:Object.create(null),lang:null};r()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const n of e.renderTasks)t.push(n.completed),n.cancel();return this.objs.clear(),this.#t=!1,Promise.all(t)}cleanup(t=!1){this.#t=!0;const e=this.#e();return t&&e&&(this._stats&&=new IC),e}#e(){if(!this.#t||this.destroyed)return!1;for(const{renderTasks:t,operatorList:e}of this._intentStates.values())if(t.size>0||!e.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#t=!1,!0}_startRenderPage(t,e){const n=this._intentStates.get(e);n&&(this._stats?.timeEnd("Page Request"),n.displayReadyCapability?.resolve(t))}_renderPageChunk(t,e){for(let n=0,s=t.length;n<s;n++)e.operatorList.fnArray.push(t.fnArray[n]),e.operatorList.argsArray.push(t.argsArray[n]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const n of e.renderTasks)n.operatorListChanged();t.lastChunk&&this.#e()}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:n,modifiedIds:s}){const{map:r,transfer:a}=n,u=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:r,modifiedIds:s},a).getReader(),h=this._intentStates.get(e);h.streamReader=u;const f=()=>{u.read().then(({value:m,done:y})=>{if(y){h.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(m,h),f())},m=>{if(h.streamReader=null,!this._transport.destroyed){if(h.operatorList){h.operatorList.lastChunk=!0;for(const y of h.renderTasks)y.operatorListChanged();this.#e()}if(h.displayReadyCapability)h.displayReadyCapability.reject(m);else if(h.opListReadCapability)h.opListReadCapability.reject(m);else throw m}})};f()}_abortOperatorList({intentState:t,reason:e,force:n=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!n){if(t.renderTasks.size>0)return;if(e instanceof fE){let s=u9;e.extraDelay>0&&e.extraDelay<1e3&&(s+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},s);return}}if(t.streamReader.cancel(new Do(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[s,r]of this._intentStates)if(r===t){this._intentStates.delete(s);break}this.cleanup()}}}get stats(){return this._stats}}var _o,Qi,pr,Ca,kp,Ia,Ra,Jn,jf,hP,dP,rh,hc,Zf;const Ie=class Ie{constructor({name:t=null,port:e=null,verbosity:n=Yz()}={}){Ts(this,Jn);Ts(this,_o,Promise.withResolvers());Ts(this,Qi,null);Ts(this,pr,null);Ts(this,Ca,null);if(this.name=t,this.destroyed=!1,this.verbosity=n,e){if(Ce(Ie,Ra).has(e))throw new Error("Cannot use more than one PDFWorker per port.");Ce(Ie,Ra).set(e,this),As(this,Jn,hP).call(this,e)}else As(this,Jn,dP).call(this)}get promise(){return Ce(this,_o).promise}get port(){return Ce(this,pr)}get messageHandler(){return Ce(this,Qi)}destroy(){this.destroyed=!0,Ce(this,Ca)?.terminate(),ei(this,Ca,null),Ce(Ie,Ra).delete(Ce(this,pr)),ei(this,pr,null),Ce(this,Qi)?.destroy(),ei(this,Qi,null)}static create(t){const e=Ce(this,Ra).get(t?.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new Ie(t)}static get workerSrc(){if(uc.workerSrc)return uc.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return Ht(this,"_setupFakeWorkerGlobal",(async()=>Ce(this,hc,Zf)?Ce(this,hc,Zf):(await import(this.workerSrc)).WorkerMessageHandler)())}};_o=new WeakMap,Qi=new WeakMap,pr=new WeakMap,Ca=new WeakMap,kp=new WeakMap,Ia=new WeakMap,Ra=new WeakMap,Jn=new WeakSet,jf=function(){Ce(this,_o).resolve(),Ce(this,Qi).send("configure",{verbosity:this.verbosity})},hP=function(t){ei(this,pr,t),ei(this,Qi,new sh("main","worker",t)),Ce(this,Qi).on("ready",()=>{}),As(this,Jn,jf).call(this)},dP=function(){if(Ce(Ie,Ia)||Ce(Ie,hc,Zf)){As(this,Jn,rh).call(this);return}let{workerSrc:t}=Ie;try{Ie._isSameOrigin(window.location,t)||(t=Ie._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),n=new sh("main","worker",e),s=()=>{r.abort(),n.destroy(),e.terminate(),this.destroyed?Ce(this,_o).reject(new Error("Worker was destroyed")):As(this,Jn,rh).call(this)},r=new AbortController;e.addEventListener("error",()=>{Ce(this,Ca)||s()},{signal:r.signal}),n.on("test",c=>{if(r.abort(),this.destroyed||!c){s();return}ei(this,Qi,n),ei(this,pr,e),ei(this,Ca,e),As(this,Jn,jf).call(this)}),n.on("ready",c=>{if(r.abort(),this.destroyed){s();return}try{a()}catch{As(this,Jn,rh).call(this)}});const a=()=>{const c=new Uint8Array;n.send("test",c,[c.buffer])};a();return}catch{pm("The worker has been disabled.")}As(this,Jn,rh).call(this)},rh=function(){Ce(Ie,Ia)||(Ft("Setting up fake worker."),ei(Ie,Ia,!0)),Ie._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){Ce(this,_o).reject(new Error("Worker was destroyed"));return}const e=new T5;ei(this,pr,e);const n=`fake${HA(Ie,kp)._++}`,s=new sh(n+"_worker",n,e);t.setup(s,e),ei(this,Qi,new sh(n,n+"_worker",e)),As(this,Jn,jf).call(this)}).catch(t=>{Ce(this,_o).reject(new Error(`Setting up fake worker failed: "${t.message}".`))})},hc=new WeakSet,Zf=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},Ts(Ie,hc),Ts(Ie,kp,0),Ts(Ie,Ia,!1),Ts(Ie,Ra,new WeakMap),Kn&&(ei(Ie,Ia,!0),uc.workerSrc||="./pdf.worker.mjs"),Ie._isSameOrigin=(t,e)=>{const n=URL.parse(t);if(!n?.origin||n.origin==="null")return!1;const s=new URL(e,n);return n.origin===s.origin},Ie._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},Ie.fromPort=t=>{if(s5("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!t?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return Ie.create(t)};let bh=Ie;class f9{#t=new Map;#e=new Map;#i=new Map;#n=new Map;#o=null;constructor(t,e,n,s,r,a){this.messageHandler=t,this.loadingTask=e,this.commonObjs=new lP,this.fontLoader=new m5({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.wasmFactory=r.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=a,this.setupMessageHandler()}#r(t,e=null){const n=this.#t.get(t);if(n)return n;const s=this.messageHandler.sendWithPromise(t,e);return this.#t.set(t,s),s}get annotationStorage(){return Ht(this,"annotationStorage",new yE)}getRenderingIntent(t,e=yo.ENABLE,n=null,s=!1,r=!1){let a=mi.DISPLAY,c=K_;switch(t){case"any":a=mi.ANY;break;case"display":break;case"print":a=mi.PRINT;break;default:Ft(`getRenderingIntent - invalid intent: ${t}`)}const u=a&mi.PRINT&&n instanceof JM?n:this.annotationStorage;switch(e){case yo.DISABLE:a+=mi.ANNOTATIONS_DISABLE;break;case yo.ENABLE:break;case yo.ENABLE_FORMS:a+=mi.ANNOTATIONS_FORMS;break;case yo.ENABLE_STORAGE:a+=mi.ANNOTATIONS_STORAGE,c=u.serializable;break;default:Ft(`getRenderingIntent - invalid annotationMode: ${e}`)}s&&(a+=mi.IS_EDITING),r&&(a+=mi.OPLIST);const{ids:h,hash:f}=u.modifiedIds,m=[a,c.hash,f];return{renderingIntent:a,cacheKey:m.join("_"),annotationStorageSerializable:c,modifiedIds:h}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#o?.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const n of this.#e.values())t.push(n._destroy());this.#e.clear(),this.#i.clear(),this.#n.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),Wn.cleanup(),this._networkStream?.cancelAllRequests(new Do("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(n,s)=>{ee(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=r=>{this._lastProgress={loaded:r.loaded,total:r.total}},s.onPull=()=>{this._fullReader.read().then(function({value:r,done:a}){if(a){s.close();return}ee(r instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{s.error(r)})},s.onCancel=r=>{this._fullReader.cancel(r),s.ready.catch(a=>{if(!this.destroyed)throw a})}}),t.on("ReaderHeadersReady",async n=>{await this._fullReader.headersReady;const{isStreamingSupported:s,isRangeSupported:r,contentLength:a}=this._fullReader;return(!s||!r)&&(this._lastProgress&&e.onProgress?.(this._lastProgress),this._fullReader.onProgress=c=>{e.onProgress?.({loaded:c.loaded,total:c.total})}),{isStreamingSupported:s,isRangeSupported:r,contentLength:a}}),t.on("GetRangeReader",(n,s)=>{ee(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const r=this._networkStream.getRangeReader(n.begin,n.end);if(!r){s.close();return}s.onPull=()=>{r.read().then(function({value:a,done:c}){if(c){s.close();return}ee(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{s.error(a)})},s.onCancel=a=>{r.cancel(a),s.ready.catch(c=>{if(!this.destroyed)throw c})}}),t.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,e._capability.resolve(new h9(n,this))}),t.on("DocException",n=>{e._capability.reject(ni(n))}),t.on("PasswordRequest",n=>{this.#o=Promise.withResolvers();try{if(!e.onPassword)throw ni(n);const s=r=>{r instanceof Error?this.#o.reject(r):this.#o.resolve({password:r})};e.onPassword(s,n.code)}catch(s){this.#o.reject(s)}return this.#o.promise}),t.on("DataLoaded",n=>{e.onProgress?.({loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),t.on("StartRenderPage",n=>{if(this.destroyed)return;this.#e.get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),t.on("commonobj",([n,s,r])=>{if(this.destroyed||this.commonObjs.has(n))return null;switch(s){case"Font":if("error"in r){const m=r.error;Ft(`Error during font loading: ${m}`),this.commonObjs.resolve(n,m);break}const a=new _e(r),c=this._params.pdfBug&&globalThis.FontInspector?.enabled?(m,y)=>globalThis.FontInspector.fontAdded(m,y):null,u=new g5(a,c,r.extra,r.charProcOperatorList);this.fontLoader.bind(u).catch(()=>t.sendWithPromise("FontFallback",{id:n})).finally(()=>{!u.fontExtraProperties&&u.data&&u.clearData(),this.commonObjs.resolve(n,u)});break;case"CopyLocalImage":const{imageRef:h}=r;ee(h,"The imageRef must be defined.");for(const m of this.#e.values())for(const[,y]of m.objs)if(y?.ref===h)return y.dataLen?(this.commonObjs.resolve(n,structuredClone(y)),y.dataLen):null;break;case"FontPath":case"Image":this.commonObjs.resolve(n,r);break;case"Pattern":const f=new gn(r);this.commonObjs.resolve(n,f.getIR());break;default:throw new Error(`Got unknown common object type ${s}`)}return null}),t.on("obj",([n,s,r,a])=>{if(this.destroyed)return;const c=this.#e.get(s);if(!c.objs.has(n)){if(c._intentStates.size===0){a?.bitmap?.close();return}switch(r){case"Image":case"Pattern":c.objs.resolve(n,a);break;default:throw new Error(`Got unknown object type ${r}`)}}}),t.on("DocProgress",n=>{this.destroyed||e.onProgress?.({loaded:n.loaded,total:n.total})}),t.on("FetchBinaryData",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");const s=this[n.type];if(!s)throw new Error(`${n.type} not initialized, see the \`useWorkerFetch\` parameter.`);return s.fetch(n)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&Ft("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},e).finally(()=>{this.annotationStorage.resetModified()})}extractPages(t){return this.messageHandler.sendWithPromise("ExtractPages",{pageInfos:t})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,n=this.#i.get(e);if(n)return n;const s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(r=>{if(this.destroyed)throw new Error("Transport destroyed");r.refStr&&this.#n.set(r.refStr,t);const a=new d9(e,r,this,this._params.pdfBug);return this.#e.set(e,a),a});return this.#i.set(e,s),s}getPageIndex(t){return X_(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return this.#r("GetFieldObjects")}hasJSActions(){return this.#r("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(t,e){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:t,pageIndexesToSkip:e})}getDocJSActions(){return this.#r("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return this.#r("GetOptionalContentConfig").then(e=>new $5(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=this.#t.get(t);if(e)return e;const n=this.messageHandler.sendWithPromise(t,null).then(s=>({info:s[0],metadata:s[1]?new q5(s[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null,hasStructTree:s[2]}));return this.#t.set(t,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of this.#e.values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0),Wn.cleanup()}}cachedPageNumber(t){if(!X_(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return this.#n.get(e)??null}}class p9{#t=null;onContinue=null;onError=null;constructor(t){this.#t=t}get promise(){return this.#t.capability.promise}cancel(t=0){this.#t.cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=this.#t.operatorList;if(!t)return!1;const{annotationCanvasMap:e}=this.#t;return t.form||t.canvas&&e?.size>0}}class jl{#t=null;static#e=new WeakSet;constructor({callback:t,params:e,objs:n,commonObjs:s,annotationCanvasMap:r,operatorList:a,pageIndex:c,canvasFactory:u,filterFactory:h,useRequestAnimationFrame:f=!1,pdfBug:m=!1,pageColors:y=null,enableHWA:T=!1,operationsFilter:S=null}){this.callback=t,this.params=e,this.objs=n,this.commonObjs=s,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=c,this.canvasFactory=u,this.filterFactory=h,this._pdfBug=m,this.pageColors=y,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=f===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new p9(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvas,this._canvasContext=e.canvas?null:e.canvasContext,this._enableHWA=T,this._dependencyTracker=e.dependencyTracker,this._operationsFilter=S}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){if(this.cancelled)return;if(this._canvas){if(jl.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");jl.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:n,transform:s,background:r,dependencyTracker:a}=this.params,c=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new cc(c,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors,a),this.gfx.beginDrawing({transform:s,viewport:n,transparency:t,background:r}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(t=null,e=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null),jl.#e.delete(this._canvas),t||=new fE(`Rendering cancelled, page ${this._pageIndex+1}`,e),this.callback(t),this.task.onError?.(t)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.gfx.dependencyTracker?.growOperationsCount(this.operatorList.fnArray.length),this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#t=window.requestAnimationFrame(()=>{this.#t=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),jl.#e.delete(this._canvas),this.callback())))}}const m9="5.4.449",g9="f44e5f0e6";class Li{#t=null;#e=null;#i;#n=null;#o=!1;#r=!1;#s=null;#a;#c=null;#l=null;static#d=null;static get _keyboardManager(){return Ht(this,"_keyboardManager",new Yh([[["Escape","mac+Escape"],Li.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Li.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Li.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Li.prototype._moveToPrevious],[["Home","mac+Home"],Li.prototype._moveToBeginning],[["End","mac+End"],Li.prototype._moveToEnd]]))}constructor({editor:t=null,uiManager:e=null}){t?(this.#r=!1,this.#s=t):this.#r=!0,this.#l=t?._uiManager||e,this.#a=this.#l._eventBus,this.#i=t?.color?.toUpperCase()||this.#l?.highlightColors.values().next().value||"#FFFF98",Li.#d||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const t=this.#t=document.createElement("button");t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.ariaHasPopup="true",this.#s&&(t.ariaControls=`${this.#s.id}_colorpicker_dropdown`);const e=this.#l._signal;t.addEventListener("click",this.#m.bind(this),{signal:e}),t.addEventListener("keydown",this.#g.bind(this),{signal:e});const n=this.#e=document.createElement("span");return n.className="swatch",n.ariaHidden="true",n.style.backgroundColor=this.#i,t.append(n),t}renderMainDropdown(){const t=this.#n=this.#h();return t.ariaOrientation="horizontal",t.ariaLabelledBy="highlightColorPickerLabel",t}#h(){const t=document.createElement("div"),e=this.#l._signal;t.addEventListener("contextmenu",Fi,{signal:e}),t.className="dropdown",t.role="listbox",t.ariaMultiSelectable="false",t.ariaOrientation="vertical",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#s&&(t.id=`${this.#s.id}_colorpicker_dropdown`);for(const[n,s]of this.#l.highlightColors){const r=document.createElement("button");r.tabIndex="0",r.role="option",r.setAttribute("data-color",s),r.title=n,r.setAttribute("data-l10n-id",Li.#d[n]);const a=document.createElement("span");r.append(a),a.className="swatch",a.style.backgroundColor=s,r.ariaSelected=s===this.#i,r.addEventListener("click",this.#f.bind(this,s),{signal:e}),t.append(r)}return t.addEventListener("keydown",this.#g.bind(this),{signal:e}),t}#f(t,e){e.stopPropagation(),this.#a.dispatch("switchannotationeditorparams",{source:this,type:te.HIGHLIGHT_COLOR,value:t}),this.updateColor(t)}_colorSelectFromKeyboard(t){if(t.target===this.#t){this.#m(t);return}const e=t.target.getAttribute("data-color");e&&this.#f(e,t)}_moveToNext(t){if(!this.#p){this.#m(t);return}if(t.target===this.#t){this.#n.firstElementChild?.focus();return}t.target.nextSibling?.focus()}_moveToPrevious(t){if(t.target===this.#n?.firstElementChild||t.target===this.#t){this.#p&&this._hideDropdownFromKeyboard();return}this.#p||this.#m(t),t.target.previousSibling?.focus()}_moveToBeginning(t){if(!this.#p){this.#m(t);return}this.#n.firstElementChild?.focus()}_moveToEnd(t){if(!this.#p){this.#m(t);return}this.#n.lastElementChild?.focus()}#g(t){Li._keyboardManager.exec(this,t)}#m(t){if(this.#p){this.hideDropdown();return}if(this.#o=t.detail===0,this.#c||(this.#c=new AbortController,window.addEventListener("pointerdown",this.#u.bind(this),{signal:this.#l.combinedSignal(this.#c)})),this.#t.ariaExpanded="true",this.#n){this.#n.classList.remove("hidden");return}const e=this.#n=this.#h();this.#t.append(e)}#u(t){this.#n?.contains(t.target)||this.hideDropdown()}hideDropdown(){this.#n?.classList.add("hidden"),this.#t.ariaExpanded="false",this.#c?.abort(),this.#c=null}get#p(){return this.#n&&!this.#n.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#r){if(!this.#p){this.#s?.unselect();return}this.hideDropdown(),this.#t.focus({preventScroll:!0,focusVisible:this.#o})}}updateColor(t){if(this.#e&&(this.#e.style.backgroundColor=t),!this.#n)return;const e=this.#l.highlightColors.values();for(const n of this.#n.children)n.ariaSelected=e.next().value===t.toUpperCase()}destroy(){this.#t?.remove(),this.#t=null,this.#e=null,this.#n?.remove(),this.#n=null}}class Ch{#t=null;#e=null;#i=null;static#n=null;constructor(t){this.#e=t,this.#i=t._uiManager,Ch.#n||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#t)return this.#t;const{editorType:t,colorType:e,color:n}=this.#e,s=this.#t=document.createElement("input");return s.type="color",s.value=n||"#000000",s.className="basicColorPicker",s.tabIndex=0,s.setAttribute("data-l10n-id",Ch.#n[t]),s.addEventListener("input",()=>{this.#i.updateParams(e,s.value)},{signal:this.#i._signal}),s}update(t){this.#t&&(this.#t.value=t)}destroy(){this.#t?.remove(),this.#t=null}hideDropdown(){}}function XC(i){return Math.floor(Math.max(0,Math.min(1,i))*255).toString(16).padStart(2,"0")}function Ku(i){return Math.max(0,Math.min(255,255*i))}class JC{static CMYK_G([t,e,n,s]){return["G",1-Math.min(1,.3*t+.59*n+.11*e+s)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=Ku(t),[t,t,t]}static G_HTML([t]){const e=XC(t);return`#${e}${e}${e}`}static RGB_G([t,e,n]){return["G",.3*t+.59*e+.11*n]}static RGB_rgb(t){return t.map(Ku)}static RGB_HTML(t){return`#${t.map(XC).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,n,s]){return["RGB",1-Math.min(1,t+s),1-Math.min(1,n+s),1-Math.min(1,e+s)]}static CMYK_rgb([t,e,n,s]){return[Ku(1-Math.min(1,t+s)),Ku(1-Math.min(1,n+s)),Ku(1-Math.min(1,e+s))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,n]){const s=1-t,r=1-e,a=1-n,c=Math.min(s,r,a);return["CMYK",s,r,a,c]}}class y9{create(t,e,n=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),n||(s.setAttribute("width",`${t}px`),s.setAttribute("height",`${e}px`)),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${t} ${e}`),s}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){Ee("Abstract method `_createSVG` called.")}}class Np extends y9{_createSVG(t){return document.createElementNS(hr,t)}}const _9=9,Va=new WeakSet,v9=new Date().getTimezoneOffset()*60*1e3;class jy{static create(t){switch(t.data.annotationType){case Ze.LINK:return new AE(t);case Ze.TEXT:return new T9(t);case Ze.WIDGET:switch(t.data.fieldType){case"Tx":return new A9(t);case"Btn":return t.data.radioButton?new fP(t):t.data.checkBox?new w9(t):new b9(t);case"Ch":return new C9(t);case"Sig":return new S9(t)}return new Wa(t);case Ze.POPUP:return new j_(t);case Ze.FREETEXT:return new pP(t);case Ze.LINE:return new R9(t);case Ze.SQUARE:return new M9(t);case Ze.CIRCLE:return new P9(t);case Ze.POLYLINE:return new mP(t);case Ze.CARET:return new D9(t);case Ze.INK:return new SE(t);case Ze.POLYGON:return new x9(t);case Ze.HIGHLIGHT:return new gP(t);case Ze.UNDERLINE:return new N9(t);case Ze.SQUIGGLY:return new k9(t);case Ze.STRIKEOUT:return new L9(t);case Ze.STAMP:return new yP(t);case Ze.FILEATTACHMENT:return new O9(t);default:return new Ne(t)}}}class Ne{#t=null;#e=!1;#i=null;constructor(t,{isRenderable:e=!1,ignoreBorder:n=!1,createQuadrilaterals:s=!1}={}){this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableComment=t.enableComment,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,this.hasOwnCommentButton=!1,e&&(this.contentElement=this.container=this._createContainer(n)),s&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:t,richText:e}){return!!(t?.str||e?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Ne._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){const{data:t}=this,e=this.annotationStorage?.getEditor(t.id);return e?e.getData():t}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){const t=this.annotationStorage?.getEditor(this.data.id);if(t)return t.commentButtonPositionInPage;const{quadPoints:e,inkLists:n,rect:s}=this.data;let r=-1/0,a=-1/0;if(e?.length>=8){for(let c=0;c<e.length;c+=8)e[c+1]>a?(a=e[c+1],r=e[c+2]):e[c+1]===a&&(r=Math.max(r,e[c+2]));return[r,a]}if(n?.length>=1){for(const c of n)for(let u=0,h=c.length;u<h;u+=2)c[u+1]>a?(a=c[u+1],r=c[u]):c[u+1]===a&&(r=Math.max(r,c[u]));if(r!==1/0)return[r,a]}return s?[s[2],s[3]]:null}_normalizePoint(t){const{page:{view:e},viewport:{rawDims:{pageWidth:n,pageHeight:s,pageX:r,pageY:a}}}=this.parent;return t[1]=e[3]-t[1]+e[1],t[0]=100*(t[0]-r)/n,t[1]=100*(t[1]-a)/s,t}get commentText(){const{data:t}=this;return this.annotationStorage.getRawValue(`${Ah}${t.id}`)?.popup?.contents||t.contentsObj?.str||""}set commentText(t){const{data:e}=this,n={deleted:!t,contents:t||""};this.annotationStorage.updateEditor(e.id,{popup:n})||this.annotationStorage.setValue(`${Ah}${e.id}`,{id:e.id,annotationType:e.annotationType,pageIndex:this.parent.page._pageIndex,popup:n,popupRef:e.popupRef,modificationDate:new Date}),t||this.removePopup()}removePopup(){(this.#i?.popup||this.popup)?.remove(),this.#i=this.popup=null}updateEdited(t){if(!this.container)return;t.rect&&(this.#t||={rect:this.data.rect.slice(0)});const{rect:e,popup:n}=t;e&&this.#n(e);let s=this.#i?.popup||this.popup;!s&&n?.text&&(this._createPopup(n),s=this.#i.popup),s&&(s.updateEdited(t),n?.deleted&&(s.remove(),this.#i=null,this.popup=null))}resetEdited(){this.#t&&(this.#n(this.#t.rect),this.#i?.popup.resetEdited(),this.#t=null)}#n(t){const{container:{style:e},data:{rect:n,rotation:s},parent:{viewport:{rawDims:{pageWidth:r,pageHeight:a,pageX:c,pageY:u}}}}=this;n?.splice(0,4,...t),e.left=`${100*(t[0]-c)/r}%`,e.top=`${100*(a-t[3]+u)/a}%`,s===0?(e.width=`${100*(t[2]-t[0])/r}%`,e.height=`${100*(t[3]-t[1])/a}%`):this.setRotation(s)}_createContainer(t){const{data:e,parent:{page:n,viewport:s}}=this,r=document.createElement("section");r.setAttribute("data-annotation-id",e.id),!(this instanceof Wa)&&!(this instanceof AE)&&(r.tabIndex=0);const{style:a}=r;if(a.zIndex=this.parent.zIndex,this.parent.zIndex+=2,e.alternativeText&&(r.title=e.alternativeText),e.noRotate&&r.classList.add("norotate"),!e.rect||this instanceof j_){const{rotation:b}=e;return!e.hasOwnCanvas&&b!==0&&this.setRotation(b,r),r}const{width:c,height:u}=this;if(!t&&e.borderStyle.width>0){a.borderWidth=`${e.borderStyle.width}px`;const b=e.borderStyle.horizontalCornerRadius,C=e.borderStyle.verticalCornerRadius;if(b>0||C>0){const D=`calc(${b}px * var(--total-scale-factor)) / calc(${C}px * var(--total-scale-factor))`;a.borderRadius=D}else if(this instanceof fP){const D=`calc(${c}px * var(--total-scale-factor)) / calc(${u}px * var(--total-scale-factor))`;a.borderRadius=D}switch(e.borderStyle.style){case zl.SOLID:a.borderStyle="solid";break;case zl.DASHED:a.borderStyle="dashed";break;case zl.BEVELED:Ft("Unimplemented border style: beveled");break;case zl.INSET:Ft("Unimplemented border style: inset");break;case zl.UNDERLINE:a.borderBottomStyle="solid";break}const I=e.borderColor||null;I?(this.#e=!0,a.borderColor=Tt.makeHexColor(I[0]|0,I[1]|0,I[2]|0)):a.borderWidth=0}const h=Tt.normalizeRect([e.rect[0],n.view[3]-e.rect[1]+n.view[1],e.rect[2],n.view[3]-e.rect[3]+n.view[1]]),{pageWidth:f,pageHeight:m,pageX:y,pageY:T}=s.rawDims;a.left=`${100*(h[0]-y)/f}%`,a.top=`${100*(h[1]-T)/m}%`;const{rotation:S}=e;return e.hasOwnCanvas||S===0?(a.width=`${100*c/f}%`,a.height=`${100*u/m}%`):this.setRotation(S,r),r}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:n,pageHeight:s}=this.parent.viewport.rawDims;let{width:r,height:a}=this;t%180!==0&&([r,a]=[a,r]),e.style.width=`${100*r/n}%`,e.style.height=`${100*a/s}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,n,s)=>{const r=s.detail[e],a=r[0],c=r.slice(1);s.target.style[n]=JC[`${a}_HTML`](c),this.annotationStorage.setValue(this.data.id,{[n]:JC[`${a}_rgb`](c)})};return Ht(this,"_commonActions",{display:e=>{const{display:n}=e.detail,s=n%2===1;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:s,noPrint:n===1||n===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:n}=e.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const n=e.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(t,e){const n=this._commonActions;for(const s of Object.keys(e.detail))(t[s]||n[s])?.(e)}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const n=this._commonActions;for(const[s,r]of Object.entries(e)){const a=n[s];if(a){const c={detail:{[s]:r},target:t};a(c),delete e[s]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,n,s,r]=this.data.rect.map(b=>Math.fround(b));if(t.length===8){const[b,C,I,D]=t.subarray(2,6);if(s===b&&r===C&&e===I&&n===D)return}const{style:a}=this.container;let c;if(this.#e){const{borderColor:b,borderWidth:C}=a;a.borderWidth=0,c=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${b}" stroke-width="${C}">`],this.container.classList.add("hasBorder")}const u=s-e,h=r-n,{svgFactory:f}=this,m=f.createElement("svg");m.classList.add("quadrilateralsContainer"),m.setAttribute("width",0),m.setAttribute("height",0),m.role="none";const y=f.createElement("defs");m.append(y);const T=f.createElement("clipPath"),S=`clippath_${this.data.id}`;T.setAttribute("id",S),T.setAttribute("clipPathUnits","objectBoundingBox"),y.append(T);for(let b=2,C=t.length;b<C;b+=8){const I=t[b],D=t[b+1],P=t[b+2],H=t[b+3],F=f.createElement("rect"),G=(P-e)/u,N=(r-D)/h,x=(I-P)/u,k=(D-H)/h;F.setAttribute("x",G),F.setAttribute("y",N),F.setAttribute("width",x),F.setAttribute("height",k),T.append(F),c?.push(`<rect vector-effect="non-scaling-stroke" x="${G}" y="${N}" width="${x}" height="${k}"/>`)}this.#e&&(c.push("</g></svg>')"),a.backgroundImage=c.join("")),this.container.append(m),this.container.style.clipPath=`url(#${S})`}_createPopup(t=null){const{data:e}=this;let n,s;t?(n={str:t.text},s=t.date):(n=e.contentsObj,s=e.modificationDate),this.#i=new j_({data:{color:e.color,titleObj:e.titleObj,modificationDate:s,contentsObj:n,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]})}get hasPopupElement(){return!!(this.#i||this.popup||this.data.popupRef)}get extraPopupElement(){return this.#i}render(){Ee("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const n=[];if(this._fieldObjects){const s=this._fieldObjects[t];if(s)for(const{page:r,id:a,exportValues:c}of s){if(r===-1||a===e)continue;const u=typeof c=="string"?c:null,h=document.querySelector(`[data-element-id="${a}"]`);if(h&&!Va.has(h)){Ft(`_getElementsByName - element not allowed: ${a}`);continue}n.push({id:a,exportValue:u,domElement:h})}return n}for(const s of document.getElementsByName(t)){const{exportValue:r}=s,a=s.getAttribute("data-element-id");a!==e&&Va.has(s)&&n.push({id:a,exportValue:r,domElement:s})}return n}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class E9 extends Ne{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.editor=t.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:t}=this;t.hasComment&&this._createPopup(t.comment)}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(t){this.editor.comment=t,t||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.parent.removeAnnotation(this.data.id),this.container.remove(),this.container=null,this.removePopup()}}class AE extends Ne{constructor(t,e=null){super(t,{isRenderable:!0,ignoreBorder:!!e?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:e}=this,n=document.createElement("a");n.setAttribute("data-element-id",t.id);let s=!1;return t.url?(e.addLinkAttributes(n,t.url,t.newWindow),s=!0):t.action?(this._bindNamedAction(n,t.action,t.overlaidText),s=!0):t.attachment?(this.#e(n,t.attachment,t.overlaidText,t.attachmentDest),s=!0):t.setOCGState?(this.#i(n,t.setOCGState,t.overlaidText),s=!0):t.dest?(this._bindLink(n,t.dest,t.overlaidText),s=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(n,t),s=!0),t.resetForm?(this._bindResetFormAction(n,t.resetForm),s=!0):this.isTooltipOnly&&!s&&(this._bindLink(n,""),s=!0)),this.container.classList.add("linkAnnotation"),s&&(this.contentElement=n,this.container.append(n)),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(t,e,n=""){t.href=this.linkService.getDestinationHash(e),t.onclick=()=>(e&&this.linkService.goToDestination(e),!1),(e||e==="")&&this.#t(),n&&(t.title=n)}_bindNamedAction(t,e,n=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(e),!1),n&&(t.title=n),this.#t()}#e(t,e,n="",s=null){t.href=this.linkService.getAnchorUrl(""),e.description?t.title=e.description:n&&(t.title=n),t.onclick=()=>(this.downloadManager?.openOrDownloadData(e.content,e.filename,s),!1),this.#t()}#i(t,e,n=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(e),!1),n&&(t.title=n),this.#t()}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");const n=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const s of Object.keys(e.actions)){const r=n.get(s);r&&(t[r]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:s}}),!1))}e.overlaidText&&(t.title=e.overlaidText),t.onclick||(t.onclick=()=>!1),this.#t()}_bindResetFormAction(t,e){const n=t.onclick;if(n||(t.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){Ft('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),n||(t.onclick=()=>!1);return}t.onclick=()=>{n?.();const{fields:s,refs:r,include:a}=e,c=[];if(s.length!==0||r.length!==0){const f=new Set(r);for(const m of s){const y=this._fieldObjects[m]||[];for(const{id:T}of y)f.add(T)}for(const m of Object.values(this._fieldObjects))for(const y of m)f.has(y.id)===a&&c.push(y)}else for(const f of Object.values(this._fieldObjects))c.push(...f);const u=this.annotationStorage,h=[];for(const f of c){const{id:m}=f;switch(h.push(m),f.type){case"text":{const T=f.defaultValue||"";u.setValue(m,{value:T});break}case"checkbox":case"radiobutton":{const T=f.defaultValue===f.exportValues;u.setValue(m,{value:T});break}case"combobox":case"listbox":{const T=f.defaultValue||"";u.setValue(m,{value:T});break}default:continue}const y=document.querySelector(`[data-element-id="${m}"]`);if(y){if(!Va.has(y)){Ft(`_bindResetFormAction - element not allowed: ${m}`);continue}}else continue;y.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:h,name:"ResetForm"}}),!1}}}class T9 extends Ne{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(t),this.container}}class Wa extends Ne{render(){return this.container}showElementAndHideCanvas(t){this.data.hasOwnCanvas&&(t.previousSibling?.nodeName==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return Pn.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,n,s,r){n.includes("mouse")?t.addEventListener(n,a=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:r(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):t.addEventListener(n,a=>{if(n==="blur"){if(!e.focused||!a.relatedTarget)return;e.focused=!1}else if(n==="focus"){if(e.focused)return;e.focused=!0}r&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:r(a)}})})}_setEventListeners(t,e,n,s){for(const[r,a]of n)(a==="Action"||this.data.actions?.[a])&&((a==="Focus"||a==="Blur")&&(e||={focused:!1}),this._setEventListener(t,e,r,a,s),a==="Focus"&&!this.data.actions?.Blur?this._setEventListener(t,e,"blur","Blur",null):a==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":Tt.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||_9,r=t.style;let a;const c=2,u=h=>Math.round(10*h)/10;if(this.data.multiLine){const h=Math.abs(this.data.rect[3]-this.data.rect[1]-c),f=Math.round(h/(zy*s))||1,m=h/f;a=Math.min(s,u(m/zy))}else{const h=Math.abs(this.data.rect[3]-this.data.rect[1]-c);a=Math.min(s,u(h/zy))}r.fontSize=`calc(${a}px * var(--total-scale-factor))`,r.color=Tt.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(r.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class A9 extends Wa{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,n,s){const r=this.annotationStorage;for(const a of this._getElementsByName(t.name,t.id))a.domElement&&(a.domElement[e]=n),r.setValue(a.id,{[s]:n})}render(){const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){const s=t.getValue(e,{value:this.data.fieldValue});let r=s.value||"";const a=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;a&&r.length>a&&(r=r.slice(0,a));let c=s.formattedValue||this.data.textContent?.join(`
`)||null;c&&this.data.comb&&(c=c.replaceAll(/\s+/g,""));const u={userValue:r,formattedValue:c,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=c??r,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type=this.data.password?"password":"text",n.setAttribute("value",c??r),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),Va.add(n),this.contentElement=n,n.setAttribute("data-element-id",e),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=0;const{datetimeFormat:h,datetimeType:f,timeStep:m}=this.data,y=!!f&&this.enableScripting;h&&(n.title=h),this._setRequired(n,this.data.required),a&&(n.maxLength=a),n.addEventListener("input",S=>{t.setValue(e,{value:S.target.value}),this.setPropertyOnSiblings(n,"value",S.target.value,"value"),u.formattedValue=null}),n.addEventListener("resetform",S=>{const b=this.data.defaultFieldValue??"";n.value=u.userValue=b,u.formattedValue=null});let T=S=>{const{formattedValue:b}=u;b!=null&&(S.target.value=b),S.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",b=>{if(u.focused)return;const{target:C}=b;if(y&&(C.type=f,m&&(C.step=m)),u.userValue){const I=u.userValue;if(y)if(f==="time"){const D=new Date(I),P=[D.getHours(),D.getMinutes(),D.getSeconds()];C.value=P.map(H=>H.toString().padStart(2,"0")).join(":")}else C.value=new Date(I-v9).toISOString().split(f==="date"?"T":".",1)[0];else C.value=I}u.lastCommittedValue=C.value,u.commitKey=1,this.data.actions?.Focus||(u.focused=!0)}),n.addEventListener("updatefromsandbox",b=>{this.showElementAndHideCanvas(b.target);const C={value(I){u.userValue=I.detail.value??"",y||t.setValue(e,{value:u.userValue.toString()}),I.target.value=u.userValue},formattedValue(I){const{formattedValue:D}=I.detail;u.formattedValue=D,D!=null&&I.target!==document.activeElement&&(I.target.value=D);const P={formattedValue:D};y&&(P.value=D),t.setValue(e,P)},selRange(I){I.target.setSelectionRange(...I.detail.selRange)},charLimit:I=>{const{charLimit:D}=I.detail,{target:P}=I;if(D===0){P.removeAttribute("maxLength");return}P.setAttribute("maxLength",D);let H=u.userValue;!H||H.length<=D||(H=H.slice(0,D),P.value=u.userValue=H,t.setValue(e,{value:H}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:H,willCommit:!0,commitKey:1,selStart:P.selectionStart,selEnd:P.selectionEnd}}))}};this._dispatchEventFromSandbox(C,b)}),n.addEventListener("keydown",b=>{u.commitKey=1;let C=-1;if(b.key==="Escape"?C=0:b.key==="Enter"&&!this.data.multiLine?C=2:b.key==="Tab"&&(u.commitKey=3),C===-1)return;const{value:I}=b.target;u.lastCommittedValue!==I&&(u.lastCommittedValue=I,u.userValue=I,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:I,willCommit:!0,commitKey:C,selStart:b.target.selectionStart,selEnd:b.target.selectionEnd}}))});const S=T;T=null,n.addEventListener("blur",b=>{if(!u.focused||!b.relatedTarget)return;this.data.actions?.Blur||(u.focused=!1);const{target:C}=b;let{value:I}=C;if(y){if(I&&f==="time"){const D=I.split(":").map(P=>parseInt(P,10));I=new Date(2e3,0,1,D[0],D[1],D[2]||0).valueOf(),C.step=""}else I.includes("T")||(I=`${I}T00:00`),I=new Date(I).valueOf();C.type="text"}u.userValue=I,u.lastCommittedValue!==I&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:I,willCommit:!0,commitKey:u.commitKey,selStart:b.target.selectionStart,selEnd:b.target.selectionEnd}}),S(b)}),this.data.actions?.Keystroke&&n.addEventListener("beforeinput",b=>{u.lastCommittedValue=null;const{data:C,target:I}=b,{value:D,selectionStart:P,selectionEnd:H}=I;let F=P,G=H;switch(b.inputType){case"deleteWordBackward":{const N=D.substring(0,P).match(/\w*[^\w]*$/);N&&(F-=N[0].length);break}case"deleteWordForward":{const N=D.substring(P).match(/^[^\w]*\w*/);N&&(G+=N[0].length);break}case"deleteContentBackward":P===H&&(F-=1);break;case"deleteContentForward":P===H&&(G+=1);break}b.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:D,change:C||"",willCommit:!1,selStart:F,selEnd:G}})}),this._setEventListeners(n,u,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],b=>b.target.value)}if(T&&n.addEventListener("blur",T),this.data.comb){const b=(this.data.rect[2]-this.data.rect[0])/a;n.classList.add("comb"),n.style.letterSpacing=`calc(${b}px * var(--total-scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class S9 extends Wa{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class w9 extends Wa{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,n=e.id;let s=t.getValue(n,{value:e.exportValue===e.fieldValue}).value;typeof s=="string"&&(s=s!=="Off",t.setValue(n,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const r=document.createElement("input");return Va.add(r),r.setAttribute("data-element-id",n),r.disabled=e.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=e.fieldName,s&&r.setAttribute("checked",!0),r.setAttribute("exportValue",e.exportValue),r.tabIndex=0,r.addEventListener("change",a=>{const{name:c,checked:u}=a.target;for(const h of this._getElementsByName(c,n)){const f=u&&h.exportValue===e.exportValue;h.domElement&&(h.domElement.checked=f),t.setValue(h.id,{value:f})}t.setValue(n,{value:u})}),r.addEventListener("resetform",a=>{const c=e.defaultFieldValue||"Off";a.target.checked=c===e.exportValue}),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",a=>{const c={value(u){u.target.checked=u.detail.value!=="Off",t.setValue(n,{value:u.target.checked})}};this._dispatchEventFromSandbox(c,a)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class fP extends Wa{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,n=e.id;let s=t.getValue(n,{value:e.fieldValue===e.buttonValue}).value;if(typeof s=="string"&&(s=s!==e.buttonValue,t.setValue(n,{value:s})),s)for(const a of this._getElementsByName(e.fieldName,n))t.setValue(a.id,{value:!1});const r=document.createElement("input");if(Va.add(r),r.setAttribute("data-element-id",n),r.disabled=e.readOnly,this._setRequired(r,this.data.required),r.type="radio",r.name=e.fieldName,s&&r.setAttribute("checked",!0),r.tabIndex=0,r.addEventListener("change",a=>{const{name:c,checked:u}=a.target;for(const h of this._getElementsByName(c,n))t.setValue(h.id,{value:!1});t.setValue(n,{value:u})}),r.addEventListener("resetform",a=>{const c=e.defaultFieldValue;a.target.checked=c!=null&&c===e.buttonValue}),this.enableScripting&&this.hasJSActions){const a=e.buttonValue;r.addEventListener("updatefromsandbox",c=>{const u={value:h=>{const f=a===h.detail.value;for(const m of this._getElementsByName(h.target.name)){const y=f&&m.id===n;m.domElement&&(m.domElement.checked=y),t.setValue(m.id,{value:y})}}};this._dispatchEventFromSandbox(u,c)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],c=>c.target.checked)}return this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class b9 extends AE{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),t}}class C9 extends Wa{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,n=t.getValue(e,{value:this.data.fieldValue}),s=document.createElement("select");Va.add(s),s.setAttribute("data-element-id",e),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=0;let r=this.data.combo&&this.data.options.length>0;this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",f=>{const m=this.data.defaultFieldValue;for(const y of s.options)y.selected=y.value===m});for(const f of this.data.options){const m=document.createElement("option");m.textContent=f.displayValue,m.value=f.exportValue,n.value.includes(f.exportValue)&&(m.setAttribute("selected",!0),r=!1),s.append(m)}let a=null;if(r){const f=document.createElement("option");f.value=" ",f.setAttribute("hidden",!0),f.setAttribute("selected",!0),s.prepend(f),a=()=>{f.remove(),s.removeEventListener("input",a),a=null},s.addEventListener("input",a)}const c=f=>{const m=f?"value":"textContent",{options:y,multiple:T}=s;return T?Array.prototype.filter.call(y,S=>S.selected).map(S=>S[m]):y.selectedIndex===-1?null:y[y.selectedIndex][m]};let u=c(!1);const h=f=>{const m=f.target.options;return Array.prototype.map.call(m,y=>({displayValue:y.textContent,exportValue:y.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",f=>{const m={value(y){a?.();const T=y.detail.value,S=new Set(Array.isArray(T)?T:[T]);for(const b of s.options)b.selected=S.has(b.value);t.setValue(e,{value:c(!0)}),u=c(!1)},multipleSelection(y){s.multiple=!0},remove(y){const T=s.options,S=y.detail.remove;T[S].selected=!1,s.remove(S),T.length>0&&Array.prototype.findIndex.call(T,C=>C.selected)===-1&&(T[0].selected=!0),t.setValue(e,{value:c(!0),items:h(y)}),u=c(!1)},clear(y){for(;s.length!==0;)s.remove(0);t.setValue(e,{value:null,items:[]}),u=c(!1)},insert(y){const{index:T,displayValue:S,exportValue:b}=y.detail.insert,C=s.children[T],I=document.createElement("option");I.textContent=S,I.value=b,C?C.before(I):s.append(I),t.setValue(e,{value:c(!0),items:h(y)}),u=c(!1)},items(y){const{items:T}=y.detail;for(;s.length!==0;)s.remove(0);for(const S of T){const{displayValue:b,exportValue:C}=S,I=document.createElement("option");I.textContent=b,I.value=C,s.append(I)}s.options.length>0&&(s.options[0].selected=!0),t.setValue(e,{value:c(!0),items:h(y)}),u=c(!1)},indices(y){const T=new Set(y.detail.indices);for(const S of y.target.options)S.selected=T.has(S.index);t.setValue(e,{value:c(!0)}),u=c(!1)},editable(y){y.target.disabled=!y.detail.editable}};this._dispatchEventFromSandbox(m,f)}),s.addEventListener("input",f=>{const m=c(!0),y=c(!1);t.setValue(e,{value:m}),f.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:u,change:y,changeEx:m,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],f=>f.target.value)):s.addEventListener("input",function(f){t.setValue(e,{value:c(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class j_ extends Ne{constructor(t){const{data:e,elements:n,parent:s}=t,r=!!s._commentManager;if(super(t,{isRenderable:!r&&Ne._hasPopupData(e)}),this.elements=n,r&&Ne._hasPopupData(e)){const a=this.popup=this.#t();for(const c of n)c.popup=a}else this.popup=null}#t(){return new I9({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const e=this.popup=this.#t(),n=[];for(const s of this.elements)s.popup=e,s.container.ariaHasPopup="dialog",n.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",n.map(s=>`${Jl}${s}`).join(",")),this.container}}class I9{#t=null;#e=this.#z.bind(this);#i=this.#B.bind(this);#n=this.#N.bind(this);#o=this.#A.bind(this);#r=null;#s=null;#a=null;#c=null;#l=null;#d=null;#h=null;#f=!1;#g=null;#m=null;#u=null;#p=null;#y=null;#v=null;#_=null;#b=null;#S=null;#T=null;#I=!1;#E=null;#w=null;constructor({container:t,color:e,elements:n,titleObj:s,modificationDate:r,contentsObj:a,richText:c,parent:u,rect:h,parentRect:f,open:m,commentManager:y=null}){this.#s=t,this.#S=s,this.#a=a,this.#b=c,this.#d=u,this.#r=e,this.#_=h,this.#h=f,this.#l=n,this.#t=y,this.#E=n[0],this.#c=$_.toDateObject(r),this.trigger=n.flatMap(T=>T.getElementsToTriggerPopup()),y||(this.#P(),this.#s.hidden=!0,m&&this.#A())}#P(){if(this.#m)return;this.#m=new AbortController;const{signal:t}=this.#m;for(const e of this.trigger)e.addEventListener("click",this.#o,{signal:t}),e.addEventListener("pointerenter",this.#n,{signal:t}),e.addEventListener("pointerleave",this.#i,{signal:t}),e.classList.add("popupTriggerArea");for(const e of this.#l)e.container?.addEventListener("keydown",this.#e,{signal:t})}#R(){const t=this.#l.find(e=>e.hasCommentButton);t&&(this.#y=t._normalizePoint(t.commentButtonPosition))}renderCommentButton(){if(this.#p){this.#p.parentNode||this.#E.container.after(this.#p);return}if(this.#y||this.#R(),!this.#y)return;const{signal:t}=this.#m=new AbortController,e=this.#E.hasOwnCommentButton,n=()=>{this.#t.toggleCommentPopup(this,!0,void 0,!e)},s=()=>{this.#t.toggleCommentPopup(this,!1,!0,!e)},r=()=>{this.#t.toggleCommentPopup(this,!1,!1)};if(e){this.#p=this.#E.container;for(const a of this.trigger)a.ariaHasPopup="dialog",a.ariaControls="commentPopup",a.addEventListener("keydown",this.#e,{signal:t}),a.addEventListener("click",n,{signal:t}),a.addEventListener("pointerenter",s,{signal:t}),a.addEventListener("pointerleave",r,{signal:t}),a.classList.add("popupTriggerArea")}else{const a=this.#p=document.createElement("button");a.className="annotationCommentButton";const c=this.#E.container;a.style.zIndex=c.style.zIndex+1,a.tabIndex=0,a.ariaHasPopup="dialog",a.ariaControls="commentPopup",a.setAttribute("data-l10n-id","pdfjs-show-comment-button"),this.#U(),this.#M(),a.addEventListener("keydown",this.#e,{signal:t}),a.addEventListener("click",n,{signal:t}),a.addEventListener("pointerenter",s,{signal:t}),a.addEventListener("pointerleave",r,{signal:t}),c.after(a)}}#M(){if(this.#E.extraPopupElement&&!this.#E.editor)return;this.#p||this.renderCommentButton();const[t,e]=this.#y,{style:n}=this.#p;n.left=`calc(${t}%)`,n.top=`calc(${e}% - var(--comment-button-dim))`}#U(){this.#E.extraPopupElement||(this.#p||this.renderCommentButton(),this.#p.style.backgroundColor=this.commentButtonColor||"")}get commentButtonColor(){const{color:t,opacity:e}=this.#E.commentData;return t?this.#d._commentManager.makeCommentColor(t,e):null}focusCommentButton(){setTimeout(()=>{this.#p?.focus()},0)}getData(){const{richText:t,color:e,opacity:n,creationDate:s,modificationDate:r}=this.#E.commentData;return{contentsObj:{str:this.comment},richText:t,color:e,opacity:n,creationDate:s,modificationDate:r}}get elementBeforePopup(){return this.#p}get comment(){return this.#w||=this.#E.commentText,this.#w}set comment(t){t!==this.comment&&(this.#E.commentText=this.#w=t)}focus(){this.#E.container?.focus()}get parentBoundingClientRect(){return this.#E.layer.getBoundingClientRect()}setCommentButtonStates({selected:t,hasPopup:e}){this.#p&&(this.#p.classList.toggle("selected",t),this.#p.ariaExpanded=e)}setSelectedCommentButton(t){this.#p.classList.toggle("selected",t)}get commentPopupPosition(){if(this.#v)return this.#v;const{x:t,y:e,height:n}=this.#p.getBoundingClientRect(),{x:s,y:r,width:a,height:c}=this.#E.layer.getBoundingClientRect();return[(t-s)/a,(e+n-r)/c]}set commentPopupPosition(t){this.#v=t}hasDefaultPopupPosition(){return this.#v===null}get commentButtonPosition(){return this.#y}get commentButtonWidth(){return this.#p.getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(t){const[e,n]=this.#v||this.commentButtonPosition.map(h=>h/100),s=this.parentBoundingClientRect,{x:r,y:a,width:c,height:u}=s;this.#t.showDialog(null,this,r+e*c,a+n*u,{...t,parentDimensions:s})}render(){if(this.#g)return;const t=this.#g=document.createElement("div");if(t.className="popup",this.#r){const n=t.style.outlineColor=Tt.makeHexColor(...this.#r);t.style.backgroundColor=`color-mix(in srgb, ${n} 30%, white)`}const e=document.createElement("span");if(e.className="header",this.#S?.str){const n=document.createElement("span");n.className="title",e.append(n),{dir:n.dir,str:n.textContent}=this.#S}if(t.append(e),this.#c){const n=document.createElement("time");n.className="popupDate",n.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),n.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#c.valueOf()})),n.dateTime=this.#c.toISOString(),e.append(n)}YM({html:this.#D||this.#a.str,dir:this.#a?.dir,className:"popupContent"},t),this.#s.append(t)}get#D(){const t=this.#b,e=this.#a;return t?.str&&(!e?.str||e.str===t.str)&&this.#b.html||null}get#k(){return this.#D?.attributes?.style?.fontSize||0}get#V(){return this.#D?.attributes?.style?.color||null}#L(t){const e=[],n={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},s={style:{color:this.#V,fontSize:this.#k?`calc(${this.#k}px * var(--total-scale-factor))`:""}};for(const r of t.split(`
`))e.push({name:"span",value:r,attributes:s});return n}#z(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&this.#f)&&this.#A()}updateEdited({rect:t,popup:e,deleted:n}){if(this.#t){n?(this.remove(),this.#w=null):e&&(e.deleted?this.remove():(this.#U(),this.#w=e.text)),t&&(this.#y=null,this.#R(),this.#M());return}if(n||e?.deleted){this.remove();return}this.#P(),this.#T||={contentsObj:this.#a,richText:this.#b},t&&(this.#u=null),e&&e.text&&(this.#b=this.#L(e.text),this.#c=$_.toDateObject(e.date),this.#a=null),this.#g?.remove(),this.#g=null}resetEdited(){this.#T&&({contentsObj:this.#a,richText:this.#b}=this.#T,this.#T=null,this.#g?.remove(),this.#g=null,this.#u=null)}remove(){if(this.#m?.abort(),this.#m=null,this.#g?.remove(),this.#g=null,this.#I=!1,this.#f=!1,this.#p?.remove(),this.#p=null,this.trigger)for(const t of this.trigger)t.classList.remove("popupTriggerArea")}#C(){if(this.#u!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:n,pageX:s,pageY:r}}}=this.#d;let a=!!this.#h,c=a?this.#h:this.#_;for(const S of this.#l)if(!c||Tt.intersect(S.data.rect,c)!==null){c=S.data.rect,a=!0;break}const u=Tt.normalizeRect([c[0],t[3]-c[1]+t[1],c[2],t[3]-c[3]+t[1]]),f=a?c[2]-c[0]+5:0,m=u[0]+f,y=u[1];this.#u=[100*(m-s)/e,100*(y-r)/n];const{style:T}=this.#s;T.left=`${this.#u[0]}%`,T.top=`${this.#u[1]}%`}#A(){if(this.#t){this.#t.toggleCommentPopup(this,!1);return}this.#f=!this.#f,this.#f?(this.#N(),this.#s.addEventListener("click",this.#o),this.#s.addEventListener("keydown",this.#e)):(this.#B(),this.#s.removeEventListener("click",this.#o),this.#s.removeEventListener("keydown",this.#e))}#N(){this.#g||this.render(),this.isVisible?this.#f&&this.#s.classList.add("focused"):(this.#C(),this.#s.hidden=!1,this.#s.style.zIndex=parseInt(this.#s.style.zIndex)+1e3)}#B(){this.#s.classList.remove("focused"),!(this.#f||!this.isVisible)&&(this.#s.hidden=!0,this.#s.style.zIndex=parseInt(this.#s.style.zIndex)-1e3)}forceHide(){this.#I=this.isVisible,this.#I&&(this.#s.hidden=!0)}maybeShow(){this.#t||(this.#P(),this.#I&&(this.#g||this.#N(),this.#I=!1,this.#s.hidden=!1))}get isVisible(){return this.#t?!1:this.#s.hidden===!1}}class pP extends Ne{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=qt.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=this.contentElement=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const n=document.createElement("span");n.textContent=e,t.append(n)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class R9 extends Ne{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:t,width:e,height:n}=this,s=this.svgFactory.create(e,n,!0),r=this.#t=this.svgFactory.createElement("svg:line");return r.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),r.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),r.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),r.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),r.setAttribute("stroke-width",t.borderStyle.width||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),s.append(r),this.container.append(s),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class M9 extends Ne{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:t,width:e,height:n}=this,s=this.svgFactory.create(e,n,!0),r=t.borderStyle.width,a=this.#t=this.svgFactory.createElement("svg:rect");return a.setAttribute("x",r/2),a.setAttribute("y",r/2),a.setAttribute("width",e-r),a.setAttribute("height",n-r),a.setAttribute("stroke-width",r||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),s.append(a),this.container.append(s),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class P9 extends Ne{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:t,width:e,height:n}=this,s=this.svgFactory.create(e,n,!0),r=t.borderStyle.width,a=this.#t=this.svgFactory.createElement("svg:ellipse");return a.setAttribute("cx",e/2),a.setAttribute("cy",n/2),a.setAttribute("rx",e/2-r/2),a.setAttribute("ry",n/2-r/2),a.setAttribute("stroke-width",r||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),s.append(a),this.container.append(s),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class mP extends Ne{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:e,borderStyle:n,popupRef:s},width:r,height:a}=this;if(!e)return this.container;const c=this.svgFactory.create(r,a,!0);let u=[];for(let f=0,m=e.length;f<m;f+=2){const y=e[f]-t[0],T=t[3]-e[f+1];u.push(`${y},${T}`)}u=u.join(" ");const h=this.#t=this.svgFactory.createElement(this.svgElementName);return h.setAttribute("points",u),h.setAttribute("stroke-width",n.width||1),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),c.append(h),this.container.append(c),!s&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class x9 extends mP{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class D9 extends Ne{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}}class SE extends Ne{#t=null;#e=[];constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?qt.HIGHLIGHT:qt.INK}#i(t,e){switch(t){case 90:return{transform:`rotate(90) translate(${-e[0]},${e[1]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};case 180:return{transform:`rotate(180) translate(${-e[2]},${e[1]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]};case 270:return{transform:`rotate(270) translate(${-e[2]},${e[3]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};default:return{transform:`translate(${-e[0]},${e[3]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:e,inkLists:n,borderStyle:s,popupRef:r}}=this,{transform:a,width:c,height:u}=this.#i(e,t),h=this.svgFactory.create(c,u,!0),f=this.#t=this.svgFactory.createElement("svg:g");h.append(f),f.setAttribute("stroke-width",s.width||1),f.setAttribute("stroke-linecap","round"),f.setAttribute("stroke-linejoin","round"),f.setAttribute("stroke-miterlimit",10),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),f.setAttribute("transform",a);for(let m=0,y=n.length;m<y;m++){const T=this.svgFactory.createElement(this.svgElementName);this.#e.push(T),T.setAttribute("points",n[m].join(",")),f.append(T)}return!r&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(h),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:e,points:n,rect:s}=t,r=this.#t;if(e>=0&&r.setAttribute("stroke-width",e||1),n)for(let a=0,c=this.#e.length;a<c;a++)this.#e[a].setAttribute("points",n[a].join(","));if(s){const{transform:a,width:c,height:u}=this.#i(this.data.rotation,s);r.parentElement.setAttribute("viewBox",`0 0 ${c} ${u}`),r.setAttribute("transform",a)}}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class gP extends Ne{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=qt.HIGHLIGHT}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),t){const n=document.createElement("mark");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class N9 extends Ne{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("underlineAnnotation"),t){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class k9 extends Ne{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("squigglyAnnotation"),t){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class L9 extends Ne{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("strikeoutAnnotation"),t){const n=document.createElement("s");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class yP extends Ne{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=qt.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class O9 extends Ne{#t=null;constructor(t){super(t,{isRenderable:!0});const{file:e}=this.data;this.filename=e.filename,this.content=e.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...e})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:e}=this;let n;e.hasAppearance||e.fillAlpha===0?n=document.createElement("div"):(n=document.createElement("img"),n.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`,e.fillAlpha&&e.fillAlpha<1&&(n.style=`filter: opacity(${Math.round(e.fillAlpha*100)}%);`)),n.addEventListener("dblclick",this.#e.bind(this)),this.#t=n;const{isMac:s}=Pn.platform;return t.addEventListener("keydown",r=>{r.key==="Enter"&&(s?r.metaKey:r.ctrlKey)&&this.#e()}),!e.popupRef&&this.hasPopupData?(this.hasOwnCommentButton=!0,this._createPopup()):n.classList.add("popupTriggerArea"),t.append(n),t}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class wE{#t=null;#e=null;#i=null;#n=new Map;#o=null;#r=null;#s=[];#a=!1;constructor({div:t,accessibilityManager:e,annotationCanvasMap:n,annotationEditorUIManager:s,page:r,viewport:a,structTreeLayer:c,commentManager:u,linkService:h,annotationStorage:f}){this.div=t,this.#t=e,this.#e=n,this.#o=c||null,this.#r=h||null,this.#i=f||new yE,this.page=r,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=s,this._commentManager=u||null}hasEditableAnnotations(){return this.#n.size>0}async render(t){const{annotations:e}=t,n=this.div;Ua(n,this.viewport);const s=new Map,r=[],a={data:null,layer:n,linkService:this.#r,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new Np,annotationStorage:this.#i,enableComment:t.enableComment===!0,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const c of e){if(c.noHTML)continue;const u=c.annotationType===Ze.POPUP;if(u){const m=s.get(c.id);if(!m)continue;if(!this._commentManager){r.push(c);continue}a.elements=m}else if(c.rect[2]===c.rect[0]||c.rect[3]===c.rect[1])continue;a.data=c;const h=jy.create(a);if(!h.isRenderable)continue;if(!u&&(this.#s.push(h),c.popupRef)){const m=s.get(c.popupRef);m?m.push(h):s.set(c.popupRef,[h])}const f=h.render();c.hidden&&(f.style.visibility="hidden"),h._isEditable&&(this.#n.set(h.data.id,h),this._annotationEditorUIManager?.renderAnnotationElement(h))}await this.#c();for(const c of r){const u=a.elements=s.get(c.id);a.data=c;const h=jy.create(a);if(!h.isRenderable)continue;const f=h.render();h.contentElement.id=`${Jl}${c.id}`,c.hidden&&(f.style.visibility="hidden"),u.at(-1).container.after(f)}this.#l()}async#c(){if(this.#s.length===0)return;this.div.replaceChildren();const t=[];if(!this.#a){this.#a=!0;for(const{contentElement:n,data:{id:s}}of this.#s){const r=n.id=`${Jl}${s}`;t.push(this.#o?.getAriaAttributes(r).then(a=>{if(a)for(const[c,u]of a)n.setAttribute(c,u)}))}}this.#s.sort(({data:{rect:[n,s,r,a]}},{data:{rect:[c,u,h,f]}})=>{if(n===r&&s===a)return 1;if(c===h&&u===f)return-1;const m=a,y=s,T=(s+a)/2,S=f,b=u,C=(u+f)/2;if(T>=S&&C<=y)return-1;if(C>=m&&T<=b)return 1;const I=(n+r)/2,D=(c+h)/2;return I-D});const e=document.createDocumentFragment();for(const n of this.#s)e.append(n.container),this._commentManager?(n.extraPopupElement?.popup||n.popup)?.renderCommentButton():n.extraPopupElement&&e.append(n.extraPopupElement.render());if(this.div.append(e),await Promise.all(t),this.#t)for(const n of this.#s)this.#t.addPointerInTextLayer(n.contentElement,!1)}async addLinkAnnotations(t){const e={data:null,layer:this.div,linkService:this.#r,svgFactory:new Np,parent:this};for(const n of t){n.borderStyle||=wE._defaultBorderStyle,e.data=n;const s=jy.create(e);s.isRenderable&&(s.render(),s.contentElement.id=`${Jl}${n.id}`,this.#s.push(s))}await this.#c()}update({viewport:t}){const e=this.div;this.viewport=t,Ua(e,{rotation:t.rotation}),this.#l(),e.hidden=!1}#l(){if(!this.#e)return;const t=this.div;for(const[e,n]of this.#e){const s=t.querySelector(`[data-annotation-id="${e}"]`);if(!s)continue;n.className="annotationContent";const{firstChild:r}=s;r?r.nodeName==="CANVAS"?r.replaceWith(n):r.classList.contains("annotationContent")?r.after(n):r.before(n):s.append(n);const a=this.#n.get(e);a&&(a._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(e,s.id,n),a._hasNoCanvas=!1):a.canvas=n)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#n.values())}getEditableAnnotation(t){return this.#n.get(t)}addFakeAnnotation(t){const{div:e}=this,{id:n,rotation:s}=t,r=new E9({data:{id:n,rect:t.getPDFRect(),rotation:s},editor:t,layer:e,parent:this,enableComment:!!this._commentManager,linkService:this.#r,annotationStorage:this.#i});return r.render(),r.contentElement.id=`${Jl}${n}`,r.createOrUpdatePopup(),this.#s.push(r),r}removeAnnotation(t){const e=this.#s.findIndex(s=>s.data.id===t);if(e<0)return;const[n]=this.#s.splice(e,1);this.#t?.removePointerInTextLayer(n.contentElement)}updateFakeAnnotations(t){if(t.length!==0){for(const e of t)e.updateFakeAnnotationElement(this);this.#c()}}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}static get _defaultBorderStyle(){return Ht(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:zl.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const kf=/\r\n?|\n/g;class yn extends Rt{#t="";#e=`${this.id}-editor`;#i=null;#n;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const t=yn.prototype,e=r=>r.isEmpty(),n=No.TRANSLATE_SMALL,s=No.TRANSLATE_BIG;return Ht(this,"_keyboardManager",new Yh([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-n,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[n,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[s,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-n],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,n],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,s],checker:e}]]))}static _type="freetext";static _editorType=qt.FREETEXT;constructor(t){super({...t,name:"freeTextEditor"}),this.color=t.color||yn._defaultColor||Rt._defaultLineColor,this.#n=t.fontSize||yn._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert"),this.canAddComment=!1}static initialize(t,e){Rt.initialize(t,e);const n=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(n.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case te.FREETEXT_SIZE:yn._defaultFontSize=e;break;case te.FREETEXT_COLOR:yn._defaultColor=e;break}}updateParams(t,e){switch(t){case te.FREETEXT_SIZE:this.#o(e);break;case te.FREETEXT_COLOR:this.#r(e);break}}static get defaultPropertiesToUpdate(){return[[te.FREETEXT_SIZE,yn._defaultFontSize],[te.FREETEXT_COLOR,yn._defaultColor||Rt._defaultLineColor]]}get propertiesToUpdate(){return[[te.FREETEXT_SIZE,this.#n],[te.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||=new Ch(this),[["colorPicker",this._colorPicker]]}get colorType(){return te.FREETEXT_COLOR}#o(t){const e=s=>{this.editorDiv.style.fontSize=`calc(${s}px * var(--total-scale-factor))`,this.translate(0,-(s-this.#n)*this.parentScale),this.#n=s,this.#a()},n=this.#n;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:te.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}onUpdatedColor(){this.editorDiv.style.color=this.color,this._colorPicker?.update(this.color),super.onUpdatedColor()}#r(t){const e=s=>{this.color=s,this.onUpdatedColor()},n=this.color;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:te.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}getInitialTranslation(){const t=this.parentScale;return[-yn._internalPadding*t,-(yn._internalPadding+this.#n)*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#i=new AbortController;const t=this._uiManager.combinedSignal(this.#i);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#e),this._isDraggable=!0,this.#i?.abort(),this.#i=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#s(){const t=[];this.editorDiv.normalize();let e=null;for(const n of this.editorDiv.childNodes)e?.nodeType===Node.TEXT_NODE&&n.nodeName==="BR"||(t.push(yn.#c(n)),e=n);return t.join(`
`)}#a(){const[t,e]=this.parentDimensions;let n;if(this.isAttachedToDOM)n=this.div.getBoundingClientRect();else{const{currentLayer:s,div:r}=this,a=r.style.display,c=r.classList.contains("hidden");r.classList.remove("hidden"),r.style.display="hidden",s.div.append(this.div),n=r.getBoundingClientRect(),r.remove(),r.style.display=a,r.classList.toggle("hidden",c)}this.rotation%180===this.parentRotation%180?(this.width=n.width/t,this.height=n.height/e):(this.width=n.height/t,this.height=n.width/e),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=this.#t,e=this.#t=this.#s().trimEnd();if(t===e)return;const n=s=>{if(this.#t=s,!s){this.remove();return}this.#l(),this._uiManager.rebuild(this),this.#a()};this.addCommands({cmd:()=>{n(e)},undo:()=>{n(t)},mustExec:!1}),this.#a()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){yn._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,e;(this._isCopy||this.annotationElementId)&&(t=this.x,e=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#e),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:n}=this.editorDiv;if(n.fontSize=`calc(${this.#n}px * var(--total-scale-factor))`,n.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[s,r]=this.parentDimensions;if(this.annotationElementId){const{position:a}=this._initialData;let[c,u]=this.getInitialTranslation();[c,u]=this.pageTranslationToScreen(c,u);const[h,f]=this.pageDimensions,[m,y]=this.pageTranslation;let T,S;switch(this.rotation){case 0:T=t+(a[0]-m)/h,S=e+this.height-(a[1]-y)/f;break;case 90:T=t+(a[0]-m)/h,S=e-(a[1]-y)/f,[c,u]=[u,-c];break;case 180:T=t-this.width+(a[0]-m)/h,S=e-(a[1]-y)/f,[c,u]=[-c,-u];break;case 270:T=t+(a[0]-m-this.height*f)/h,S=e+(a[1]-y-this.width*h)/f,[c,u]=[-u,c];break}this.setAt(T*s,S*r,c,u)}else this._moveAfterPaste(t,e);this.#l(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#c(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(kf,"")}editorDivPaste(t){const e=t.clipboardData||window.clipboardData,{types:n}=e;if(n.length===1&&n[0]==="text/plain")return;t.preventDefault();const s=yn.#h(e.getData("text")||"").replaceAll(kf,`
`);if(!s)return;const r=window.getSelection();if(!r.rangeCount)return;this.editorDiv.normalize(),r.deleteFromDocument();const a=r.getRangeAt(0);if(!s.includes(`
`)){a.insertNode(document.createTextNode(s)),this.editorDiv.normalize(),r.collapseToStart();return}const{startContainer:c,startOffset:u}=a,h=[],f=[];if(c.nodeType===Node.TEXT_NODE){const T=c.parentElement;if(f.push(c.nodeValue.slice(u).replaceAll(kf,"")),T!==this.editorDiv){let S=h;for(const b of this.editorDiv.childNodes){if(b===T){S=f;continue}S.push(yn.#c(b))}}h.push(c.nodeValue.slice(0,u).replaceAll(kf,""))}else if(c===this.editorDiv){let T=h,S=0;for(const b of this.editorDiv.childNodes)S++===u&&(T=f),T.push(yn.#c(b))}this.#t=`${h.join(`
`)}${s}${f.join(`
`)}`,this.#l();const m=new Range;let y=Math.sumPrecise(h.map(T=>T.length));for(const{firstChild:T}of this.editorDiv.childNodes)if(T.nodeType===Node.TEXT_NODE){const S=T.nodeValue.length;if(y<=S){m.setStart(T,y),m.setEnd(T,y);break}y-=S}r.removeAllRanges(),r.addRange(m)}#l(){if(this.editorDiv.replaceChildren(),!!this.#t)for(const t of this.#t.split(`
`)){const e=document.createElement("div");e.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(e)}}#d(){return this.#t.replaceAll(""," ")}static#h(t){return t.replaceAll(" ","")}get contentDiv(){return this.editorDiv}getPDFRect(){const t=yn._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,e,n){let s=null;if(t instanceof pP){const{data:{defaultAppearanceData:{fontSize:a,fontColor:c},rect:u,rotation:h,id:f,popupRef:m,richText:y,contentsObj:T,creationDate:S,modificationDate:b},textContent:C,textPosition:I,parent:{page:{pageNumber:D}}}=t;if(!C||C.length===0)return null;s=t={annotationType:qt.FREETEXT,color:Array.from(c),fontSize:a,value:C.join(`
`),position:I,pageIndex:D-1,rect:u.slice(0),rotation:h,annotationElementId:f,id:f,deleted:!1,popupRef:m,comment:T?.str||null,richText:y,creationDate:S,modificationDate:b}}const r=await super.deserialize(t,e,n);return r.#n=t.fontSize,r.color=Tt.makeHexColor(...t.color),r.#t=yn.#h(t.value),r._initialData=s,t.comment&&r.setCommentData(t),r}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const e=Rt._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),n=Object.assign(super.serialize(t),{color:e,fontSize:this.#n,value:this.#d()});return this.addComment(n),t?(n.isCopy=!0,n):this.annotationElementId&&!this.#f(n)?null:(n.id=this.annotationElementId,n)}#f(t){const{value:e,fontSize:n,color:s,pageIndex:r}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==e||t.fontSize!==n||t.color.some((a,c)=>a!==s[c])||t.pageIndex!==r}renderAnnotationElement(t){const e=super.renderAnnotationElement(t);if(!e)return null;const{style:n}=e;n.fontSize=`calc(${this.#n}px * var(--total-scale-factor))`,n.color=this.color,e.replaceChildren();for(const s of this.#t.split(`
`)){const r=document.createElement("div");r.append(s?document.createTextNode(s):document.createElement("br")),e.append(r)}return t.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:this.#t}}),e}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}}class Et{static PRECISION=1e-4;toSVGPath(){Ee("Abstract method `toSVGPath` must be implemented.")}get box(){Ee("Abstract getter `box` must be implemented.")}serialize(t,e){Ee("Abstract method `serialize` must be implemented.")}static _rescale(t,e,n,s,r,a){a||=new Float32Array(t.length);for(let c=0,u=t.length;c<u;c+=2)a[c]=e+t[c]*s,a[c+1]=n+t[c+1]*r;return a}static _rescaleAndSwap(t,e,n,s,r,a){a||=new Float32Array(t.length);for(let c=0,u=t.length;c<u;c+=2)a[c]=e+t[c+1]*s,a[c+1]=n+t[c]*r;return a}static _translate(t,e,n,s){s||=new Float32Array(t.length);for(let r=0,a=t.length;r<a;r+=2)s[r]=e+t[r],s[r+1]=n+t[r+1];return s}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,n,s,r){switch(r){case 90:return[1-e/n,t/s];case 180:return[1-t/n,1-e/s];case 270:return[e/n,1-t/s];default:return[t/n,e/s]}}static _normalizePagePoint(t,e,n){switch(n){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,n,s,r,a){return[(t+5*n)/6,(e+5*s)/6,(5*n+r)/6,(5*s+a)/6,(n+r)/2,(s+a)/2]}}class ba{#t;#e=[];#i;#n;#o=[];#r=new Float32Array(18);#s;#a;#c;#l;#d;#h;#f=[];static#g=8;static#m=2;static#u=ba.#g+ba.#m;constructor({x:t,y:e},n,s,r,a,c=0){this.#t=n,this.#h=r*s,this.#n=a,this.#r.set([NaN,NaN,NaN,NaN,t,e],6),this.#i=c,this.#l=ba.#g*s,this.#c=ba.#u*s,this.#d=s,this.#f.push(t,e)}isEmpty(){return isNaN(this.#r[8])}#p(){const t=this.#r.subarray(4,6),e=this.#r.subarray(16,18),[n,s,r,a]=this.#t;return[(this.#s+(t[0]-e[0])/2-n)/r,(this.#a+(t[1]-e[1])/2-s)/a,(this.#s+(e[0]-t[0])/2-n)/r,(this.#a+(e[1]-t[1])/2-s)/a]}add({x:t,y:e}){this.#s=t,this.#a=e;const[n,s,r,a]=this.#t;let[c,u,h,f]=this.#r.subarray(8,12);const m=t-h,y=e-f,T=Math.hypot(m,y);if(T<this.#c)return!1;const S=T-this.#l,b=S/T,C=b*m,I=b*y;let D=c,P=u;c=h,u=f,h+=C,f+=I,this.#f?.push(t,e);const H=-I/S,F=C/S,G=H*this.#h,N=F*this.#h;return this.#r.set(this.#r.subarray(2,8),0),this.#r.set([h+G,f+N],4),this.#r.set(this.#r.subarray(14,18),12),this.#r.set([h-G,f-N],16),isNaN(this.#r[6])?(this.#o.length===0&&(this.#r.set([c+G,u+N],2),this.#o.push(NaN,NaN,NaN,NaN,(c+G-n)/r,(u+N-s)/a),this.#r.set([c-G,u-N],14),this.#e.push(NaN,NaN,NaN,NaN,(c-G-n)/r,(u-N-s)/a)),this.#r.set([D,P,c,u,h,f],6),!this.isEmpty()):(this.#r.set([D,P,c,u,h,f],6),Math.abs(Math.atan2(P-u,D-c)-Math.atan2(I,C))<Math.PI/2?([c,u,h,f]=this.#r.subarray(2,6),this.#o.push(NaN,NaN,NaN,NaN,((c+h)/2-n)/r,((u+f)/2-s)/a),[c,u,D,P]=this.#r.subarray(14,18),this.#e.push(NaN,NaN,NaN,NaN,((D+c)/2-n)/r,((P+u)/2-s)/a),!0):([D,P,c,u,h,f]=this.#r.subarray(0,6),this.#o.push(((D+5*c)/6-n)/r,((P+5*u)/6-s)/a,((5*c+h)/6-n)/r,((5*u+f)/6-s)/a,((c+h)/2-n)/r,((u+f)/2-s)/a),[h,f,c,u,D,P]=this.#r.subarray(12,18),this.#e.push(((D+5*c)/6-n)/r,((P+5*u)/6-s)/a,((5*c+h)/6-n)/r,((5*u+f)/6-s)/a,((c+h)/2-n)/r,((u+f)/2-s)/a),!0))}toSVGPath(){if(this.isEmpty())return"";const t=this.#o,e=this.#e;if(isNaN(this.#r[6])&&!this.isEmpty())return this.#y();const n=[];n.push(`M${t[4]} ${t[5]}`);for(let s=6;s<t.length;s+=6)isNaN(t[s])?n.push(`L${t[s+4]} ${t[s+5]}`):n.push(`C${t[s]} ${t[s+1]} ${t[s+2]} ${t[s+3]} ${t[s+4]} ${t[s+5]}`);this.#_(n);for(let s=e.length-6;s>=6;s-=6)isNaN(e[s])?n.push(`L${e[s+4]} ${e[s+5]}`):n.push(`C${e[s]} ${e[s+1]} ${e[s+2]} ${e[s+3]} ${e[s+4]} ${e[s+5]}`);return this.#v(n),n.join(" ")}#y(){const[t,e,n,s]=this.#t,[r,a,c,u]=this.#p();return`M${(this.#r[2]-t)/n} ${(this.#r[3]-e)/s} L${(this.#r[4]-t)/n} ${(this.#r[5]-e)/s} L${r} ${a} L${c} ${u} L${(this.#r[16]-t)/n} ${(this.#r[17]-e)/s} L${(this.#r[14]-t)/n} ${(this.#r[15]-e)/s} Z`}#v(t){const e=this.#e;t.push(`L${e[4]} ${e[5]} Z`)}#_(t){const[e,n,s,r]=this.#t,a=this.#r.subarray(4,6),c=this.#r.subarray(16,18),[u,h,f,m]=this.#p();t.push(`L${(a[0]-e)/s} ${(a[1]-n)/r} L${u} ${h} L${f} ${m} L${(c[0]-e)/s} ${(c[1]-n)/r}`)}newFreeDrawOutline(t,e,n,s,r,a){return new _P(t,e,n,s,r,a)}getOutlines(){const t=this.#o,e=this.#e,n=this.#r,[s,r,a,c]=this.#t,u=new Float32Array((this.#f?.length??0)+2);for(let m=0,y=u.length-2;m<y;m+=2)u[m]=(this.#f[m]-s)/a,u[m+1]=(this.#f[m+1]-r)/c;if(u[u.length-2]=(this.#s-s)/a,u[u.length-1]=(this.#a-r)/c,isNaN(n[6])&&!this.isEmpty())return this.#b(u);const h=new Float32Array(this.#o.length+24+this.#e.length);let f=t.length;for(let m=0;m<f;m+=2){if(isNaN(t[m])){h[m]=h[m+1]=NaN;continue}h[m]=t[m],h[m+1]=t[m+1]}f=this.#T(h,f);for(let m=e.length-6;m>=6;m-=6)for(let y=0;y<6;y+=2){if(isNaN(e[m+y])){h[f]=h[f+1]=NaN,f+=2;continue}h[f]=e[m+y],h[f+1]=e[m+y+1],f+=2}return this.#S(h,f),this.newFreeDrawOutline(h,u,this.#t,this.#d,this.#i,this.#n)}#b(t){const e=this.#r,[n,s,r,a]=this.#t,[c,u,h,f]=this.#p(),m=new Float32Array(36);return m.set([NaN,NaN,NaN,NaN,(e[2]-n)/r,(e[3]-s)/a,NaN,NaN,NaN,NaN,(e[4]-n)/r,(e[5]-s)/a,NaN,NaN,NaN,NaN,c,u,NaN,NaN,NaN,NaN,h,f,NaN,NaN,NaN,NaN,(e[16]-n)/r,(e[17]-s)/a,NaN,NaN,NaN,NaN,(e[14]-n)/r,(e[15]-s)/a],0),this.newFreeDrawOutline(m,t,this.#t,this.#d,this.#i,this.#n)}#S(t,e){const n=this.#e;return t.set([NaN,NaN,NaN,NaN,n[4],n[5]],e),e+=6}#T(t,e){const n=this.#r.subarray(4,6),s=this.#r.subarray(16,18),[r,a,c,u]=this.#t,[h,f,m,y]=this.#p();return t.set([NaN,NaN,NaN,NaN,(n[0]-r)/c,(n[1]-a)/u,NaN,NaN,NaN,NaN,h,f,NaN,NaN,NaN,NaN,m,y,NaN,NaN,NaN,NaN,(s[0]-r)/c,(s[1]-a)/u],e),e+=24}}class _P extends Et{#t;#e=new Float32Array(4);#i;#n;#o;#r;#s;constructor(t,e,n,s,r,a){super(),this.#s=t,this.#o=e,this.#t=n,this.#r=s,this.#i=r,this.#n=a,this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],this.#a(a);const[c,u,h,f]=this.#e;for(let m=0,y=t.length;m<y;m+=2)t[m]=(t[m]-c)/h,t[m+1]=(t[m+1]-u)/f;for(let m=0,y=e.length;m<y;m+=2)e[m]=(e[m]-c)/h,e[m+1]=(e[m+1]-u)/f}toSVGPath(){const t=[`M${this.#s[4]} ${this.#s[5]}`];for(let e=6,n=this.#s.length;e<n;e+=6){if(isNaN(this.#s[e])){t.push(`L${this.#s[e+4]} ${this.#s[e+5]}`);continue}t.push(`C${this.#s[e]} ${this.#s[e+1]} ${this.#s[e+2]} ${this.#s[e+3]} ${this.#s[e+4]} ${this.#s[e+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,e,n,s],r){const a=n-t,c=s-e;let u,h;switch(r){case 0:u=Et._rescale(this.#s,t,s,a,-c),h=Et._rescale(this.#o,t,s,a,-c);break;case 90:u=Et._rescaleAndSwap(this.#s,t,e,a,c),h=Et._rescaleAndSwap(this.#o,t,e,a,c);break;case 180:u=Et._rescale(this.#s,n,e,-a,c),h=Et._rescale(this.#o,n,e,-a,c);break;case 270:u=Et._rescaleAndSwap(this.#s,n,s,-a,-c),h=Et._rescaleAndSwap(this.#o,n,s,-a,-c);break}return{outline:Array.from(u),points:[Array.from(h)]}}#a(t){const e=this.#s;let n=e[4],s=e[5];const r=[n,s,n,s];let a=n,c=s,u=n,h=s;const f=t?Math.max:Math.min,m=new Float32Array(4);for(let T=6,S=e.length;T<S;T+=6){const b=e[T+4],C=e[T+5];isNaN(e[T])?(Tt.pointBoundingBox(b,C,r),c>C?(a=b,c=C):c===C&&(a=f(a,b)),h<C?(u=b,h=C):h===C&&(u=f(u,b))):(m[0]=m[1]=1/0,m[2]=m[3]=-1/0,Tt.bezierBoundingBox(n,s,...e.slice(T,T+6),m),Tt.rectBoundingBox(m[0],m[1],m[2],m[3],r),c>m[1]?(a=m[0],c=m[1]):c===m[1]&&(a=f(a,m[0])),h<m[3]?(u=m[2],h=m[3]):h===m[3]&&(u=f(u,m[2]))),n=b,s=C}const y=this.#e;y[0]=r[0]-this.#i,y[1]=r[1]-this.#i,y[2]=r[2]-r[0]+2*this.#i,y[3]=r[3]-r[1]+2*this.#i,this.firstPoint=[a,c],this.lastPoint=[u,h]}get box(){return this.#e}newOutliner(t,e,n,s,r,a=0){return new ba(t,e,n,s,r,a)}getNewOutline(t,e){const[n,s,r,a]=this.#e,[c,u,h,f]=this.#t,m=r*h,y=a*f,T=n*h+c,S=s*f+u,b=this.newOutliner({x:this.#o[0]*m+T,y:this.#o[1]*y+S},this.#t,this.#r,t,this.#n,e??this.#i);for(let C=2;C<this.#o.length;C+=2)b.add({x:this.#o[C]*m+T,y:this.#o[C+1]*y+S});return b.getOutlines()}}class Z_{#t;#e;#i;#n=[];#o=[];constructor(t,e=0,n=0,s=!0){const r=[1/0,1/0,-1/0,-1/0],a=10**-4;for(const{x:b,y:C,width:I,height:D}of t){const P=Math.floor((b-e)/a)*a,H=Math.ceil((b+I+e)/a)*a,F=Math.floor((C-e)/a)*a,G=Math.ceil((C+D+e)/a)*a,N=[P,F,G,!0],x=[H,F,G,!1];this.#n.push(N,x),Tt.rectBoundingBox(P,F,H,G,r)}const c=r[2]-r[0]+2*n,u=r[3]-r[1]+2*n,h=r[0]-n,f=r[1]-n;let m=s?-1/0:1/0,y=1/0;const T=this.#n.at(s?-1:-2),S=[T[0],T[2]];for(const b of this.#n){const[C,I,D,P]=b;!P&&s?I<y?(y=I,m=C):I===y&&(m=Math.max(m,C)):P&&!s&&(I<y?(y=I,m=C):I===y&&(m=Math.min(m,C))),b[0]=(C-h)/c,b[1]=(I-f)/u,b[2]=(D-f)/u}this.#t=new Float32Array([h,f,c,u]),this.#e=[m,y],this.#i=S}getOutlines(){this.#n.sort((e,n)=>e[0]-n[0]||e[1]-n[1]||e[2]-n[2]);const t=[];for(const e of this.#n)e[3]?(t.push(...this.#l(e)),this.#a(e)):(this.#c(e),t.push(...this.#l(e)));return this.#r(t)}#r(t){const e=[],n=new Set;for(const a of t){const[c,u,h]=a;e.push([c,u,a],[c,h,a])}e.sort((a,c)=>a[1]-c[1]||a[0]-c[0]);for(let a=0,c=e.length;a<c;a+=2){const u=e[a][2],h=e[a+1][2];u.push(h),h.push(u),n.add(u),n.add(h)}const s=[];let r;for(;n.size>0;){const a=n.values().next().value;let[c,u,h,f,m]=a;n.delete(a);let y=c,T=u;for(r=[c,h],s.push(r);;){let S;if(n.has(f))S=f;else if(n.has(m))S=m;else break;n.delete(S),[c,u,h,f,m]=S,y!==c&&(r.push(y,T,c,T===u?u:h),y=c),T=T===u?h:u}r.push(y,T)}return new U9(s,this.#t,this.#e,this.#i)}#s(t){const e=this.#o;let n=0,s=e.length-1;for(;n<=s;){const r=n+s>>1,a=e[r][0];if(a===t)return r;a<t?n=r+1:s=r-1}return s+1}#a([,t,e]){const n=this.#s(t);this.#o.splice(n,0,[t,e])}#c([,t,e]){const n=this.#s(t);for(let s=n;s<this.#o.length;s++){const[r,a]=this.#o[s];if(r!==t)break;if(r===t&&a===e){this.#o.splice(s,1);return}}for(let s=n-1;s>=0;s--){const[r,a]=this.#o[s];if(r!==t)break;if(r===t&&a===e){this.#o.splice(s,1);return}}}#l(t){const[e,n,s]=t,r=[[e,n,s]],a=this.#s(s);for(let c=0;c<a;c++){const[u,h]=this.#o[c];for(let f=0,m=r.length;f<m;f++){const[,y,T]=r[f];if(!(h<=y||T<=u)){if(y>=u){if(T>h)r[f][1]=h;else{if(m===1)return[];r.splice(f,1),f--,m--}continue}r[f][2]=u,T>h&&r.push([e,h,T])}}}return r}}class U9 extends Et{#t;#e;constructor(t,e,n,s){super(),this.#e=t,this.#t=e,this.firstPoint=n,this.lastPoint=s}toSVGPath(){const t=[];for(const e of this.#e){let[n,s]=e;t.push(`M${n} ${s}`);for(let r=2;r<e.length;r+=2){const a=e[r],c=e[r+1];a===n?(t.push(`V${c}`),s=c):c===s&&(t.push(`H${a}`),n=a)}t.push("Z")}return t.join(" ")}serialize([t,e,n,s],r){const a=[],c=n-t,u=s-e;for(const h of this.#e){const f=new Array(h.length);for(let m=0;m<h.length;m+=2)f[m]=t+h[m]*c,f[m+1]=s-h[m+1]*u;a.push(f)}return a}get box(){return this.#t}get classNamesForOutlining(){return["highlightOutline"]}}class tv extends ba{newFreeDrawOutline(t,e,n,s,r,a){return new V9(t,e,n,s,r,a)}}class V9 extends _P{newOutliner(t,e,n,s,r,a=0){return new tv(t,e,n,s,r,a)}}class We extends Rt{#t=null;#e=0;#i;#n=null;#o=null;#r=null;#s=null;#a=0;#c=null;#l=null;#d=null;#h=!1;#f=null;#g=null;#m=null;#u="";#p;#y="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=qt.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const t=We.prototype;return Ht(this,"_keyboardManager",new Yh([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"}),this.color=t.color||We._defaultColor,this.#p=t.thickness||We._defaultThickness,this.opacity=t.opacity||We._defaultOpacity,this.#i=t.boxes||null,this.#y=t.methodOfCreation||"",this.#u=t.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(this.#h=!0,this.#_(t),this.#E()):this.#i&&(this.#t=t.anchorNode,this.#e=t.anchorOffset,this.#s=t.focusNode,this.#a=t.focusOffset,this.#v(),this.#E(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#h?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#p,methodOfCreation:this.#y}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#v(){const t=new Z_(this.#i,.001);this.#l=t.getOutlines(),[this.x,this.y,this.width,this.height]=this.#l.box;const e=new Z_(this.#i,.0025,.001,this._uiManager.direction==="ltr");this.#r=e.getOutlines();const{firstPoint:n}=this.#l;this.#f=[(n[0]-this.x)/this.width,(n[1]-this.y)/this.height];const{lastPoint:s}=this.#r;this.#g=[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height]}#_({highlightOutlines:t,highlightId:e,clipPathId:n}){this.#l=t;const s=1.5;if(this.#r=t.getNewOutline(this.#p/2+s,.0025),e>=0)this.#d=e,this.#n=n,this.parent.drawLayer.finalizeDraw(e,{bbox:t.box,path:{d:t.toSVGPath()}}),this.#m=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#r.box,path:{d:this.#r.toSVGPath()}},!0);else if(this.parent){const m=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#d,{bbox:We.#w(this.#l.box,(m-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#m,{bbox:We.#w(this.#r.box,m),path:{d:this.#r.toSVGPath()}})}const[r,a,c,u]=t.box;switch(this.rotation){case 0:this.x=r,this.y=a,this.width=c,this.height=u;break;case 90:{const[m,y]=this.parentDimensions;this.x=a,this.y=1-r,this.width=c*y/m,this.height=u*m/y;break}case 180:this.x=1-r,this.y=1-a,this.width=c,this.height=u;break;case 270:{const[m,y]=this.parentDimensions;this.x=1-a,this.y=r,this.width=c*y/m,this.height=u*m/y;break}}const{firstPoint:h}=t;this.#f=[(h[0]-r)/c,(h[1]-a)/u];const{lastPoint:f}=this.#r;this.#g=[(f[0]-r)/c,(f[1]-a)/u]}static initialize(t,e){Rt.initialize(t,e),We._defaultColor||=e.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,e){switch(t){case te.HIGHLIGHT_COLOR:We._defaultColor=e;break;case te.HIGHLIGHT_THICKNESS:We._defaultThickness=e;break}}translateInPage(t,e){}get toolbarPosition(){return this.#g}get commentButtonPosition(){return this.#f}updateParams(t,e){switch(t){case te.HIGHLIGHT_COLOR:this.#b(e);break;case te.HIGHLIGHT_THICKNESS:this.#S(e);break}}static get defaultPropertiesToUpdate(){return[[te.HIGHLIGHT_COLOR,We._defaultColor],[te.HIGHLIGHT_THICKNESS,We._defaultThickness]]}get propertiesToUpdate(){return[[te.HIGHLIGHT_COLOR,this.color||We._defaultColor],[te.HIGHLIGHT_THICKNESS,this.#p||We._defaultThickness],[te.HIGHLIGHT_FREE,this.#h]]}onUpdatedColor(){this.parent?.drawLayer.updateProperties(this.#d,{root:{fill:this.color,"fill-opacity":this.opacity}}),this.#o?.updateColor(this.color),super.onUpdatedColor()}#b(t){const e=(r,a)=>{this.color=r,this.opacity=a,this.onUpdatedColor()},n=this.color,s=this.opacity;this.addCommands({cmd:e.bind(this,t,We._defaultOpacity),undo:e.bind(this,n,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:te.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)}#S(t){const e=this.#p,n=s=>{this.#p=s,this.#T(s)};this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:te.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#o=new Li({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#M())}getBaseTranslation(){return[0,0]}getRect(t,e){return super.getRect(t,e,this.#M())}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){this.#I(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#E(),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?this.#I():t&&(this.#E(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),e&&this.select()}#T(t){this.#h&&(this.#_({highlightOutlines:this.#l.getNewOutline(t/2)}),this.fixAndSetPosition(),this.setDims())}#I(){this.#d===null||!this.parent||(this.parent.drawLayer.remove(this.#d),this.#d=null,this.parent.drawLayer.remove(this.#m),this.#m=null)}#E(t=this.parent){this.#d===null&&({id:this.#d,clipPathId:this.#n}=t.drawLayer.draw({bbox:this.#l.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:this.#h},path:{d:this.#l.toSVGPath()}},!1,!0),this.#m=t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#h},bbox:this.#r.box,path:{d:this.#r.toSVGPath()}},this.#h),this.#c&&(this.#c.style.clipPath=this.#n))}static#w([t,e,n,s],r){switch(r){case 90:return[1-e-s,t,s,n];case 180:return[1-t-n,1-e-s,n,s];case 270:return[e,1-t-n,s,n]}return[t,e,n,s]}rotate(t){const{drawLayer:e}=this.parent;let n;this.#h?(t=(t-this.rotation+360)%360,n=We.#w(this.#l.box,t)):n=We.#w([this.x,this.y,this.width,this.height],t),e.updateProperties(this.#d,{bbox:n,root:{"data-main-rotation":t}}),e.updateProperties(this.#m,{bbox:We.#w(this.#r.box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();this.#u&&(t.setAttribute("aria-label",this.#u),t.setAttribute("role","mark")),this.#h?t.classList.add("free"):this.div.addEventListener("keydown",this.#P.bind(this),{signal:this._uiManager._signal});const e=this.#c=document.createElement("div");return t.append(e),e.setAttribute("aria-hidden","true"),e.className="internal",e.style.clipPath=this.#n,this.setDims(),KM(this,this.#c,["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#m,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#m,{rootClass:{hovered:!1}})}#P(t){We._keyboardManager.exec(this,t)}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:this.#R(!0);break;case 1:case 3:this.#R(!1);break}}#R(t){if(!this.#t)return;const e=window.getSelection();t?e.setPosition(this.#t,this.#e):e.setPosition(this.#s,this.#a)}select(){super.select(),this.#m&&this.parent?.drawLayer.updateProperties(this.#m,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#m&&(this.parent?.drawLayer.updateProperties(this.#m,{rootClass:{selected:!1}}),this.#h||this.#R(!1))}get _mustFixPosition(){return!this.#h}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(this.#d,{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(this.#m,{rootClass:{hidden:!t}}))}#M(){return this.#h?this.rotation:0}#U(){if(this.#h)return null;const[t,e]=this.pageDimensions,[n,s]=this.pageTranslation,r=this.#i,a=new Float32Array(r.length*8);let c=0;for(const{x:u,y:h,width:f,height:m}of r){const y=u*t+n,T=(1-h)*e+s;a[c]=a[c+4]=y,a[c+1]=a[c+3]=T,a[c+2]=a[c+6]=y+f*t,a[c+5]=a[c+7]=T-m*e,c+=8}return a}#D(t){return this.#l.serialize(t,this.#M())}static startHighlighting(t,e,{target:n,x:s,y:r}){const{x:a,y:c,width:u,height:h}=n.getBoundingClientRect(),f=new AbortController,m=t.combinedSignal(f),y=T=>{f.abort(),this.#V(t,T)};window.addEventListener("blur",y,{signal:m}),window.addEventListener("pointerup",y,{signal:m}),window.addEventListener("pointerdown",Ue,{capture:!0,passive:!1,signal:m}),window.addEventListener("contextmenu",Fi,{signal:m}),n.addEventListener("pointermove",this.#k.bind(this,t),{signal:m}),this._freeHighlight=new tv({x:s,y:r},[a,c,u,h],t.scale,this._defaultThickness/2,e,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#k(t,e){this._freeHighlight.add(e)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#V(t,e){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(t,e,n){let s=null;if(t instanceof gP){const{data:{quadPoints:S,rect:b,rotation:C,id:I,color:D,opacity:P,popupRef:H,richText:F,contentsObj:G,creationDate:N,modificationDate:x},parent:{page:{pageNumber:k}}}=t;s=t={annotationType:qt.HIGHLIGHT,color:Array.from(D),opacity:P,quadPoints:S,boxes:null,pageIndex:k-1,rect:b.slice(0),rotation:C,annotationElementId:I,id:I,deleted:!1,popupRef:H,richText:F,comment:G?.str||null,creationDate:N,modificationDate:x}}else if(t instanceof SE){const{data:{inkLists:S,rect:b,rotation:C,id:I,color:D,borderStyle:{rawWidth:P},popupRef:H,richText:F,contentsObj:G,creationDate:N,modificationDate:x},parent:{page:{pageNumber:k}}}=t;s=t={annotationType:qt.HIGHLIGHT,color:Array.from(D),thickness:P,inkLists:S,boxes:null,pageIndex:k-1,rect:b.slice(0),rotation:C,annotationElementId:I,id:I,deleted:!1,popupRef:H,richText:F,comment:G?.str||null,creationDate:N,modificationDate:x}}const{color:r,quadPoints:a,inkLists:c,opacity:u}=t,h=await super.deserialize(t,e,n);h.color=Tt.makeHexColor(...r),h.opacity=u||1,c&&(h.#p=t.thickness),h._initialData=s,t.comment&&h.setCommentData(t);const[f,m]=h.pageDimensions,[y,T]=h.pageTranslation;if(a){const S=h.#i=[];for(let b=0;b<a.length;b+=8)S.push({x:(a[b]-y)/f,y:1-(a[b+1]-T)/m,width:(a[b+2]-a[b])/f,height:(a[b+1]-a[b+5])/m});h.#v(),h.#E(),h.rotate(h.rotation)}else if(c){h.#h=!0;const S=c[0],b={x:S[0]-y,y:m-(S[1]-T)},C=new tv(b,[0,0,f,m],1,h.#p/2,!0,.001);for(let P=0,H=S.length;P<H;P+=2)b.x=S[P]-y,b.y=m-(S[P+1]-T),C.add(b);const{id:I,clipPathId:D}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:h.color,"fill-opacity":h._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:C.toSVGPath()}},!0,!0);h.#_({highlightOutlines:C.getOutlines(),highlightId:I,clipPathId:D}),h.#E(),h.rotate(h.parentRotation)}return h}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const e=Rt._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),n=super.serialize(t);return Object.assign(n,{color:e,opacity:this.opacity,thickness:this.#p,quadPoints:this.#U(),outlines:this.#D(n.rect)}),this.addComment(n),this.annotationElementId&&!this.#L(n)?null:(n.id=this.annotationElementId,n)}#L(t){const{color:e}=this._initialData;return this.hasEditedComment||t.color.some((n,s)=>n!==e[s])}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}}class vP{#t=Object.create(null);updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,n]of Object.entries(t))e.startsWith("_")||this.updateProperty(e,n)}updateSVGProperty(t,e){this.#t[t]=e}toSVGProperties(){const t=this.#t;return this.#t=Object.create(null),{root:t}}reset(){this.#t=Object.create(null)}updateAll(t=this){this.updateProperties(t)}clone(){Ee("Not implemented")}}class le extends Rt{#t=null;#e;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#i=null;static#n=null;static#o=null;static _INNER_MARGIN=3;constructor(t){super(t),this.#e=t.mustBeCommitted||!1,this._addOutlines(t)}onUpdatedColor(){this._colorPicker?.update(this.color),super.onUpdatedColor()}_addOutlines(t){t.drawOutlines&&(this.#r(t),this.#c())}#r({drawOutlines:t,drawId:e,drawingOptions:n}){this.#t=t,this._drawingOptions||=n,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),e>=0?(this._drawId=e,this.parent.drawLayer.finalizeDraw(e,t.defaultProperties)):this._drawId=this.#s(t,this.parent),this.#h(t.box)}#s(t,e){const{id:n}=e.drawLayer.draw(le._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return n}static _mergeSVGProperties(t,e){const n=new Set(Object.keys(t));for(const[s,r]of Object.entries(e))n.has(s)?Object.assign(t[s],r):t[s]=r;return t}static getDefaultDrawingOptions(t){Ee("Not implemented")}static get typesMap(){Ee("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,e){const n=this.typesMap.get(t);n&&this._defaultDrawingOptions.updateProperty(n,e),this._currentParent&&(le.#i.updateProperty(n,e),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,e){const n=this.constructor.typesMap.get(t);n&&this._updateProperty(t,n,e)}static get defaultPropertiesToUpdate(){const t=[],e=this._defaultDrawingOptions;for(const[n,s]of this.typesMap)t.push([n,e[s]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:e}=this;for(const[n,s]of this.constructor.typesMap)t.push([n,e[s]]);return t}_updateProperty(t,e,n){const s=this._drawingOptions,r=s[e],a=c=>{s.updateProperty(e,c);const u=this.#t.updateProperty(e,c);u&&this.#h(u),this.parent?.drawLayer.updateProperties(this._drawId,s.toSVGProperties()),t===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:a.bind(this,n),undo:a.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,le._mergeSVGProperties(this.#t.getPathResizingSVGProperties(this.#d()),{bbox:this.#f()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,le._mergeSVGProperties(this.#t.getPathResizedSVGProperties(this.#d()),{bbox:this.#f()}))}_onTranslating(t,e){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#f()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,le._mergeSVGProperties(this.#t.getPathTranslatedSVGProperties(this.#d(),this.parentDimensions),{bbox:this.#f()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#e&&(this.#e=!1,this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){this.#a(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#c(),this.#h(this.#t.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),this.#a()):t&&(this._uiManager.addShouldRescale(this),this.#c(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),e&&this.select()}#a(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#c(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#s(this.#t,t)}}#l([t,e,n,s]){const{parentDimensions:[r,a],rotation:c}=this;switch(c){case 90:return[e,1-t,n*(a/r),s*(r/a)];case 180:return[1-t,1-e,n,s];case 270:return[1-e,t,n*(a/r),s*(r/a)];default:return[t,e,n,s]}}#d(){const{x:t,y:e,width:n,height:s,parentDimensions:[r,a],rotation:c}=this;switch(c){case 90:return[1-e,t,n*(r/a),s*(a/r)];case 180:return[1-t,1-e,n,s];case 270:return[e,1-t,n*(r/a),s*(a/r)];default:return[t,e,n,s]}}#h(t){[this.x,this.y,this.width,this.height]=this.#l(t),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()}#f(){const{x:t,y:e,width:n,height:s,rotation:r,parentRotation:a,parentDimensions:[c,u]}=this;switch((r*4+a)/90){case 1:return[1-e-s,t,s,n];case 2:return[1-t-n,1-e-s,n,s];case 3:return[e,1-t-n,s,n];case 4:return[t,e-n*(c/u),s*(u/c),n*(c/u)];case 5:return[1-e,t,n*(c/u),s*(u/c)];case 6:return[1-t-s*(u/c),1-e,s*(u/c),n*(c/u)];case 7:return[e-n*(c/u),1-t-s*(u/c),n*(c/u),s*(u/c)];case 8:return[t-n,e-s,n,s];case 9:return[1-e,t-n,s,n];case 10:return[1-t,1-e,n,s];case 11:return[e-s,1-t,s,n];case 12:return[t-s*(u/c),e,s*(u/c),n*(c/u)];case 13:return[1-e-n*(c/u),t-s*(u/c),n*(c/u),s*(u/c)];case 14:return[1-t,1-e-n*(c/u),s*(u/c),n*(c/u)];case 15:return[e,1-t,n*(c/u),s*(u/c)];default:return[t,e,n,s]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,le._mergeSVGProperties({bbox:this.#f()},this.#t.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#h(this.#t.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,e;this._isCopy&&(t=this.x,e=this.y);const n=super.render();n.classList.add("draw");const s=document.createElement("div");return n.append(s),s.setAttribute("aria-hidden","true"),s.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,e),n}static createDrawerInstance(t,e,n,s,r){Ee("Not implemented")}static startDrawing(t,e,n,s){const{target:r,offsetX:a,offsetY:c,pointerId:u,pointerType:h}=s;if(ce.isInitializedAndDifferentPointerType(h))return;const{viewport:{rotation:f}}=t,{width:m,height:y}=r.getBoundingClientRect(),T=le.#n=new AbortController,S=t.combinedSignal(T);if(ce.setPointer(h,u),window.addEventListener("pointerup",b=>{ce.isSamePointerIdOrRemove(b.pointerId)&&this._endDraw(b)},{signal:S}),window.addEventListener("pointercancel",b=>{ce.isSamePointerIdOrRemove(b.pointerId)&&this._currentParent.endDrawingSession()},{signal:S}),window.addEventListener("pointerdown",b=>{ce.isSamePointerType(b.pointerType)&&(ce.initializeAndAddPointerId(b.pointerId),le.#i.isCancellable()&&(le.#i.removeLastElement(),le.#i.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:S}),window.addEventListener("contextmenu",Fi,{signal:S}),r.addEventListener("pointermove",this._drawMove.bind(this),{signal:S}),r.addEventListener("touchmove",b=>{ce.isSameTimeStamp(b.timeStamp)&&Ue(b)},{signal:S}),t.toggleDrawing(),e._editorUndoBar?.hide(),le.#i){t.drawLayer.updateProperties(this._currentDrawId,le.#i.startNew(a,c,m,y,f));return}e.updateUIForDefaultProperties(this),le.#i=this.createDrawerInstance(a,c,m,y,f),le.#o=this.getDefaultDrawingOptions(),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(le.#o.toSVGProperties(),le.#i.defaultSVGProperties),!0,!1)}static _drawMove(t){if(ce.isSameTimeStamp(t.timeStamp),!le.#i)return;const{offsetX:e,offsetY:n,pointerId:s}=t;if(ce.isSamePointerId(s)){if(ce.isUsingMultiplePointers()){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,le.#i.add(e,n)),ce.setTimeStamp(t.timeStamp),Ue(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,le.#i=null,le.#o=null,ce.clearPointerType(),ce.clearTimeStamp()),le.#n&&(le.#n.abort(),le.#n=null,ce.clearPointerIds())}static _endDraw(t){const e=this._currentParent;if(e){if(e.toggleDrawing(!0),this._cleanup(!1),t?.target===e.div&&e.drawLayer.updateProperties(this._currentDrawId,le.#i.end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const n=le.#i,s=this._currentDrawId,r=n.getLastElement();e.addCommands({cmd:()=>{e.drawLayer.updateProperties(s,n.setLastElement(r))},undo:()=>{e.drawLayer.updateProperties(s,n.removeLastElement())},mustExec:!1,type:te.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const e=this._currentParent;if(!e)return null;if(e.toggleDrawing(!0),e.cleanUndoStack(te.DRAW_STEP),!le.#i.isEmpty()){const{pageDimensions:[n,s],scale:r}=e,a=e.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:le.#i.getOutlines(n*r,s*r,r,this._INNER_MARGIN),drawingOptions:le.#o,mustBeCommitted:!t});return this._cleanup(!0),a}return e.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,e,n,s,r,a){Ee("Not implemented")}static async deserialize(t,e,n){const{rawDims:{pageWidth:s,pageHeight:r,pageX:a,pageY:c}}=e.viewport,u=this.deserializeDraw(a,c,s,r,this._INNER_MARGIN,t),h=await super.deserialize(t,e,n);return h.createDrawingOptions(t),h.#r({drawOutlines:u}),h.#c(),h.onScaleChanging(),h.rotate(),h}serializeDraw(t){const[e,n]=this.pageTranslation,[s,r]=this.pageDimensions;return this.#t.serialize([e,n,s,r],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class B9{#t=new Float64Array(6);#e;#i;#n;#o;#r;#s="";#a=0;#c=new Kh;#l;#d;constructor(t,e,n,s,r,a){this.#l=n,this.#d=s,this.#n=r,this.#o=a,[t,e]=this.#h(t,e);const c=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#r=[t,e],this.#i=[{line:c,points:this.#r}],this.#t.set(c,0)}updateProperty(t,e){t==="stroke-width"&&(this.#o=e)}#h(t,e){return Et._normalizePoint(t,e,this.#l,this.#d,this.#n)}isEmpty(){return!this.#i||this.#i.length===0}isCancellable(){return this.#r.length<=10}add(t,e){[t,e]=this.#h(t,e);const[n,s,r,a]=this.#t.subarray(2,6),c=t-r,u=e-a;return Math.hypot(this.#l*c,this.#d*u)<=2?null:(this.#r.push(t,e),isNaN(n)?(this.#t.set([r,a,t,e],2),this.#e.push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(this.#t[0])&&this.#e.splice(6,6),this.#t.set([n,s,r,a,t,e],0),this.#e.push(...Et.createBezierPoints(n,s,r,a,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){const n=this.add(t,e);return n||(this.#r.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,n,s,r){this.#l=n,this.#d=s,this.#n=r,[t,e]=this.#h(t,e);const a=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#r=[t,e];const c=this.#i.at(-1);return c&&(c.line=new Float32Array(c.line),c.points=new Float32Array(c.points)),this.#i.push({line:a,points:this.#r}),this.#t.set(a,0),this.#a=0,this.toSVGPath(),null}getLastElement(){return this.#i.at(-1)}setLastElement(t){return this.#i?(this.#i.push(t),this.#e=t.line,this.#r=t.points,this.#a=0,{path:{d:this.toSVGPath()}}):this.#c.setLastElement(t)}removeLastElement(){if(!this.#i)return this.#c.removeLastElement();this.#i.pop(),this.#s="";for(let t=0,e=this.#i.length;t<e;t++){const{line:n,points:s}=this.#i[t];this.#e=n,this.#r=s,this.#a=0,this.toSVGPath()}return{path:{d:this.#s}}}toSVGPath(){const t=Et.svgRound(this.#e[4]),e=Et.svgRound(this.#e[5]);if(this.#r.length===2)return this.#s=`${this.#s} M ${t} ${e} Z`,this.#s;if(this.#r.length<=6){const s=this.#s.lastIndexOf("M");this.#s=`${this.#s.slice(0,s)} M ${t} ${e}`,this.#a=6}if(this.#r.length===4){const s=Et.svgRound(this.#e[10]),r=Et.svgRound(this.#e[11]);return this.#s=`${this.#s} L ${s} ${r}`,this.#a=12,this.#s}const n=[];this.#a===0&&(n.push(`M ${t} ${e}`),this.#a=6);for(let s=this.#a,r=this.#e.length;s<r;s+=6){const[a,c,u,h,f,m]=this.#e.slice(s,s+6).map(Et.svgRound);n.push(`C${a} ${c} ${u} ${h} ${f} ${m}`)}return this.#s+=n.join(" "),this.#a=this.#e.length,this.#s}getOutlines(t,e,n,s){const r=this.#i.at(-1);return r.line=new Float32Array(r.line),r.points=new Float32Array(r.points),this.#c.build(this.#i,t,e,n,this.#n,this.#o,s),this.#t=null,this.#e=null,this.#i=null,this.#s=null,this.#c}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class Kh extends Et{#t;#e=0;#i;#n;#o;#r;#s;#a;#c;build(t,e,n,s,r,a,c){this.#o=e,this.#r=n,this.#s=s,this.#a=r,this.#c=a,this.#i=c??0,this.#n=t,this.#h()}get thickness(){return this.#c}setLastElement(t){return this.#n.push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#n.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:e}of this.#n){if(t.push(`M${Et.svgRound(e[4])} ${Et.svgRound(e[5])}`),e.length===6){t.push("Z");continue}if(e.length===12&&isNaN(e[6])){t.push(`L${Et.svgRound(e[10])} ${Et.svgRound(e[11])}`);continue}for(let n=6,s=e.length;n<s;n+=6){const[r,a,c,u,h,f]=e.subarray(n,n+6).map(Et.svgRound);t.push(`C${r} ${a} ${c} ${u} ${h} ${f}`)}}return t.join("")}serialize([t,e,n,s],r){const a=[],c=[],[u,h,f,m]=this.#d();let y,T,S,b,C,I,D,P,H;switch(this.#a){case 0:H=Et._rescale,y=t,T=e+s,S=n,b=-s,C=t+u*n,I=e+(1-h-m)*s,D=t+(u+f)*n,P=e+(1-h)*s;break;case 90:H=Et._rescaleAndSwap,y=t,T=e,S=n,b=s,C=t+h*n,I=e+u*s,D=t+(h+m)*n,P=e+(u+f)*s;break;case 180:H=Et._rescale,y=t+n,T=e,S=-n,b=s,C=t+(1-u-f)*n,I=e+h*s,D=t+(1-u)*n,P=e+(h+m)*s;break;case 270:H=Et._rescaleAndSwap,y=t+n,T=e+s,S=-n,b=-s,C=t+(1-h-m)*n,I=e+(1-u-f)*s,D=t+(1-h)*n,P=e+(1-u)*s;break}for(const{line:F,points:G}of this.#n)a.push(H(F,y,T,S,b,r?new Array(F.length):null)),c.push(H(G,y,T,S,b,r?new Array(G.length):null));return{lines:a,points:c,rect:[C,I,D,P]}}static deserialize(t,e,n,s,r,{paths:{lines:a,points:c},rotation:u,thickness:h}){const f=[];let m,y,T,S,b;switch(u){case 0:b=Et._rescale,m=-t/n,y=e/s+1,T=1/n,S=-1/s;break;case 90:b=Et._rescaleAndSwap,m=-e/s,y=-t/n,T=1/s,S=1/n;break;case 180:b=Et._rescale,m=t/n+1,y=-e/s,T=-1/n,S=1/s;break;case 270:b=Et._rescaleAndSwap,m=e/s+1,y=t/n+1,T=-1/s,S=-1/n;break}if(!a){a=[];for(const I of c){const D=I.length;if(D===2){a.push(new Float32Array([NaN,NaN,NaN,NaN,I[0],I[1]]));continue}if(D===4){a.push(new Float32Array([NaN,NaN,NaN,NaN,I[0],I[1],NaN,NaN,NaN,NaN,I[2],I[3]]));continue}const P=new Float32Array(3*(D-2));a.push(P);let[H,F,G,N]=I.subarray(0,4);P.set([NaN,NaN,NaN,NaN,H,F],0);for(let x=4;x<D;x+=2){const k=I[x],V=I[x+1];P.set(Et.createBezierPoints(H,F,G,N,k,V),(x-2)*3),[H,F,G,N]=[G,N,k,V]}}}for(let I=0,D=a.length;I<D;I++)f.push({line:b(a[I].map(P=>P??NaN),m,y,T,S),points:b(c[I].map(P=>P??NaN),m,y,T,S)});const C=new this.prototype.constructor;return C.build(f,n,s,1,u,h,r),C}#l(t=this.#c){const e=this.#i+t/2*this.#s;return this.#a%180===0?[e/this.#o,e/this.#r]:[e/this.#r,e/this.#o]}#d(){const[t,e,n,s]=this.#t,[r,a]=this.#l(0);return[t+r,e+a,n-2*r,s-2*a]}#h(){const t=this.#t=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:s}of this.#n){if(s.length<=12){for(let c=4,u=s.length;c<u;c+=6)Tt.pointBoundingBox(s[c],s[c+1],t);continue}let r=s[4],a=s[5];for(let c=6,u=s.length;c<u;c+=6){const[h,f,m,y,T,S]=s.subarray(c,c+6);Tt.bezierBoundingBox(r,a,h,f,m,y,T,S,t),r=T,a=S}}const[e,n]=this.#l();t[0]=Xn(t[0]-e,0,1),t[1]=Xn(t[1]-n,0,1),t[2]=Xn(t[2]+e,0,1),t[3]=Xn(t[3]+n,0,1),t[2]-=t[0],t[3]-=t[1]}get box(){return this.#t}updateProperty(t,e){return t==="stroke-width"?this.#f(e):null}#f(t){const[e,n]=this.#l();this.#c=t;const[s,r]=this.#l(),[a,c]=[s-e,r-n],u=this.#t;return u[0]-=a,u[1]-=c,u[2]+=2*a,u[3]+=2*c,u}updateParentDimensions([t,e],n){const[s,r]=this.#l();this.#o=t,this.#r=e,this.#s=n;const[a,c]=this.#l(),u=a-s,h=c-r,f=this.#t;return f[0]-=u,f[1]-=h,f[2]+=2*u,f[3]+=2*h,f}updateRotation(t){return this.#e=t,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#t.map(Et.svgRound).join(" ")}get defaultProperties(){const[t,e]=this.#t;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Et.svgRound(t)} ${Et.svgRound(e)}`}}}get rotationTransform(){const[,,t,e]=this.#t;let n=0,s=0,r=0,a=0,c=0,u=0;switch(this.#e){case 90:s=e/t,r=-t/e,c=t;break;case 180:n=-1,a=-1,c=t,u=e;break;case 270:s=-e/t,r=t/e,u=e;break;default:return""}return`matrix(${n} ${s} ${r} ${a} ${Et.svgRound(c)} ${Et.svgRound(u)})`}getPathResizingSVGProperties([t,e,n,s]){const[r,a]=this.#l(),[c,u,h,f]=this.#t;if(Math.abs(h-r)<=Et.PRECISION||Math.abs(f-a)<=Et.PRECISION){const b=t+n/2-(c+h/2),C=e+s/2-(u+f/2);return{path:{"transform-origin":`${Et.svgRound(t)} ${Et.svgRound(e)}`,transform:`${this.rotationTransform} translate(${b} ${C})`}}}const m=(n-2*r)/(h-2*r),y=(s-2*a)/(f-2*a),T=h/n,S=f/s;return{path:{"transform-origin":`${Et.svgRound(c)} ${Et.svgRound(u)}`,transform:`${this.rotationTransform} scale(${T} ${S}) translate(${Et.svgRound(r)} ${Et.svgRound(a)}) scale(${m} ${y}) translate(${Et.svgRound(-r)} ${Et.svgRound(-a)})`}}}getPathResizedSVGProperties([t,e,n,s]){const[r,a]=this.#l(),c=this.#t,[u,h,f,m]=c;if(c[0]=t,c[1]=e,c[2]=n,c[3]=s,Math.abs(f-r)<=Et.PRECISION||Math.abs(m-a)<=Et.PRECISION){const C=t+n/2-(u+f/2),I=e+s/2-(h+m/2);for(const{line:D,points:P}of this.#n)Et._translate(D,C,I,D),Et._translate(P,C,I,P);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Et.svgRound(t)} ${Et.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const y=(n-2*r)/(f-2*r),T=(s-2*a)/(m-2*a),S=-y*(u+r)+t+r,b=-T*(h+a)+e+a;if(y!==1||T!==1||S!==0||b!==0)for(const{line:C,points:I}of this.#n)Et._rescale(C,S,b,y,T,C),Et._rescale(I,S,b,y,T,I);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Et.svgRound(t)} ${Et.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,e],n){const[s,r]=n,a=this.#t,c=t-a[0],u=e-a[1];if(this.#o===s&&this.#r===r)for(const{line:h,points:f}of this.#n)Et._translate(h,c,u,h),Et._translate(f,c,u,f);else{const h=this.#o/s,f=this.#r/r;this.#o=s,this.#r=r;for(const{line:m,points:y}of this.#n)Et._rescale(m,c,u,h,f,m),Et._rescale(y,c,u,h,f,y);a[2]*=h,a[3]*=f}return a[0]=t,a[1]=e,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${Et.svgRound(t)} ${Et.svgRound(e)}`}}}get defaultSVGProperties(){const t=this.#t;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${Et.svgRound(t[0])} ${Et.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}class _m extends vP{constructor(t){super(),this._viewParameters=t,super.updateProperties({fill:"none",stroke:Rt._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){t==="stroke-width"&&(e??=this["stroke-width"],e*=this._viewParameters.realScale),super.updateSVGProperty(t,e)}clone(){const t=new _m(this._viewParameters);return t.updateAll(this),t}}class bE extends le{static _type="ink";static _editorType=qt.INK;static _defaultDrawingOptions=null;constructor(t){super({...t,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,e){Rt.initialize(t,e),this._defaultDrawingOptions=new _m(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!0}static get typesMap(){return Ht(this,"typesMap",new Map([[te.INK_THICKNESS,"stroke-width"],[te.INK_COLOR,"stroke"],[te.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,e,n,s,r){return new B9(t,e,n,s,r,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,e,n,s,r,a){return Kh.deserialize(t,e,n,s,r,a)}static async deserialize(t,e,n){let s=null;if(t instanceof SE){const{data:{inkLists:a,rect:c,rotation:u,id:h,color:f,opacity:m,borderStyle:{rawWidth:y},popupRef:T,richText:S,contentsObj:b,creationDate:C,modificationDate:I},parent:{page:{pageNumber:D}}}=t;s=t={annotationType:qt.INK,color:Array.from(f),thickness:y,opacity:m,paths:{points:a},boxes:null,pageIndex:D-1,rect:c.slice(0),rotation:u,annotationElementId:h,id:h,deleted:!1,popupRef:T,richText:S,comment:b?.str||null,creationDate:C,modificationDate:I}}const r=await super.deserialize(t,e,n);return r._initialData=s,t.comment&&r.setCommentData(t),r}get toolbarButtons(){return this._colorPicker||=new Ch(this),[["colorPicker",this._colorPicker]]}get colorType(){return te.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:e,parent:n}=this;e.updateSVGProperty("stroke-width"),n.drawLayer.updateProperties(t,e.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:e,opacity:n}){this._drawingOptions=bE.getDefaultDrawingOptions({stroke:Tt.makeHexColor(...t),"stroke-width":e,"stroke-opacity":n})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:e,points:n}=this.serializeDraw(t),{_drawingOptions:{stroke:s,"stroke-opacity":r,"stroke-width":a}}=this,c=Object.assign(super.serialize(t),{color:Rt._colorManager.convert(s),opacity:r,thickness:a,paths:{lines:e,points:n}});return this.addComment(c),t?(c.isCopy=!0,c):this.annotationElementId&&!this.#t(c)?null:(c.id=this.annotationElementId,c)}#t(t){const{color:e,thickness:n,opacity:s,pageIndex:r}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((a,c)=>a!==e[c])||t.thickness!==n||t.opacity!==s||t.pageIndex!==r}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const{points:e,rect:n}=this.serializeDraw(!1);return t.updateEdited({rect:n,thickness:this._drawingOptions["stroke-width"],points:e,popup:this.comment}),null}}class ev extends Kh{toSVGPath(){let t=super.toSVGPath();return t.endsWith("Z")||(t+="Z"),t}}const Lf=8,Xu=3;class Yl{static#t={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#e(t,e,n,s){return n-=t,s-=e,n===0?s>0?0:4:n===1?s+6:2-s}static#i=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#n(t,e,n,s,r,a,c){const u=this.#e(n,s,r,a);for(let h=0;h<8;h++){const f=(-h+u-c+16)%8,m=this.#i[2*f],y=this.#i[2*f+1];if(t[(n+m)*e+(s+y)]!==0)return f}return-1}static#o(t,e,n,s,r,a,c){const u=this.#e(n,s,r,a);for(let h=0;h<8;h++){const f=(h+u+c+16)%8,m=this.#i[2*f],y=this.#i[2*f+1];if(t[(n+m)*e+(s+y)]!==0)return f}return-1}static#r(t,e,n,s){const r=t.length,a=new Int32Array(r);for(let f=0;f<r;f++)a[f]=t[f]<=s?1:0;for(let f=1;f<n-1;f++)a[f*e]=a[f*e+e-1]=0;for(let f=0;f<e;f++)a[f]=a[e*n-1-f]=0;let c=1,u;const h=[];for(let f=1;f<n-1;f++){u=1;for(let m=1;m<e-1;m++){const y=f*e+m,T=a[y];if(T===0)continue;let S=f,b=m;if(T===1&&a[y-1]===0)c+=1,b-=1;else if(T>=1&&a[y+1]===0)c+=1,b+=1,T>1&&(u=T);else{T!==1&&(u=Math.abs(T));continue}const C=[m,f],I=b===m+1,D={isHole:I,points:C,id:c,parent:0};h.push(D);let P;for(const U of h)if(U.id===u){P=U;break}P?P.isHole?D.parent=I?P.parent:u:D.parent=I?u:P.parent:D.parent=I?u:0;const H=this.#n(a,e,f,m,S,b,0);if(H===-1){a[y]=-c,a[y]!==1&&(u=Math.abs(a[y]));continue}let F=this.#i[2*H],G=this.#i[2*H+1];const N=f+F,x=m+G;S=N,b=x;let k=f,V=m;for(;;){const U=this.#o(a,e,k,V,S,b,1);F=this.#i[2*U],G=this.#i[2*U+1];const $=k+F,B=V+G;C.push(B,$);const vt=k*e+V;if(a[vt+1]===0?a[vt]=-c:a[vt]===1&&(a[vt]=c),$===f&&B===m&&k===N&&V===x){a[y]!==1&&(u=Math.abs(a[y]));break}else S=k,b=V,k=$,V=B}}}return h}static#s(t,e,n,s){if(n-e<=4){for(let N=e;N<n-2;N+=2)s.push(t[N],t[N+1]);return}const r=t[e],a=t[e+1],c=t[n-4]-r,u=t[n-3]-a,h=Math.hypot(c,u),f=c/h,m=u/h,y=f*a-m*r,T=u/c,S=1/h,b=Math.atan(T),C=Math.cos(b),I=Math.sin(b),D=S*(Math.abs(C)+Math.abs(I)),P=S*(1-D+D**2),H=Math.max(Math.atan(Math.abs(I+C)*P),Math.atan(Math.abs(I-C)*P));let F=0,G=e;for(let N=e+2;N<n-2;N+=2){const x=Math.abs(y-f*t[N+1]+m*t[N]);x>F&&(G=N,F=x)}F>(h*H)**2?(this.#s(t,e,G+2,s),this.#s(t,G,n,s)):s.push(r,a)}static#a(t){const e=[],n=t.length;return this.#s(t,0,n,e),e.push(t[n-2],t[n-1]),e.length<=4?null:e}static#c(t,e,n,s,r,a){const c=new Float32Array(a**2),u=-2*s**2,h=a>>1;for(let b=0;b<a;b++){const C=(b-h)**2;for(let I=0;I<a;I++)c[b*a+I]=Math.exp((C+(I-h)**2)/u)}const f=new Float32Array(256),m=-2*r**2;for(let b=0;b<256;b++)f[b]=Math.exp(b**2/m);const y=t.length,T=new Uint8Array(y),S=new Uint32Array(256);for(let b=0;b<n;b++)for(let C=0;C<e;C++){const I=b*e+C,D=t[I];let P=0,H=0;for(let G=0;G<a;G++){const N=b+G-h;if(!(N<0||N>=n))for(let x=0;x<a;x++){const k=C+x-h;if(k<0||k>=e)continue;const V=t[N*e+k],U=c[G*a+x]*f[Math.abs(V-D)];P+=V*U,H+=U}}const F=T[I]=Math.round(P/H);S[F]++}return[T,S]}static#l(t){const e=new Uint32Array(256);for(const n of t)e[n]++;return e}static#d(t){const e=t.length,n=new Uint8ClampedArray(e>>2);let s=-1/0,r=1/0;for(let c=0,u=n.length;c<u;c++){const h=n[c]=t[c<<2];s=Math.max(s,h),r=Math.min(r,h)}const a=255/(s-r);for(let c=0,u=n.length;c<u;c++)n[c]=(n[c]-r)*a;return n}static#h(t){let e,n=-1/0,s=-1/0;const r=t.findIndex(u=>u!==0);let a=r,c=r;for(e=r;e<256;e++){const u=t[e];u>n&&(e-a>s&&(s=e-a,c=e-1),n=u,a=e)}for(e=c-1;e>=0&&!(t[e]>t[e+1]);e--);return e}static#f(t){const e=t,{width:n,height:s}=t,{maxDim:r}=this.#t;let a=n,c=s;if(n>r||s>r){let y=n,T=s,S=Math.log2(Math.max(n,s)/r);const b=Math.floor(S);S=S===b?b-1:b;for(let I=0;I<S;I++){a=Math.ceil(y/2),c=Math.ceil(T/2);const D=new OffscreenCanvas(a,c);D.getContext("2d").drawImage(t,0,0,y,T,0,0,a,c),y=a,T=c,t!==e&&t.close(),t=D.transferToImageBitmap()}const C=Math.min(r/a,r/c);a=Math.round(a*C),c=Math.round(c*C)}const h=new OffscreenCanvas(a,c).getContext("2d",{willReadFrequently:!0});h.fillStyle="white",h.fillRect(0,0,a,c),h.filter="grayscale(1)",h.drawImage(t,0,0,t.width,t.height,0,0,a,c);const f=h.getImageData(0,0,a,c).data;return[this.#d(f),a,c]}static extractContoursFromText(t,{fontFamily:e,fontStyle:n,fontWeight:s},r,a,c,u){let h=new OffscreenCanvas(1,1),f=h.getContext("2d",{alpha:!1});const m=200,y=f.font=`${n} ${s} ${m}px ${e}`,{actualBoundingBoxLeft:T,actualBoundingBoxRight:S,actualBoundingBoxAscent:b,actualBoundingBoxDescent:C,fontBoundingBoxAscent:I,fontBoundingBoxDescent:D,width:P}=f.measureText(t),H=1.5,F=Math.ceil(Math.max(Math.abs(T)+Math.abs(S)||0,P)*H),G=Math.ceil(Math.max(Math.abs(b)+Math.abs(C)||m,Math.abs(I)+Math.abs(D)||m)*H);h=new OffscreenCanvas(F,G),f=h.getContext("2d",{alpha:!0,willReadFrequently:!0}),f.font=y,f.filter="grayscale(1)",f.fillStyle="white",f.fillRect(0,0,F,G),f.fillStyle="black",f.fillText(t,F*(H-1)/2,G*(3-H)/2);const N=this.#d(f.getImageData(0,0,F,G).data),x=this.#l(N),k=this.#h(x),V=this.#r(N,F,G,k);return this.processDrawnLines({lines:{curves:V,width:F,height:G},pageWidth:r,pageHeight:a,rotation:c,innerMargin:u,mustSmooth:!0,areContours:!0})}static process(t,e,n,s,r){const[a,c,u]=this.#f(t),[h,f]=this.#c(a,c,u,Math.hypot(c,u)*this.#t.sigmaSFactor,this.#t.sigmaR,this.#t.kernelSize),m=this.#h(f),y=this.#r(h,c,u,m);return this.processDrawnLines({lines:{curves:y,width:c,height:u},pageWidth:e,pageHeight:n,rotation:s,innerMargin:r,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:t,pageWidth:e,pageHeight:n,rotation:s,innerMargin:r,mustSmooth:a,areContours:c}){s%180!==0&&([e,n]=[n,e]);const{curves:u,width:h,height:f}=t,m=t.thickness??0,y=[],T=Math.min(e/h,n/f),S=T/e,b=T/n,C=[];for(const{points:D}of u){const P=a?this.#a(D):D;if(!P)continue;C.push(P);const H=P.length,F=new Float32Array(H),G=new Float32Array(3*(H===2?2:H-2));if(y.push({line:G,points:F}),H===2){F[0]=P[0]*S,F[1]=P[1]*b,G.set([NaN,NaN,NaN,NaN,F[0],F[1]],0);continue}let[N,x,k,V]=P;N*=S,x*=b,k*=S,V*=b,F.set([N,x,k,V],0),G.set([NaN,NaN,NaN,NaN,N,x],0);for(let U=4;U<H;U+=2){const $=F[U]=P[U]*S,B=F[U+1]=P[U+1]*b;G.set(Et.createBezierPoints(N,x,k,V,$,B),(U-2)*3),[N,x,k,V]=[k,V,$,B]}}if(y.length===0)return null;const I=c?new ev:new Kh;return I.build(y,e,n,1,s,c?0:m,r),{outline:I,newCurves:C,areContours:c,thickness:m,width:h,height:f}}static async compressSignature({outlines:t,areContours:e,thickness:n,width:s,height:r}){let a=1/0,c=-1/0,u=0;for(const P of t){u+=P.length;for(let H=2,F=P.length;H<F;H++){const G=P[H]-P[H-2];a=Math.min(a,G),c=Math.max(c,G)}}let h;a>=-128&&c<=127?h=Int8Array:a>=-32768&&c<=32767?h=Int16Array:h=Int32Array;const f=t.length,m=Lf+Xu*f,y=new Uint32Array(m);let T=0;y[T++]=m*Uint32Array.BYTES_PER_ELEMENT+(u-2*f)*h.BYTES_PER_ELEMENT,y[T++]=0,y[T++]=s,y[T++]=r,y[T++]=e?0:1,y[T++]=Math.max(0,Math.floor(n??0)),y[T++]=f,y[T++]=h.BYTES_PER_ELEMENT;for(const P of t)y[T++]=P.length-2,y[T++]=P[0],y[T++]=P[1];const S=new CompressionStream("deflate-raw"),b=S.writable.getWriter();await b.ready,b.write(y);const C=h.prototype.constructor;for(const P of t){const H=new C(P.length-2);for(let F=2,G=P.length;F<G;F++)H[F-2]=P[F]-P[F-2];b.write(H)}b.close();const I=await new Response(S.readable).arrayBuffer(),D=new Uint8Array(I);return zM(D)}static async decompressSignature(t){try{const e=e5(t),{readable:n,writable:s}=new DecompressionStream("deflate-raw"),r=s.getWriter();await r.ready,r.write(e).then(async()=>{await r.ready,await r.close()}).catch(()=>{});let a=null,c=0;for await(const P of n)a||=new Uint8Array(new Uint32Array(P.buffer,0,4)[0]),a.set(P,c),c+=P.length;const u=new Uint32Array(a.buffer,0,a.length>>2),h=u[1];if(h!==0)throw new Error(`Invalid version: ${h}`);const f=u[2],m=u[3],y=u[4]===0,T=u[5],S=u[6],b=u[7],C=[],I=(Lf+Xu*S)*Uint32Array.BYTES_PER_ELEMENT;let D;switch(b){case Int8Array.BYTES_PER_ELEMENT:D=new Int8Array(a.buffer,I);break;case Int16Array.BYTES_PER_ELEMENT:D=new Int16Array(a.buffer,I);break;case Int32Array.BYTES_PER_ELEMENT:D=new Int32Array(a.buffer,I);break}c=0;for(let P=0;P<S;P++){const H=u[Xu*P+Lf],F=new Float32Array(H+2);C.push(F);for(let G=0;G<Xu-1;G++)F[G]=u[Xu*P+Lf+G+1];for(let G=0;G<H;G++)F[G+2]=F[G]+D[c++]}return{areContours:y,thickness:T,outlines:C,width:f,height:m}}catch(e){return Ft(`decompressSignature: ${e}`),null}}}class CE extends vP{constructor(){super(),super.updateProperties({fill:Rt._defaultLineColor,"stroke-width":0})}clone(){const t=new CE;return t.updateAll(this),t}}class IE extends _m{constructor(t){super(t),super.updateProperties({stroke:Rt._defaultLineColor,"stroke-width":1})}clone(){const t=new IE(this._viewParameters);return t.updateAll(this),t}}class bs extends le{#t=!1;#e=null;#i=null;#n=null;static _type="signature";static _editorType=qt.SIGNATURE;static _defaultDrawingOptions=null;constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#i=t.signatureData||null,this.#e=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,e){Rt.initialize(t,e),this._defaultDrawingOptions=new CE,this._defaultDrawnSignatureOptions=new IE(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!1}static get typesMap(){return Ht(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#e}}static computeTelemetryFinalData(t){const e=t.get("hasDescription");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,e;const{_isCopy:n}=this;if(n&&(this._isCopy=!1,t=this.x,e=this.y),super.render(),this._drawId===null)if(this.#i){const{lines:s,mustSmooth:r,areContours:a,description:c,uuid:u,heightInPage:h}=this.#i,{rawDims:{pageWidth:f,pageHeight:m},rotation:y}=this.parent.viewport,T=Yl.processDrawnLines({lines:s,pageWidth:f,pageHeight:m,rotation:y,innerMargin:bs._INNER_MARGIN,mustSmooth:r,areContours:a});this.addSignature(T,h,c,u)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#e||""}));return n&&(this._isCopy=!0,this._moveAfterPaste(t,e)),this.div}setUuid(t){this.#n=t,this.addEditToolbar()}getUuid(){return this.#n}get description(){return this.#e}set description(t){this.#e=t,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(e=>{e?.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:e,thickness:n,width:s,height:r}=this.#i,a=Math.max(s,r),c=Yl.processDrawnLines({lines:{curves:t.map(u=>({points:u})),thickness:n,width:s,height:r},pageWidth:a,pageHeight:a,rotation:0,innerMargin:0,mustSmooth:!1,areContours:e});return{areContours:e,outline:c.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,e,n,s){const{x:r,y:a}=this,{outline:c}=this.#i=t;this.#t=c instanceof ev,this.description=n;let u;this.#t?u=bs.getDefaultDrawingOptions():(u=bs._defaultDrawnSignatureOptions.clone(),u.updateProperties({"stroke-width":c.thickness})),this._addOutlines({drawOutlines:c,drawingOptions:u});const[,h]=this.pageDimensions;let f=e/h;f=f>=1?.5:f,this.width*=f/this.height,this.width>=1&&(f*=.9/this.width,this.width=.9),this.height=f,this.setDims(),this.x=r,this.y=a,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(s),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!s,hasDescription:!!n}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:e,pageHeight:n},rotation:s}=this.parent.viewport;return Yl.process(t,e,n,s,bs._INNER_MARGIN)}getFromText(t,e){const{rawDims:{pageWidth:n,pageHeight:s},rotation:r}=this.parent.viewport;return Yl.extractContoursFromText(t,e,n,s,r,bs._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:e,pageHeight:n},rotation:s}=this.parent.viewport;return Yl.processDrawnLines({lines:t,pageWidth:e,pageHeight:n,rotation:s,innerMargin:bs._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:e}){t?this._drawingOptions=bs.getDefaultDrawingOptions():(this._drawingOptions=bs._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":e}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:e,points:n}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":s}}=this,r=Object.assign(super.serialize(t),{isSignature:!0,areContours:this.#t,color:[0,0,0],thickness:this.#t?0:s});return this.addComment(r),t?(r.paths={lines:e,points:n},r.uuid=this.#n,r.isCopy=!0):r.lines=e,this.#e&&(r.accessibilityData={type:"Figure",alt:this.#e}),r}static deserializeDraw(t,e,n,s,r,a){return a.areContours?ev.deserialize(t,e,n,s,r,a):Kh.deserialize(t,e,n,s,r,a)}static async deserialize(t,e,n){const s=await super.deserialize(t,e,n);return s.#t=t.areContours,s.description=t.accessibilityData?.alt||"",s.#n=t.uuid,s}}class F9 extends Rt{#t=null;#e=null;#i=null;#n=null;#o=null;#r="";#s=null;#a=!1;#c=null;#l=!1;#d=!1;static _type="stamp";static _editorType=qt.STAMP;constructor(t){super({...t,name:"stampEditor"}),this.#n=t.bitmapUrl,this.#o=t.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,e){Rt.initialize(t,e)}static isHandlingMimeForPasting(t){return Y_.includes(t)}static paste(t,e){e.pasteEditor({mode:qt.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(t){const e=t.get("hasAltText");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}#h(t,e=!1){if(!t){this.remove();return}this.#t=t.bitmap,e||(this.#e=t.id,this.#l=t.isSvg),t.file&&(this.#r=t.file.name),this.#m()}#f(){if(this.#i=null,this._uiManager.enableWaiting(!1),!!this.#s){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(t=null,e=!0){if(this.hasAltTextData())return null;const{mlManager:n}=this._uiManager;if(!n)throw new Error("No ML.");if(!await n.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:s,width:r,height:a}=t||this.copyCanvas(null,null,!0).imageData,c=await n.guess({name:"altText",request:{data:s,width:r,height:a,channels:s.length/(r*a)}});if(!c)throw new Error("No response from the AI service.");if(c.error)throw new Error("Error from the AI service.");if(c.cancel)return null;if(!c.output)throw new Error("No valid response from the AI service.");const u=c.output;return await this.setGuessedAltText(u),e&&!this.hasAltTextData()&&(this.altTextData={alt:u,decorative:!1}),u}#g(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(n=>this.#h(n,!0)).finally(()=>this.#f());return}if(this.#n){const n=this.#n;this.#n=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromUrl(n).then(s=>this.#h(s)).finally(()=>this.#f());return}if(this.#o){const n=this.#o;this.#o=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromFile(n).then(s=>this.#h(s)).finally(()=>this.#f());return}const t=document.createElement("input");t.type="file",t.accept=Y_.join(",");const e=this._uiManager._signal;this.#i=new Promise(n=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const s=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#h(s)}n()},{signal:e}),t.addEventListener("cancel",()=>{this.remove(),n()},{signal:e})}).finally(()=>this.#f()),t.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#s?.remove(),this.#s=null,this.#c&&(clearTimeout(this.#c),this.#c=null)),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#g();return}super.rebuild(),this.div!==null&&(this.#e&&this.#s===null&&this.#g(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(this.#i||this.#t||this.#n||this.#o||this.#e||this.#a)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,e;return this._isCopy&&(t=this.x,e=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#a||(this.#t?this.#m():this.#g()),this._isCopy&&this._moveAfterPaste(t,e),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,e){const{id:n,bitmap:s}=this._uiManager.imageManager.getFromCanvas(t,e);e.remove(),n&&this._uiManager.imageManager.isValidId(n)&&(this.#e=n,s&&(this.#t=s),this.#a=!1,this.#m())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#c!==null&&clearTimeout(this.#c);const t=200;this.#c=setTimeout(()=>{this.#c=null,this.#p()},t)}#m(){const{div:t}=this;let{width:e,height:n}=this.#t;const[s,r]=this.pageDimensions,a=.75;if(this.width)e=this.width*s,n=this.height*r;else if(e>a*s||n>a*r){const u=Math.min(a*s/e,a*r/n);e*=u,n*=u}this._uiManager.enableWaiting(!1);const c=this.#s=document.createElement("canvas");c.setAttribute("role","img"),this.addContainer(c),this.width=e/s,this.height=n/r,this.setDims(),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),this.#p(),this.#d||(this.parent.addUndoableEditor(this),this.#d=!0),this._reportTelemetry({action:"inserted_image"}),this.#r&&this.div.setAttribute("aria-description",this.#r),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(t,e,n=!1){t||(t=224);const{width:s,height:r}=this.#t,a=new Vs;let c=this.#t,u=s,h=r,f=null;if(e){if(s>e||r>e){const G=Math.min(e/s,e/r);u=Math.floor(s*G),h=Math.floor(r*G)}f=document.createElement("canvas");const y=f.width=Math.ceil(u*a.sx),T=f.height=Math.ceil(h*a.sy);this.#l||(c=this.#u(y,T));const S=f.getContext("2d");S.filter=this._uiManager.hcmFilter;let b="white",C="#cfcfd8";this._uiManager.hcmFilter!=="none"?C="black":a5.isDarkMode&&(b="#8f8f9d",C="#42414d");const I=15,D=I*a.sx,P=I*a.sy,H=new OffscreenCanvas(D*2,P*2),F=H.getContext("2d");F.fillStyle=b,F.fillRect(0,0,D*2,P*2),F.fillStyle=C,F.fillRect(0,0,D,P),F.fillRect(D,P,D,P),S.fillStyle=S.createPattern(H,"repeat"),S.fillRect(0,0,y,T),S.drawImage(c,0,0,c.width,c.height,0,0,y,T)}let m=null;if(n){let y,T;if(a.symmetric&&c.width<t&&c.height<t)y=c.width,T=c.height;else if(c=this.#t,s>t||r>t){const C=Math.min(t/s,t/r);y=Math.floor(s*C),T=Math.floor(r*C),this.#l||(c=this.#u(y,T))}const b=new OffscreenCanvas(y,T).getContext("2d",{willReadFrequently:!0});b.drawImage(c,0,0,c.width,c.height,0,0,y,T),m={width:y,height:T,data:b.getImageData(0,0,y,T).data}}return{canvas:f,width:u,height:h,imageData:m}}#u(t,e){const{width:n,height:s}=this.#t;let r=n,a=s,c=this.#t;for(;r>2*t||a>2*e;){const u=r,h=a;r>2*t&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2)),a>2*e&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));const f=new OffscreenCanvas(r,a);f.getContext("2d").drawImage(c,0,0,u,h,0,0,r,a),c=f.transferToImageBitmap()}return c}#p(){const[t,e]=this.parentDimensions,{width:n,height:s}=this,r=new Vs,a=Math.ceil(n*t*r.sx),c=Math.ceil(s*e*r.sy),u=this.#s;if(!u||u.width===a&&u.height===c)return;u.width=a,u.height=c;const h=this.#l?this.#t:this.#u(a,c),f=u.getContext("2d");f.filter=this._uiManager.hcmFilter,f.drawImage(h,0,0,h.width,h.height,0,0,a,c)}#y(t){if(t){if(this.#l){const s=this._uiManager.imageManager.getSvgUrl(this.#e);if(s)return s}const e=document.createElement("canvas");return{width:e.width,height:e.height}=this.#t,e.getContext("2d").drawImage(this.#t,0,0),e.toDataURL()}if(this.#l){const[e,n]=this.pageDimensions,s=Math.round(this.width*e*Ac.PDF_TO_CSS_UNITS),r=Math.round(this.height*n*Ac.PDF_TO_CSS_UNITS),a=new OffscreenCanvas(s,r);return a.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,s,r),a.transferToImageBitmap()}return structuredClone(this.#t)}static async deserialize(t,e,n){let s=null,r=!1;if(t instanceof yP){const{data:{rect:b,rotation:C,id:I,structParent:D,popupRef:P,richText:H,contentsObj:F,creationDate:G,modificationDate:N},container:x,parent:{page:{pageNumber:k}},canvas:V}=t;let U,$;V?(delete t.canvas,{id:U,bitmap:$}=n.imageManager.getFromCanvas(x.id,V),V.remove()):(r=!0,t._hasNoCanvas=!0);const B=(await e._structTree.getAriaAttributes(`${Jl}${I}`))?.get("aria-label")||"";s=t={annotationType:qt.STAMP,bitmapId:U,bitmap:$,pageIndex:k-1,rect:b.slice(0),rotation:C,annotationElementId:I,id:I,deleted:!1,accessibilityData:{decorative:!1,altText:B},isSvg:!1,structParent:D,popupRef:P,richText:H,comment:F?.str||null,creationDate:G,modificationDate:N}}const a=await super.deserialize(t,e,n),{rect:c,bitmap:u,bitmapUrl:h,bitmapId:f,isSvg:m,accessibilityData:y}=t;r?(n.addMissingCanvas(t.id,a),a.#a=!0):f&&n.imageManager.isValidId(f)?(a.#e=f,u&&(a.#t=u)):a.#n=h,a.#l=m;const[T,S]=a.pageDimensions;return a.width=(c[2]-c[0])/T,a.height=(c[3]-c[1])/S,y&&(a.altTextData=y),a._initialData=s,t.comment&&a.setCommentData(t),a.#d=!!s,a}serialize(t=!1,e=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const n=Object.assign(super.serialize(t),{bitmapId:this.#e,isSvg:this.#l});if(this.addComment(n),t)return n.bitmapUrl=this.#y(!0),n.accessibilityData=this.serializeAltText(!0),n.isCopy=!0,n;const{decorative:s,altText:r}=this.serializeAltText(!1);if(!s&&r&&(n.accessibilityData={type:"Figure",alt:r}),this.annotationElementId){const c=this.#v(n);return c.isSame?null:(c.isSameAltText?delete n.accessibilityData:n.accessibilityData.structParent=this._initialData.structParent??-1,n.id=this.annotationElementId,delete n.bitmapId,n)}if(e===null)return n;e.stamps||=new Map;const a=this.#l?(n.rect[2]-n.rect[0])*(n.rect[3]-n.rect[1]):null;if(!e.stamps.has(this.#e))e.stamps.set(this.#e,{area:a,serialized:n}),n.bitmap=this.#y(!1);else if(this.#l){const c=e.stamps.get(this.#e);a>c.area&&(c.area=a,c.serialized.bitmap.close(),c.serialized.bitmap=this.#y(!1))}return n}#v(t){const{pageIndex:e,accessibilityData:{altText:n}}=this._initialData,s=t.pageIndex===e,r=(t.accessibilityData?.alt||"")===n;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&s&&r,isSameAltText:r}}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}class dr{#t;#e=!1;#i=null;#n=null;#o=null;#r=new Map;#s=!1;#a=!1;#c=!1;#l=null;#d=null;#h=null;#f=null;#g=null;#m=-1;#u;static _initialized=!1;static#p=new Map([yn,bE,F9,We,bs].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:e,div:n,structTreeLayer:s,accessibilityManager:r,annotationLayer:a,drawLayer:c,textLayer:u,viewport:h,l10n:f}){const m=[...dr.#p.values()];if(!dr._initialized){dr._initialized=!0;for(const y of m)y.initialize(f,t)}t.registerEditorTypes(m),this.#u=t,this.pageIndex=e,this.div=n,this.#t=r,this.#i=a,this.viewport=h,this.#h=u,this.drawLayer=c,this._structTree=s,this.#u.addLayer(this)}get isEmpty(){return this.#r.size===0}get isInvisible(){return this.isEmpty&&this.#u.getMode()===qt.NONE}updateToolbar(t){this.#u.updateToolbar(t)}updateMode(t=this.#u.getMode()){switch(this.#T(),t){case qt.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case qt.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case qt.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;if(e.toggle("nonEditing",!1),t===qt.POPUP)e.toggle("commentEditing",!0);else{e.toggle("commentEditing",!1);for(const n of dr.#p.values())e.toggle(`${n._type}Editing`,t===n._editorType)}this.div.hidden=!1}hasTextLayer(t){return t===this.#h?.div}setEditingState(t){this.#u.setEditingState(t)}addCommands(t){this.#u.addCommands(t)}cleanUndoStack(t){this.#u.cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#i?.togglePointerEvents(t)}get#y(){return this.#r.size!==0?this.#r.values():this.#u.getEditors(this.pageIndex)}async enable(){this.#c=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),this.#g?.abort(),this.#g=null;const t=new Set;for(const n of this.#y)n.enableEditing(),n.show(!0),n.annotationElementId&&(this.#u.removeChangedExistingAnnotation(n),t.add(n.annotationElementId));const e=this.#i;if(e)for(const n of e.getEditableAnnotations()){if(n.hide(),this.#u.isDeletedAnnotationElement(n.data.id)||t.has(n.data.id))continue;const s=await this.deserialize(n);s&&(this.addOrRebuild(s),s.enableEditing())}this.#c=!1,this.#u._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){if(this.#a=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),this.#h&&!this.#g){this.#g=new AbortController;const s=this.#u.combinedSignal(this.#g);this.#h.div.addEventListener("pointerdown",r=>{const{clientX:c,clientY:u,timeStamp:h}=r,f=this.#m;if(h-f>500){this.#m=h;return}this.#m=-1;const{classList:m}=this.div;m.toggle("getElements",!0);const y=document.elementsFromPoint(c,u);if(m.toggle("getElements",!1),!this.div.contains(y[0]))return;let T;const S=new RegExp(`^${Ah}[0-9]+$`);for(const C of y)if(S.test(C.id)){T=C.id;break}if(!T)return;const b=this.#r.get(T);b?.annotationElementId===null&&(r.stopPropagation(),r.preventDefault(),b.dblclick(r))},{signal:s,capture:!0})}const t=this.#i,e=[];if(t){const s=new Map,r=new Map;for(const c of this.#y){if(c.disableEditing(),!c.annotationElementId){e.push(c);continue}if(c.serialize()!==null){s.set(c.annotationElementId,c);continue}else r.set(c.annotationElementId,c);this.getEditableAnnotation(c.annotationElementId)?.show(),c.remove()}const a=t.getEditableAnnotations();for(const c of a){const{id:u}=c.data;if(this.#u.isDeletedAnnotationElement(u)){c.updateEdited({deleted:!0});continue}let h=r.get(u);if(h){h.resetAnnotationElement(c),h.show(!1),c.show();continue}h=s.get(u),h&&(this.#u.addChangedExistingAnnotation(h),h.renderAnnotationElement(c)&&h.show(!1)),c.show()}}this.#T(),this.isEmpty&&(this.div.hidden=!0);const{classList:n}=this.div;for(const s of dr.#p.values())n.remove(`${s._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),t?.updateFakeAnnotations(e),this.#a=!1}getEditableAnnotation(t){return this.#i?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#u.getActive()!==t&&this.#u.setActiveEditor(t)}enableTextSelection(){if(this.div.tabIndex=-1,this.#h?.div&&!this.#f){this.#f=new AbortController;const t=this.#u.combinedSignal(this.#f);this.#h.div.addEventListener("pointerdown",this.#v.bind(this),{signal:t}),this.#h.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#h?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#h.div.classList.remove("highlighting"))}#v(t){this.#u.unselectAll();const{target:e}=t;if(e===this.#h.div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&this.#h.div.contains(e)){const{isMac:n}=Pn.platform;if(t.button!==0||t.ctrlKey&&n)return;this.#u.showAllEditors("highlight",!0,!0),this.#h.div.classList.add("free"),this.toggleDrawing(),We.startHighlighting(this,this.#u.direction==="ltr",{target:this.#h.div,x:t.x,y:t.y}),this.#h.div.addEventListener("pointerup",()=>{this.#h.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#u._signal}),t.preventDefault()}}enableClick(){if(this.#n)return;this.#n=new AbortController;const t=this.#u.combinedSignal(this.#n);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){this.#n?.abort(),this.#n=null}attach(t){this.#r.set(t.id,t);const{annotationElementId:e}=t;e&&this.#u.isDeletedAnnotationElement(e)&&this.#u.removeDeletedAnnotationElement(t)}detach(t){this.#r.delete(t.id),this.#t?.removePointerInTextLayer(t.contentDiv),!this.#a&&t.annotationElementId&&this.#u.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#u.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#u.addDeletedAnnotationElement(t),Rt.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),this.#u.addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!this.#c),this.#u.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!this.#o&&(t._focusEventsAllowed=!1,this.#o=setTimeout(()=>{this.#o=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this.#u._signal}),e.focus())},0)),t._structTreeParentId=this.#t?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),n=()=>{t.remove()};this.addCommands({cmd:e,undo:n,mustExec:!1})}getEditorByUID(t){for(const e of this.#r.values())if(e.uid===t)return e;return null}getNextId(){return this.#u.getId()}get#_(){return dr.#p.get(this.#u.getMode())}combinedSignal(t){return this.#u.combinedSignal(t)}#b(t){const e=this.#_;return e?new e.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#_?.canCreateNewEmptyEditor()}async pasteEditor(t,e){this.updateToolbar(t),await this.#u.updateMode(t.mode);const{offsetX:n,offsetY:s}=this.#S(),r=this.getNextId(),a=this.#b({parent:this,id:r,x:n,y:s,uiManager:this.#u,isCentered:!0,...e});a&&this.add(a)}async deserialize(t){return await dr.#p.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#u)||null}createAndAddNewEditor(t,e,n={}){const s=this.getNextId(),r=this.#b({parent:this,id:s,x:t.offsetX,y:t.offsetY,uiManager:this.#u,isCentered:e,...n});return r&&this.add(r),r}get boundingClientRect(){return this.div.getBoundingClientRect()}#S(){const{x:t,y:e,width:n,height:s}=this.boundingClientRect,r=Math.max(0,t),a=Math.max(0,e),c=Math.min(window.innerWidth,t+n),u=Math.min(window.innerHeight,e+s),h=(r+c)/2-t,f=(a+u)/2-e,[m,y]=this.viewport.rotation%180===0?[h,f]:[f,h];return{offsetX:m,offsetY:y}}addNewEditor(t={}){this.createAndAddNewEditor(this.#S(),!0,t)}setSelected(t){this.#u.setSelected(t)}toggleSelected(t){this.#u.toggleSelected(t)}unselect(t){this.#u.unselect(t)}pointerup(t){const{isMac:e}=Pn.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div||!this.#s||(this.#s=!1,this.#_?.isDrawer&&this.#_.supportMultipleDrawings))return;if(!this.#e){this.#e=!0;return}const n=this.#u.getMode();if(n===qt.STAMP||n===qt.SIGNATURE){this.#u.unselectAll();return}this.createAndAddNewEditor(t,!1)}pointerdown(t){if(this.#u.getMode()===qt.HIGHLIGHT&&this.enableTextSelection(),this.#s){this.#s=!1;return}const{isMac:e}=Pn.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(this.#s=!0,this.#_?.isDrawer){this.startDrawingSession(t);return}const n=this.#u.getActive();this.#e=!n||n.isEmpty()}startDrawingSession(t){if(this.div.focus({preventScroll:!0}),this.#l){this.#_.startDrawing(this,this.#u,!1,t);return}this.#u.setCurrentDrawingSession(this),this.#l=new AbortController;const e=this.#u.combinedSignal(this.#l);this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(this.#d=null,this.commitOrRemove())},{signal:e}),this.#_.startDrawing(this,this.#u,!1,t)}pause(t){if(t){const{activeElement:e}=document;this.div.contains(e)&&(this.#d=e);return}this.#d&&setTimeout(()=>{this.#d?.focus(),this.#d=null},0)}endDrawingSession(t=!1){return this.#l?(this.#u.setCurrentDrawingSession(null),this.#l.abort(),this.#l=null,this.#d=null,this.#_.endDrawing(t)):null}findNewParent(t,e,n){const s=this.#u.findParent(e,n);return s===null||s===this?!1:(s.changeParent(t),!0)}commitOrRemove(){return this.#l?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#l&&this.#_.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#u.getActive()?.parent===this&&(this.#u.commitOrRemove(),this.#u.setActiveEditor(null)),this.#o&&(clearTimeout(this.#o),this.#o=null);for(const t of this.#r.values())this.#t?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#r.clear(),this.#u.removeLayer(this)}#T(){for(const t of this.#r.values())t.isEmpty()&&t.remove()}render({viewport:t}){this.viewport=t,Ua(this.div,t);for(const e of this.#u.getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){this.#u.commitOrRemove(),this.#T();const e=this.viewport.rotation,n=t.rotation;if(this.viewport=t,Ua(this.div,{rotation:n}),e!==n)for(const s of this.#r.values())s.rotate(n)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return this.#u.viewParameters.realScale}}class Cn{#t=null;#e=new Map;#i=new Map;static#n=0;constructor({pageIndex:t}){this.pageIndex=t}setParent(t){if(!this.#t){this.#t=t;return}if(this.#t!==t){if(this.#e.size>0)for(const e of this.#e.values())e.remove(),t.append(e);this.#t=t}}static get _svgFactory(){return Ht(this,"_svgFactory",new Np)}static#o(t,[e,n,s,r]){const{style:a}=t;a.top=`${100*n}%`,a.left=`${100*e}%`,a.width=`${100*s}%`,a.height=`${100*r}%`}#r(){const t=Cn._svgFactory.create(1,1,!0);return this.#t.append(t),t.setAttribute("aria-hidden",!0),t}#s(t,e){const n=Cn._svgFactory.createElement("clipPath");t.append(n);const s=`clip_${e}`;n.setAttribute("id",s),n.setAttribute("clipPathUnits","objectBoundingBox");const r=Cn._svgFactory.createElement("use");return n.append(r),r.setAttribute("href",`#${e}`),r.classList.add("clip"),s}#a(t,e){for(const[n,s]of Object.entries(e))s===null?t.removeAttribute(n):t.setAttribute(n,s)}draw(t,e=!1,n=!1){const s=Cn.#n++,r=this.#r(),a=Cn._svgFactory.createElement("defs");r.append(a);const c=Cn._svgFactory.createElement("path");a.append(c);const u=`path_p${this.pageIndex}_${s}`;c.setAttribute("id",u),c.setAttribute("vector-effect","non-scaling-stroke"),e&&this.#i.set(s,c);const h=n?this.#s(a,u):null,f=Cn._svgFactory.createElement("use");return r.append(f),f.setAttribute("href",`#${u}`),this.updateProperties(r,t),this.#e.set(s,r),{id:s,clipPathId:`url(#${h})`}}drawOutline(t,e){const n=Cn.#n++,s=this.#r(),r=Cn._svgFactory.createElement("defs");s.append(r);const a=Cn._svgFactory.createElement("path");r.append(a);const c=`path_p${this.pageIndex}_${n}`;a.setAttribute("id",c),a.setAttribute("vector-effect","non-scaling-stroke");let u;if(e){const m=Cn._svgFactory.createElement("mask");r.append(m),u=`mask_p${this.pageIndex}_${n}`,m.setAttribute("id",u),m.setAttribute("maskUnits","objectBoundingBox");const y=Cn._svgFactory.createElement("rect");m.append(y),y.setAttribute("width","1"),y.setAttribute("height","1"),y.setAttribute("fill","white");const T=Cn._svgFactory.createElement("use");m.append(T),T.setAttribute("href",`#${c}`),T.setAttribute("stroke","none"),T.setAttribute("fill","black"),T.setAttribute("fill-rule","nonzero"),T.classList.add("mask")}const h=Cn._svgFactory.createElement("use");s.append(h),h.setAttribute("href",`#${c}`),u&&h.setAttribute("mask",`url(#${u})`);const f=h.cloneNode();return s.append(f),h.classList.add("mainOutline"),f.classList.add("secondaryOutline"),this.updateProperties(s,t),this.#e.set(n,s),n}finalizeDraw(t,e){this.#i.delete(t),this.updateProperties(t,e)}updateProperties(t,e){if(!e)return;const{root:n,bbox:s,rootClass:r,path:a}=e,c=typeof t=="number"?this.#e.get(t):t;if(c){if(n&&this.#a(c,n),s&&Cn.#o(c,s),r){const{classList:u}=c;for(const[h,f]of Object.entries(r))u.toggle(h,f)}if(a){const h=c.firstElementChild.firstElementChild;this.#a(h,a)}}}updateParent(t,e){if(e===this)return;const n=this.#e.get(t);n&&(e.#t.append(n),this.#e.delete(t),e.#e.set(t,n))}remove(t){this.#i.delete(t),this.#t!==null&&(this.#e.get(t).remove(),this.#e.delete(t))}destroy(){this.#t=null;for(const t of this.#e.values())t.remove();this.#e.clear(),this.#i.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:Z_};globalThis.pdfjsLib={AbortException:Do,AnnotationEditorLayer:dr,AnnotationEditorParamsType:te,AnnotationEditorType:qt,AnnotationEditorUIManager:No,AnnotationLayer:wE,AnnotationMode:yo,AnnotationType:Ze,applyOpacity:c5,build:g9,ColorPicker:Li,createValidAbsoluteUrl:FM,CSSConstants:l5,DOMSVGFactory:Np,DrawLayer:Cn,FeatureTest:Pn,fetchData:qh,findContrastColor:u5,getDocument:cP,getFilenameFromUrl:n5,getPdfFilenameFromUrl:i5,getRGB:$h,getUuid:qM,getXfaPageViewport:r5,GlobalWorkerOptions:uc,ImageKind:Qf,InvalidPDFException:z_,isDataScheme:mm,isPdfFile:pE,isValidExplicitDest:E5,MathClamp:Xn,noContextMenu:Fi,normalizeUnicode:Zz,OPS:Sh,OutputScale:Vs,PasswordResponses:zz,PDFDataRangeTransport:uP,PDFDateString:$_,PDFWorker:bh,PermissionFlag:qz,PixelsPerInch:Ac,RenderingCancelledException:fE,renderRichText:YM,ResponseException:xp,setLayerDimensions:Ua,shadow:Ht,SignatureExtractor:Yl,stopEvent:Ue,SupportedImageMimeTypes:Y_,TextLayer:Wn,TouchManager:gm,updateUrlHash:HM,Util:Tt,VerbosityLevel:dm,version:m9,XfaLayer:$M};const H9="/Notify/assets/pdf.worker-CSHkrWs3.mjs";uc.workerSrc=H9;async function G9(i){const t=await cP(i).promise;let e="";for(let n=1;n<=t.numPages;n++){const r=await(await t.getPage(n)).getTextContent();e+=r.items.map(a=>a.str).join(" ")+`
`}return e.toLowerCase().replace(/\s+/g," ").replace(/[^\w\s]/g,"").trim()}const q9=new Gz({apiKey:"AIzaSyCB3ghPlVpgP3Nl-eKZrS1IvJd2HCeqn1Q"});async function z9(i,t,e){const n=await $9(i,t,e);let s="";return n.split(`
`).forEach(a=>{a=a.trim(),a&&(a.startsWith("- ")?s+=`<ul><li>${a.slice(2).replace(/\*\*(.*?)\*\*/g,"<b>$1</b>")}</li></ul>`:s+=`<p>${a.replace(/\*\*(.*?)\*\*/g,"<b>$1</b>")}</p>`)}),s}async function $9(i,t,e){const n=`
  You are an AI assistant tasked with merging multiple text documents into a single master document. 

  Your goal:
  1. Include **all unique information** from all documents.
  2. Avoid **any duplicates**, even if the same idea is phrased differently.
  3. Maintain the **original factual details** as much as possible.
  4. Organize the merged content **logically** (group related content together, keep paragraphs intact).

  Instructions:
  - Compare each new paragraph or sentence with the existing master content.
  - Only add information that is **not already present**.
  - Preserve key numbers, names, dates, or other important details exactly as they appear.
  - If multiple phrasings of the same fact exist, choose **the clearest one** or merge them into one sentence.
  - Output the final master document as text only.
  - ${t?"Use headers and bullet points only.":"Use headers and paragraphs only. No bullet points."}
  - ${e?"Correct grammar.":"Do not correct grammar. Keep it as original as possible grammatically"}
  - The first part of your response should be a short one-paragraph maximum broad overview of all the content.
  - Ignore empty documents.
  - Format using line skips "
", bold using enclosing double astericks "**bolded text**", and bullet points using "- "
  `;let s="";const r=Object.keys(i).map(c=>G9(i[c].fileUrl)),a=await Promise.all(r);for(const c of a){const u=n+`
    Document 1 text: ${s}

    Document 2 text: ${c}
    `;s=(await q9.models.generateContent({model:"gemini-2.5-flash",contents:u})).text}return s}function QC(i){return Fs({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M11.75 4.5a.75.75 0 0 1 .75.75V11h5.75a.75.75 0 0 1 0 1.5H12.5v5.75a.75.75 0 0 1-1.5 0V12.5H5.25a.75.75 0 0 1 0-1.5H11V5.25a.75.75 0 0 1 .75-.75Z"},child:[]}]})(i)}function jC(i){return Fs({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"},child:[]}]})(i)}function Y9(i){return Fs({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"},child:[]}]})(i)}function W9(i){return Fs({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},child:[]}]})(i)}function K9(i){return Fs({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M120,216a8,8,0,0,1-8,8H48a8,8,0,0,1-8-8V40a8,8,0,0,1,8-8h64a8,8,0,0,1,0,16H56V208h56A8,8,0,0,1,120,216Zm109.66-93.66-40-40a8,8,0,0,0-11.32,11.32L204.69,120H112a8,8,0,0,0,0,16h92.69l-26.35,26.34a8,8,0,0,0,11.32,11.32l40-40A8,8,0,0,0,229.66,122.34Z"},child:[]}]})(i)}function X9(i){return Fs({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M362.6 192.9L345 174.8c-.7-.8-1.8-1.2-2.8-1.2-1.1 0-2.1.4-2.8 1.2l-122 122.9-44.4-44.4c-.8-.8-1.8-1.2-2.8-1.2-1 0-2 .4-2.8 1.2l-17.8 17.8c-1.6 1.6-1.6 4.1 0 5.7l56 56c3.6 3.6 8 5.7 11.7 5.7 5.3 0 9.9-3.9 11.6-5.5h.1l133.7-134.4c1.4-1.7 1.4-4.2-.1-5.7z"},child:[]},{tag:"path",attr:{d:"M256 76c48.1 0 93.3 18.7 127.3 52.7S436 207.9 436 256s-18.7 93.3-52.7 127.3S304.1 436 256 436c-48.1 0-93.3-18.7-127.3-52.7S76 304.1 76 256s18.7-93.3 52.7-127.3S207.9 76 256 76m0-28C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48z"},child:[]}]})(i)}function J9(i){return Fs({attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M8.6 1c1.6.1 3.1.9 4.2 2 1.3 1.4 2 3.1 2 5.1 0 1.6-.6 3.1-1.6 4.4-1 1.2-2.4 2.1-4 2.4-1.6.3-3.2.1-4.6-.7-1.4-.8-2.5-2-3.1-3.5C.9 9.2.8 7.5 1.3 6c.5-1.6 1.4-2.9 2.8-3.8C5.4 1.3 7 .9 8.6 1zm.5 12.9c1.3-.3 2.5-1 3.4-2.1.8-1.1 1.3-2.4 1.2-3.8 0-1.6-.6-3.2-1.7-4.3-1-1-2.2-1.6-3.6-1.7-1.3-.1-2.7.2-3.8 1-1.1.8-1.9 1.9-2.3 3.3-.4 1.3-.4 2.7.2 4 .6 1.3 1.5 2.3 2.7 3 1.2.7 2.6.9 3.9.6zM7.9 7.5L10.3 5l.7.7-2.4 2.5 2.4 2.5-.7.7-2.4-2.5-2.4 2.5-.7-.7 2.4-2.5-2.4-2.5.7-.7 2.4 2.5z"},child:[]}]})(i)}const Q9={success:st.jsx(X9,{className:"toasticon"}),error:st.jsx(J9,{className:"toasticon"}),neutral:st.jsx(Y9,{className:"toasticon"})},j9=({style:i,type:t="neutral",message:e,onClose:n})=>{const s=Q9[t]||null;return st.jsxs("div",{className:`toastdiv ${t}`,style:i,children:[s,st.jsx("p",{children:e}),st.jsx(W9,{className:"toasticon",style:{cursor:"pointer"},onClick:n})]})},Z9=et.forwardRef((i,t)=>{const[e,n]=et.useState([]),s=(a,c)=>{const u=Date.now();n(h=>[...h,{id:u,type:a,message:c}]),setTimeout(()=>{r(u)},3e3)},r=a=>{n(c=>c.filter(u=>u.id!==a))};return et.useImperativeHandle(t,()=>({addToast:s,removeToast:r})),st.jsx("div",{className:`toastContainer ${i.position}`,children:e.map((a,c)=>st.jsx(j9,{style:{transform:`translateY(${c*10}%)`},type:a.type,message:a.message,onClose:()=>r(a.id)},a.id))})});function t8(){const i=Op(),t=et.useRef(null),[e,n]=et.useState(null),[s,r]=et.useState("join"),[a,c]=et.useState("none"),[u,h]=et.useState([]),[f,m]=et.useState({}),[y,T]=et.useState({}),[S,b]=et.useState("Pinned Doc"),[C,I]=et.useState(""),[D,P]=et.useState(""),[H,F]=et.useState({}),[G,N]=et.useState(!0),[x,k]=et.useState(""),[V,U]=et.useState({});et.useEffect(()=>{let ct=!0;const mt=A2(Ec,async wt=>{if(ct)if(wt){const se=await CF();if(!se){i("/login");return}n(se)}else{n(null),i("/login");return}});return()=>{ct=!1,mt()}},[]),et.useEffect(()=>{if(!e)return;const ct=$e(Ye,"users",e.uid),mt=xw(ct,wt=>{if(wt.exists()){const se=wt.data();n(se),h(se.classes)}});return()=>mt()},[e?.uid]),et.useEffect(()=>{if(!f?.classCode)return;const ct=$e(Ye,"classes",f.classCode),mt=xw(ct,wt=>{if(wt.exists()){const se=wt.data();m(se)}});return()=>mt()},[f?.classCode]),et.useEffect(()=>{if(y?.topicName&&f?.topics&&y?.topicName in f.topics){T(f.topics[y.topicName]);return}$(),B()},[f]),et.useEffect(()=>{if(u&&u.length>0){if(u.some(ct=>ct.classCode==f?.classCode))return;z(u[0].className,u[0].classCode)}else m({}),T({})},[u]),et.useEffect(()=>{$()},[f?.classCode]);function $(){if(f&&f.topics){const ct=Object.keys(f.topics);if(ct.length>0){T(f.topics[ct[0]]);return}}T({})}async function B(){if(!f?.members){F([]);return}const ct=await Promise.all(f.members.map(async mt=>{const wt=await Gl($e(Ye,"users",mt));return wt.exists()?wt.data():null}));F(ct.filter(Boolean))}const vt="QWERTYUIOPASDFGHJKLZXCVBNM1234567890",It=6;async function W(){let ct,mt;do{ct="";for(let se=0;se<It;se++)ct+=vt[Math.floor(Math.random()*vt.length)];mt=(await Gl($e(Ye,"classes",ct))).exists()}while(mt);return ct}async function nt(ct,mt){await pi($e(Ye,"users",e.uid),{classes:By({className:ct,classCode:mt})})}async function ft(){let ct;try{const mt=C;ct=await W(),await F1($e(Ye,"classes",ct),{className:mt,classCode:ct,members:[e.uid]}),await pi($e(Ye,"users",e.uid),{classes:Vy({className:mt,classCode:ct})}),t.current.addToast("success","Class created successfully."),c("none"),z(mt,ct)}catch(mt){if(console.error("Caught error when creating new class:",mt),t.current.addToast("error","Class created unsuccessfully."),ct)try{await WB($e(Ye,"classes",ct)),await nt(C,ct)}catch(wt){console.error("Caught error during creating new class cleanup:",wt);return}}}async function xt(){const ct=C;if(!ct)return;const mt=$e(Ye,"classes",ct),wt=await Gl(mt);if(!wt.exists())console.error("Failed joining class | Class does not exist:",ct),t.current.addToast("error","Class does not exist.");else{const se=wt.data();try{await pi(mt,{members:Vy(e.uid)}),await pi($e(Ye,"users",e.uid),{classes:Vy({className:se.className,classCode:ct})}),t.current.addToast("success","Successfully joined class."),c("none")}catch(Ve){console.error("Caught error when adding user to class or when updating user's classes list:",Ve);try{await pi(mt,{members:By(e.uid)}),await nt(se.className,ct)}catch(Ka){console.error("Caught error when removing user from class or removing class from user after joining error:",Ka)}}}}async function z(ct,mt){const wt=await Gl($e(Ye,"classes",mt));if(!wt.exists()){t.current.addToast("error","Class no longer exists."),await nt(ct,mt);return}const se=wt.data();if(!se.members.includes(e.uid)){t.current.addToast("error","You are no longer a member of this class."),await nt(se.className,se.classCode);return}m(se)}async function ot(){if(!f)return;const ct=D;if(f.topics?.newTopicName){t.current.addToast("error","A topic with this name already exists.");return}try{const mt={topicName:ct};await pi($e(Ye,"classes",f.classCode),{[`topics.${ct}`]:mt}),t.current.addToast("success","Topic created successfully."),c("none"),T(mt)}catch(mt){console.error("Caught error while trying to create new topic:",mt);return}}async function dt(ct){if(!f||!y?.topicName||!e)return;const mt=ct.target.files[0];if(ct.target.value=null,!mt){t.current.addToast("error","File does not exist.");return}if(mt.type!=="application/pdf"){t.current.addToast("error","You can only upload a single PDF.");return}try{const wt=Tc.unique();await Hu.createFile({bucketId:Gu,fileId:wt,file:mt});const se=Hu.getFileDownload({bucketId:Gu,fileId:wt}),Ve=y?.pinnedDoc?.fileId;await pi($e(Ye,"classes",f.classCode),{[`topics.${y.topicName}.pinnedDoc`]:{pinnedBy:e.username,pinnedDate:Date.now(),fileId:wt,fileUrl:se,fleName:mt.name}}),t.current.addToast("success","Successfully pinned file."),Ve&&Wt(Ve)}catch(wt){console.error("Caught error while pinning uploaded file:",wt),t.current.addToast("error","Something went wrong while uploading file.");return}}async function ht(){if(!(!f||!y?.topicName||!e))try{const ct=V[f?.className]?.[y?.topicName]||"";if(ct=="")throw new Error("No compiled document to be pinned.");const mt=y?.pinnedDoc?.fileId;await pi($e(Ye,"classes",f.classCode),{[`topics.${y.topicName}.pinnedDoc`]:{pinnedBy:e.username,pinnedDate:Date.now(),innerHTML:ct}}),t.current.addToast("success","Successfully pinned compiled document."),mt&&Wt(mt)}catch(ct){console.error("Caught error while pinning uploaded file:",ct),t.current.addToast("error",ct);return}}async function _t(ct){try{return(await fetch(ct,{method:"HEAD"})).ok}catch(mt){return console.error("Invalid url:",mt),!1}}async function Ot(ct){const mt=await _t(ct);return mt||await pi($e(Ye,"classes",f.classCode),{[`topics.${y.topicName}.pinnedDoc`]:{}}),mt}async function St(ct){const mt=await _t(ct.fileUrl);return mt||await Xe(ct),mt}async function $t(ct){for(const mt of ct.target.files)try{const wt=Tc.unique();await Hu.createFile({bucketId:Gu,fileId:wt,file:mt});const se=Hu.getFileDownload({bucketId:Gu,fileId:wt});await pi($e(Ye,"classes",f.classCode),{[`topics.${y.topicName}.collection.${wt}`]:{uploadedBy:e.username,uploadedDate:Date.now(),fileId:wt,fileUrl:se,fileName:mt.name,noCompile:!1}}),t.current.addToast("success","Successfully added file to collection.")}catch(wt){console.error("Caught error while pinning uploaded file:",wt),t.current.addToast("error","Something went wrong while uploading file.");return}ct.target.value=null}async function Wt(ct){try{await Hu.deleteFile({bucketId:Gu,fileId:ct}),t.current.addToast("success","File deleted from storage.")}catch(mt){t.current.addToast("error","Something went wrong."),console.error("Caught error while deleting file from storage:",mt)}}async function Xe(ct){try{await pi($e(Ye,"classes",f.classCode),{[`topics.${y.topicName}.collection.${ct.fileId}`]:KB()}),Wt(ct.fileId),t.current.addToast("success","File deleted from DB.")}catch(mt){t.current.addToast("error","Something went wrong."),console.error("Caught error while deleting file from collection:",mt)}}async function qs(ct,mt){try{await pi($e(Ye,"classes",f.classCode),{[`topics.${y.topicName}.collection.${mt}.noCompile`]:!ct.target.checked})}catch(wt){console.error("Caught error while pinning uploaded file:",wt),t.current.addToast("error","Something went wrong.");return}}async function vi(){const ct=f?.classCode;if(!ct)return;const mt=$e(Ye,"classes",ct),wt=await Gl(mt);if(!wt.exists())console.error("Failed leaving class | Class does not exist:",ct),t.current.addToast("error","Class does not exist.");else{const se=wt.data();try{await nt(se.className,ct),await pi(mt,{members:By(e.uid)}),t.current.addToast("success","Successfully left class.")}catch(Ve){console.error("Caught error when removing class from user or when updating class' members list:",Ve)}}}async function Ei(){if(!f||!y?.collection)return;const ct=f.className,mt=y.topicName;let wt={...V};ct in wt||(wt[ct]={}),wt[ct][mt]=await z9(y.collection,x,G),U(wt)}return st.jsxs("div",{className:"page",children:[st.jsx(Z9,{position:"bottom",ref:t}),a=="classOverlay"&&st.jsxs(st.Fragment,{children:[st.jsxs("div",{id:"classOverlay",className:"overlay",children:[st.jsxs("div",{className:"container",children:[st.jsx("button",{className:"joinOrCreate",style:{fontWeight:s=="join"?"bold":"normal"},onClick:()=>r("join"),children:"Join"}),st.jsx("button",{className:"joinOrCreate",style:{fontWeight:s=="create"?"bold":"normal"},onClick:()=>r("create"),children:"Create"})]}),st.jsx("input",{placeholder:s=="join"?"Enter class code":"Enter class name",value:C,onChange:ct=>I(ct.target.value)}),st.jsx("button",{className:"special",onClick:s=="join"?xt:ft,children:s=="join"?"Join":"Create"})]}),st.jsx("div",{className:"overlayBackground",onClick:()=>c("none")})]}),a=="topicOverlay"&&st.jsxs(st.Fragment,{children:[st.jsxs("div",{id:"topicOverlay",className:"overlay",children:[st.jsx("p",{id:"topicOverlayLabel",children:"Create topic"}),st.jsx("input",{placeholder:"Enter topic name",value:D,onChange:ct=>P(ct.target.value)}),st.jsx("button",{className:"special",onClick:ot,children:"Create"})]}),st.jsx("div",{className:"overlayBackground",onClick:()=>c("none")})]}),st.jsxs("div",{id:"panelsContainer",children:[st.jsx("p",{id:"title",children:"otify"}),st.jsxs("div",{id:"classPanel",className:"sidePanel",children:[st.jsxs("div",{className:"labelIconContainer",children:[st.jsx("p",{className:"directoryLabel",children:"Classes"}),st.jsx(QC,{className:"goPlusIcon",onClick:()=>c("classOverlay")})]}),st.jsx("div",{className:"directoryScroll",children:u&&u.length>0&&u.map((ct,mt)=>st.jsx("button",{onClick:()=>z(ct.className,ct.classCode),style:{fontWeight:`${f.classCode==ct.classCode?"bold":"normal"}`},children:ct.className},mt))})]}),st.jsxs("div",{id:"topicPanel",className:"sidePanel",children:[st.jsxs("div",{className:"labelIconContainer",children:[st.jsx("p",{className:"directoryLabel",children:"Topics"}),st.jsx(QC,{className:"goPlusIcon",onClick:()=>c("topicOverlay")})]}),st.jsx("div",{className:"directoryScroll",children:f.topics&&Object.keys(f.topics).map((ct,mt)=>{const wt=f.topics[ct];return st.jsx("button",{onClick:()=>T(wt),style:{fontWeight:`${y?.topicName==wt.topicName?"bold":"normal"}`},children:wt.topicName},mt)})})]})]}),st.jsxs("div",{id:"rightContainer",children:[st.jsxs("div",{id:"directoryPanel",children:[st.jsx("p",{id:"classDirectory",children:f.className}),st.jsx("p",{id:"topicDirectory",children:y?.topicName}),st.jsx("p",{id:"tabDirectory",children:S}),st.jsx(K9,{id:"signOut",onClick:IF})]}),st.jsxs("div",{id:"tabdiv",children:[st.jsxs("div",{id:"tabBoxes",children:[st.jsxs("div",{id:"tabButtons",children:[st.jsx("button",{className:"tabButton",onClick:()=>b("Pinned Doc"),style:{fontWeight:`${S=="Pinned Doc"?"bold":"normal"}`},children:"Pinned Doc"}),st.jsx("button",{className:"tabButton",onClick:()=>b("Compiled Doc"),style:{fontWeight:`${S=="Compiled Doc"?"bold":"normal"}`},children:"Compiled Doc"}),st.jsx("button",{className:"tabButton",onClick:()=>b("Collection"),style:{fontWeight:`${S=="Collection"?"bold":"normal"}`},children:"Collection"}),st.jsx("button",{className:"tabButton",onClick:()=>b("Members"),style:{fontWeight:`${S=="Members"?"bold":"normal"}`},children:"Members"}),st.jsx("button",{className:"tabButton",onClick:()=>b("Class Settings"),style:{fontWeight:`${S=="Class Settings"?"bold":"normal"}`},children:"Class Settings"})]}),S=="Pinned Doc"&&st.jsxs("div",{className:"tabBox custom pinnedDoc",children:[st.jsxs("p",{children:["Pinned by: ",y?.pinnedDoc?.pinnedBy]}),st.jsxs("p",{children:["Pinned date: ",y?.pinnedDoc?.pinnedDate]}),st.jsxs("label",{children:["Pin new",st.jsx("input",{type:"file",accept:"application/pdf",style:{display:"none"},onChange:dt})]}),st.jsx("button",{onClick:ht,children:"Pin compiled"})]}),S=="Compiled Doc"&&st.jsxs("div",{className:"tabBox custom compiledDoc",children:[st.jsx("p",{children:"Compiled by: "}),st.jsx("p",{children:"Compiled date: "}),st.jsxs("label",{children:[st.jsx("input",{type:"checkbox",checked:G,onChange:ct=>N(ct.target.checked)}),"Grammar check"]}),st.jsxs("label",{children:[st.jsx("input",{type:"checkbox",checked:x,onChange:ct=>k(ct.target.checked)}),"Bullet format"]}),st.jsx("button",{onClick:Ei,children:"Compile"})]})]}),S=="Pinned Doc"&&st.jsx("div",{className:"tab",children:y?.pinnedDoc?.fileUrl&&Ot(y.pinnedDoc.fileUrl)?st.jsx("iframe",{src:y.pinnedDoc.fileUrl.replace("/download","/view")}):y?.pinnedDoc?.innerHTML?st.jsx("div",{id:"compiledDocTab",dangerouslySetInnerHTML:{__html:y.pinnedDoc.innerHTML}}):null}),S=="Collection"&&st.jsxs("div",{className:"tab",children:[st.jsx("div",{id:"fileDropBox",children:st.jsx("input",{type:"file",accept:"application/pdf",onChange:$t,multiple:!0})}),st.jsx("div",{className:"listScroll",children:y?.collection&&Object.keys(y.collection).map((ct,mt)=>{const wt=y.collection[ct];if(St(wt))return st.jsxs("div",{className:"listItem",children:[st.jsx("p",{children:mt+1}),st.jsx("a",{href:wt.fileUrl.replace("/download","/view"),target:"_blank",children:wt.fileName||"Document link"}),st.jsx("p",{children:wt.uploadedBy}),st.jsx("p",{children:wt.uploadedDate}),st.jsxs("label",{children:[st.jsx("input",{type:"checkbox",id:"subscribe",name:"subscribe",checked:!wt.noCompile,onChange:se=>qs(se,wt.fileId)}),"Compile"]}),st.jsx(jC,{className:"deleteIcon",onClick:()=>Xe(wt)})]},ct)})})]}),S=="Members"&&st.jsxs("div",{className:"tab",children:[st.jsx("div",{id:"membersButtons",children:st.jsx("button",{id:"leaveButton",onClick:vi,children:"Leave class"})}),st.jsx("div",{className:"listScroll",children:H.map((ct,mt)=>st.jsxs("div",{className:"listItem",children:[st.jsx("p",{children:mt+1}),st.jsx("p",{children:ct.username}),st.jsx("p",{children:ct.email}),st.jsx(jC,{className:"deleteIcon"})]},mt))})]}),S=="Compiled Doc"&&st.jsx("div",{className:"tab",id:"compiledDocTab",dangerouslySetInnerHTML:{__html:V[f?.className]?.[y?.topicName]||""}})]})]})]})}function e8(){return st.jsx(yN,{children:st.jsxs(KD,{children:[st.jsx(Of,{path:"/",element:st.jsx(YD,{to:"/login",replace:!0})}),st.jsx(Of,{path:"/login",element:st.jsx(MF,{})}),st.jsx(Of,{path:"/main",element:st.jsx(t8,{})})]})})}iD.createRoot(document.getElementById("root")).render(st.jsx(e8,{}));
